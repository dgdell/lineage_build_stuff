From d055ef0d2efaaed816dde045000bc324d47d2867 Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Mon, 27 Aug 2018 21:01:56 +0800
Subject: [PATCH 20/20] vold: fix exfat driver support

Change-Id: Ia4750f5672de6d7643ad0fbb265bd764a3be909b
---
 Android.bp   | 6 ++++--
 Utils.cpp    | 2 +-
 fs/Exfat.cpp | 6 ------
 3 files changed, 5 insertions(+), 9 deletions(-)

diff --git a/Android.bp b/Android.bp
index 6d0be05..aa05c9b 100644
--- a/Android.bp
+++ b/Android.bp
@@ -140,8 +140,10 @@ cc_library_static {
                 "libarcobbvolume",
             ],
         },
-        target_exfat_driver : {
-            cflags: ["-DCONFIG_EXFAT_DRIVER=\"%s\""],
+        lineage: {
+            target_exfat_driver: {
+                 cflags: ["-DCONFIG_EXFAT_DRIVER=\"%s\""],
+            },
         },
     },
 }
diff --git a/Utils.cpp b/Utils.cpp
index f1a162d..a4b8646 100644
--- a/Utils.cpp
+++ b/Utils.cpp
@@ -566,7 +566,7 @@ bool IsFilesystemSupported(const std::string& fsType) {
 
 #ifdef CONFIG_EXFAT_DRIVER
     /* Add exfat if an exfat driver is present */
-    if (supported.find(CONFIG_EXFAT_DRIVER + "\n") != std::string::npos)
+    if (supported.find(std::string(CONFIG_EXFAT_DRIVER) + "\n") != std::string::npos)
         supported.append("nodev\texfat\n");
 #endif
 
diff --git a/fs/Exfat.cpp b/fs/Exfat.cpp
index 250906b..5e23a79 100644
--- a/fs/Exfat.cpp
+++ b/fs/Exfat.cpp
@@ -33,12 +33,6 @@ namespace exfat {
 static const char* kMkfsPath = "/system/bin/mkfs.exfat";
 static const char* kFsckPath = "/system/bin/fsck.exfat";
 
-#ifdef CONFIG_EXFAT_DRIVER
-static constexpr char* kExfatDriver = CONFIG_EXFAT_DRIVER;
-#else
-static constexpr char* kExfatDriver = "exfat";
-#endif
-
 bool IsSupported() {
     return access(kMkfsPath, X_OK) == 0 && access(kFsckPath, X_OK) == 0 &&
            (IsFilesystemSupported("exfat") || IsFilesystemSupported("sdfat"));
-- 
2.17.1

