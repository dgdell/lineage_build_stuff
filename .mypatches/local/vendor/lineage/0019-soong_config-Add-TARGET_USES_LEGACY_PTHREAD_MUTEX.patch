From eaa9513ce7e123ecb7e39ced5b99b39033b6c1ef Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Wed, 3 Oct 2018 21:27:30 +0800
Subject: [PATCH 19/19] soong_config: Add TARGET_USES_LEGACY_PTHREAD_MUTEX

allow use pre-P pthread mutex.

Change-Id: I377a23bbb63097e1ebd4fc85cecb6a0edd6f0211
---
 build/soong/android/variable.go | 4 ++++
 build/soong/soong_config.mk     | 1 +
 2 files changed, 5 insertions(+)

diff --git a/build/soong/android/variable.go b/build/soong/android/variable.go
index cf04bc7e..60acdeaf 100644
--- a/build/soong/android/variable.go
+++ b/build/soong/android/variable.go
@@ -39,6 +39,9 @@ type Product_variables struct {
 		Cppflags []string
 		Shared_libs []string
 	}
+	Uses_legacy_pthread_mutex struct {
+		Cppflags []string
+	}
 }
 
 type ProductVariables struct {
@@ -56,4 +59,5 @@ type ProductVariables struct {
 	Uses_nvidia_enhancements  *bool `json:",omitempty"`
 	Uses_qcom_bsp_legacy  *bool `json:",omitempty"`
 	Uses_qti_camera_device  *bool `json:",omitempty"`
+	Uses_legacy_pthread_mutex  *bool `json:",omitempty"`
 }
diff --git a/build/soong/soong_config.mk b/build/soong/soong_config.mk
index ae518cca..33edbf9e 100644
--- a/build/soong/soong_config.mk
+++ b/build/soong/soong_config.mk
@@ -17,6 +17,7 @@ $(call add_json_bool, Uses_generic_camera_parameter_library, $(if $(TARGET_SPECI
 $(call add_json_bool, Uses_nvidia_enhancements, $(filter TRUE,$(NV_ANDROID_FRAMEWORK_ENHANCEMENTS)))
 $(call add_json_bool, Uses_qcom_bsp_legacy, $(filter true,$(TARGET_USES_QCOM_BSP_LEGACY)))
 $(call add_json_bool, Uses_qti_camera_device, $(filter true,$(TARGET_USES_QTI_CAMERA_DEVICE)))
+$(call add_json_bool, Uses_legacy_pthread_mutex, $(filter true,$(TARGET_USES_LEGACY_PTHREAD_MUTEX)))
 
 # This causes the build system to strip out the last comma in our nested struct, to keep the JSON valid.
 _contents := $(_contents)__SV_END
-- 
2.17.1

