From fbf34e85b3f15c54d9a5742124426b2bc941947e Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Wed, 4 Jul 2018 16:50:55 +0800
Subject: [PATCH 31/31] appops: fix resetCounters crash.

Change-Id: I983f50d3af090b3cbcb7c75e1dfa85fd85a64b2e
---
 services/core/java/com/android/server/AppOpsService.java | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/services/core/java/com/android/server/AppOpsService.java b/services/core/java/com/android/server/AppOpsService.java
index 2a7c9d66a7c..665e9c04777 100644
--- a/services/core/java/com/android/server/AppOpsService.java
+++ b/services/core/java/com/android/server/AppOpsService.java
@@ -3120,11 +3120,14 @@ public class AppOpsService extends IAppOpsService.Stub {
         synchronized (this) {
             for (int i = 0; i < mUidStates.size(); i++) {
                 final UidState uidState = mUidStates.valueAt(i);
+                if(uidState.pkgOps == null)continue;
                 for (Map.Entry<String, Ops> ent : uidState.pkgOps.entrySet()) {
+                    if(ent == null)continue;
                     String packageName = ent.getKey();
                     Ops pkgOps = ent.getValue();
                     for (int j = 0; j < pkgOps.size(); j++) {
                         Op curOp = pkgOps.valueAt(j);
+                        if(curOp == null)continue;
                         curOp.allowedCount = 0;
                         curOp.ignoredCount = 0;
                     }
-- 
2.17.1

