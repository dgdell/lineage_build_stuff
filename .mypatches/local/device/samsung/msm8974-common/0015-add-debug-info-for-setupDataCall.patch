From 64c1775caa1155832f29ba604beed6f94bc9dcde Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Sat, 6 Oct 2018 17:24:43 +0800
Subject: [PATCH 15/15] add debug info for setupDataCall

Change-Id: Ifef2c61213ad9aab4c4ddbc2d18b882d31fbd7e4
---
 ril/libril/ril_service.cpp | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/ril/libril/ril_service.cpp b/ril/libril/ril_service.cpp
index 362712b..a979e49 100644
--- a/ril/libril/ril_service.cpp
+++ b/ril/libril/ril_service.cpp
@@ -1149,6 +1149,7 @@ Return<void> RadioImpl::setupDataCall(int32_t serial, RadioTechnology radioTechn
     if (s_vendorFunctions->version >= 4 && s_vendorFunctions->version <= 14) {
         const hidl_string &protocol =
                 (isRoaming ? dataProfileInfo.roamingProtocol : dataProfileInfo.protocol);
+        RLOGD("%s: version=%d radioTechnology=%d", __FUNCTION__, s_vendorFunctions->version, (int) radioTechnology);
         dispatchStrings(serial, mSlotId, RIL_REQUEST_SETUP_DATA_CALL, true, 7,
             std::to_string((int) radioTechnology + 2).c_str(),
             std::to_string((int) dataProfileInfo.profileId).c_str(),
@@ -1159,6 +1160,7 @@ Return<void> RadioImpl::setupDataCall(int32_t serial, RadioTechnology radioTechn
             protocol.c_str());
     } else if (s_vendorFunctions->version >= 15) {
         char *mvnoTypeStr = NULL;
+        RLOGD("%s: version=%d radioTechnology=%d", __FUNCTION__, s_vendorFunctions->version, (int) radioTechnology);
         if (!convertMvnoTypeToString(dataProfileInfo.mvnoType, mvnoTypeStr)) {
             RequestInfo *pRI = android::addRequestToList(serial, mSlotId,
                     RIL_REQUEST_SETUP_DATA_CALL);
@@ -4102,6 +4104,7 @@ int radio::setupDataCallResponse(int slotId,
         if (response == NULL || (responseLen % sizeof(RIL_Data_Call_Response_v11) != 0
                 && responseLen % sizeof(RIL_Data_Call_Response_v9) != 0
                 && responseLen % sizeof(RIL_Data_Call_Response_v6) != 0)) {
+            RLOGD("%s: not v6/v9/v11", __FUNCTION__);
             if (response != NULL) {
                 RLOGE("setupDataCallResponse: Invalid response (responseLen=%d, sizeof(RIL_Data_Call_Response_v11=%d)",responseLen, sizeof(RIL_Data_Call_Response_v11));
                 if (e == RIL_E_SUCCESS) responseInfo.error = RadioError::INVALID_RESPONSE;
@@ -4114,13 +4117,17 @@ int radio::setupDataCallResponse(int slotId,
             result.gateways = hidl_string();
             result.pcscf = hidl_string();
         } else if ((responseLen % sizeof(RIL_Data_Call_Response_v11)) == 0) {
+            RLOGD("%s: v11", __FUNCTION__);
             convertRilDataCallToHal((RIL_Data_Call_Response_v11 *) response, result);
         } else if ((responseLen % sizeof(RIL_Data_Call_Response_v9)) == 0) {
+            RLOGD("%s: v9", __FUNCTION__);
             convertRilDataCallToHal((RIL_Data_Call_Response_v9 *) response, result);
         } else if ((responseLen % sizeof(RIL_Data_Call_Response_v6)) == 0) {
-            convertRilDataCallToHal((RIL_Data_Call_Response_v6 *) response, result);
+           RLOGD("%s: v6", __FUNCTION__);
+           convertRilDataCallToHal((RIL_Data_Call_Response_v6 *) response, result);
         }
 
+        RLOGD("%s: status=%d type=%s ifname=%s, addresses=%s, dnses=%s, gateways=%s, pcscf=%s", __FUNCTION__, result.status, result.type.c_str(), result.ifname.c_str(), result.addresses.c_str(), result.dnses.c_str(), result.gateways.c_str(), result.pcscf.c_str());
         Return<void> retStatus = radioService[slotId]->mRadioResponse->setupDataCallResponse(
                 responseInfo, result);
         radioService[slotId]->checkReturnStatus(retStatus);
-- 
2.17.1

