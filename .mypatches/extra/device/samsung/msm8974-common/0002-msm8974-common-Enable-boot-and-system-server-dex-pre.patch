From d6c24dca5f0f63456382c34edcbd04ae0da3f7d6 Mon Sep 17 00:00:00 2001
From: Artem Borisov <dedsa2002@gmail.com>
Date: Sat, 30 Dec 2017 16:03:20 +0300
Subject: [PATCH 2/2] msm8974-common: Enable boot and system server dex-preopt

As stated in https://android.googlesource.com/platform/build/+/418258c
this is required in O-MR1 since sepolicy now prevents system server from
loading anything from /data making our system extremely slow and janky.

Change-Id: I215ec7ebe95981ef0b953fe938e12b83675795ab
---
 BoardConfigCommon.mk | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/BoardConfigCommon.mk b/BoardConfigCommon.mk
index 5ab6484..a530e2c 100644
--- a/BoardConfigCommon.mk
+++ b/BoardConfigCommon.mk
@@ -34,6 +34,16 @@ BOARD_BATTERY_DEVICE_NAME := "battery"
 BOARD_CHARGING_CMDLINE_NAME := "androidboot.bootchg"
 BOARD_CHARGING_CMDLINE_VALUE := "true"
 
+# Dexpreopt
+ifeq ($(HOST_OS),linux)
+  ifneq ($(TARGET_BUILD_VARIANT),eng)
+    ifeq ($(WITH_DEXPREOPT),)
+      WITH_DEXPREOPT := true
+      WITH_DEXPREOPT_BOOT_IMG_AND_SYSTEM_SERVER_ONLY := true
+    endif
+  endif
+endif
+
 # Display
 NUM_FRAMEBUFFER_SURFACE_BUFFERS := 3
 OVERRIDE_RS_DRIVER:= libRSDriver_adreno.so
-- 
2.7.4

