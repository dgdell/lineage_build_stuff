From 26fe566a354930b5e6ad6300f4634cd3943a3821 Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Tue, 25 Oct 2016 23:26:12 +0200
Subject: [PATCH 1/3] Add rules required for TARGET_HAS_LEGACY_CAMERA_HAL1

Change-Id: Ica4926fa3acf88b95c687f25eec4dbc68ea41fbb
---
 Android.mk            | 1 +
 public/mediaserver.te | 6 ++++++
 2 files changed, 7 insertions(+)

diff --git a/Android.mk b/Android.mk
index 652209e..bd714df 100644
--- a/Android.mk
+++ b/Android.mk
@@ -421,6 +421,7 @@ $(PLAT_PUBLIC_POLICY) $(REQD_MASK_POLICY) $(PLAT_VENDOR_POLICY) $(BOARD_SEPOLICY
 		-D target_arch=$(PRIVATE_TGT_ARCH) \
 		-D target_with_asan=$(PRIVATE_TGT_WITH_ASAN) \
 		-D target_full_treble=$(PRODUCT_FULL_TREBLE) \
+		-D target_has_legacy_camera_hal1=$(TARGET_HAS_LEGACY_CAMERA_HAL1) \
 		-D target_needs_platform_text_relocations=$(TARGET_NEEDS_PLATFORM_TEXT_RELOCATIONS) \
 		-D target_uses_legacy_adb_interface=$(TARGET_USES_LEGACY_ADB_INTERFACE) \
 		-s $^ > $@
diff --git a/public/mediaserver.te b/public/mediaserver.te
index 6efaf0f..cea3d86 100644
--- a/public/mediaserver.te
+++ b/public/mediaserver.te
@@ -98,6 +98,12 @@ allow mediaserver mediadrmserver_service:service_manager find;
 # For interfacing with OMX HAL
 allow mediaserver hidl_token_hwservice:hwservice_manager find;
 
+ifelse(target_has_legacy_camera_hal1, `true',
+  allow mediaserver cameraproxy_service:service_manager find;
+  allow mediaserver cameraserver_service:service_manager add;
+,
+)
+
 # /oem access
 allow mediaserver oemfs:dir search;
 allow mediaserver oemfs:file r_file_perms;
-- 
2.7.4

