From 54cabbd43840e798ae15c3166d1495a36dff2668 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Wed, 20 Dec 2017 22:07:16 +0200
Subject: [PATCH 2/5] cryptfs_hw: Featureize support for waiting on QSEE to
 start

* Match keymaster change to support older blobs

Change-Id: I2d45fe60e0f4bf076d064d6c432740af0b3c840c
---
 Android.bp   | 3 +++
 cryptfs_hw.c | 7 +++++++
 2 files changed, 10 insertions(+)

diff --git a/Android.bp b/Android.bp
index ad5b0eb..42e9ed8 100644
--- a/Android.bp
+++ b/Android.bp
@@ -21,6 +21,9 @@ cc_library_shared {
             device_support_legacy_hwfde: {
                 cflags: ["-DLEGACY_HW_DISK_ENCRYPTION"],
             },
+            device_support_wait_for_qsee: {
+                cflags: ["-DWAIT_FOR_QSEE"],
+            },
         },
     },
 
diff --git a/cryptfs_hw.c b/cryptfs_hw.c
index e231759..6a3a5b1 100644
--- a/cryptfs_hw.c
+++ b/cryptfs_hw.c
@@ -373,6 +373,7 @@ static unsigned char* get_tmp_passwd(const char* passwd)
     return tmp_passwd;
 }
 
+#ifdef WAIT_FOR_QSEE
 int is_qseecom_up()
 {
     int i = 0;
@@ -390,6 +391,12 @@ int is_qseecom_up()
     }
     return 0;
 }
+#else
+int is_qseecom_up()
+{
+    return 1;
+}
+#endif
 
 /*
  * For NON-ICE targets, it would return 0 on success. On ICE based targets,
-- 
2.17.1

