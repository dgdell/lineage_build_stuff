From 68cadecb9877009f8d9e1e12d7300dfd3c70ba53 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Mon, 2 Apr 2018 19:54:45 +0300
Subject: [PATCH 3/6] envsetup: Fix lineageremote for caf projects

Change-Id: I9d98cef27deea805904f4500c4bc02905da885f4
---
 build/envsetup.sh | 25 ++++++++++++++++++++-----
 1 file changed, 20 insertions(+), 5 deletions(-)

diff --git a/build/envsetup.sh b/build/envsetup.sh
index ff516eea..61181566 100644
--- a/build/envsetup.sh
+++ b/build/envsetup.sh
@@ -264,18 +264,33 @@ function lineageremote()
         return 1
     fi
     git remote rm lineage 2> /dev/null
-    local GERRIT_REMOTE=$(git config --get remote.github.projectname)
-    if [ -z "$GERRIT_REMOTE" ]
+    local REMOTE=$(git config --get remote.github.projectname)
+    local LINEAGE="true"
+    if [ -z "$REMOTE" ]
     then
-        local GERRIT_REMOTE=$(git config --get remote.aosp.projectname | sed s#platform/#android/#g | sed s#/#_#g)
+        REMOTE=$(git config --get remote.aosp.projectname)
+        LINEAGE="false"
+    fi
+    if [ -z "$REMOTE" ]
+    then
+        REMOTE=$(git config --get remote.caf.projectname)
+        LINEAGE="false"
+    fi
+
+    if [ $LINEAGE = "false" ]
+    then
+        local PROJECT=$(echo $REMOTE | sed -e "s#platform/#android/#g; s#/#_#g")
         local PFX="LineageOS/"
+    else
+        local PROJECT=$REMOTE
     fi
+
     local LINEAGE_USER=$(git config --get review.review.lineageos.org.username)
     if [ -z "$LINEAGE_USER" ]
     then
-        git remote add lineage ssh://review.lineageos.org:29418/$PFX$GERRIT_REMOTE
+        git remote add lineage ssh://review.lineageos.org:29418/$PFX$PROJECT
     else
-        git remote add lineage ssh://$LINEAGE_USER@review.lineageos.org:29418/$PFX$GERRIT_REMOTE
+        git remote add lineage ssh://$LINEAGE_USER@review.lineageos.org:29418/$PFX$PROJECT
     fi
     echo "Remote 'lineage' created"
 }
-- 
2.15.1

