From 3e36f9bfd9c456805023adfae868d96c109330fd Mon Sep 17 00:00:00 2001
From: dianlujitao <dianlujitao@lineageos.org>
Date: Mon, 6 Aug 2018 15:30:55 +0800
Subject: [PATCH 22/22] soong_config: Add NO_SECURE_DISCARD flag

Change-Id: I44e374361bf689942e721fbc247e06d74a056ba0
---
 build/soong/android/variable.go | 4 ++++
 build/soong/soong_config.mk     | 1 +
 2 files changed, 5 insertions(+)

diff --git a/build/soong/android/variable.go b/build/soong/android/variable.go
index c2bb782a..516dafc2 100644
--- a/build/soong/android/variable.go
+++ b/build/soong/android/variable.go
@@ -22,6 +22,9 @@ type Product_variables struct {
 		Cppflags []string
 		Shared_libs []string
 	}
+	No_secure_discard struct {
+		Cflags []string
+	}
 }
 
 type ProductVariables struct {
@@ -33,4 +36,5 @@ type ProductVariables struct {
 	Uses_nvidia_enhancements  *bool `json:",omitempty"`
 	Uses_qcom_bsp_legacy  *bool `json:",omitempty"`
 	Uses_qti_camera_device  *bool `json:",omitempty"`
+	No_secure_discard  *bool `json:",omitempty"`
 }
diff --git a/build/soong/soong_config.mk b/build/soong/soong_config.mk
index fdc0869a..040df4af 100644
--- a/build/soong/soong_config.mk
+++ b/build/soong/soong_config.mk
@@ -6,6 +6,7 @@ lineage_soong:
 	echo '"Lineage": {'; \
 	echo '    "Has_legacy_camera_hal1": $(if $(filter true,$(TARGET_HAS_LEGACY_CAMERA_HAL1)),true,false),'; \
 	echo '    "Needs_text_relocations": $(if $(filter true,$(TARGET_NEEDS_PLATFORM_TEXT_RELOCATIONS)),true,false),'; \
+	echo '    "No_secure_discard": $(if $(filter true,$(BOARD_NO_SECURE_DISCARD)),true,false),'; \
 	echo '    "Specific_camera_parameter_library": "$(TARGET_SPECIFIC_CAMERA_PARAMETER_LIBRARY)",'; \
 	echo '    "Target_shim_libs": "$(subst $(space),:,$(TARGET_LD_SHIM_LIBS))",'; \
 	echo '    "Uses_generic_camera_parameter_library": $(if $(TARGET_SPECIFIC_CAMERA_PARAMETER_LIBRARY),false,true),'; \
-- 
2.17.1

