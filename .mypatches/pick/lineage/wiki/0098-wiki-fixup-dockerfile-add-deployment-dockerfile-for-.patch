From a45d9220949686e8e06e8c9ea94040c8b29ab39b Mon Sep 17 00:00:00 2001
From: Tom Powell <tom@powell.io>
Date: Sun, 11 Feb 2018 20:51:38 -0800
Subject: [PATCH 098/249] wiki: fixup dockerfile, add deployment dockerfile for
 use with quay

Change-Id: I5183b54d511bc67095dbd224bb97f5b9d1946625
---
 Dockerfile                      | 2 +-
 Dockerfile.deploy               | 9 +++++++++
 pages/meta/contributing_wiki.md | 4 +---
 3 files changed, 11 insertions(+), 4 deletions(-)
 create mode 100644 Dockerfile.deploy

diff --git a/Dockerfile b/Dockerfile
index 6795703..1d8d71f 100644
--- a/Dockerfile
+++ b/Dockerfile
@@ -8,4 +8,4 @@ RUN bundle install
 
 VOLUME /src
 EXPOSE 4000
-ENTRYPOINT [ "bundle", "exec", "jekyll", "serve", "--host", "0.0.0.0" ]
+ENTRYPOINT bundle exec ruby test/validate.rb && bundle exec jekyll serve --host 0.0.0.0 --incremental
diff --git a/Dockerfile.deploy b/Dockerfile.deploy
new file mode 100644
index 0000000..b4b0d54
--- /dev/null
+++ b/Dockerfile.deploy
@@ -0,0 +1,9 @@
+FROM ruby:2.4 as builder
+COPY . /src
+WORKDIR /src
+RUN gem install bundler
+RUN bundle install
+RUN bundle exec jekyll build
+
+FROM nginx:latest
+COPY --from=builder /src/_site/ /usr/share/nginx/html/
diff --git a/pages/meta/contributing_wiki.md b/pages/meta/contributing_wiki.md
index d67c36d..4c72ece 100644
--- a/pages/meta/contributing_wiki.md
+++ b/pages/meta/contributing_wiki.md
@@ -149,13 +149,11 @@ Each time that you want to edit the wiki, you will need to start a local web ser
 
 ```
 cd $LINEAGE_SRC/lineage/wiki
-docker run -p 4000:4000 -v $(pwd):/src lineageos/wiki --incremental
+docker run -p 4000:4000 -v $(pwd):/src -it lineageos/wiki
 ```
 
 At this point you should be able to view the [local Jekyll server](http://127.0.0.1:4000).
 
-{% include tip.html content="The incremental flag will cause Jekyll to only reprocess each page as you change it (without the incremental flag, it would reprocess the entire site which takes 10-30+ seconds depending on your hardware). This works very well when editing meta pages but is a little annoying when editing the data/device/name.yml files. When editing those files you will need to save the data and then touch the `.md` file of the page that you are viewing in the browser. An easy way to do that is: `touch pages/*/<devicename>*`." %}
-
 ### Preview locally using rvm and jekyll
 
 #### Install `rvm`
-- 
2.17.1

