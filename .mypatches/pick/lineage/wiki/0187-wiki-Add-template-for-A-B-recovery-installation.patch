From cc6b865203752f4965f09003de0678c8479efc94 Mon Sep 17 00:00:00 2001
From: TheScarastic <warabhishek@gmail.com>
Date: Wed, 16 May 2018 17:32:00 +0530
Subject: [PATCH 187/249] wiki: Add template for A/B recovery installation

Change-Id: I50c218023632ae3e8c6460cc9c87d7ed23dcb88b
---
 .../templates/recovery_install_fastboot_ab.md | 33 +++++++++++++++++++
 .../recovery_install_fastboot_nexus.md        |  4 +++
 pages/internal/adding_device.md               |  1 +
 3 files changed, 38 insertions(+)
 create mode 100644 _includes/templates/recovery_install_fastboot_ab.md

diff --git a/_includes/templates/recovery_install_fastboot_ab.md b/_includes/templates/recovery_install_fastboot_ab.md
new file mode 100644
index 0000000..6cc7d75
--- /dev/null
+++ b/_includes/templates/recovery_install_fastboot_ab.md
@@ -0,0 +1,33 @@
+{% if site.data.devices[page.device].custom_twrp_codename %}
+{% assign twrp_codename = site.data.devices[page.device].custom_twrp_codename %}
+{% else %}
+{% assign twrp_codename = site.data.devices[page.device].codename %}
+{% endif %}
+
+## Temporarily installing a custom recovery using `fastboot`
+
+{% if site.data.devices[page.device].custom_twrp_link %}
+1. Download a custom recovery - you can download [TWRP]({{ site.data.devices[page.device].custom_twrp_link }}).
+{% else %}
+1. Download a custom recovery - you can download [TWRP](https://dl.twrp.me/{{ twrp_codename }}). Simply download the latest recovery file, named something like `twrp-x.x.x-x-{{ twrp_codename }}.img`.
+{% endif %}
+2. Connect your device to your PC via USB.
+3. On the computer, open a command prompt (on Windows) or terminal (on Linux or macOS) window, and type:
+```
+adb reboot bootloader
+```
+    {% if site.data.devices[page.device].download_boot %}
+    You can also boot into fastboot mode via a key combination:
+
+    * {{ site.data.devices[page.device].download_boot }}
+    {% endif %}
+4. Once the device is in fastboot mode, verify your PC finds it by typing:
+```
+fastboot devices
+```
+    {% include tip.html content="If you see `no permissions fastboot` while on Linux or macOS, try running `fastboot` as root." %}
+5. Temporarily flash recovery onto your device and boot it once by typing:
+```
+fastboot boot twrp-x.x.x-x-{{ twrp_codename }}.img
+```
+    {% include tip.html content="The file may not be named identically to what stands in this command, so adjust accordingly." %}
diff --git a/_includes/templates/recovery_install_fastboot_nexus.md b/_includes/templates/recovery_install_fastboot_nexus.md
index 0962e17..20229eb 100644
--- a/_includes/templates/recovery_install_fastboot_nexus.md
+++ b/_includes/templates/recovery_install_fastboot_nexus.md
@@ -37,4 +37,8 @@ fastboot oem unlock
 6. If the device doesn't automatically reboot, reboot it. It should now be unlocked.
 7. Since the device resets completely, you will need to re-enable USB debugging to continue.
 
+{% if device.is_ab_device %}
+{% include templates/recovery_install_fastboot_ab.md %}
+{% else %}
 {% include templates/recovery_install_fastboot_generic.md %}
+{% endif %}
diff --git a/pages/internal/adding_device.md b/pages/internal/adding_device.md
index 826d74f..b63ab12 100644
--- a/pages/internal/adding_device.md
+++ b/pages/internal/adding_device.md
@@ -111,6 +111,7 @@ Additionally there are some optional properties which you might not need, but in
 * `custom_twrp_link`: A custom TWRP link in case the official recovery doesn't exist for the specific device or doesn't work properly. Remove this if not used!
 * `custom_twrp_codename`: If an official TWRP exists for the device, but TWRP uses a different codename, specify the used one here. Remove this if not used!
 * `custom_unlock_cmd`: Used if the command to unlock your device via fastboot is different than `fastboot oem unlock`. Remove this if not used!
+* `is_ab_device`: Used if device supports A/B partitions to flash custom recovery. Remove this if not used!
 * `required_bootloader`: Specify the bootloader versions which are required to install LineageOS. If no special requirement exists, remove this line! Example:
 
   ```
-- 
2.17.1

