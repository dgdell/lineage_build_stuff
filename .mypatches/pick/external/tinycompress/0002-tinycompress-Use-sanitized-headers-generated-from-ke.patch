From d34f9ef8401ebbc76c7e8be8328eb5733926c33c Mon Sep 17 00:00:00 2001
From: Roopesh Rajashekharaiah Nataraja <roopeshr@codeaurora.org>
Date: Tue, 30 Jan 2018 11:00:00 -0800
Subject: [PATCH 2/4] tinycompress: Use sanitized headers generated from kernel
 source

Change-Id: Ie22c0075283169d15130f2b917ffd8604168c4ec
---
 Android.mk               | 41 ++++++++++++++++++++++++++++++++++++++++
 Android.bp => Android_bp |  0
 CleanSpec.mk             |  4 +++-
 3 files changed, 44 insertions(+), 1 deletion(-)
 create mode 100644 Android.mk
 rename Android.bp => Android_bp (100%)

diff --git a/Android.mk b/Android.mk
new file mode 100644
index 0000000..57e31f1
--- /dev/null
+++ b/Android.mk
@@ -0,0 +1,41 @@
+LOCAL_PATH := $(call my-dir)
+
+include $(CLEAR_VARS)
+LOCAL_CFLAGS := -Wno-macro-redefined -Wno-unused-function
+LOCAL_C_INCLUDES := $(LOCAL_PATH)/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/techpack/audio/include
+LOCAL_ADDITIONAL_DEPENDENCIES := $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_SRC_FILES := compress.c utils.c
+LOCAL_MODULE := libtinycompress
+LOCAL_SHARED_LIBRARIES := libcutils libutils
+LOCAL_MODULE_TAGS := optional
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_SHARED_LIBRARY)
+
+include $(CLEAR_VARS)
+LOCAL_CFLAGS := -Wno-macro-redefined -Wno-unused-function
+LOCAL_C_INCLUDES := $(LOCAL_PATH)/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/techpack/audio/include
+LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_SRC_FILES := cplay.c
+LOCAL_MODULE := cplay
+LOCAL_VENDOR_MODULE := true
+LOCAL_SHARED_LIBRARIES := libcutils libutils libtinycompress
+LOCAL_MODULE_TAGS := optional
+include $(BUILD_EXECUTABLE)
+
+include $(CLEAR_VARS)
+LOCAL_CFLAGS := -Wno-macro-redefined -Wno-unused-function
+LOCAL_C_INCLUDES := $(LOCAL_PATH)/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
+LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/techpack/audio/include
+LOCAL_ADDITIONAL_DEPENDENCIES := $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_SRC_FILES := compress.c utils.c
+LOCAL_CFLAGS += -DUSE_VENDOR_EXTN
+LOCAL_MODULE := libtinycompress_vendor
+LOCAL_SHARED_LIBRARIES := libcutils libutils
+LOCAL_MODULE_TAGS := optional
+LOCAL_VENDOR_MODULE := true
+include $(BUILD_SHARED_LIBRARY)
diff --git a/Android.bp b/Android_bp
similarity index 100%
rename from Android.bp
rename to Android_bp
diff --git a/CleanSpec.mk b/CleanSpec.mk
index f7dec23..9eab8b3 100644
--- a/CleanSpec.mk
+++ b/CleanSpec.mk
@@ -44,7 +44,9 @@
 #$(call add-clean-step, find $(OUT_DIR) -type f -name "IGTalkSession*" -print0 | xargs -0 rm -f)
 #$(call add-clean-step, rm -rf $(PRODUCT_OUT)/data/*)
 
-$(call add-clean-step, rm -rf $(PRODUCT_OUT)/system/bin/cplay)
+$(call add-clean-step, rm -rf $(PRODUCT_OUT)/vendor/bin/cplay)
+$(call add-clean-step, rm -rf $(PRODUCT_OUT)/vendor/lib64/libtinycompress.so)
+$(call add-clean-step, rm -rf $(PRODUCT_OUT)/vendor/lib/libtinycompress.so)
 
 # ************************************************
 # NEWER CLEAN STEPS MUST BE AT THE END OF THE LIST
-- 
2.17.1

