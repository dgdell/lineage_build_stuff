From 731b92ef34e190b19c4186855afbc887166f4ad7 Mon Sep 17 00:00:00 2001
From: Rashed Abdel-Tawab <rashed@linux.com>
Date: Sun, 12 Aug 2018 19:04:14 -0700
Subject: [PATCH 1/2] openssh: Update for pie boringssl

Change-Id: Ifca7510d78916cec389badbd4aa40987b2b62537
---
 config.h                      | 4 ++--
 openbsd-compat/bcrypt_pbkdf.c | 2 +-
 sshkey.c                      | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/config.h b/config.h
index d20f94dc..b8933e9b 100644
--- a/config.h
+++ b/config.h
@@ -129,8 +129,8 @@
 /* File names may not contain backslash characters */
 /* #undef FILESYSTEM_NO_BACKSLASH */
 
-#define OPENSSL_NO_BF 1
-#define OPENSSL_NO_CAST 1
+//#define OPENSSL_NO_BF 1
+//#define OPENSSL_NO_CAST 1
 
 /* fsid_t has member val */
 /* #undef FSID_HAS_VAL */
diff --git a/openbsd-compat/bcrypt_pbkdf.c b/openbsd-compat/bcrypt_pbkdf.c
index 78523456..8fd49a2b 100644
--- a/openbsd-compat/bcrypt_pbkdf.c
+++ b/openbsd-compat/bcrypt_pbkdf.c
@@ -134,7 +134,7 @@ bcrypt_pbkdf(const char *pass, size_t passlen, const u_int8_t *salt, size_t salt
 	memcpy(countsalt, salt, saltlen);
 
 	/* collapse password */
-	crypto_hash_sha512(sha2pass, pass, passlen);
+	crypto_hash_sha512(sha2pass, (const unsigned char *)pass, passlen);
 
 	/* generate key, sizeof(out) at a time */
 	for (count = 1; keylen > 0; count++) {
diff --git a/sshkey.c b/sshkey.c
index f544ab5d..484793de 100644
--- a/sshkey.c
+++ b/sshkey.c
@@ -3706,7 +3706,7 @@ sshkey_private_pem_to_blob(struct sshkey *key, struct sshbuf *blob,
 		r = SSH_ERR_LIBCRYPTO_ERROR;
 		goto out;
 	}
-	if ((blen = BIO_get_mem_data(bio, &bptr)) <= 0) {
+	if ((blen = BIO_get_mem_data(bio, (char **)&bptr)) <= 0) {
 		r = SSH_ERR_INTERNAL_ERROR;
 		goto out;
 	}
-- 
2.17.1

