From ab3a79f75d18af11676ca2ec3e1176669a4c372f Mon Sep 17 00:00:00 2001
From: Jesse Chan <jc@lineageos.org>
Date: Fri, 13 Apr 2018 18:30:40 -0700
Subject: [PATCH 09/11] SystemUI: add navbar button layout inversion tuning

Change-Id: Id6a76c635b3d3927a2ffd8e0c2d912473d7dcde3
Signed-off-by: Jesse Chan <jc@lineageos.org>
---
 packages/SystemUI/res/values/strings.xml             |  3 +++
 packages/SystemUI/res/xml/nav_bar_tuner.xml          |  4 ++++
 .../statusbar/phone/NavigationBarInflaterView.java   | 12 +++++++++++-
 3 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/packages/SystemUI/res/values/strings.xml b/packages/SystemUI/res/values/strings.xml
index 7ccb6b0db12..8e737bdd597 100644
--- a/packages/SystemUI/res/values/strings.xml
+++ b/packages/SystemUI/res/values/strings.xml
@@ -1682,6 +1682,9 @@
     <!-- SysUI Tuner: Button that controls layout of navigation bar [CHAR LIMIT=60] -->
     <string name="nav_bar_layout">Layout</string>
 
+    <!-- SysUI Tuner: Button that controls inversion of layout of navigation bar [CHAR LIMIT=60] -->
+    <string name="nav_bar_layout_inverse">Inverse button layout</string>
+
     <!-- SysUI Tuner: Setting for button type in nav bar [CHAR LIMIT=60] -->
     <string name="left_nav_bar_button_type">Extra left button type</string>
 
diff --git a/packages/SystemUI/res/xml/nav_bar_tuner.xml b/packages/SystemUI/res/xml/nav_bar_tuner.xml
index 68e8fad1e24..eea4892e2df 100644
--- a/packages/SystemUI/res/xml/nav_bar_tuner.xml
+++ b/packages/SystemUI/res/xml/nav_bar_tuner.xml
@@ -26,6 +26,10 @@
         android:entries="@array/nav_bar_layouts"
         android:entryValues="@array/nav_bar_layouts_values" />
 
+    <com.android.systemui.tuner.TunerSwitch
+        android:key="sysui_nav_bar_inverse"
+        android:title="@string/nav_bar_layout_inverse" />
+
     <com.android.systemui.tuner.RadioListPreference
         android:key="type_left"
         android:title="@string/left_nav_bar_button_type"
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
index 69c3d2ae096..cfe6d5e3d3a 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
@@ -56,6 +56,7 @@ public class NavigationBarInflaterView extends FrameLayout
     public static final String NAV_BAR_VIEWS = "sysui_nav_bar";
     public static final String NAV_BAR_LEFT = "sysui_nav_bar_left";
     public static final String NAV_BAR_RIGHT = "sysui_nav_bar_right";
+    public static final String NAV_BAR_INVERSE = "sysui_nav_bar_inverse";
 
     public static final String MENU_IME = "menu_ime";
     public static final String BACK = "back";
@@ -96,6 +97,8 @@ public class NavigationBarInflaterView extends FrameLayout
 
     private boolean mAlternativeOrder;
 
+    private boolean mInverseLayout;
+
     public NavigationBarInflaterView(Context context, AttributeSet attrs) {
         super(context, attrs);
         createInflaters();
@@ -141,7 +144,7 @@ public class NavigationBarInflaterView extends FrameLayout
     protected void onAttachedToWindow() {
         super.onAttachedToWindow();
         Dependency.get(TunerService.class).addTunable(this, NAV_BAR_VIEWS, NAV_BAR_LEFT,
-                NAV_BAR_RIGHT);
+                NAV_BAR_RIGHT, NAV_BAR_INVERSE);
         Dependency.get(PluginManager.class).addPluginListener(this,
                 NavBarButtonProvider.class, true /* Allow multiple */);
     }
@@ -163,6 +166,10 @@ public class NavigationBarInflaterView extends FrameLayout
         } else if (NAV_BAR_LEFT.equals(key) || NAV_BAR_RIGHT.equals(key)) {
             clearViews();
             inflateLayout(mCurrentLayout);
+        } else if (NAV_BAR_INVERSE.equals(key)) {
+            mInverseLayout = newValue != null && Integer.parseInt(newValue) != 0;
+            clearViews();
+            inflateLayout(mCurrentLayout);
         }
     }
 
@@ -218,6 +225,9 @@ public class NavigationBarInflaterView extends FrameLayout
         if (newLayout == null) {
             newLayout = getDefaultLayout();
         }
+        if (mInverseLayout) {
+            newLayout = newLayout.replace("recent", "back").replaceFirst("back", "recent");
+        }
         String[] sets = newLayout.split(GRAVITY_SEPARATOR, 3);
         String[] start = sets[0].split(BUTTON_SEPARATOR);
         String[] center = sets[1].split(BUTTON_SEPARATOR);
-- 
2.17.0

