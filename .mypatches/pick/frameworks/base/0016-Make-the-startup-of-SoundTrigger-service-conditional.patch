From 66826e1310361efb90021b4e8ecb0763884bf8be Mon Sep 17 00:00:00 2001
From: c457 <android.c357@gmail.com>
Date: Thu, 23 Nov 2017 02:45:06 +0100
Subject: [PATCH 16/36] Make the startup of SoundTrigger service conditional

Change-Id: Iacdc689bfcaa12225ece48c38ae8d881d3ec3217
---
 services/java/com/android/server/SystemServer.java | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/services/java/com/android/server/SystemServer.java b/services/java/com/android/server/SystemServer.java
index 66a723ea8f0..2806c92cb8a 100644
--- a/services/java/com/android/server/SystemServer.java
+++ b/services/java/com/android/server/SystemServer.java
@@ -738,6 +738,8 @@ public final class SystemServer {
         boolean disableCameraService = SystemProperties.getBoolean("config.disable_cameraservice",
                 false);
         boolean enableLeftyService = SystemProperties.getBoolean("config.enable_lefty", false);
+        boolean disableSoundTrigger = SystemProperties.getBoolean("config.disable_soundtrigger",
+                false);
 
         boolean isEmulator = SystemProperties.get("ro.kernel.qemu").equals("1");
 
@@ -1318,9 +1320,11 @@ public final class SystemServer {
             mSystemServiceManager.startService(JobSchedulerService.class);
             traceEnd();
 
-            traceBeginAndSlog("StartSoundTrigger");
-            mSystemServiceManager.startService(SoundTriggerService.class);
-            traceEnd();
+            if (!disableSoundTrigger) {
+                traceBeginAndSlog("StartSoundTrigger");
+                mSystemServiceManager.startService(SoundTriggerService.class);
+                traceEnd();
+            }
 
             if (!disableNonCoreServices) {
                 if (!disableTrustManager) {
-- 
2.17.1

