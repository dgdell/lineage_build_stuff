From bbda63860dab5bffa8538ff2f03d8baefc804b72 Mon Sep 17 00:00:00 2001
From: Toha <tohenk@yahoo.com>
Date: Sat, 10 Mar 2018 09:18:29 +0700
Subject: [PATCH 04/10] TelephonyManager: Prevent NPE when registering phone
 state listener.

Change-Id: Iccb69da375ddd7950706707fa53d5a23e0e4d097
Signed-off-by: Toha <tohenk@yahoo.com>
---
 telephony/java/android/telephony/TelephonyManager.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/telephony/java/android/telephony/TelephonyManager.java b/telephony/java/android/telephony/TelephonyManager.java
index 5241408..95cf4ba 100644
--- a/telephony/java/android/telephony/TelephonyManager.java
+++ b/telephony/java/android/telephony/TelephonyManager.java
@@ -3541,7 +3541,7 @@ public class TelephonyManager {
      *               LISTEN_ flags.
      */
     public void listen(PhoneStateListener listener, int events) {
-        if (mContext == null) return;
+        if (mContext == null || listener == null) return;
         try {
             boolean notifyNow = (getITelephony() != null);
             // If the listener has not explicitly set the subId (for example, created with the
-- 
2.7.4

