From 54ed52f1cc0209b5a5e497d5cf15da5e200559c2 Mon Sep 17 00:00:00 2001
From: Kshitij Gupta <kshitijgm@gmail.com>
Date: Sun, 17 Dec 2017 22:22:03 +0000
Subject: [PATCH 21/21] overlays: Overlay Settings for Dark UI [1/2]

harryyoud: split overlay from fw/b

Change-Id: I87529559936fb22131718e29dfd1ad785ef9c845
Signed-off-by: Kshitij Gupta <kshitijgm@gmail.com>
---
 .../src/com/android/systemui/statusbar/phone/StatusBar.java      | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
index 86120c4..9c18800 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
@@ -3016,12 +3016,15 @@ public class StatusBar extends SystemUI implements DemoMode,
         OverlayInfo systemuiThemeInfo = null;
         OverlayInfo settingsThemeInfo = null;
         try {
-            themeInfo = mOverlayManager.getOverlayInfo("com.android.systemui.theme.dark",
+            systemuiThemeInfo = mOverlayManager.getOverlayInfo("com.android.systemui.theme.dark",
+                    mCurrentUserId);
+            settingsThemeInfo = mOverlayManager.getOverlayInfo("com.android.systemui.theme.dark",
                     mCurrentUserId);
         } catch (RemoteException e) {
             e.printStackTrace();
         }
-        return themeInfo != null && themeInfo.isEnabled();
+        return (systemuiThemeInfo != null && systemuiThemeInfo.isEnabled()) ||
+                (settingsThemeInfo != null && settingsThemeInfo.isEnabled());
     }
 
     @Nullable
@@ -4925,6 +4928,8 @@ public class StatusBar extends SystemUI implements DemoMode,
             try {
                 mOverlayManager.setEnabled("com.android.systemui.theme.dark",
                         useDarkTheme, mCurrentUserId);
+                mOverlayManager.setEnabled("com.android.settings.theme.dark",
+                        useDarkTheme, mCurrentUserId);
             } catch (RemoteException e) {
                 Log.w(TAG, "Can't change theme", e);
             }
-- 
2.7.4

