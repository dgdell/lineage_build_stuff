From 595d4a60497b640eea37a396fdde1d96836fb1c8 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mikeioannina@gmail.com>
Date: Tue, 14 Jul 2015 16:55:04 +0300
Subject: [PATCH 40/59] Fix mounting of non-FAT formatted SD cards (1/2)

Change-Id: I77fe9e09b523bcba68dd2409def68acb715ca33c
---
 core/java/android/os/storage/StorageVolume.java | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

diff --git a/core/java/android/os/storage/StorageVolume.java b/core/java/android/os/storage/StorageVolume.java
index fd5a22a9c55..f68d842161d 100644
--- a/core/java/android/os/storage/StorageVolume.java
+++ b/core/java/android/os/storage/StorageVolume.java
@@ -249,16 +249,21 @@ public final class StorageVolume implements Parcelable {
     }
 
     /**
-     * Parse and return volume UUID as FAT volume ID, or return -1 if unable to
+     * Parse and return volume UUID as volume ID, or return -1 if unable to
      * parse or UUID is unknown.
      * @hide
      */
-    public int getFatVolumeId() {
-        if (mFsUuid == null || mFsUuid.length() != 9) {
+    public int getVolumeId() {
+        String id = mFsUuid;
+        if (id == null) {
             return -1;
         }
+        id = id.replace("-", "");
+        if (id.length() > 8) {
+            id = id.substring(0, 8);
+        }
         try {
-            return (int) Long.parseLong(mFsUuid.replace("-", ""), 16);
+            return (int) Long.parseLong(id, 16);
         } catch (NumberFormatException e) {
             return -1;
         }
-- 
2.17.1

