From 3edc53f9806a3cec820a58d0de516a99dc10aaa2 Mon Sep 17 00:00:00 2001
From: Roman Birg <romanbirg@gmail.com>
Date: Tue, 11 Dec 2012 04:12:41 -0600
Subject: [PATCH 43/70] SystemUI: add left and right virtual buttons while
 typing

Adapt for cm-12.0.

[cyanogen] refactor for cm-14.0
[LuK1337] update for 8.1

Squashes the following commits:

    Fix side button visibility tracking.

    Previously one could e.g. get legacy menu button being visible in
    certain scenarios, like this one:
    - Open legacy app, e.g. CatLog
    - Invoke IME
    - Lock screen
    - Unlock screen
    - Result: Menu button visible in keyguard

    Change-Id: Ia796f73ec995ea1cc34d38f8aefdbccda7be7565

    SystemUI: fix up navigation cursor keyevent flags

    Volume cursor controls use slightly different flags to keep the cursor
    within the field. Match them in the SystemUI for consistent (and better)
    behavior.

    Change-Id: I56d597f111ec611b0ca24a10f30575401fa76d18
    Signed-off-by: Roman Birg <roman@cyngn.com>

    SystemUI: fix up initial cursor down flags on nav bar

    We were using the regular flags for the initial ACTION_DOWN event so the
    FLAG_KEEP_TOUCH_MODE was not being passed and allowed the cursor to jump
    out of bounds slightly.

    Change-Id: I5b4d2a5e5e0ce562985fcc3b7b6fac8b4abc49da
    Signed-off-by: Roman Birg <roman@cyngn.com>

    SystemUI: Fix navigation bar arrows visibility handling

    * Fixes issue where input events would be sent
      while dpad_group view was set to be invisible.

    Change-Id: Ie802e9c8157505a2ad706332f0b2fe715caf428c

Change-Id: Iea446443d33ff305765e47c86523b619676116ac
---
 .../res/drawable-hdpi/ic_sysbar_ime_left.png  | Bin 0 -> 1284 bytes
 .../res/drawable-hdpi/ic_sysbar_ime_right.png | Bin 0 -> 1307 bytes
 .../res/drawable-mdpi/ic_sysbar_ime_left.png  | Bin 0 -> 1213 bytes
 .../res/drawable-mdpi/ic_sysbar_ime_right.png | Bin 0 -> 1218 bytes
 .../res/drawable-xhdpi/ic_sysbar_ime_left.png | Bin 0 -> 1388 bytes
 .../drawable-xhdpi/ic_sysbar_ime_right.png    | Bin 0 -> 1383 bytes
 .../drawable-xxhdpi/ic_sysbar_ime_left.png    | Bin 0 -> 1632 bytes
 .../drawable-xxhdpi/ic_sysbar_ime_right.png   | Bin 0 -> 1770 bytes
 .../nav_buttons_dpad_group_rot90.xml          |  48 ++++++++++++++++++
 .../navigation_layout_rot90.xml               |   2 +
 .../res/layout/nav_buttons_dpad_group.xml     |  48 ++++++++++++++++++
 .../layout/nav_buttons_dpad_group_rot90.xml   |  48 ++++++++++++++++++
 .../SystemUI/res/layout/navigation_layout.xml |   2 +
 .../res/layout/navigation_layout_rot90.xml    |   2 +
 packages/SystemUI/res/values/cm_strings.xml   |   4 ++
 .../phone/NavigationBarInflaterView.java      |   4 +-
 .../statusbar/phone/NavigationBarView.java    |  35 ++++++++++++-
 .../statusbar/policy/KeyButtonView.java       |  24 +++++++--
 18 files changed, 212 insertions(+), 5 deletions(-)
 create mode 100644 packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_left.png
 create mode 100644 packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_right.png
 create mode 100644 packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_left.png
 create mode 100644 packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_right.png
 create mode 100644 packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_left.png
 create mode 100644 packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_right.png
 create mode 100644 packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_left.png
 create mode 100644 packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_right.png
 create mode 100644 packages/SystemUI/res/layout-sw600dp/nav_buttons_dpad_group_rot90.xml
 create mode 100644 packages/SystemUI/res/layout/nav_buttons_dpad_group.xml
 create mode 100644 packages/SystemUI/res/layout/nav_buttons_dpad_group_rot90.xml

diff --git a/packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_left.png b/packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_left.png
new file mode 100644
index 0000000000000000000000000000000000000000..ad9ae23f20de6969e839bd47395182762524b73c
GIT binary patch
literal 1284
zcmeAS@N?(olHy`uVBq!ia0vp^HXzKw1|+Ti+$;i8k|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ-L~|H8MjYN+NuHtdjF{^%6m9^eS=-fVzQ(*;f=KCTFLXC?ut(
zXXe=|z2CiGNg*@ERw>-n*TA>HIW;5GqpB!1xXLdixhgx^GDXSWPQj+a3TQxXYDuC(
zMQ%=Bu~mhw64+cTAR8pCucQE0Qj%?}1aVY^Z-9bxeo?A|sh+8BvVoDIg1M!hp{c34
zxsi^7k%6I!zJZ~>p|P%^rIm?^m4Sf*6et00D@sYT3UYCS+6Cm<DrJ<E6j<r&mzS68
zl^g5j7p3bPT3TA_8yM*u8R-I5=oVMzl_XZ^<`pZ$OmImpPA<wUD9OyvQvjKmn3P{y
zVygsnDZ~r81#n~YilM;-3^4tQ!~%UoJp+)JU<!SG@hi>Eg{v+u2}(t{7puX=A(aKG
z`a!A1`K3k4z=%sz23b{L<y@4SSdw29lAoUg3&ntp{F40QjQj!xXJ>GzDQNg6CTHe>
z1U13Be0{Av^NLFn^O93NU2K(r=ICW+rdT<<m>9Vkm{_`*nHw4!x*9t=x){5f8yK6L
zI~zGWnYzLBy5uL9=BDPA!1Sgd^g80y3rY~V1wfl!Qj0RnQd8WD@^cly9=FQG;uc3|
zM-vNYM`xVoLG`BKc8dj0z4}1M=!2pcDY{`oz%&G6!V@o$15f^`dB8MZ1WepDo7Si^
zFfbN*x;TbZ+<J5KY*w>_0Q-kqEhbZ(7I?f|*y?cJ^6MP+kBPG;A9uKaz+Br&&_;}j
z^T)=SyiT*OPTQq@OY%Q=GrQ?-`|vYw)-0d0ODgy?1Dixb10xF2E&pN9IkwBk56iRo
z)at$1w_fqUa=(~Ei}ss$@pq+OPyTti;x~)9>&C$6Vb0x5(h;H4Qs*pt+3m5R^X#TK
z#$AiTtxT`aXAFFxmLt)YZS_@w?+^F4iI4h{l%7q^>rUm}c5oBx?WD-2*bQ$Eth=%A
z!1dUtPb%llR(SgRUt^zj*WNm{|4BQqT;$1qqvSd1?f1xKk?T`~gW_Ha&v>NS_qe?D
zrj$6>or6}<yB6+PUa`%!__vq!V#|O0)(dy0MP17{w{wf=tlwEHO`{G~{czv%q|2RG
zch{qfEqqN0rXfccpWn4*Ux8a;bZQ#A@$qR99oNPES0^XxX&iZH)04NFHNh|84L>uF
j!2t#+@xkI&U;`sVocl?Y-p$j$fXXFLS3j3^P6<r_kCDkT

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_right.png b/packages/SystemUI/res/drawable-hdpi/ic_sysbar_ime_right.png
new file mode 100644
index 0000000000000000000000000000000000000000..5324ad9992dcf7fe8715cd9261893aba51ec684d
GIT binary patch
literal 1307
zcmeAS@N?(olHy`uVBq!ia0vp^HXzKw1|+Ti+$;i8k|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ-L~|H8MjYN+NuHtdjF{^%6m9^eS=-fVzQ(*;f=KCTFLXC?ut(
zXXe=|z2CiGNg*@ERw>-n*TA>HIW;5GqpB!1xXLdixhgx^GDXSWPQj+a3TQxXYDuC(
zMQ%=Bu~mhw64+cTAR8pCucQE0Qj%?}1aVY^Z-9bxeo?A|sh+8BvVoDIg1M!hp{c34
zxsi^7k%6I!zJZ~>p|P%^rIm?^m4Sf*6et00D@sYT3UYCS+6Cm<DrJ<E6j<r&mzS68
zl^g5j7p3bPT3TA_8yM*u8R-I5=oVMzl_XZ^<`pZ$OmImpPA<wUD9OyvQvjKmn3P{y
zVygsnDZ~r81#n~YilM;-3^4tQ!~%UoJp+)JU<!SG@hi>Eg{v+u2}(t{7puX=A(aKG
z`a!A1`K3k4z=%sz23b{L<y@4SSdw29lAoUg3&ntp{F40QjQj!xXJ>GzDQNg6CTHe>
z1U13Be0{Av^NLFn^O93NU2K(r=ICW+rdT;TJDONHJ36|VnHw4!x*9t=x){5f8yK6L
zI~zGWnYzLBy5uL9=BDPA!1Sgd^g7|x3rY~V1wfl!Qj0RnQd8WD@^cly9=FQG?G_81
z=0WwQ;C728PQCg-$LNEi7b&`7LclZxV!{(IkONQtsd>OOUj$6t{Rw`+e8Jf1>Eakt
zaqG=3NADH~5%z*y-Rw@Kj#pwA)j6!LtjwSGv`ln;++U8m$@`qjK0PwMQc~44fpg;H
zS2v{p^UGC7+?Y8(zwG<j6`Cyu(?qO~9b!soU}Td(CN$TqWH<0F-f~{*@rI;rT$i8p
zPv5X4d`fkpO#J27+6(7euKTj&=0Ul(#ERf)PiOz&bAK8W8oJ}3()*xwlT{+aL$Atx
z_sm=>8oGn+eek@%xSi{M2Z$Wq{X?>^Yo}KHr77ah7w;U1UToR4-Km(B->sO9->I10
zdvPg)_rl{d`cu!yt3GwV{4DCql#X~Q@v^l~<3sH}*}PvD9h>Dme{0MoM}a$K8zZOX
z-nx4Anfq$~u-W^U?u*cs;+NF<eJx1rbk%1AmeXa`79yv=9Z~kZ-26?ta^C(M+x|vW
zm)L&X@ul|vKD+C$q9fm_%PpUx9w;*R^tPVlGsoxr^4xRI@z1K0RTunkrrI2f3C))~
zrB;~FnXu0M^1s`ccST%cVCFG603!<4{}4)GSS)<N!y~l`RN66ky85}Sb4q9e0N>Ko
A4gdfE

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_left.png b/packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_left.png
new file mode 100644
index 0000000000000000000000000000000000000000..1f084026df91d5e7b532198a93790be2792e4813
GIT binary patch
literal 1213
zcmeAS@N?(olHy`uVBq!ia0vp^8X(NU1|)m_?Z^dEk|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ*9U+m^Cs(B1$5BeXNr6bM+EIYV;~{3xK*A7;Nk-3KEmEQ%e+*
zQqwc@Y?a>c-mj#PnPRIHZt82`Ti~3Uk?B!Ylp0*+7m{3+ootz+WN)WnQ(*-(AUCxn
zQK2F?C$HG5!d3}vt`(3C64qBz04piUwpD^SD#ABF!8yMuRl!uxR5#hc$WX!DQqR!T
z)ZE-iN5ROz&_v(BP~Xs4*U-|+#Kg+LKmiJrfVLH-q*(>IxIyg#@@$ndN=gc>^!3Zj
z%k|2Q_413-^$jg8E%gnI^o@*kfhu&1EAvVcD|GXUm0>2hq!uR^WfqiV=I1GZOiWD5
zFD<cE0=g99h1>$Tv3bSNU;+l1ennz|zM-B0$V)JVzP|XC=H|jx7ncO3BHWAB;Np<V
zf>iyW)Z+ZoqGVvir744~DzI`cN=+=uFAB-e&w+(vKt_H^esM;Afr7I$IMft0d=ry1
z^FV@{U|qhxR-SpqC5d^-sh%#jN<ee;GBZ=G9Gx9aESw$9+|0}k4Gmq59UWbaUCj-Q
z&CQ*SoSjVFV0vBhlS^|`^GaZPQxJO1aq0ynh};68%`T}$nPsUdZbkXI3Sf_0W#V>=
z2~P8%dQ)(_#T2JreV}9XLD7p8-7q0w8Uiuli5JL$C;!wuV45!iChh`mFAD|+Mr}_Q
z$B>F!Z>FE+Yck+zkj$%?+@kFNSo?>A+@GDR`k%}cZ&VLx%GluB*4TXGWP<e;&&xRi
z-<B@57xul(V&^SUp~rKg0fb)c^mx_n)UlsW;<i_ARlt?fy>73QJ6uCUtu>#DuJ!eh
zZdjyqx>m$BI)-7vCMn53?iyAM<r!N<Tnn4_N|Yr2`n&#lAH$o2Pb=%%_Og`R<lU(4
zAT&qY!DtS*gR+Hm!?K%VPHTUQlrOy^d`9+5qt4_lLeBh2WyfCZyw?5V;=*0#)g7f4
z!dgovs~9$xgr%*R;KyysTJ%omouzyFdtKkl%3F4F=e^STzD)eP&CJxBY;R7b>5E-y
z{B-<47yneY>V?X;cUhDrOx?z`aN(<SRre;&=Qufi*-1V78vQf}wiE~dr@99izO7Na
UsCdqM0jNOnboFyt=akR{080L#6#xJL

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_right.png b/packages/SystemUI/res/drawable-mdpi/ic_sysbar_ime_right.png
new file mode 100644
index 0000000000000000000000000000000000000000..762649942b7b24f4766fa1a9cc28f36a6a25cfc4
GIT binary patch
literal 1218
zcmeAS@N?(olHy`uVBq!ia0vp^8X(NU1|)m_?Z^dEk|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ*9U+m^Cs(B1$5BeXNr6bM+EIYV;~{3xK*A7;Nk-3KEmEQ%e+*
zQqwc@Y?a>c-mj#PnPRIHZt82`Ti~3Uk?B!Ylp0*+7m{3+ootz+WN)WnQ(*-(AUCxn
zQK2F?C$HG5!d3}vt`(3C64qBz04piUwpD^SD#ABF!8yMuRl!uxR5#hc$WX!DQqR!T
z)ZE-iN5ROz&_v(BP~Xs4*U-|+#Kg+LKmiJrfVLH-q*(>IxIyg#@@$ndN=gc>^!3Zj
z%k|2Q_413-^$jg8E%gnI^o@*kfhu&1EAvVcD|GXUm0>2hq!uR^WfqiV=I1GZOiWD5
zFD<cE0=g99h1>$Tv3bSNU;+l1ennz|zM-B0$V)JVzP|XC=H|jx7ncO3BHWAB;Np<V
zf>iyW)Z+ZoqGVvir744~DzI`cN=+=uFAB-e&w+(vKt_H^esM;Afr7I$IMft0d=ry1
z^FV@{U|qhxR-SpqC5d^-sh%#jN<ee;GBZ=G9Gx9aESw#U+|0}k4Gmq59UWbaUCj-Q
z&CQ*SoSjVFV0vBhlS^|`^GaZPQxJNMaq0ynh};68%`T}$nPsUdZbkXI3Sf_0WnyuQ
zshhEZg_)ZvPV=C8Q?R%Ns@DvsUVWfr^g+>!6x}c(U>X83;fWW>fhYgeJYbqH0w(UG
z-OYsz42%YzE{-7;x8B@1%hlu{!0_Oh*{6^POPy_f^e<?KURXHadHogdA3Sj^td0jm
zw%v`;7c!k4z55Ce&x?a!lb8MVd@zSUhA;m?g}{Uc78M0XS^jI~3=9>oE#HV`Z)ytS
z3Jukb&DnUQ_mj<i!()2Bmvds7PZj=Iq;c%K^!eKo&Zq7>%?~jYu@trJU-aTksEzZY
z<K`?=bf;bAcF{99k<Yw!qFF<fN3?^9khR_K1CR8thO^3EE9I5lGd1$himp1D<IA^I
zMNWHrHK%;>QO`*-QFC_Kt=iTsJo$;}xmQNb2P30bY_yPFaB=SrozoNdcwYV@!g4U`
zY}&h1aW;aM+=mOkt|{8}zIEUIv@4BY>+S?ya7+2Rs_4e|SxjZ(iG45cg!lciS~366
kWtK0sAm2Th&z#T1!;oUGK11_?9JpBVboFyt=akR{0Oi-HoB#j-

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_left.png b/packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_left.png
new file mode 100644
index 0000000000000000000000000000000000000000..4183e20f45d0b7a54ecb27b07900be808bf61715
GIT binary patch
literal 1388
zcmeAS@N?(olHy`uVBq!ia0vp^0U*r51|<6gKdl8)k|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ*9U+m^Cs(B1$5BeXNr6bM+EIYV;~{3xK*A7;Nk-3KEmEQ%e+*
zQqwc@Y?a>c-mj#PnPRIHZt82`Ti~3Uk?B!Ylp0*+7m{3+ootz+WN)WnQ(*-(AUCxn
zQK2F?C$HG5!d3}vt`(3C64qBz04piUwpD^SD#ABF!8yMuRl!uxR5#hc$WX!DQqR!T
z)ZE-iN5ROz&_v(BP~Xs4*U-|+#Kg+LKmiJrfVLH-q*(>IxIyg#@@$ndN=gc>^!3Zj
z%k|2Q_413-^$jg8E%gnI^o@*kfhu&1EAvVcD|GXUm0>2hq!uR^WfqiV=I1GZOiWD5
zFD<cE0=g99h1>$Tv3bSNU;+l1ennz|zM-B0$V)JVzP|XC=H|jx7ncO3BHWAB;Np<V
zf>iyW)Z+ZoqGVvir744~DzI`cN=+=uFAB-e&w+(vKt_H^esM;Afr7I$IMft0d=ry1
z^FV@{U|qhxR-SpqC5d^-sh%#jN<ee;GBZ=GOx=tPEX-Wp+|0}k4Gmq59UWbaUCj-Q
z&CQ*SoSjVFV0vBhlS^|`^GaZPQ{Z~t3~=fNC5YStpv^9+MVV!(DQ-pixe8#9TV>*Q
ziwjQkpn6kqy2aHMr(S)aWAs7Mixk~3Az&H;G2w|9$bl#S)I4CCF9Ig+3D?rv7#J9D
zdAc};RNQ)V>#Wyd2a&dier_TqfdzLj%`Um$<n4OF+DB|JW4+cSiSs8|l5RDf^?5Mm
zb6r8lmXK4IjWeGg-<oT!{5aTwL7{<x$%BDKz=44i$l_371hN=aK&%E92Zqw;NvrDL
z%$fbhH~ZG<u-lDITliA9F$Z5VIqRnP`p5Rq_wv)a>|c6nv96a@Y4ZCw?|8_<wV%5d
z-H_f^8vDB-dMUI2n>`cWmi<=oKfiR(F}@JS3ZC^kr_(E|7#~#ZS$bvdmC$+)<{1s_
z2}*JeofXd*gFpH(KRaN|J%jtaN`jwFal_7!YtFXD&N=?>X!ZRQPi?P-7g(Maz1nGQ
z@Zjv>nr{K(@5*-nHtc4Z*0!Pl^9@&tP3;2h-k}WtSW7<s6MI*DI;P{=zShmkQGaA-
zh+cf<qawZN>COT%m)ENePj;+fS5sn|(ZP|Rr1blcZMOygzq!Ke!&V<(wJPq0xLs}h
zj|}y!`{HH6b4#QOt+e+%2zsS9Md4m6`%-QBC!e&wiiI8DGWXmi77Ld>ef_mO)AyJ#
zW?9d@dRI6-cDtvY>3Z?3*9Yp<%i;^}JKI=&sGoad&fzAL^d(#Q615jHGvW&H^Gfzi
aJPdEdjx<-iSd$AX|2$p&T-G@yGywn*{_Ma2

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_right.png b/packages/SystemUI/res/drawable-xhdpi/ic_sysbar_ime_right.png
new file mode 100644
index 0000000000000000000000000000000000000000..ab1c7b404414e09390a388261dfbf495dc24c3cc
GIT binary patch
literal 1383
zcmeAS@N?(olHy`uVBq!ia0vp^0U*r51|<6gKdl8)k|nMYCBgY=CFO}lsSJ)O`AMk?
zp1FzXsX?iUDV2pMQ*9U+m^Cs(B1$5BeXNr6bM+EIYV;~{3xK*A7;Nk-3KEmEQ%e+*
zQqwc@Y?a>c-mj#PnPRIHZt82`Ti~3Uk?B!Ylp0*+7m{3+ootz+WN)WnQ(*-(AUCxn
zQK2F?C$HG5!d3}vt`(3C64qBz04piUwpD^SD#ABF!8yMuRl!uxR5#hc$WX!DQqR!T
z)ZE-iN5ROz&_v(BP~Xs4*U-|+#Kg+LKmiJrfVLH-q*(>IxIyg#@@$ndN=gc>^!3Zj
z%k|2Q_413-^$jg8E%gnI^o@*kfhu&1EAvVcD|GXUm0>2hq!uR^WfqiV=I1GZOiWD5
zFD<cE0=g99h1>$Tv3bSNU;+l1ennz|zM-B0$V)JVzP|XC=H|jx7ncO3BHWAB;Np<V
zf>iyW)Z+ZoqGVvir744~DzI`cN=+=uFAB-e&w+(vKt_H^esM;Afr7I$IMft0d=ry1
z^FV@{U|qhxR-SpqC5d^-sh%#jN<ee;GBZ=GOx=tPEX>@D-OS7l4Gmq59UWbaUCj-Q
z&CQ*SoSjVFV0vBhlS^|`^GaZPQxJMhaOwpmh};68%`T}$nPsUdZbkXI3Sf_0W#V>=
zAx`t4dQ)(_#R#WfeV}9XLD7p8-7q0w8Uiuli5JL$C;!wuV45!iCT{8TZW|dG7_WM|
zIEGZ*dUMCoo5@k+z{j$wVYi$GN>)#vzkc^}pI1>K^8*q;YRDC*&Pq!VUt@OUUXD%m
zfA;qin$G;G*=&-}X8isy=f~eC6d42@7#LL;Sb!8K10#@P0`gfVz=Q+JdA9PXoZfWL
zZuj}k`D;ZbOxX?R7MC+7c(Ka0l}i<EiCeE;InV!=7FVcMu=y<u1Kyp@;VpY2^rrX!
ztM=J?Ht@Dk-($&Eo7;KYV^=%hFA585{J67R?vvJ&3cLCHf4!TLHFNPTRhds#qKi}y
z#0jirRCC|LF+=2{R)Ues=>|`Mwai_Dj3P=*8ZImW9XFouFfB{|_Agp|)4j|}-oNMX
zJEZ06*La8?TXy(q(#DE+TDH&c^r-Gh=L`@1dZl&y&761TtN9%m<r<u97+NbBxISj6
zaeT~3=lpoaJY;Fbvglu$AI`{WEj?shttYcBsd;_=wbH)<B1dyK%Rh^$xWBXD#`Aq1
zTJQCr&B*+DweMM3ShfDLo=}PSh_zwnsgc(voqAo|cZ<P3Rxj&cUG}Z;xJ{>Y7`Ju2
z{rofb*BPKxl=P~?WA7w(?T-2QSKs?bL^BsClyL;M?vZu|W(F_*9o1?E%wIu8pQo#z
J%Q~loCIGbF;E@0T

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_left.png b/packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_left.png
new file mode 100644
index 0000000000000000000000000000000000000000..08cbeefaa0cdd81660f60bd1d039e374f89cbfd3
GIT binary patch
literal 1632
zcmeAS@N?(olHy`uVBq!ia0vp^6(G#P1|%(0%q{^b$r9IylHmNblJdl&R0hYC{G?O`
z&)mfH)S%SFl*+=BsWuD@%o>>?5hW46K32*3xq68pHF_1f1wh>l3^w)^1&PVosU-?Y
zsp*+{wo31J?^jaDOtDo8H}y5}EpSfF$n>ZxN)4{^3rViZPPR-@vbR&PsjvbXkegbP
zs8ErclUHn2VXFi-*9yo63F|8<fR&VF+bTgE72zA8;GAESs$i;Ts+(+JWT;?nsb^?v
zYHn_%qhMrUXrgamsBdVjYiMa@Vq#@rpa2C*K--E^(yW49+@N*=dA3R!B_#z``ugSN
z<$C4Ddih1^`i7R4mih)p`bI{&Koz>hm3bwJ6}oxF$}kgLQj3#|G7CyF^YauyCMG83
zmzLNn0bL65LT&-v*t}wBFaZNhzap_f-%!s0<RzFwUtj!6b93RUi%Wu15$?rmaB)aw
zL8^XGYH@yPQ8F;%(v(3~6<9eJr6!i-7lq{K=fFZSAS1sdzc?emK*8A=9BK+0zKO}1
zc_2Yeur6O;E6=>*lEl2^R8JRMC7?NanVBh8&MqcKZU&}?Zf53&hK8=jj*c$IuI2{D
z=H|{u&Q7LoFugAM$)&lec_lEtDG0qrIQ4=OL~a4lW|!2W%(B!Jx1#)91+d4hGI6@a
z#0{r;P`xR*-C}@KuRhQ*`k?4Vif)(?Fb#p2@Wcz`z>|M!9x%-p0TcIMopfNvVmjyP
z;uunK>&@MRSyGM?2R_a%{JO;5R@2Vi&-S;GVtb5N#_OdbPKpclADb?>>3HDyL8Zc=
zFnzcD+zVGtW-StU{`+6O#HKdisL#dbyHA$9I<@JHNB%s0#se${j6Mv)Ac_ah@?l_x
zia{uBie#hzU94w(ekV}A{*9FK?)rV(Oucnv56-u6ef>7tRPIr9gQ=*KM0ozOj}I;E
z*dn;seXo1HV(Rf}6ZWdcbf35<m6t33zHe^}`wyGK@YPrQ(>DLKwX0{}pmgVG(#Oqr
z^X`Yu=53hz@LbyF-+9}s(^<oLKU5bizx;B2-TwOXwHt!&JS@;~&s*Up*q$?;VSb@&
z;2-{V3+#?>+}QM{_o3a<k31Xd?kqCdaAz;OctQaq8<@B*VX&jC@n9$q&$^_9f>LJd
znVE$J>d%>WyktE6K5g%rEfXZgf0xPdu!VpA`A6suOXKQ`KoO(QN%zm~jeB3UGbXNi
z_6^NntdVJPCwO{lt;?<Eo`3!I*RoqY57a8;b&L(3G-chlTO0P;yEO5e=qZziry6%=
zl`4jxZlAE$H_cykN8j#~|IY2xaJa_)=hZj%6x-!5m{RVFM=D6~=wiEhAXn(bt@q82
z*Z6rhF(yplWoXV}kVs)Zpdig)$7z&ZqT!a-%Xjp|nu`->eV9K}=DpLl9d7NvU(D27
z9+hiWXP<lI;u<$?zMFYIYLmM!W_*!&c)johw`1LRnKFC%1L<rv43_=w*(dJ(oBmI$
z@$-}Tg}3!5Ouzhf|GnqRPt=UJxVf+UVEI<*J(D=YYe&88+j_U>iKQe-E{*wEtexHQ
zb$4q(^LYk8dCTg@zl+#5=%q~lc>fiH&zwd6Uz)idai}$LCIAuB3<eO3NdnFS2{3}i
hAW}eCuVwd{co_OKuPQUQ*eim{d{0+Dmvv4FO#maqS`z>O

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_right.png b/packages/SystemUI/res/drawable-xxhdpi/ic_sysbar_ime_right.png
new file mode 100644
index 0000000000000000000000000000000000000000..db4e88885a700007f5bcf248502cf6dc10aab13e
GIT binary patch
literal 1770
zcmaJ?Yfuwc6kb5UQW3TFfr2h;D_9|$1VYG4M92eT35|#n6_JoE5JR%dW&`12p-ycr
zpcEO47L_SV6|G1C5y2|Rw1L5*LP0^$sN<+S1X0Yi_~?e0{wUp<y^nLw_nmXk{dV>{
zNl2i*-C{cc0PICU{7`Dvo8Or>)W}hIw^EZMDUgyIuoyB)MxcPd0*gjLky;juhN3b>
zazYd83jkJb$}lM@6$c}7Oih!SV`zFcPN4z7*H4ej<SLW|qtRHUh6@eWUWP!Wf(wPS
z#B?#vL*tY|DFnJ9B_vFqqLOnIklz~6SC3ExYLt|LdUd=;i|Dz~7%xJt&1M(^$3jRI
z7aA{0Dwcpej6gvajpZSyGZ`S8Lu0U5Y&O#!WYQU4Fr5K2JUtj3#LEkz)4_=cqOuW+
z7$lT0oXAD(xKJEP;s^{UB_+|4JZTsa3o|$z4oqjlOr{4F;h{~|kTSi8M!S5HfsbnC
zgc2u}m<BX6%AzqH$%Uv&$B&@Kr)V|Wi8fIUgY_~TX3*&7BTWX1#s43wR!>E1$x!rN
zz5hw94NJyRI26@lIzmoeT+DKFDjeYvsEovjFbs>I?4l$NBQb3phJ!rbSl2)|u}rSi
zn2jsPP+~D6(r8JUMvjX3T!`YKDU}L@$M<3i>0W%HH=Ds=2t57$`JMtc-ILAcF?j(j
z;Ut!i$#rT}Lr!89@34Ytv1UQ2aVj$(C6tM%LP%h0aO~iSa{5{VrsbQ!DyFZ6H!T*X
zih<47``&d=nkWsKms8@UHdFFPHI(KFO5D)VOA_jvk&5{KVfwEA?(M2B$s$8Sp4;;)
zF4;Y9$D5jO_1sy1zMvkl>Ah8$r7Qbq*B_CY>(>6Y1pc`G&~Z^g{Qefd>&H2qYbINV
z%=W5hdD?jeCk!(i%7icWHf;sy76*Y~U<L3|#s_s{!;C0Pvu)P<ju}yucft`2*o-6c
zT!Xgd+cReIO6~?8C}#AwnuZJkC#&S5!$o`J1t-sPZ2ESqiXV=C3D>-Kb}{+bgfF`p
z9Q9zUyrMIWE`BZ_9{G~VbpT3NXpkKb)RjLpKio)p3X>!KE;s`bf9Braqxw}Eaqjj&
zlI_v6tnv~Le$k4ZSbIcwpT!^?jG0gpa^$B+$?SQ#zrXslxoY5^g6X)9*D>E`4R?0Y
za9-x1?Y;-yK|F7kp+_*{x^g>I{<MzK@4Yg&5&7cAn#Pnu#aHe|_btBVU+0L5a*NYu
zFUWE)K?6T2uRQ9W&^WK)Dc|Mufm2uQH;=T;X;N1}-xr$%svP%A&$t({tH?J_!p4SE
zP}X2pNUnXukZI|<B{r?hU7*jSt&Z7I=K={ys@|F7lw-&*?TcKRy0g+MEi-Zdn!5Q}
zkCHK%M!Vyb+LBoNI(~D<+IDVuR!aX%*EUsJW6FZ|=O-gWPPFw6@jLoP^1F7LelEE`
zYB$8|-V_GMRCJm)RG)6|RShp*mHNtBI@jog_q|<x!BT2(48ScmSyj^`GMa5$tWCGB
zSy%fSyD6K4Pk2N|yJd^>!YEzFhxOJ}=oQ?8wyau0g<8{`78-{$3TG@d5*cmQQai&L
z%d$NzB<-$WjnI(t+nbIZ=WL$rej_=cn|Z;QzM#B)Ako3Q<w^FcQ^y(-4i|RrmXd~c
zN1xj4hHafyJGq6|(u3;H9I1gqOYHwX->X8nH}f|AC?xI%Ur#!A<MDyMn#;p=+{&(B
zJ{vr}uWmH9H9eo%Z50xzqb(2DMQs}`YKwV^4_?YWR5Q3GdgJy%M`N4e9$i~Hx4&Ms
ztmkcoi{OQW@9Z*RBh--Y4Fn%7+IaBWhB;y({hd5l09KQN9+T{%aY2vUEXI{?c5qzJ
bTh0P{Bi28DxjHAu{Pz(FLinWtQM>*Hc8jLq

literal 0
HcmV?d00001

diff --git a/packages/SystemUI/res/layout-sw600dp/nav_buttons_dpad_group_rot90.xml b/packages/SystemUI/res/layout-sw600dp/nav_buttons_dpad_group_rot90.xml
new file mode 100644
index 00000000000..5f9383c5686
--- /dev/null
+++ b/packages/SystemUI/res/layout-sw600dp/nav_buttons_dpad_group_rot90.xml
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2016 The CyanogenMod Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<RelativeLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:systemui="http://schemas.android.com/apk/res-auto"
+    android:id="@+id/dpad_group"
+    android:layout_width="fill_parent"
+    android:layout_height="fill_parent"
+    android:clipChildren="false">
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_left"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/navigation_extra_key_width"
+            android:layout_alignParentTop="true"
+            android:src="@drawable/ic_sysbar_ime_left"
+            systemui:keyCode="21"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_left" />
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_right"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/navigation_extra_key_width"
+            android:layout_alignParentBottom="true"
+            android:src="@drawable/ic_sysbar_ime_right"
+            systemui:keyCode="22"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_right" />
+
+</RelativeLayout>
diff --git a/packages/SystemUI/res/layout-sw600dp/navigation_layout_rot90.xml b/packages/SystemUI/res/layout-sw600dp/navigation_layout_rot90.xml
index 78304fd894d..17300ad7c95 100644
--- a/packages/SystemUI/res/layout-sw600dp/navigation_layout_rot90.xml
+++ b/packages/SystemUI/res/layout-sw600dp/navigation_layout_rot90.xml
@@ -39,6 +39,8 @@
             android:orientation="horizontal"
             android:clipChildren="false" />
 
+        <include layout="@layout/nav_buttons_dpad_group_rot90" />
+
     </FrameLayout>
 
 </FrameLayout>
diff --git a/packages/SystemUI/res/layout/nav_buttons_dpad_group.xml b/packages/SystemUI/res/layout/nav_buttons_dpad_group.xml
new file mode 100644
index 00000000000..d7bb9429fad
--- /dev/null
+++ b/packages/SystemUI/res/layout/nav_buttons_dpad_group.xml
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2016 The CyanogenMod Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<RelativeLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:systemui="http://schemas.android.com/apk/res-auto"
+    android:id="@+id/dpad_group"
+    android:layout_width="fill_parent"
+    android:layout_height="fill_parent"
+    android:clipChildren="false">
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_left"
+            android:layout_width="@dimen/navigation_extra_key_width"
+            android:layout_height="match_parent"
+            android:layout_alignParentLeft="true"
+            android:src="@drawable/ic_sysbar_ime_left"
+            systemui:keyCode="21"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_left" />
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_right"
+            android:layout_width="@dimen/navigation_extra_key_width"
+            android:layout_height="match_parent"
+            android:layout_alignParentRight="true"
+            android:src="@drawable/ic_sysbar_ime_right"
+            systemui:keyCode="22"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_right" />
+
+</RelativeLayout>
diff --git a/packages/SystemUI/res/layout/nav_buttons_dpad_group_rot90.xml b/packages/SystemUI/res/layout/nav_buttons_dpad_group_rot90.xml
new file mode 100644
index 00000000000..5f9383c5686
--- /dev/null
+++ b/packages/SystemUI/res/layout/nav_buttons_dpad_group_rot90.xml
@@ -0,0 +1,48 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2016 The CyanogenMod Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<RelativeLayout
+    xmlns:android="http://schemas.android.com/apk/res/android"
+    xmlns:systemui="http://schemas.android.com/apk/res-auto"
+    android:id="@+id/dpad_group"
+    android:layout_width="fill_parent"
+    android:layout_height="fill_parent"
+    android:clipChildren="false">
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_left"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/navigation_extra_key_width"
+            android:layout_alignParentTop="true"
+            android:src="@drawable/ic_sysbar_ime_left"
+            systemui:keyCode="21"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_left" />
+
+        <com.android.systemui.statusbar.policy.KeyButtonView
+            android:id="@+id/dpad_right"
+            android:layout_width="match_parent"
+            android:layout_height="@dimen/navigation_extra_key_width"
+            android:layout_alignParentBottom="true"
+            android:src="@drawable/ic_sysbar_ime_right"
+            systemui:keyCode="22"
+            systemui:keyRepeat="true"
+            android:visibility="gone"
+            android:scaleType="center"
+            android:contentDescription="@string/accessibility_dpad_right" />
+
+</RelativeLayout>
diff --git a/packages/SystemUI/res/layout/navigation_layout.xml b/packages/SystemUI/res/layout/navigation_layout.xml
index baaf699c278..a57f0d787d7 100644
--- a/packages/SystemUI/res/layout/navigation_layout.xml
+++ b/packages/SystemUI/res/layout/navigation_layout.xml
@@ -51,6 +51,8 @@
             android:clipToPadding="false"
             android:clipChildren="false" />
 
+        <include layout="@layout/nav_buttons_dpad_group" />
+
     </com.android.systemui.statusbar.phone.NearestTouchFrame>
 
 </FrameLayout>
diff --git a/packages/SystemUI/res/layout/navigation_layout_rot90.xml b/packages/SystemUI/res/layout/navigation_layout_rot90.xml
index 6d5b77885a0..bba2b6d048c 100644
--- a/packages/SystemUI/res/layout/navigation_layout_rot90.xml
+++ b/packages/SystemUI/res/layout/navigation_layout_rot90.xml
@@ -50,6 +50,8 @@
             android:clipChildren="false"
             android:clipToPadding="false" />
 
+        <include layout="@layout/nav_buttons_dpad_group_rot90" />
+
     </com.android.systemui.statusbar.phone.NearestTouchFrame>
 
 </FrameLayout>
diff --git a/packages/SystemUI/res/values/cm_strings.xml b/packages/SystemUI/res/values/cm_strings.xml
index 6e443b7b130..3eb20b21608 100644
--- a/packages/SystemUI/res/values/cm_strings.xml
+++ b/packages/SystemUI/res/values/cm_strings.xml
@@ -81,4 +81,8 @@
 
     <!-- Label for current user in power menu options dialog -->
     <string name="global_action_current_user">Current</string>
+
+    <!-- Navigation bar dpad -->
+    <string name="accessibility_dpad_left">Cursor left</string>
+    <string name="accessibility_dpad_right">Cursor right</string>
 </resources>
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
index e6f2c33c33d..35ec3325aee 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarInflaterView.java
@@ -475,7 +475,9 @@ public class NavigationBarInflaterView extends FrameLayout
 
     private void clearAllChildren(ViewGroup group) {
         for (int i = 0; i < group.getChildCount(); i++) {
-            ((ViewGroup) group.getChildAt(i)).removeAllViews();
+            if (group.getChildAt(i).getId() != R.id.dpad_group) {
+                ((ViewGroup) group.getChildAt(i)).removeAllViews();
+            }
         }
     }
 
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
index 2a1f92f5edd..78535da456d 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/NavigationBarView.java
@@ -78,6 +78,9 @@ import com.android.systemui.stackdivider.Divider;
 import com.android.systemui.statusbar.policy.DeadZone;
 import com.android.systemui.statusbar.policy.KeyButtonDrawable;
 import com.android.systemui.statusbar.policy.TintedKeyButtonDrawable;
+import com.android.systemui.tuner.TunerService;
+
+import lineageos.providers.LineageSettings;
 
 import java.io.FileDescriptor;
 import java.io.PrintWriter;
@@ -88,10 +91,14 @@ import static com.android.systemui.shared.system.NavigationBarCompat.FLAG_SHOW_O
 import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_OVERVIEW;
 import static com.android.systemui.shared.system.NavigationBarCompat.HIT_TARGET_ROTATION;
 
-public class NavigationBarView extends FrameLayout implements PluginListener<NavGesture> {
+public class NavigationBarView extends FrameLayout implements PluginListener<NavGesture>,
+        TunerService.Tunable {
     final static boolean DEBUG = false;
     final static String TAG = "StatusBar/NavBarView";
 
+    private static final String NAVIGATION_BAR_MENU_ARROW_KEYS =
+            "lineagesystem:" + LineageSettings.System.NAVIGATION_BAR_MENU_ARROW_KEYS;
+
     // slippery nav bar when everything is disabled, e.g. during setup
     final static boolean SLIPPERY_WHEN_DISABLED = true;
 
@@ -161,6 +168,8 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
 
     private int mRotateBtnStyle = R.style.RotateButtonCCWStart90;
 
+    private boolean mShowDpadArrowKeys;
+
     private class NavTransitionListener implements TransitionListener {
         private boolean mBackTransitioning;
         private boolean mHomeAppearing;
@@ -454,6 +463,10 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
                 && ((mOverviewProxyService.getInteractionFlags() & FLAG_DISABLE_QUICK_SCRUB) == 0);
     }
 
+    public ViewGroup getDpadView() {
+        return (ViewGroup) getCurrentView().findViewById(R.id.dpad_group);
+    }
+
     // TODO(b/80003212): change car mode icons to vector icons.
     private void updateCarModeIcons(Context ctx) {
         mBackCarModeIcon = getDrawable(ctx,
@@ -633,6 +646,7 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
         final boolean showImeButton =
                 !mShowAccessibilityButton &&
                         !mShowRotateButton &&
+                        !mShowDpadArrowKeys &&
                         ((mNavigationIconHints & StatusBarManager.NAVIGATION_HINT_IME_SHOWN) != 0);
         getImeSwitchButton().setVisibility(showImeButton ? View.VISIBLE : View.INVISIBLE);
         getImeSwitchButton().setImageDrawable(mImeIcon);
@@ -649,6 +663,7 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
         getAccessibilityButton().setImageDrawable(mAccessibilityIcon);
 
         mBarTransitions.reapplyDarkIntensity();
+        updateDpadKeys();
 
         boolean disableHome = ((mDisabledFlags & View.STATUS_BAR_DISABLE_HOME) != 0);
 
@@ -1138,6 +1153,8 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
         onPluginDisconnected(null); // Create default gesture helper
         Dependency.get(PluginManager.class).addPluginListener(this,
                 NavGesture.class, false /* Only one */);
+        final TunerService tunerService = Dependency.get(TunerService.class);
+        tunerService.addTunable(this, NAVIGATION_BAR_MENU_ARROW_KEYS);
         setUpSwipeUpOnboarding(isQuickStepSwipeUpEnabled());
     }
 
@@ -1151,6 +1168,14 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
         setUpSwipeUpOnboarding(false);
     }
 
+    @Override
+    public void onTuningChanged(String key, String newValue) {
+        if (NAVIGATION_BAR_MENU_ARROW_KEYS.equals(key)) {
+            mShowDpadArrowKeys = newValue == null || Integer.parseInt(newValue) == 1;
+            setNavigationIconHints(mNavigationIconHints);
+        }
+    }
+
     private void setUpSwipeUpOnboarding(boolean connectedToOverviewProxy) {
         if (connectedToOverviewProxy) {
             mRecentsOnboarding.onConnectedToLauncher();
@@ -1237,6 +1262,14 @@ public class NavigationBarView extends FrameLayout implements PluginListener<Nav
         void onVerticalChanged(boolean isVertical);
     }
 
+    public void updateDpadKeys() {
+        final int visibility = mShowDpadArrowKeys && (mNavigationIconHints
+                & StatusBarManager.NAVIGATION_HINT_BACK_ALT) != 0 ? View.VISIBLE : View.GONE;
+
+        getDpadView().findViewById(R.id.dpad_left).setVisibility(visibility);
+        getDpadView().findViewById(R.id.dpad_right).setVisibility(visibility);
+    }
+
     private final Consumer<Boolean> mDockedListener = exists -> mHandler.post(() -> {
         mDockedStackExists = exists;
         updateRecentsIcon();
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/policy/KeyButtonView.java b/packages/SystemUI/src/com/android/systemui/statusbar/policy/KeyButtonView.java
index 12b6f9de61e..f4f6723fcb8 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/policy/KeyButtonView.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/policy/KeyButtonView.java
@@ -54,6 +54,8 @@ import com.android.systemui.shared.system.NavigationBarCompat;
 
 public class KeyButtonView extends ImageView implements ButtonInterface {
     private static final String TAG = KeyButtonView.class.getSimpleName();
+    private static final int CURSOR_REPEAT_FLAGS = KeyEvent.FLAG_SOFT_KEYBOARD
+            | KeyEvent.FLAG_KEEP_TOUCH_MODE;
 
     private final boolean mPlaySounds;
     private int mContentDescriptionRes;
@@ -75,7 +77,13 @@ public class KeyButtonView extends ImageView implements ButtonInterface {
         public void run() {
             if (isPressed()) {
                 // Log.d("KeyButtonView", "longpressed: " + this);
-                if (isLongClickable()) {
+                if (mCode == KeyEvent.KEYCODE_DPAD_LEFT || mCode == KeyEvent.KEYCODE_DPAD_RIGHT) {
+                    sendEvent(KeyEvent.ACTION_UP, CURSOR_REPEAT_FLAGS,
+                            System.currentTimeMillis(), false);
+                    sendEvent(KeyEvent.ACTION_DOWN, CURSOR_REPEAT_FLAGS,
+                            System.currentTimeMillis(), false);
+                    postDelayed(mCheckLongPress, ViewConfiguration.getKeyRepeatDelay());
+                } else if (isLongClickable()) {
                     // Just an old-fashioned ImageView
                     performLongClick();
                     mLongClicked = true;
@@ -215,7 +223,10 @@ public class KeyButtonView extends ImageView implements ButtonInterface {
                 // Use raw X and Y to detect gestures in case a parent changes the x and y values
                 mTouchDownX = (int) ev.getRawX();
                 mTouchDownY = (int) ev.getRawY();
-                if (mCode != 0) {
+                if (mCode == KeyEvent.KEYCODE_DPAD_LEFT || mCode == KeyEvent.KEYCODE_DPAD_RIGHT) {
+                    sendEvent(KeyEvent.ACTION_DOWN, KeyEvent.FLAG_VIRTUAL_HARD_KEY
+                            | KeyEvent.FLAG_KEEP_TOUCH_MODE, mDownTime, false);
+                } else if (mCode != 0) {
                     sendEvent(KeyEvent.ACTION_DOWN, 0, mDownTime);
                 } else {
                     // Provide the same haptic feedback that the system offers for virtual keys.
@@ -297,15 +308,22 @@ public class KeyButtonView extends ImageView implements ButtonInterface {
     }
 
     void sendEvent(int action, int flags, long when) {
+        sendEvent(action, flags, when, true);
+    }
+
+    void sendEvent(int action, int flags, long when, boolean applyDefaultFlags) {
         mMetricsLogger.write(new LogMaker(MetricsEvent.ACTION_NAV_BUTTON_EVENT)
                 .setType(MetricsEvent.TYPE_ACTION)
                 .setSubtype(mCode)
                 .addTaggedData(MetricsEvent.FIELD_NAV_ACTION, action)
                 .addTaggedData(MetricsEvent.FIELD_FLAGS, flags));
         final int repeatCount = (flags & KeyEvent.FLAG_LONG_PRESS) != 0 ? 1 : 0;
+        if (applyDefaultFlags) {
+            flags |= KeyEvent.FLAG_FROM_SYSTEM | KeyEvent.FLAG_VIRTUAL_HARD_KEY;
+        }
         final KeyEvent ev = new KeyEvent(mDownTime, when, action, mCode, repeatCount,
                 0, KeyCharacterMap.VIRTUAL_KEYBOARD, 0,
-                flags | KeyEvent.FLAG_FROM_SYSTEM | KeyEvent.FLAG_VIRTUAL_HARD_KEY,
+                flags,
                 InputDevice.SOURCE_KEYBOARD);
         InputManager.getInstance().injectInputEvent(ev,
                 InputManager.INJECT_INPUT_EVENT_MODE_ASYNC);
-- 
2.17.1

