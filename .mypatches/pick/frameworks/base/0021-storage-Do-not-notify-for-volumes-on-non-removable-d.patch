From 416fd598038a9db3015b7b7b57a4f4185d636846 Mon Sep 17 00:00:00 2001
From: Tom Marshall <tdm@cyngn.com>
Date: Tue, 24 Nov 2015 15:28:43 -0800
Subject: [PATCH 21/53] storage: Do not notify for volumes on non-removable
 disks

Change-Id: Ia353ab43fbeba42d7d9c21d926f638f550a3dbbe
---
 core/java/android/os/storage/DiskInfo.java                  | 6 ++++++
 .../src/com/android/systemui/usb/StorageNotification.java   | 5 +++++
 2 files changed, 11 insertions(+)

diff --git a/core/java/android/os/storage/DiskInfo.java b/core/java/android/os/storage/DiskInfo.java
index d493ccebf53..e41ecf8f901 100644
--- a/core/java/android/os/storage/DiskInfo.java
+++ b/core/java/android/os/storage/DiskInfo.java
@@ -48,6 +48,8 @@ public class DiskInfo implements Parcelable {
     public static final int FLAG_DEFAULT_PRIMARY = 1 << 1;
     public static final int FLAG_SD = 1 << 2;
     public static final int FLAG_USB = 1 << 3;
+    public static final int FLAG_EMMC = 1 << 4;
+    public static final int FLAG_NON_REMOVABLE = 1 << 5;
 
     public final String id;
     public final int flags;
@@ -140,6 +142,10 @@ public class DiskInfo implements Parcelable {
         return (flags & FLAG_USB) != 0;
     }
 
+    public boolean isNonRemovable() {
+        return (flags & FLAG_NON_REMOVABLE) != 0;
+    }
+
     @Override
     public String toString() {
         final CharArrayWriter writer = new CharArrayWriter();
diff --git a/packages/SystemUI/src/com/android/systemui/usb/StorageNotification.java b/packages/SystemUI/src/com/android/systemui/usb/StorageNotification.java
index 2f8dfdc2991..7e4aa6518cb 100644
--- a/packages/SystemUI/src/com/android/systemui/usb/StorageNotification.java
+++ b/packages/SystemUI/src/com/android/systemui/usb/StorageNotification.java
@@ -287,6 +287,11 @@ public class StorageNotification extends SystemUI {
     }
 
     private void onPublicVolumeStateChangedInternal(VolumeInfo vol) {
+        // Do not notify for volumes on non-removable disks
+        if (vol.disk.isNonRemovable()) {
+            return;
+        }
+
         Log.d(TAG, "Notifying about public volume: " + vol.toString());
 
         final Notification notif;
-- 
2.17.1

