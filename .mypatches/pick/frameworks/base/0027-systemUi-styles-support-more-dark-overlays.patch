From 2d4c313a14415472c6db5cfe7cde8715be62aaa1 Mon Sep 17 00:00:00 2001
From: Joey <joey@lineageos.org>
Date: Thu, 5 Jul 2018 21:14:01 +0200
Subject: [PATCH 27/29] systemUi: styles: support more dark overlays

Change-Id: I4fafa2b1e342608e2690c3dda7cb06aaf88247ba
Signed-off-by: Joey <joey@lineageos.org>
---
 .../systemui/statusbar/phone/StatusBar.java       | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
index b7b240505a8..5c022f2b113 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/phone/StatusBar.java
@@ -274,6 +274,7 @@ import java.util.Stack;
 
 import lineageos.hardware.LiveDisplayManager;
 import lineageos.providers.LineageSettings;
+import lineageos.style.StyleInterface;
 
 public class StatusBar extends SystemUI implements DemoMode,
         DragDownHelper.DragDownCallback, ActivityStarter, OnUnlockMethodChangedListener,
@@ -3028,8 +3029,8 @@ public class StatusBar extends SystemUI implements DemoMode,
     public boolean isUsingDarkTheme() {
         OverlayInfo systemuiThemeInfo = null;
         try {
-            systemuiThemeInfo = mOverlayManager.getOverlayInfo("org.lineageos.overlay.dark",
-                    mCurrentUserId);
+            String darkTheme = getDarkOverlay();
+            systemuiThemeInfo = mOverlayManager.getOverlayInfo(darkTheme, mCurrentUserId);
         } catch (RemoteException e) {
             e.printStackTrace();
         }
@@ -3048,6 +3049,12 @@ public class StatusBar extends SystemUI implements DemoMode,
         return false;
     }
 
+    private String getDarkOverlay() {
+        return LineageSettings.System.getString(mContext.getContentResolver(),
+                LineageSettings.System.BERRY_DARK_OVERLAY,
+                StyleInterface.OVERLAY_DARK_DEFAULT);
+    }
+
     @Nullable
     public View getAmbientIndicationContainer() {
         return mAmbientIndicationContainer;
@@ -4975,8 +4982,8 @@ public class StatusBar extends SystemUI implements DemoMode,
 
         if (isUsingDarkTheme() != useDarkTheme) {
             try {
-                mOverlayManager.setEnabled("org.lineageos.overlay.dark",
-                        useDarkTheme, mCurrentUserId);
+                String darkOverlay = getDarkOverlay();
+                mOverlayManager.setEnabled(darkOverlay, useDarkTheme, mCurrentUserId);
             } catch (RemoteException e) {
                 Log.w(TAG, "Can't change theme", e);
             }
-- 
2.17.1

