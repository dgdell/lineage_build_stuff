From acd147a4261cbf3759264b9e0fe762c830719ded Mon Sep 17 00:00:00 2001
From: emancebo <emancebo@cyngn.com>
Date: Tue, 10 Feb 2015 15:17:18 -0800
Subject: [PATCH 27/31] Expose call creation time to link call recordings with
 recent call log (1/2)

Change-Id: I9743abbf23b767cf5cf1f27fffccb0f76618e5b1
---
 telecomm/java/android/telecom/Call.java           | 14 ++++++++++++++
 telecomm/java/android/telecom/ParcelableCall.java | 14 ++++++++++++++
 2 files changed, 28 insertions(+)

diff --git a/telecomm/java/android/telecom/Call.java b/telecomm/java/android/telecom/Call.java
index 6114a20d079..54100186906 100644
--- a/telecomm/java/android/telecom/Call.java
+++ b/telecomm/java/android/telecom/Call.java
@@ -437,6 +437,7 @@ public final class Call {
         private final int mCallProperties;
         private final int mSupportedAudioRoutes = CallAudioState.ROUTE_ALL;
         private final DisconnectCause mDisconnectCause;
+        private final long mCreateTimeMillis;
         private final long mConnectTimeMillis;
         private final GatewayInfo mGatewayInfo;
         private final int mVideoState;
@@ -680,6 +681,14 @@ public final class Call {
             return mConnectTimeMillis;
         }
 
+        /**
+         * @return the time the Call object was created
+         * @hide
+         */
+        public long getCreateTimeMillis() {
+            return mCreateTimeMillis;
+        }
+
         /**
          * @return Information about any calling gateway the {@code Call} may be using.
          */
@@ -742,6 +751,7 @@ public final class Call {
                         Objects.equals(mCallCapabilities, d.mCallCapabilities) &&
                         Objects.equals(mCallProperties, d.mCallProperties) &&
                         Objects.equals(mDisconnectCause, d.mDisconnectCause) &&
+                        Objects.equals(mCreateTimeMillis, d.mCreateTimeMillis) &&
                         Objects.equals(mConnectTimeMillis, d.mConnectTimeMillis) &&
                         Objects.equals(mGatewayInfo, d.mGatewayInfo) &&
                         Objects.equals(mVideoState, d.mVideoState) &&
@@ -763,6 +773,7 @@ public final class Call {
                             mCallCapabilities,
                             mCallProperties,
                             mDisconnectCause,
+                            mCreateTimeMillis,
                             mConnectTimeMillis,
                             mGatewayInfo,
                             mVideoState,
@@ -783,6 +794,7 @@ public final class Call {
                 int capabilities,
                 int properties,
                 DisconnectCause disconnectCause,
+                long createTimeMillis,
                 long connectTimeMillis,
                 GatewayInfo gatewayInfo,
                 int videoState,
@@ -799,6 +811,7 @@ public final class Call {
             mCallCapabilities = capabilities;
             mCallProperties = properties;
             mDisconnectCause = disconnectCause;
+            mCreateTimeMillis = createTimeMillis;
             mConnectTimeMillis = connectTimeMillis;
             mGatewayInfo = gatewayInfo;
             mVideoState = videoState;
@@ -820,6 +833,7 @@ public final class Call {
                     parcelableCall.getCapabilities(),
                     parcelableCall.getProperties(),
                     parcelableCall.getDisconnectCause(),
+                    parcelableCall.getCreateTimeMillis(),
                     parcelableCall.getConnectTimeMillis(),
                     parcelableCall.getGatewayInfo(),
                     parcelableCall.getVideoState(),
diff --git a/telecomm/java/android/telecom/ParcelableCall.java b/telecomm/java/android/telecom/ParcelableCall.java
index 6212a77feba..83988726542 100644
--- a/telecomm/java/android/telecom/ParcelableCall.java
+++ b/telecomm/java/android/telecom/ParcelableCall.java
@@ -40,6 +40,7 @@ public final class ParcelableCall implements Parcelable {
     private final int mCapabilities;
     private final int mProperties;
     private final int mSupportedAudioRoutes;
+    private final long mCreateTimeMillis;
     private final long mConnectTimeMillis;
     private final Uri mHandle;
     private final int mHandlePresentation;
@@ -69,6 +70,7 @@ public final class ParcelableCall implements Parcelable {
             int capabilities,
             int properties,
             int supportedAudioRoutes,
+            long createTimeMillis,
             long connectTimeMillis,
             Uri handle,
             int handlePresentation,
@@ -95,6 +97,7 @@ public final class ParcelableCall implements Parcelable {
         mCapabilities = capabilities;
         mProperties = properties;
         mSupportedAudioRoutes = supportedAudioRoutes;
+        mCreateTimeMillis = createTimeMillis;
         mConnectTimeMillis = connectTimeMillis;
         mHandle = handle;
         mHandlePresentation = handlePresentation;
@@ -154,6 +157,14 @@ public final class ParcelableCall implements Parcelable {
         return mSupportedAudioRoutes;
     }
 
+    /**
+     * The time that the call object was created
+     * @hide
+     */
+    public long getCreateTimeMillis() {
+        return mCreateTimeMillis;
+    }
+
     /** The time that the call switched to the active state. */
     public long getConnectTimeMillis() {
         return mConnectTimeMillis;
@@ -312,6 +323,7 @@ public final class ParcelableCall implements Parcelable {
             source.readList(cannedSmsResponses, classLoader);
             int capabilities = source.readInt();
             int properties = source.readInt();
+            long createTimeMillis = source.readLong();
             long connectTimeMillis = source.readLong();
             Uri handle = source.readParcelable(classLoader);
             int handlePresentation = source.readInt();
@@ -343,6 +355,7 @@ public final class ParcelableCall implements Parcelable {
                     capabilities,
                     properties,
                     supportedAudioRoutes,
+                    createTimeMillis,
                     connectTimeMillis,
                     handle,
                     handlePresentation,
@@ -385,6 +398,7 @@ public final class ParcelableCall implements Parcelable {
         destination.writeList(mCannedSmsResponses);
         destination.writeInt(mCapabilities);
         destination.writeInt(mProperties);
+        destination.writeLong(mCreateTimeMillis);
         destination.writeLong(mConnectTimeMillis);
         destination.writeParcelable(mHandle, 0);
         destination.writeInt(mHandlePresentation);
-- 
2.17.1

