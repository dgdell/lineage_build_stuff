From 49f4c7b95d25cb542dd36c56ae9632d32706acee Mon Sep 17 00:00:00 2001
From: Aaron Kling <webgeek1234@gmail.com>
Date: Tue, 7 Nov 2017 13:59:01 -0600
Subject: [PATCH 08/11] Expose updateChannelList [2/2]

Change-Id: Id0703e1493c1722ab825c00d2133f8ef7475680e
---
 .../java/com/android/server/wifi/WifiServiceImpl.java |  5 +++++
 .../com/android/server/wifi/WifiStateMachine.java     | 11 +++++++++++
 2 files changed, 16 insertions(+)

diff --git a/service/java/com/android/server/wifi/WifiServiceImpl.java b/service/java/com/android/server/wifi/WifiServiceImpl.java
index ea724510e..b30314e62 100644
--- a/service/java/com/android/server/wifi/WifiServiceImpl.java
+++ b/service/java/com/android/server/wifi/WifiServiceImpl.java
@@ -2781,4 +2781,9 @@ public class WifiServiceImpl extends IWifiManager.Stub {
 
         return mWifiStateMachine.syncGetChannelList(this.mWifiStateMachineChannel);
     }
+
+    @Override
+    public void updateChannelList() {
+        mWifiStateMachine.updateChannelList();
+    }
 }
diff --git a/service/java/com/android/server/wifi/WifiStateMachine.java b/service/java/com/android/server/wifi/WifiStateMachine.java
index a931e5948..6c305b48c 100644
--- a/service/java/com/android/server/wifi/WifiStateMachine.java
+++ b/service/java/com/android/server/wifi/WifiStateMachine.java
@@ -2176,6 +2176,10 @@ public class WifiStateMachine extends StateMachine implements WifiNative.WifiRss
         }
     }
 
+    public void updateChannelList() {
+        sendMessage(NvWifi.CMD_NV_UPDATE_CHANNEL_LIST);
+    }
+
     /**
      * Enable TDLS for a specific MAC address
      */
@@ -4167,6 +4171,13 @@ public class WifiStateMachine extends StateMachine implements WifiNative.WifiRss
                 case CMD_DIAGS_CONNECT_TIMEOUT:
                     mWifiDiagnostics.reportConnectionEvent(
                             (Long) message.obj, BaseWifiDiagnostics.CONNECTION_EVENT_FAILED);
+                case NvWifi.CMD_NV_UPDATE_CHANNEL_LIST:
+                    //int currentBand = Global.getInt(mContext.getContentResolver(), "wifi_frequency_band", 0);
+                    if (!mNvWifi.updateChannelList()) {
+                        Log.e(TAG, "Failed to update channel list");
+                        break;
+                    }
+                    break;
                 case NvWifi.CMD_NV_GET_APP_PROP:
                     replyToMessage(message, message.what, message.obj);
                     break;
-- 
2.17.1

