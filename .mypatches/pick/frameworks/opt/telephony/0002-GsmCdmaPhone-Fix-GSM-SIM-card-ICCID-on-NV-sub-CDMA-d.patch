From 71e503882933d5eae061c5aa22b6b2d94213f1f3 Mon Sep 17 00:00:00 2001
From: nadlabak <pavel@doshaska.net>
Date: Mon, 17 Apr 2017 02:52:04 +0200
Subject: [PATCH 2/4] GsmCdmaPhone: Fix GSM SIM card ICCID on NV sub CDMA
 devices

The commit 94ae0fe784f0701d3c3bb3c7575362dc6684300b
("GsmCdmaPhone: Return dummy ICCID serial for NV sub")
broke the reported ICCID for GSM SIM cards when used
in global capable NV subscription CDMA devices.

GSM SIM ICCID shouldn't depend on the selected CDMA
subscription source in any way.

Change-Id: Ief48eba854f7c954eaa5132742fe00dc8aa9be13
(cherry picked from commit 71c8c9583cd58434557856b3a657ab531f491a1d)
---
 .../com/android/internal/telephony/GsmCdmaPhone.java | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/java/com/android/internal/telephony/GsmCdmaPhone.java b/src/java/com/android/internal/telephony/GsmCdmaPhone.java
index 5abcefb80..c2f8a7f45 100644
--- a/src/java/com/android/internal/telephony/GsmCdmaPhone.java
+++ b/src/java/com/android/internal/telephony/GsmCdmaPhone.java
@@ -729,11 +729,11 @@ public class GsmCdmaPhone extends Phone {
 
     @Override
     public String getIccSerialNumber() {
-        if (mCdmaSubscriptionSource == CDMA_SUBSCRIPTION_NV) {
-            return DUMMY_NV_ICC_SERIAL;
-        }
         IccRecords r = mIccRecords.get();
         if (!isPhoneTypeGsm() && r == null) {
+            if (mCdmaSubscriptionSource == CDMA_SUBSCRIPTION_NV) {
+                return DUMMY_NV_ICC_SERIAL;
+            }
             // to get ICCID form SIMRecords because it is on MF.
             r = mUiccController.getIccRecords(mPhoneId, UiccController.APP_FAM_3GPP);
         }
@@ -742,11 +742,11 @@ public class GsmCdmaPhone extends Phone {
 
     @Override
     public String getFullIccSerialNumber() {
-        if (mCdmaSubscriptionSource == CDMA_SUBSCRIPTION_NV) {
-            return DUMMY_NV_ICC_SERIAL;
-        }
         IccRecords r = mIccRecords.get();
         if (!isPhoneTypeGsm() && r == null) {
+            if (mCdmaSubscriptionSource == CDMA_SUBSCRIPTION_NV) {
+                return DUMMY_NV_ICC_SERIAL;
+            }
             // to get ICCID form SIMRecords because it is on MF.
             r = mUiccController.getIccRecords(mPhoneId, UiccController.APP_FAM_3GPP);
         }
-- 
2.17.0

