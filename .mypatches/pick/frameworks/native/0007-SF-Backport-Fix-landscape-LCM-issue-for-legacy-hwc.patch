From 89b051dbc3eb7cc5dc04317a0bb3c32ab080e509 Mon Sep 17 00:00:00 2001
From: Iris Chang <iris.chang@mediatek.com>
Date: Mon, 30 Jul 2018 00:23:01 +0300
Subject: [PATCH 7/7] SF: Backport "Fix landscape LCM issue" for legacy hwc

Change-Id: Ib3a2c88e68db96c80db636addbf038ec9f6b7c35
Signed-off-by: Vladimir Oltean <olteanv@gmail.com>
---
 services/surfaceflinger/SurfaceFlinger_hwc1.cpp | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/services/surfaceflinger/SurfaceFlinger_hwc1.cpp b/services/surfaceflinger/SurfaceFlinger_hwc1.cpp
index fa591048c..5e37aa8f4 100644
--- a/services/surfaceflinger/SurfaceFlinger_hwc1.cpp
+++ b/services/surfaceflinger/SurfaceFlinger_hwc1.cpp
@@ -3822,8 +3822,14 @@ void SurfaceFlinger::renderScreenImplLocked(
     // get screen geometry
     const int32_t hw_w = hw->getWidth();
     const int32_t hw_h = hw->getHeight();
-    const bool filtering = static_cast<int32_t>(reqWidth) != hw_w ||
-                           static_cast<int32_t>(reqHeight) != hw_h;
+    bool filtering = false;
+    if (mHwOrientation & DisplayState::eOrientationSwapMask) {
+        filtering = static_cast<int32_t>(reqWidth) != hw_h ||
+                static_cast<int32_t>(reqHeight) != hw_w;
+    } else {
+        filtering = static_cast<int32_t>(reqWidth) != hw_w ||
+                static_cast<int32_t>(reqHeight) != hw_h;
+    }
 
     // if a default or invalid sourceCrop is passed in, set reasonable values
     if (sourceCrop.width() == 0 || sourceCrop.height() == 0 ||
-- 
2.17.1

