From 3f2c1013f969d94f0b77867a1642ca3f6edcb5e3 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mikeioannina@gmail.com>
Date: Tue, 14 Jul 2015 16:59:30 +0300
Subject: [PATCH] Fix mounting of non-FAT formatted SD cards (2/2)

Change-Id: I77fe9e09b523bcba68dd2409def68acb715ca33c
---
 src/com/android/providers/media/MediaProvider.java | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/src/com/android/providers/media/MediaProvider.java b/src/com/android/providers/media/MediaProvider.java
index 8f3b54b..9ac26e0 100644
--- a/src/com/android/providers/media/MediaProvider.java
+++ b/src/com/android/providers/media/MediaProvider.java
@@ -1297,7 +1297,7 @@ public class MediaProvider extends ContentProvider {
 
         // Used temporarily (until we have unique media IDs) to get an identifier
         // for the current sd card, so that the music app doesn't have to use the
-        // non-public getFatVolumeId method
+        // non-public getVolumeId method
         if (table == FS_ID) {
             MatrixCursor c = new MatrixCursor(new String[] {"fsid"});
             c.addRow(new Integer[] {mVolumeId});
@@ -4781,11 +4781,11 @@ public class MediaProvider extends ContentProvider {
                 helper = new DatabaseHelper(context, INTERNAL_DATABASE_NAME, true,
                         false, mObjectRemovedCallback);
             } else if (EXTERNAL_VOLUME.equals(volume)) {
-                // Only extract FAT volume ID for primary public
+                // Only extract volume ID for primary public
                 final VolumeInfo vol = mStorageManager.getPrimaryPhysicalVolume();
                 if (vol != null) {
                     final StorageVolume actualVolume = mStorageManager.getPrimaryVolume();
-                    final int volumeId = actualVolume.getFatVolumeId();
+                    final int volumeId = actualVolume.getVolumeId();
 
                     // Must check for failure!
                     // If the volume is not (yet) mounted, this will create a new
@@ -4798,8 +4798,8 @@ public class MediaProvider extends ContentProvider {
                                 Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
                             // This may happen if external storage was _just_ mounted.  It may also
                             // happen if the volume ID is _actually_ 0xffffffff, in which case it
-                            // must be changed since FileUtils::getFatVolumeId doesn't allow for
-                            // that.  It may also indicate that FileUtils::getFatVolumeId is broken
+                            // must be changed since FileUtils::getVolumeId doesn't allow for
+                            // that.  It may also indicate that FileUtils::getVolumeId is broken
                             // (missing ioctl), which is also impossible to disambiguate.
                             Log.e(TAG, "Can't obtain external volume ID even though it's mounted.");
                         } else {
@@ -4965,7 +4965,7 @@ public class MediaProvider extends ContentProvider {
     // name of the volume currently being scanned by the media scanner (or null)
     private String mMediaScannerVolume;
 
-    // current FAT volume ID
+    // current volume ID
     private int mVolumeId = -1;
 
     static final String INTERNAL_VOLUME = "internal";
-- 
2.17.1

