From ce92d7f75b55b35a2f13a5cf9663eb9fcea1ba63 Mon Sep 17 00:00:00 2001
From: Edward Wang <ewang@cyngn.com>
Date: Wed, 8 Apr 2015 13:16:02 -0700
Subject: [PATCH 17/28] make default overlay for "show correction suggestion"

Change-Id: I0d403021e2315ab0178b9aa7a8f5e4fa7f3f24b7
---
 java/res/values/config.xml                                 | 3 +++
 java/res/xml/prefs_screen_correction.xml                   | 1 -
 .../latin/settings/CorrectionSettingsFragment.java         | 7 +++++++
 .../android/inputmethod/latin/settings/SettingsValues.java | 7 ++++---
 4 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/java/res/values/config.xml b/java/res/values/config.xml
index 33bcb0603..84f038f78 100644
--- a/java/res/values/config.xml
+++ b/java/res/values/config.xml
@@ -109,4 +109,7 @@
     <string-array name="keyboard_switcher_symbols_shifted" translatable="false">
         <item>58,32</item> <!-- KeyEvent.KEYCODE_ALT_RIGHT , KeyEvent.META_ALT_RIGHT_ON -->
     </string-array>
+
+    <!-- Display suggested words while typing  -->
+    <bool name="config_show_suggestions_default">true</bool>
 </resources>
diff --git a/java/res/xml/prefs_screen_correction.xml b/java/res/xml/prefs_screen_correction.xml
index a943dc1a3..f620ac05f 100644
--- a/java/res/xml/prefs_screen_correction.xml
+++ b/java/res/xml/prefs_screen_correction.xml
@@ -51,7 +51,6 @@
         android:key="show_suggestions"
         android:summary="@string/prefs_show_suggestions_summary"
         android:title="@string/prefs_show_suggestions"
-        android:defaultValue="true"
         android:persistent="true" />
     <CheckBoxPreference
         android:key="pref_key_use_personalized_dicts"
diff --git a/java/src/com/android/inputmethod/latin/settings/CorrectionSettingsFragment.java b/java/src/com/android/inputmethod/latin/settings/CorrectionSettingsFragment.java
index dfe899ece..f3e7f6084 100644
--- a/java/src/com/android/inputmethod/latin/settings/CorrectionSettingsFragment.java
+++ b/java/src/com/android/inputmethod/latin/settings/CorrectionSettingsFragment.java
@@ -90,6 +90,13 @@ public final class CorrectionSettingsFragment extends SubScreenFragment
 
         mUseContactsPreference = (SwitchPreference) findPreference(Settings.PREF_KEY_USE_CONTACTS_DICT);
         turnOffUseContactsIfNoPermission();
+
+        final SwitchPreference suggestionsEnabledPreference = (SwitchPreference) findPreference(
+                Settings.PREF_SHOW_SUGGESTIONS);
+        if (suggestionsEnabledPreference != null) {
+            suggestionsEnabledPreference.setChecked(
+                    Settings.getInstance().getCurrent().isSuggestionsEnabledPerUserSettings());
+        }
     }
 
     private void overwriteUserDictionaryPreference(final Preference userDictionaryPreference) {
diff --git a/java/src/com/android/inputmethod/latin/settings/SettingsValues.java b/java/src/com/android/inputmethod/latin/settings/SettingsValues.java
index 57018244f..fa5ae00c4 100644
--- a/java/src/com/android/inputmethod/latin/settings/SettingsValues.java
+++ b/java/src/com/android/inputmethod/latin/settings/SettingsValues.java
@@ -184,7 +184,7 @@ public class SettingsValues {
                 && prefs.getBoolean(Settings.PREF_GESTURE_FLOATING_PREVIEW_TEXT, true);
         mAutoCorrectionEnabledPerUserSettings = mAutoCorrectEnabled
                 && !mInputAttributes.mInputTypeNoAutoCorrect;
-        mSuggestionsEnabledPerUserSettings = readSuggestionsEnabled(prefs);
+        mSuggestionsEnabledPerUserSettings = readSuggestionsEnabled(prefs, res);
         mIsInternal = Settings.isInternal(prefs);
         mHasCustomKeyPreviewAnimationParams = prefs.getBoolean(
                 DebugSettings.PREF_HAS_CUSTOM_KEY_PREVIEW_ANIMATION_PARAMS, false);
@@ -303,7 +303,7 @@ public class SettingsValues {
 
     private static final String SUGGESTIONS_VISIBILITY_HIDE_VALUE_OBSOLETE = "2";
 
-    private static boolean readSuggestionsEnabled(final SharedPreferences prefs) {
+    private static boolean readSuggestionsEnabled(final SharedPreferences prefs, Resources res) {
         if (prefs.contains(Settings.PREF_SHOW_SUGGESTIONS_SETTING_OBSOLETE)) {
             final boolean alwaysHide = SUGGESTIONS_VISIBILITY_HIDE_VALUE_OBSOLETE.equals(
                     prefs.getString(Settings.PREF_SHOW_SUGGESTIONS_SETTING_OBSOLETE, null));
@@ -312,7 +312,8 @@ public class SettingsValues {
                     .putBoolean(Settings.PREF_SHOW_SUGGESTIONS, !alwaysHide)
                     .apply();
         }
-        return prefs.getBoolean(Settings.PREF_SHOW_SUGGESTIONS, true);
+        return prefs.getBoolean(Settings.PREF_SHOW_SUGGESTIONS, res.getBoolean(
+                                R.bool.config_show_suggestions_default));
     }
 
     private static boolean readBigramPredictionEnabled(final SharedPreferences prefs,
-- 
2.17.1

