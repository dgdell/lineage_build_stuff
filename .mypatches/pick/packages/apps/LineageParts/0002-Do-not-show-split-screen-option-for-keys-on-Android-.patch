From 01dcfeee911c6c6db953af148c51f96f679e6c7e Mon Sep 17 00:00:00 2001
From: Tobias Tefke <tobias.tefke@gmail.com>
Date: Sat, 3 Mar 2018 13:57:36 +0100
Subject: [PATCH 2/6] Do not show split-screen option for keys on Android Go
 devices

Change-Id: Ibbbc8a4a718d5d6e089c059e2270b17651d3828e
---
 res/values/arrays.xml                         | 39 +++++++++++++++
 .../lineageparts/input/ButtonSettings.java    | 48 +++++++++++++++++++
 2 files changed, 87 insertions(+)

diff --git a/res/values/arrays.xml b/res/values/arrays.xml
index fd1bf7c..a86234b 100644
--- a/res/values/arrays.xml
+++ b/res/values/arrays.xml
@@ -69,6 +69,27 @@
         -->
     </string-array>
 
+    <!-- Hardware key rebinding for Go enabled devices -->
+    <string-array name="hardware_keys_action_entries_go" translatable="false">
+        <item>@string/hardware_keys_action_nothing</item>
+        <item>@string/hardware_keys_action_menu</item>
+        <item>@string/hardware_keys_action_app_switch</item>
+        <item>@string/hardware_keys_action_search</item>
+        <item>@string/hardware_keys_action_voice_search</item>
+        <item>@string/hardware_keys_action_in_app_search</item>
+        <item>@string/hardware_keys_action_launch_camera</item>
+        <item>@string/hardware_keys_action_sleep</item>
+        <item>@string/hardware_keys_action_last_app</item>
+        <!--
+        split-screen is not supported on Android Go devices
+        <item>@string/hardware_keys_action_split_screen</item>
+        -->
+        <!--
+        <item>@string/hardware_keys_action_single_handed_left</item>
+        <item>@string/hardware_keys_action_single_handed_right</item>
+        -->
+    </string-array>
+
     <string-array name="hardware_keys_action_values" translatable="false">
         <item>0</item>
         <item>1</item>
@@ -84,6 +105,24 @@
         <item>11</item>
     </string-array>
 
+    <string-array name="hardware_keys_action_values_go" translatable="false">
+        <item>0</item>
+        <item>1</item>
+        <item>2</item>
+        <item>3</item>
+        <item>4</item>
+        <item>5</item>
+        <item>6</item>
+        <item>7</item>
+        <item>8</item>
+        <!--
+        split-screen is not supported on Android Go devices
+        <item>9</item>
+        -->
+        <item>10</item>
+        <item>11</item>
+    </string-array>
+
     <!-- Volume key cursor control -->
     <string-array name="volbtn_cursor_control_entries" translatable="false">
         <item>@string/volbtn_cursor_control_off</item>
diff --git a/src/org/lineageos/lineageparts/input/ButtonSettings.java b/src/org/lineageos/lineageparts/input/ButtonSettings.java
index d4de027..e598e57 100644
--- a/src/org/lineageos/lineageparts/input/ButtonSettings.java
+++ b/src/org/lineageos/lineageparts/input/ButtonSettings.java
@@ -17,6 +17,7 @@
 
 package org.lineageos.lineageparts.input;
 
+import android.app.ActivityManager;
 import android.content.ComponentName;
 import android.content.ContentResolver;
 import android.content.Context;
@@ -425,6 +426,53 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
                 mVolumeWakeScreen.setDisableDependentsState(true);
             }
         }
+
+        // Override key actions on Go devices in order to hide any unsupported features
+        if (ActivityManager.isLowRamDeviceStatic()) {
+            String[] actionEntriesGo = res.getStringArray(R.array.hardware_keys_action_entries_go);
+            String[] actionValuesGo = res.getStringArray(R.array.hardware_keys_action_values_go);
+
+            if (hasHomeKey) {
+                mHomeLongPressAction.setEntries(actionEntriesGo);
+                mHomeLongPressAction.setEntryValues(actionValuesGo);
+
+                mHomeDoubleTapAction.setEntries(actionEntriesGo);
+                mHomeDoubleTapAction.setEntryValues(actionValuesGo);
+            }
+
+            if (hasMenuKey) {
+                mMenuPressAction.setEntries(actionEntriesGo);
+                mMenuPressAction.setEntryValues(actionValuesGo);
+
+                mMenuLongPressAction.setEntries(actionEntriesGo);
+                mMenuLongPressAction.setEntryValues(actionValuesGo);
+            }
+
+            if (hasAssistKey) {
+                mAssistPressAction.setEntries(actionEntriesGo);
+                mAssistPressAction.setEntryValues(actionValuesGo);
+
+                mAssistLongPressAction.setEntries(actionEntriesGo);
+                mAssistLongPressAction.setEntryValues(actionValuesGo);
+            }
+
+            if (hasAppSwitchKey) {
+                mAppSwitchPressAction.setEntries(actionEntriesGo);
+                mAppSwitchPressAction.setEntryValues(actionValuesGo);
+
+                mAppSwitchLongPressAction.setEntries(actionEntriesGo);
+                mAppSwitchLongPressAction.setEntryValues(actionValuesGo);
+            }
+
+            mNavigationHomeLongPressAction.setEntries(actionEntriesGo);
+            mNavigationHomeLongPressAction.setEntryValues(actionValuesGo);
+
+            mNavigationHomeDoubleTapAction.setEntries(actionEntriesGo);
+            mNavigationHomeDoubleTapAction.setEntryValues(actionValuesGo);
+
+            mNavigationAppSwitchLongPressAction.setEntries(actionEntriesGo);
+            mNavigationAppSwitchLongPressAction.setEntryValues(actionValuesGo);
+        }
     }
 
     @Override
-- 
2.17.0

