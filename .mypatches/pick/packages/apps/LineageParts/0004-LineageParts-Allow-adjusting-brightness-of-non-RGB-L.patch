From 175cb8a992c627d2d14042a306c209a09bcf6aaa Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Sun, 15 Apr 2018 23:54:25 +0300
Subject: [PATCH 4/5] LineageParts: Allow adjusting brightness of non-RGB LEDs

* Mimic NotificationLightSettings logic

Change-Id: Ifc0c899ef78dbdec22fa69ecd0bcffe1a9488afe
---
 .../notificationlight/BatteryLightSettings.java             | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/org/lineageos/lineageparts/notificationlight/BatteryLightSettings.java b/src/org/lineageos/lineageparts/notificationlight/BatteryLightSettings.java
index 0a27e44..c723156 100644
--- a/src/org/lineageos/lineageparts/notificationlight/BatteryLightSettings.java
+++ b/src/org/lineageos/lineageparts/notificationlight/BatteryLightSettings.java
@@ -62,6 +62,8 @@ public class BatteryLightSettings extends SettingsPreferenceFragment implements
     private int mDefaultMediumColor;
     private int mDefaultFullColor;
     private int mBatteryBrightness;
+    // liblights supports brightness control
+    private boolean mHALAdjustableBrightness;
     private boolean mMultiColorLed;
 
     private static final int MENU_RESET = Menu.FIRST;
@@ -76,6 +78,8 @@ public class BatteryLightSettings extends SettingsPreferenceFragment implements
         // Collect battery led capabilities.
         mMultiColorLed =
                 LightsCapabilities.supports(context, LightsCapabilities.LIGHTS_RGB_BATTERY_LED);
+        mHALAdjustableBrightness = LightsCapabilities.supports(
+                context, LightsCapabilities.LIGHTS_ADJUSTABLE_NOTIFICATION_LED_BRIGHTNESS);
         final boolean pulsatingLed =
                 LightsCapabilities.supports(context, LightsCapabilities.LIGHTS_PULSATING_LED);
         final boolean segmentedBatteryLed =
@@ -145,7 +149,7 @@ public class BatteryLightSettings extends SettingsPreferenceFragment implements
         }
 
         // Remove battery LED brightness controls if we can't support them.
-        if (segmentedBatteryLed || !mMultiColorLed) {
+        if (segmentedBatteryLed || (!mMultiColorLed && !mHALAdjustableBrightness)) {
             prefSet.removePreference(prefSet.findPreference(BRIGHTNESS_SECTION));
         }
 
-- 
2.17.0

