From 4f112525bf5289a9ef31cd94587d5800fc45f553 Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Tue, 26 Dec 2017 18:10:05 +0000
Subject: [PATCH 1/8] LineageParts: Bring up button backlight settings

Change-Id: Ie2b2387fdc10d2d71866be10462d3059803926f0
---
 res/xml/button_settings.xml                        |  2 --
 .../input/ButtonBacklightBrightness.java           | 22 ++++++++++++----------
 .../lineageparts/input/ButtonSettings.java         |  8 +-------
 3 files changed, 13 insertions(+), 19 deletions(-)

diff --git a/res/xml/button_settings.xml b/res/xml/button_settings.xml
index ee94d37..b11b03e 100644
--- a/res/xml/button_settings.xml
+++ b/res/xml/button_settings.xml
@@ -25,13 +25,11 @@
         android:summary="@string/disable_navkeys_summary"
         android:defaultValue="false" />
 
-    <!--
     <org.lineageos.lineageparts.input.ButtonBacklightBrightness
         android:key="button_backlight"
         android:title="@string/button_backlight_title"
         android:dialogTitle="@string/button_backlight_title"
         android:persistent="false" />
-    -->
 
     <PreferenceCategory
         android:key="navigation_bar_category"
diff --git a/src/org/lineageos/lineageparts/input/ButtonBacklightBrightness.java b/src/org/lineageos/lineageparts/input/ButtonBacklightBrightness.java
index df2ee0e..ace3daf 100644
--- a/src/org/lineageos/lineageparts/input/ButtonBacklightBrightness.java
+++ b/src/org/lineageos/lineageparts/input/ButtonBacklightBrightness.java
@@ -38,9 +38,10 @@ import android.widget.TextView;
 import org.lineageos.lineageparts.widget.CustomDialogPreference;
 import org.lineageos.lineageparts.R;
 
+import static org.lineageos.internal.util.DeviceKeysConstants.*;
+
 import lineageos.providers.LineageSettings;
 
-/*
 public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialog> implements
         SeekBar.OnSeekBarChangeListener {
     private static final int DEFAULT_BUTTON_TIMEOUT = 5;
@@ -66,11 +67,13 @@ public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialo
 
         setDialogLayoutResource(R.layout.button_backlight);
 
+        /*
         if (isKeyboardSupported()) {
             mKeyboardBrightness = new BrightnessControl(
                     LineageSettings.Secure.KEYBOARD_BRIGHTNESS, false);
             mActiveControl = mKeyboardBrightness;
         }
+        */
         if (isButtonSupported()) {
             boolean isSingleValue = !context.getResources().getBoolean(
                     com.android.internal.R.bool.config_deviceHasVariableButtonBrightness);
@@ -223,23 +226,25 @@ public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialo
     public boolean isButtonSupported() {
         final Resources res = getContext().getResources();
         final int deviceKeys = res.getInteger(
-                com.android.internal.R.integer.config_deviceHardwareKeys);
+                org.lineageos.platform.internal.R.integer.config_deviceHardwareKeys);
         // All hardware keys besides volume and camera can possibly have a backlight
-        boolean hasBacklightKey = (deviceKeys & ButtonSettings.KEY_MASK_HOME) != 0
-                || (deviceKeys & ButtonSettings.KEY_MASK_BACK) != 0
-                || (deviceKeys & ButtonSettings.KEY_MASK_MENU) != 0
-                || (deviceKeys & ButtonSettings.KEY_MASK_ASSIST) != 0
-                || (deviceKeys & ButtonSettings.KEY_MASK_APP_SWITCH) != 0;
+        boolean hasBacklightKey = (deviceKeys & KEY_MASK_HOME) != 0
+                || (deviceKeys & KEY_MASK_BACK) != 0
+                || (deviceKeys & KEY_MASK_MENU) != 0
+                || (deviceKeys & KEY_MASK_ASSIST) != 0
+                || (deviceKeys & KEY_MASK_APP_SWITCH) != 0;
         boolean hasBacklight = res.getInteger(
                 com.android.internal.R.integer.config_buttonBrightnessSettingDefault) > 0;
 
         return hasBacklightKey && hasBacklight;
     }
 
+    /*
     public boolean isKeyboardSupported() {
         return getContext().getResources().getInteger(
                 com.android.internal.R.integer.config_keyboardBrightnessSettingDefault) > 0;
     }
+    */
 
     public void updateSummary() {
         if (mButtonBrightness != null) {
@@ -413,7 +418,6 @@ public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialo
         }
 
         /* Behaviors when it's a seekbar */
-        /*
         @Override
         public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) {
             handleBrightnessUpdate(progress);
@@ -430,7 +434,6 @@ public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialo
         }
 
         /* Behaviors when it's a plain checkbox */
-        /*
         @Override
         public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
             mActiveControl = this;
@@ -459,4 +462,3 @@ public class ButtonBacklightBrightness extends CustomDialogPreference<AlertDialo
         }
     }
 }
-*/
diff --git a/src/org/lineageos/lineageparts/input/ButtonSettings.java b/src/org/lineageos/lineageparts/input/ButtonSettings.java
index 0852ed2..fb61719 100644
--- a/src/org/lineageos/lineageparts/input/ButtonSettings.java
+++ b/src/org/lineageos/lineageparts/input/ButtonSettings.java
@@ -394,13 +394,11 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
             Log.e(TAG, "Error getting navigation bar status");
         }
 
-        /*
         final ButtonBacklightBrightness backlight =
                 (ButtonBacklightBrightness) findPreference(KEY_BUTTON_BACKLIGHT);
-        if (!backlight.isButtonSupported() && !backlight.isKeyboardSupported()) {
+        if (!backlight.isButtonSupported() /*&& !backlight.isKeyboardSupported()*/) {
             prefScreen.removePreference(backlight);
         }
-        */
 
         if (mCameraWakeScreen != null) {
             if (mCameraSleepOnRelease != null && !getResources().getBoolean(
@@ -546,19 +544,15 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
                 (PreferenceCategory) prefScreen.findPreference(CATEGORY_ASSIST);
         final PreferenceCategory appSwitchCategory =
                 (PreferenceCategory) prefScreen.findPreference(CATEGORY_APPSWITCH);
-        /*
         final ButtonBacklightBrightness backlight =
                 (ButtonBacklightBrightness) prefScreen.findPreference(KEY_BUTTON_BACKLIGHT);
-        */
 
         /* Toggle backlight control depending on navbar state, force it to
            off if enabling */
-        /*
         if (backlight != null) {
             backlight.setEnabled(!navbarEnabled);
             backlight.updateSummary();
         }
-        */
 
         /* Toggle hardkey control availability depending on navbar state */
         if (mNavigationPreferencesCat != null) {
-- 
2.7.4

