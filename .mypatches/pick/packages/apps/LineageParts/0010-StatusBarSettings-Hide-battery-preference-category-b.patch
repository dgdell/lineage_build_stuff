From 1f91a08fd275b7cb3ebfeaf6877c39cb537dee2c Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Sat, 28 Jul 2018 01:01:30 +0100
Subject: [PATCH 10/13] StatusBarSettings: Hide battery preference category
 based on icon visibility

Change-Id: I5abc4419d42ba17f3de9246d1302b1c2828d0dc0
---
 res/xml/status_bar_settings.xml               |  1 +
 .../statusbar/StatusBarSettings.java          | 21 +++++++++++++++----
 2 files changed, 18 insertions(+), 4 deletions(-)

diff --git a/res/xml/status_bar_settings.xml b/res/xml/status_bar_settings.xml
index a5525f9..8265737 100644
--- a/res/xml/status_bar_settings.xml
+++ b/res/xml/status_bar_settings.xml
@@ -84,6 +84,7 @@
     </PreferenceCategory>
 
     <PreferenceCategory
+        android:key="status_bar_battery_key"
         android:title="@string/status_bar_battery_title">
 
         <lineageos.preference.LineageSystemSettingListPreference
diff --git a/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java b/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
index ffa56e4..5b1e98e 100644
--- a/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
+++ b/src/org/lineageos/lineageparts/statusbar/StatusBarSettings.java
@@ -33,6 +33,7 @@ import org.lineageos.lineageparts.SettingsPreferenceFragment;
 public class StatusBarSettings extends SettingsPreferenceFragment
         implements OnPreferenceChangeListener {
 
+    private static final String CATEGORY_BATTERY = "status_bar_battery_key";
     private static final String CATEGORY_CLOCK = "status_bar_clock_key";
 
     private static final String ICON_BLACKLIST = "icon_blacklist";
@@ -55,6 +56,7 @@ public class StatusBarSettings extends SettingsPreferenceFragment
     private LineageSystemSettingListPreference mStatusBarBattery;
     private LineageSystemSettingListPreference mStatusBarBatteryShowPercent;
 
+    private PreferenceCategory mStatusBarBatteryCategory;
     private PreferenceCategory mStatusBarClockCategory;
 
     @Override
@@ -77,6 +79,9 @@ public class StatusBarSettings extends SettingsPreferenceFragment
         mStatusBarBattery.setOnPreferenceChangeListener(this);
         enableStatusBarBatteryDependents(mStatusBarBattery.getIntValue(2));
 
+        mStatusBarBatteryCategory =
+                (PreferenceCategory) getPreferenceScreen().findPreference(CATEGORY_BATTERY);
+
         mQuickPulldown =
                 (LineageSystemSettingListPreference) findPreference(STATUS_BAR_QUICK_QS_PULLDOWN);
         mQuickPulldown.setOnPreferenceChangeListener(this);
@@ -93,10 +98,18 @@ public class StatusBarSettings extends SettingsPreferenceFragment
         final String curIconBlacklist = Settings.Secure.getString(getContext().getContentResolver(),
                 ICON_BLACKLIST);
 
-        if (curIconBlacklist != null && curIconBlacklist.contains("clock")) {
-            getPreferenceScreen().removePreference(mStatusBarClockCategory);
-        } else {
-            getPreferenceScreen().addPreference(mStatusBarClockCategory);
+        if (curIconBlacklist != null) {
+            if (curIconBlacklist.contains("clock")) {
+                getPreferenceScreen().removePreference(mStatusBarClockCategory);
+            } else {
+                getPreferenceScreen().addPreference(mStatusBarClockCategory);
+            }
+
+            if (curIconBlacklist.contains("battery")) {
+                getPreferenceScreen().removePreference(mStatusBarBatteryCategory);
+            } else {
+                getPreferenceScreen().addPreference(mStatusBarBatteryCategory);
+            }
         }
 
         if (DateFormat.is24HourFormat(getActivity())) {
-- 
2.17.1

