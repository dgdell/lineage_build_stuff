From ffcb8c83617df8482685055fa2d7ed9aee30299e Mon Sep 17 00:00:00 2001
From: Florin9doi <florin9doi@gmail.com>
Date: Fri, 5 Oct 2018 19:17:00 +0300
Subject: [PATCH] Add an option to keep brightness unchanged

Change-Id: I353fd5968e4a961146ab073a2432c488c60e6648
---
 res/values/strings.xml                          | 2 ++
 res/xml/flipflapsettings_panel.xml              | 6 ++++++
 src/org/lineageos/flipflap/FlipFlapService.java | 4 +++-
 src/org/lineageos/flipflap/FlipFlapUtils.java   | 3 +++
 4 files changed, 14 insertions(+), 1 deletion(-)

diff --git a/res/values/strings.xml b/res/values/strings.xml
index a6197d2..bdb3b35 100644
--- a/res/values/strings.xml
+++ b/res/values/strings.xml
@@ -39,6 +39,8 @@
     <string name="pass_to_security_view_summary">Opening the case directly shows lock screen</string>
     <string name="use_high_touch_sensitivity_title">High touch sensitivity</string>
     <string name="use_high_touch_sensitivity_summary">Increase touch sensitivity while cover is closed</string>
+    <string name="increase_brightness_title">Increase brightness</string>
+    <string name="increase_brightness_summary">Increase screen brightness while cover is closed</string>
 
     <string name="category_design">Design</string>
     <string name="switch_charging_status_title">Show charging status</string>
diff --git a/res/xml/flipflapsettings_panel.xml b/res/xml/flipflapsettings_panel.xml
index 44b3d35..d5a8ed4 100644
--- a/res/xml/flipflapsettings_panel.xml
+++ b/res/xml/flipflapsettings_panel.xml
@@ -34,6 +34,12 @@
             android:defaultValue="false"
             android:title="@string/use_high_touch_sensitivity_title"
             android:summary="@string/use_high_touch_sensitivity_summary" />
+
+        <SwitchPreference
+            android:key="increase_brightness"
+            android:defaultValue="true"
+            android:title="@string/increase_brightness_title"
+            android:summary="@string/increase_brightness_summary" />
     </PreferenceCategory>
 
     <PreferenceCategory
diff --git a/src/org/lineageos/flipflap/FlipFlapService.java b/src/org/lineageos/flipflap/FlipFlapService.java
index 45bf630..1cdbed3 100644
--- a/src/org/lineageos/flipflap/FlipFlapService.java
+++ b/src/org/lineageos/flipflap/FlipFlapService.java
@@ -78,7 +78,9 @@ public class FlipFlapService extends Service {
             } else {
                 WindowManager.LayoutParams params = new WindowManager.LayoutParams(
                         WindowManager.LayoutParams.TYPE_BOOT_PROGRESS);
-                params.screenBrightness = mCoverView.getScreenBrightness();
+                if (FlipFlapUtils.shouldIncreaseBrightness(getApplicationContext())) {
+                    params.screenBrightness = mCoverView.getScreenBrightness();
+                }
                 params.screenOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;
                 mWm.addView(mCoverView, params);
             }
diff --git a/src/org/lineageos/flipflap/FlipFlapUtils.java b/src/org/lineageos/flipflap/FlipFlapUtils.java
index 03bd9c6..15f28f1 100644
--- a/src/org/lineageos/flipflap/FlipFlapUtils.java
+++ b/src/org/lineageos/flipflap/FlipFlapUtils.java
@@ -90,4 +90,7 @@ public class FlipFlapUtils {
         return hardware.isSupported(LineageHardwareManager.FEATURE_HIGH_TOUCH_SENSITIVITY);
     }
 
+    public static boolean shouldIncreaseBrightness(Context context) {
+        return getPreferences(context).getBoolean("increase_brightness", true);
+    }
 }
-- 
2.17.1

