From f416bf58299f2058bc2b987b17589bfb3435e981 Mon Sep 17 00:00:00 2001
From: Tom Marshall <tdm@cyngn.com>
Date: Mon, 5 Jan 2015 16:16:20 -0800
Subject: [PATCH 5/7] Allow access to external storage

Change-Id: Ic00d3dd325af75beb81500ac74d3c27bbab8f0bc

Terminal: add runtime permissions

Change-Id: I31a8dd691ef2d2e300c4205278f2bff530b14b11
Signed-off-by: jrizzoli <joey@cyanogenmoditalia.it>
---
 AndroidManifest.xml                            |  4 ++++
 src/com/android/terminal/TerminalActivity.java | 10 ++++++++++
 2 files changed, 14 insertions(+)

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index 441ba7f..e5f1956 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -16,6 +16,10 @@
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
         package="com.android.terminal">
 
+    <uses-sdk android:minSdkVersion="23"  />
+
+    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
+
     <uses-feature android:name="android.software.leanback"
         android:required="false" />
 
diff --git a/src/com/android/terminal/TerminalActivity.java b/src/com/android/terminal/TerminalActivity.java
index 8fa5266..e23b862 100644
--- a/src/com/android/terminal/TerminalActivity.java
+++ b/src/com/android/terminal/TerminalActivity.java
@@ -18,6 +18,7 @@ package com.android.terminal;
 
 import static com.android.terminal.Terminal.TAG;
 
+import android.Manifest;
 import android.app.Activity;
 import android.content.ComponentName;
 import android.content.Context;
@@ -25,6 +26,7 @@ import android.content.Intent;
 import android.content.ServiceConnection;
 import android.content.SharedPreferences;
 import android.content.pm.ActivityInfo;
+import android.content.pm.PackageManager;
 import android.os.Bundle;
 import android.os.IBinder;
 import android.os.Parcelable;
@@ -200,6 +202,14 @@ public class TerminalActivity extends Activity {
 
         View decorView = getWindow().getDecorView();
         decorView.setOnSystemUiVisibilityChangeListener(mUiVisibilityChangeListener);
+
+        final int REQUEST_WRITE_STORAGE = 51;
+
+        if (checkSelfPermission(android.Manifest.permission.WRITE_EXTERNAL_STORAGE)
+                != PackageManager.PERMISSION_GRANTED) {
+            requestPermissions(new String[]{android.Manifest.permission.WRITE_EXTERNAL_STORAGE},
+                    REQUEST_WRITE_STORAGE);
+        }
     }
 
     @Override
-- 
2.17.1

