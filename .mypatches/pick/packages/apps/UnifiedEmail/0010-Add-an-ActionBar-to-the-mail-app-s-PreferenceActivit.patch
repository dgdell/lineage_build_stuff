From 60c7d4922f518e1568b3929e503b81975e8e47ea Mon Sep 17 00:00:00 2001
From: Danny Baumann <dannybaumann@web.de>
Date: Thu, 15 Oct 2015 14:09:06 +0200
Subject: [PATCH 10/22] Add an ActionBar to the mail app's PreferenceActivity.

Change-Id: Ie068bcb3e0f7f92fc4dc799f5d8913731d5296ba
---
 res/layout/preference_activity.xml            | 38 ++++++++++++++
 res/values/themes.xml                         |  6 +++
 .../ui/settings/BasePreferenceActivity.java   | 49 +++++++++++++++++++
 .../ui/settings/MailPreferenceActivity.java   | 19 ++++---
 4 files changed, 102 insertions(+), 10 deletions(-)
 create mode 100644 res/layout/preference_activity.xml
 create mode 100644 src/com/android/mail/ui/settings/BasePreferenceActivity.java

diff --git a/res/layout/preference_activity.xml b/res/layout/preference_activity.xml
new file mode 100644
index 000000000..ef37257d0
--- /dev/null
+++ b/res/layout/preference_activity.xml
@@ -0,0 +1,38 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+     Copyright (C) 2015 The CyanogenMod Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:orientation="vertical"
+    android:layout_width="match_parent"
+    android:layout_height="match_parent">
+
+    <android.widget.Toolbar
+        android:id="@+id/toolbar"
+        android:layout_width="match_parent"
+        android:layout_height="wrap_content"
+        android:elevation="4dp"
+        android:theme="@style/HeaderTheme"
+        android:background="@color/primary_color"
+        android:navigationIcon="?attr/homeAsUpIndicator"
+        android:minHeight="?android:attr/actionBarSize" />
+
+    <FrameLayout
+        android:id="@android:id/content"
+        android:layout_width="match_parent"
+        android:layout_height="0dp"
+        android:layout_weight="1" />
+
+</LinearLayout>
diff --git a/res/values/themes.xml b/res/values/themes.xml
index 550f1f5ec..824c639a9 100644
--- a/res/values/themes.xml
+++ b/res/values/themes.xml
@@ -31,6 +31,12 @@
         <item name="android:statusBarColor" tools:ignore="NewApi">@color/mail_activity_status_bar_color</item>
     </style>
 
+    <style name="HeaderTheme" parent="ThemeOverlay.AppCompat.Dark.ActionBar">
+        <item name="android:colorAccent">@color/primary_color</item>
+        <item name="android:popupTheme">@style/ThemeOverlay.AppCompat.Light</item>
+        <item name="android:colorBackground">@color/primary_color</item>
+    </style>
+
     <style name="MailActivityTheme" parent="@style/UnifiedEmailTheme.Appcompat.Toolbar" />
 
     <style name="ComposeTheme" parent="@style/UnifiedEmailTheme.Appcompat">
diff --git a/src/com/android/mail/ui/settings/BasePreferenceActivity.java b/src/com/android/mail/ui/settings/BasePreferenceActivity.java
new file mode 100644
index 000000000..c55bb4c6d
--- /dev/null
+++ b/src/com/android/mail/ui/settings/BasePreferenceActivity.java
@@ -0,0 +1,49 @@
+/*
+ * Copyright (C) 2015 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.mail.ui.settings;
+
+import android.os.Bundle;
+import android.preference.PreferenceActivity;
+import android.view.LayoutInflater;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.Toolbar;
+
+import com.android.mail.R;
+
+public abstract class BasePreferenceActivity extends PreferenceActivity {
+
+    @Override
+    protected void onCreate(Bundle savedInstanceState) {
+        super.onCreate(savedInstanceState);
+
+        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
+        setActionBar(toolbar);
+    }
+
+    @Override
+    public void setContentView(int layoutResID) {
+        final LayoutInflater inflater = getLayoutInflater();
+        View contentView = inflater.inflate(R.layout.preference_activity, null);
+
+        ViewGroup contentWrapper = (ViewGroup) contentView.findViewById(android.R.id.content);
+        inflater.inflate(layoutResID, contentWrapper);
+
+        getWindow().setContentView(contentView);
+    }
+
+}
diff --git a/src/com/android/mail/ui/settings/MailPreferenceActivity.java b/src/com/android/mail/ui/settings/MailPreferenceActivity.java
index 57bb75575..348dffb46 100644
--- a/src/com/android/mail/ui/settings/MailPreferenceActivity.java
+++ b/src/com/android/mail/ui/settings/MailPreferenceActivity.java
@@ -17,14 +17,12 @@
 
 package com.android.mail.ui.settings;
 
-import android.app.ActionBar;
 import android.app.Fragment;
 import android.app.LoaderManager.LoaderCallbacks;
 import android.content.CursorLoader;
 import android.content.Loader;
 import android.database.Cursor;
 import android.os.Bundle;
-import android.preference.PreferenceActivity;
 import android.text.TextUtils;
 
 import com.android.mail.R;
@@ -37,7 +35,7 @@ import com.google.common.annotations.VisibleForTesting;
 import java.lang.ref.WeakReference;
 import java.util.List;
 
-public class MailPreferenceActivity extends PreferenceActivity {
+public class MailPreferenceActivity extends BasePreferenceActivity {
 
     public static final String PREFERENCE_FRAGMENT_ID = "preference_fragment_id";
 
@@ -51,13 +49,6 @@ public class MailPreferenceActivity extends PreferenceActivity {
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
 
-        final ActionBar actionBar = getActionBar();
-        if (actionBar != null) {
-            // Hide the app icon.
-            actionBar.setIcon(android.R.color.transparent);
-            actionBar.setDisplayUseLogoEnabled(false);
-        }
-
         getLoaderManager().initLoader(ACCOUNT_LOADER_ID, null, new AccountLoaderCallbacks());
     }
 
@@ -138,4 +129,12 @@ public class MailPreferenceActivity extends PreferenceActivity {
      */
     public void onBuildExtraHeaders(List<Header> target) {
     }
+
+    @Override
+    public void switchToHeader(String fragmentName, Bundle args) {
+        super.switchToHeader(fragmentName, args);
+        if (args != null && args.containsKey(MailAccountPrefsFragment.ARG_ACCOUNT_EMAIL)) {
+            showBreadCrumbs(args.getString(MailAccountPrefsFragment.ARG_ACCOUNT_EMAIL), null);
+        }
+    }
 }
-- 
2.17.1

