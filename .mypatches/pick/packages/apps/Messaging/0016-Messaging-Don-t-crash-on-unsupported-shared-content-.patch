From 72e4ce420664e691871f0bc50eacd3df48a60983 Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca020400@lineageos.org>
Date: Tue, 27 Jun 2017 18:09:13 +0200
Subject: [PATCH 16/16] Messaging: Don't crash on unsupported shared content
 type

Change-Id: Ibbd164ecf73ed5b7d4af0cdc0ca670085e96633c
---
 .../ui/conversationlist/ShareIntentActivity.java     | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/com/android/messaging/ui/conversationlist/ShareIntentActivity.java b/src/com/android/messaging/ui/conversationlist/ShareIntentActivity.java
index 1c91e46..6d51de2 100644
--- a/src/com/android/messaging/ui/conversationlist/ShareIntentActivity.java
+++ b/src/com/android/messaging/ui/conversationlist/ShareIntentActivity.java
@@ -35,11 +35,14 @@ import com.android.messaging.util.ContentType;
 import com.android.messaging.util.LogUtil;
 import com.android.messaging.util.MediaMetadataRetrieverWrapper;
 import com.android.messaging.util.FileUtil;
+import com.android.messaging.util.UiUtils;
 import com.android.messaging.util.UriUtil;
 
 import java.io.IOException;
 import java.util.ArrayList;
 
+import com.android.messaging.R;
+
 public class ShareIntentActivity extends BaseBugleActivity implements
         ShareIntentFragment.HostInterface {
 
@@ -107,7 +110,10 @@ public class ShareIntentActivity extends BaseBugleActivity implements
                 }
             } else {
                 // Unsupported content type.
-                Assert.fail("Unsupported shared content type for " + contentUri + ": " + contentType
+                finish();
+                UiUtils.showToastAtBottom(R.string.attachment_load_failed_dialog_message);
+                LogUtil.e(LogUtil.BUGLE_TAG,
+                        "Unsupported shared content type for " + contentUri + ": " + contentType
                         + " (" + intent.getType() + ")");
             }
         } else if (Intent.ACTION_SEND_MULTIPLE.equals(action)) {
@@ -133,7 +139,9 @@ public class ShareIntentActivity extends BaseBugleActivity implements
                 }
             } else {
                 // Unsupported content type.
-                Assert.fail("Unsupported shared content type: " + contentType);
+                finish();
+                UiUtils.showToastAtBottom(R.string.attachment_load_failed_dialog_message);
+                LogUtil.e(LogUtil.BUGLE_TAG, "Unsupported shared content type: " + contentType);
             }
         } else {
             // Unsupported action.
-- 
2.17.1

