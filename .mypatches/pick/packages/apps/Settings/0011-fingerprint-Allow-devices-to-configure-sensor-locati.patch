From 8b9e5c83399037414fe3e1d8d969f8601916dee4 Mon Sep 17 00:00:00 2001
From: d34d <clark@cyngn.com>
Date: Thu, 23 Jun 2016 11:21:45 -0700
Subject: [PATCH 11/16] fingerprint: Allow devices to configure sensor location

This is a squash of the following changes:

Author: d34d <clark@cyngn.com>
Date:   2016-06-23 11:21:45 -0700

    fingerprint: Allow devices to configure sensor location

    The text for enrolling a fingerprint always assumes the sensor is
    located on the back.  This patch adds a config integer that defines
    where the sensor is located on the device.
      0 = back
      1 = front
      2 = left side
      3 = right side

    This patch also adds a new drawable that shows the front of the device
    when applicable.

    Change-Id: Ia8f5f8ff4ba4d13d35aed3052f60ff665dd4f294
    TICKET: CYNGNOS-3089

Author: Paul Keith <javelinanddart@gmail.com>
Date:   2018-01-26 22:23:03 +0100

    FingerprintEnrollFindSensor: Don't overlay front for side sensors

    * Both the base image and the base image + overlay are equally nonsense
      for devices with a side fingerprint scanner, but for those that overlay
      a custom fingerprint enrollment graphic, this image overlay wreaks havoc
    * Only set this overlay to be visible if the sensor is on the front, to
      allow devices with side sensors to only overlay the base image

    Change-Id: I7cbcea4830d4526cf9f7d139e7f84f21117fa9c4

Change-Id: Ia8f5f8ff4ba4d13d35aed3052f60ff665dd4f294
---
 ...gerprint_sensor_location_front_overlay.png | Bin 0 -> 2704 bytes
 .../fingerprint_enroll_find_sensor.xml        |   1 +
 .../fingerprint_enroll_find_sensor_base.xml   |   1 +
 ...fingerprint_enroll_find_sensor_graphic.xml |   9 ++++++
 res/values/cm_arrays.xml                      |  26 +++++++++++++++++
 res/values/cm_strings.xml                     |   9 ++++++
 res/values/lineage_config.xml                 |  27 ++++++++++++++++++
 .../FingerprintEnrollFindSensor.java          |  20 +++++++++++++
 8 files changed, 93 insertions(+)
 create mode 100644 res/drawable-nodpi/fingerprint_sensor_location_front_overlay.png
 create mode 100644 res/values/cm_arrays.xml
 create mode 100644 res/values/lineage_config.xml

diff --git a/res/drawable-nodpi/fingerprint_sensor_location_front_overlay.png b/res/drawable-nodpi/fingerprint_sensor_location_front_overlay.png
new file mode 100644
index 0000000000000000000000000000000000000000..f1e5bde0edd393e666477fc83e88488d86d56c54
GIT binary patch
literal 2704
zcmeAS@N?(olHy`uVBq!ia0y~yV4Tmuz^uW+1{4w4^tJ#<u_bxCyD<C*!3BGlPX>x`
z7I;J!Gcf3QgD~S#+i5F-g6t)pzOL*K*u;f+7_>Qsw=pnq$$GjthE&{od-r1Ar2vNG
z59_T{^k#RSOaJg!{zQ3%iQrv<DE%sq7>fl7+Nt-a7i{j;v7GSv^}@G`j6m~nfP|8%
ziVPOj?{auMe=zVY_4~BX=GoKq(<<kmUX)P!$oOM=-sBpchcl-NEM-Zb`y_l)zN%Z8
z6Z;(rriR6bK3kr2o>Z=C6IyvCRd4R}`?}se0`d)$uUbD``TbAq*3C*)+kRQvtYFxa
zSKRk}#?MWDMd4vy9sCD8SLK}lDD!%m&2h`pkBk;K_dJh@Os`gzdBoiCgTd#p(cgFX
zGfx$RjN0;YT}<@XigQ-$%7o<`jKAL8yTG@6^ULnU+vjWT7}}dRd6hH2)L9>Y^qShw
znNKuN<{wtGV|X65+`2zF{dea@H7DQB%Zpl$|D311gHLwBea7Fp|MqQs;hnQu*^WW^
z++009lu%JS?z^nw{KnH~C(Yp4p;bER_oofBf2C$!dh5T<WB>d0jrY>p8YUk4JmZP;
zxA$CU{>Oj4v-I}vH=Yd=lVaCO9(JDO|8m<B@p-31r&=aX%bT9I+t~PppeB#)!n@I_
z{-@ULN#hd{kXQR}XFSn2pOppVSqFLFm_yd8xiy+nj}D9aq;!|4Z<yIuT6tE+z(8XD
zYooT%ZQ+5I|BG+3bFEgfpHw3*-<Beja3=KIGqqrL+vzJc9~Ms5eAN71X7Tzu6rT{q
zshGV=`?o#Aob`L#G(tT0Rp>IRJ$`+GaaFG&L$a_u!x46dkBmU%P{RO30`ee)Lkuj8
zrVghV#7MY#NJe54gIEnzgrp9)7;YzG^9oKUV)F{soPAt?LBWopgCB$*F#{1W(E||<
zF^Dj#I^1GlBjM&D8Hr5{Vl_|^k~-XCxSfd2E4ZDA%_{@q>>=R9AsVtB{fa0>22$1?
z8Ce`lX*D1v6Yhc%TY)+tP8^~MqT(~O?lff~s;;HABA*-b@kWukjfpBxKvsFW`njxg
HN@xNAP22bb

literal 0
HcmV?d00001

diff --git a/res/layout-land/fingerprint_enroll_find_sensor.xml b/res/layout-land/fingerprint_enroll_find_sensor.xml
index 8712ad70e3..28e07616e4 100644
--- a/res/layout-land/fingerprint_enroll_find_sensor.xml
+++ b/res/layout-land/fingerprint_enroll_find_sensor.xml
@@ -74,6 +74,7 @@
 
                     <TextView
                         style="@style/SuwDescription.Glif"
+                        android:id="@+id/find_sensor_message"
                         android:layout_width="match_parent"
                         android:layout_height="wrap_content"
                         android:text="@string/security_settings_fingerprint_enroll_find_sensor_message"/>
diff --git a/res/layout/fingerprint_enroll_find_sensor_base.xml b/res/layout/fingerprint_enroll_find_sensor_base.xml
index ea518a7c63..9b02dbef09 100644
--- a/res/layout/fingerprint_enroll_find_sensor_base.xml
+++ b/res/layout/fingerprint_enroll_find_sensor_base.xml
@@ -41,6 +41,7 @@
 
             <TextView
                 style="@style/SuwDescription.Glif"
+                android:id="@+id/find_sensor_message"
                 android:layout_width="match_parent"
                 android:layout_height="wrap_content"
                 android:layout_marginTop="@dimen/suw_description_glif_margin_top"
diff --git a/res/layout/fingerprint_enroll_find_sensor_graphic.xml b/res/layout/fingerprint_enroll_find_sensor_graphic.xml
index 1c6ab80adf..14343e10b5 100644
--- a/res/layout/fingerprint_enroll_find_sensor_graphic.xml
+++ b/res/layout/fingerprint_enroll_find_sensor_graphic.xml
@@ -28,6 +28,15 @@
         android:src="@drawable/fingerprint_sensor_location"
         android:scaleType="centerInside"/>
 
+    <ImageView
+        android:id="@+id/fingerprint_sensor_location_front_overlay"
+        android:layout_width="match_parent"
+        android:layout_height="match_parent"
+        android:contentDescription="@string/security_settings_fingerprint_enroll_find_sensor_content_description"
+        android:src="@drawable/fingerprint_sensor_location_front_overlay"
+        android:scaleType="centerInside"
+        android:visibility="gone"/>
+
     <com.android.settings.fingerprint.FingerprintLocationAnimationView
         android:id="@+id/fingerprint_sensor_location_animation"
         android:layout_width="match_parent"
diff --git a/res/values/cm_arrays.xml b/res/values/cm_arrays.xml
new file mode 100644
index 0000000000..a313880f81
--- /dev/null
+++ b/res/values/cm_arrays.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+     Copyright (C) 2016 The CyanogenMod Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<resources>
+    <!-- Fingerprint sensor locations.  Devices should configure their sensor location using
+         config_fingerprintSensorLocation -->
+    <string-array name="security_settings_fingerprint_sensor_locations" translatable="false">
+        <item>@string/security_settings_fingerprint_sensor_location_back</item>
+        <item>@string/security_settings_fingerprint_sensor_location_front</item>
+        <item>@string/security_settings_fingerprint_sensor_location_left</item>
+        <item>@string/security_settings_fingerprint_sensor_location_right</item>
+    </string-array>
+</resources>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index 3dfc5ac883..71da5017d9 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -50,6 +50,15 @@
     <string name="status_bar_double_tap_to_sleep_title">Tap to sleep</string>
     <string name="status_bar_double_tap_to_sleep_summary">Double-tap on the status bar or lockscreen to turn off the display</string>
 
+    <!-- Format string for fingerprint location message -->
+    <string name="security_settings_fingerprint_enroll_find_sensor_message_cm">Locate the fingerprint sensor on the <xliff:g id="sensor_location">%1$s</xliff:g> of your phone.</string>
+
+    <!-- Fingerprint sensor locations -->
+    <string name="security_settings_fingerprint_sensor_location_back">back</string>
+    <string name="security_settings_fingerprint_sensor_location_front">front</string>
+    <string name="security_settings_fingerprint_sensor_location_left">left side</string>
+    <string name="security_settings_fingerprint_sensor_location_right">right side</string>
+
     <!-- Hostname setting -->
     <string name="device_hostname">Device hostname</string>
 
diff --git a/res/values/lineage_config.xml b/res/values/lineage_config.xml
new file mode 100644
index 0000000000..1d1f200319
--- /dev/null
+++ b/res/values/lineage_config.xml
@@ -0,0 +1,27 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+     Copyright (C) 2016 The CyanogenMod Project
+     Copyright (C) 2018 The LineageOS Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+    <!-- Defines the location of the fingerprint sensor on the device
+         0 = back
+         1 = front
+         2 = left side
+         3 = right side
+    -->
+    <integer name="config_fingerprintSensorLocation">0</integer>
+</resources>
diff --git a/src/com/android/settings/fingerprint/FingerprintEnrollFindSensor.java b/src/com/android/settings/fingerprint/FingerprintEnrollFindSensor.java
index 65be08a1a2..25ee1095fa 100644
--- a/src/com/android/settings/fingerprint/FingerprintEnrollFindSensor.java
+++ b/src/com/android/settings/fingerprint/FingerprintEnrollFindSensor.java
@@ -23,6 +23,7 @@ import android.os.UserHandle;
 import android.support.annotation.Nullable;
 import android.view.View;
 import android.widget.Button;
+import android.widget.TextView;
 
 import com.android.internal.logging.nano.MetricsProto.MetricsEvent;
 import com.android.settings.R;
@@ -37,6 +38,10 @@ public class FingerprintEnrollFindSensor extends FingerprintEnrollBase {
 
     private static final int CONFIRM_REQUEST = 1;
     private static final int ENROLLING = 2;
+    private static final int SENSOR_LOCATION_BACK = 0;
+    private static final int SENSOR_LOCATION_FRONT = 1;
+    private static final int SENSOR_LOCATION_LEFT = 2;
+    private static final int SENSOR_LOCATION_RIGHT = 3;
     public static final String EXTRA_KEY_LAUNCHED_CONFIRM = "launched_confirm_lock";
 
     @Nullable
@@ -69,6 +74,21 @@ public class FingerprintEnrollFindSensor extends FingerprintEnrollBase {
         } else {
             mAnimation = null;
         }
+
+        int sensorLocation = getResources().getInteger(R.integer.config_fingerprintSensorLocation);
+        if (sensorLocation < SENSOR_LOCATION_BACK || sensorLocation > SENSOR_LOCATION_RIGHT) {
+            sensorLocation = SENSOR_LOCATION_BACK;
+        }
+        final String location = getResources().getStringArray(
+                R.array.security_settings_fingerprint_sensor_locations)[sensorLocation];
+        TextView message = (TextView) findViewById(R.id.find_sensor_message);
+        message.setText(getString(
+                R.string.security_settings_fingerprint_enroll_find_sensor_message_cm,
+                location));
+        if (sensorLocation == SENSOR_LOCATION_FRONT) {
+            findViewById(R.id.fingerprint_sensor_location_front_overlay)
+                    .setVisibility(View.VISIBLE);
+        }
     }
 
     protected int getContentView() {
-- 
2.17.1

