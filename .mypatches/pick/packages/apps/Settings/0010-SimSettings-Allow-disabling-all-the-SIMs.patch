From b9f56dbc19ea746ed71cbb4b27dbf014b7d3196f Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Mon, 22 Jan 2018 19:43:16 +0100
Subject: [PATCH 10/11] SimSettings: Allow disabling all the SIMs

Change-Id: I465449f204a1bf66a3d3660280fc77494ed54a17
---
 res/values/cm_strings.xml                     |  1 -
 src/com/android/settings/sim/SimSettings.java | 29 ++-------------------------
 2 files changed, 2 insertions(+), 28 deletions(-)

diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index 581280d..7049efa 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -305,7 +305,6 @@
     <string name="sim_enabler_need_switch_data_service">This SIM will be disabled and SIM <xliff:g id="slotid">%1$s</xliff:g> will be used for data services. Are you sure you want to continue?</string>
     <string name="sim_enabler_airplane_on">Unable to perform the operation while airplane mode is on.</string>
     <string name="sim_enabler_in_call">Unable to perform the operation while in call.</string>
-    <string name="sim_enabler_both_inactive">Can\'t disable all SIM cards</string>
     <string name="sim_enabler_enabling">Activating\u2026</string>
     <string name="sim_enabler_disabling">Deactivating\u2026</string>
     <string name="sub_activate_success">SIM activated.</string>
diff --git a/src/com/android/settings/sim/SimSettings.java b/src/com/android/settings/sim/SimSettings.java
index 275f9a8..e579677 100644
--- a/src/com/android/settings/sim/SimSettings.java
+++ b/src/com/android/settings/sim/SimSettings.java
@@ -554,25 +554,6 @@ public class SimSettings extends RestrictedSettingsFragment implements Indexable
             }
         }
 
-        /**
-        * get number of Subs provisioned on the device
-        * @param context
-        * @return
-        */
-        public int getNumOfSubsProvisioned() {
-            int activeSubInfoCount = 0;
-            List<SubscriptionInfo> subInfoLists =
-                    mSubscriptionManager.getActiveSubscriptionInfoList();
-            if (subInfoLists != null) {
-                for (SubscriptionInfo subInfo : subInfoLists) {
-                    if (getProvisionStatus(subInfo.getSimSlotIndex()) == PROVISIONED) {
-                        activeSubInfoCount++;
-                    }
-                }
-            }
-            return activeSubInfoCount;
-        }
-
         @Override
         public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
             mIsChecked = isChecked;
@@ -606,14 +587,8 @@ public class SimSettings extends RestrictedSettingsFragment implements Indexable
             }
 
             if (!mIsChecked) {
-                if (getNumOfSubsProvisioned() > 1) {
-                    logd("More than one sub is active, Deactivation possible.");
-                    sendUiccProvisioningRequest();
-                } else {
-                    logd("Only one sub is active. Deactivation not possible.");
-                    showAlertDialog(ERROR_ALERT_DLG_ID, R.string.sim_enabler_both_inactive);
-                    return;
-                }
+                logd("More than one sub is active, Deactivation possible.");
+                sendUiccProvisioningRequest();
             } else {
                 logd("Activate the sub");
                 sendUiccProvisioningRequest();
-- 
2.7.4

