From ddb30a82b5f3989ede0c2563b4493ed6dc7c0984 Mon Sep 17 00:00:00 2001
From: Tom Marshall <tdm@cyngn.com>
Date: Tue, 24 Nov 2015 15:30:20 -0800
Subject: [PATCH 06/19] storage: Do not allow eject for volumes on
 non-removable disks

Change-Id: Ib10747f27ef46ebdca906a904271f7c1e9bc3e73
---
 src/com/android/settings/deviceinfo/PublicVolumeSettings.java   | 2 +-
 .../android/settings/deviceinfo/StorageVolumePreference.java    | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/com/android/settings/deviceinfo/PublicVolumeSettings.java b/src/com/android/settings/deviceinfo/PublicVolumeSettings.java
index 85b7904038..e360049704 100644
--- a/src/com/android/settings/deviceinfo/PublicVolumeSettings.java
+++ b/src/com/android/settings/deviceinfo/PublicVolumeSettings.java
@@ -179,7 +179,7 @@ public class PublicVolumeSettings extends SettingsPreferenceFragment {
         if (mVolume.getState() == VolumeInfo.STATE_UNMOUNTED) {
             addPreference(mMount);
         }
-        if (mVolume.isMountedReadable()) {
+        if (!mDisk.isNonRemovable() && mVolume.isMountedReadable()) {
             getButtonBar().setVisibility(View.VISIBLE);
         }
         addPreference(mFormatPublic);
diff --git a/src/com/android/settings/deviceinfo/StorageVolumePreference.java b/src/com/android/settings/deviceinfo/StorageVolumePreference.java
index 4a8025bfd0..2b02e3c047 100644
--- a/src/com/android/settings/deviceinfo/StorageVolumePreference.java
+++ b/src/com/android/settings/deviceinfo/StorageVolumePreference.java
@@ -120,6 +120,7 @@ public class StorageVolumePreference extends Preference {
         setIcon(icon);
 
         if (volume.getType() == VolumeInfo.TYPE_PUBLIC
+                && !volume.disk.isNonRemovable()
                 && volume.isMountedReadable()) {
             setWidgetLayoutResource(R.layout.preference_storage_action);
         }
-- 
2.17.1

