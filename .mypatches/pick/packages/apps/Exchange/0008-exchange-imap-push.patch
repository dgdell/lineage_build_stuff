From 4fed98e923f49a692367b568ea8f54bbb7391bb6 Mon Sep 17 00:00:00 2001
From: Jorge Ruesga <jorge@ruesga.com>
Date: Thu, 30 Apr 2015 00:48:45 +0200
Subject: [PATCH 08/12] exchange: imap push

Change-Id: I676124f35796d718c09e9fb0276cf31ea462391a
Signed-off-by: Jorge Ruesga <jorge@ruesga.com>
---
 src/com/android/exchange/eas/EasFolderSync.java  | 6 ++++++
 src/com/android/exchange/service/EasService.java | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/com/android/exchange/eas/EasFolderSync.java b/src/com/android/exchange/eas/EasFolderSync.java
index b5e28c14..35e61b8e 100644
--- a/src/com/android/exchange/eas/EasFolderSync.java
+++ b/src/com/android/exchange/eas/EasFolderSync.java
@@ -142,6 +142,12 @@ public class EasFolderSync extends EasOperation {
                     protocolVersion);
         }
 
+        // Include shared email capabilities in the response
+        //  - Eas always have push capability
+        int capabilities = EmailServiceProxy.CAPABILITY_PUSH;
+        mValidationResult.putInt(EmailServiceProxy.SETTINGS_BUNDLE_CAPABILITIES,
+                EmailServiceProxy.CAPABILITY_PUSH);
+
         // This is intentionally a call to super.performOperation. This is a helper function for
         // our version of perfomOperation so calling that function would infinite loop.
         final int result = super.performOperation();
diff --git a/src/com/android/exchange/service/EasService.java b/src/com/android/exchange/service/EasService.java
index 42acd3e3..9514e4e7 100644
--- a/src/com/android/exchange/service/EasService.java
+++ b/src/com/android/exchange/service/EasService.java
@@ -443,7 +443,7 @@ public class EasService extends Service {
         }
 
         // Check if account is configured for a push sync interval.
-        if (account.mSyncInterval != Account.CHECK_INTERVAL_PUSH) {
+        if (account.getSyncInterval() != Account.CHECK_INTERVAL_PUSH) {
             LogUtils.d(TAG, "Do not ping: Account %d not configured for push", account.mId);
             return false;
         }
-- 
2.17.1

