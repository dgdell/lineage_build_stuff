From 9ee0e54e58b2918319b49c4e870a4f9c89a439d7 Mon Sep 17 00:00:00 2001
From: Mihai Preda <preda@android.com>
Date: Sat, 11 Jun 2011 13:31:55 +0200
Subject: [PATCH 4/7] WallpaperPicker: add a "No Wallpaper" option

This is a squash of the following commits.

Author: Mihai Preda <preda@android.com>
Date:   Sat Jun 11 13:31:55 2011 +0200

    Add a "No wallpaper" wallpaper option.

    The simplest implementation is with a black 1x1px image,
    but it could be implemented in a more efficient way in the future.
    (i.e. the black image is an implementation detail of the
    "no wallpaper" goal).

    On Nexus One (OLED) this "no wallpaper" produces
    45mA current saving compared to the "CM Earth" image wallpaper
    when display is set to max brightness, and 20mA saving on low brightness.

Author: Keith Mok <kmok@cyngn.com>
Date:   Fri May 27 09:49:38 2016 -0700

    Add a set wallpaper button for nowallpaper

    We set the wallpaper to black without a confirm
    button currently and without exit the wallpaper picker.
    This causes odd behaviour.
    Add back a confirm button like live wallpaper picker

    FEIJ-822

Author: Steve Kondik <steve@cyngn.com>
Date:   Thu Oct 13 13:32:03 2016 -0700

    NoWallpaper: Clear lockscreen wallpaper too

Author: Joey Rizzoli <joey@lineageos.org>
Date:   Sat Jan 13 22:34:17 2018 +0200

    NoWallpaper: Add an adaptive icon

Change-Id: Id712314d4e0808145f2180001bfc4dbeea766a46

Author: Luca Stefani <luca.stefani.ge1@gmail.com>
Date:   Wed, 24 Jan 2018 19:03:37 +0100

    WallpaperPicker: Properly animate noWallpaper

Change-Id: I760c67544cdb298ed8f26f94ce77fb22d48afc25
---
 AndroidManifest.xml                           |  12 ++++
 res/drawable/black.png                        | Bin 0 -> 67 bytes
 res/drawable/ic_nowallpaper_foreground.xml    |  12 ++++
 res/layout/wallpaper_preview.xml              |  34 +++++++++
 res/mipmap/ic_nowallpaper.xml                 |   5 ++
 res/values/cm_strings.xml                     |  22 ++++++
 res/values/lineage_colors.xml                 |   1 +
 res/values/styles.xml                         |   5 ++
 .../android/wallpaperpicker/NoWallpaper.java  |  65 ++++++++++++++++++
 9 files changed, 156 insertions(+)
 create mode 100644 res/drawable/black.png
 create mode 100644 res/drawable/ic_nowallpaper_foreground.xml
 create mode 100644 res/layout/wallpaper_preview.xml
 create mode 100644 res/mipmap/ic_nowallpaper.xml
 create mode 100644 res/values/cm_strings.xml
 create mode 100644 src/com/android/wallpaperpicker/NoWallpaper.java

diff --git a/AndroidManifest.xml b/AndroidManifest.xml
index 8ef44c7..db469a6 100644
--- a/AndroidManifest.xml
+++ b/AndroidManifest.xml
@@ -35,5 +35,17 @@
                 <data android:mimeType="image/*" />
             </intent-filter>
         </activity>
+
+        <activity
+            android:name="com.android.wallpaperpicker.NoWallpaper"
+            android:theme="@style/NoWallpaperStyle"
+            android:label="@string/no_wallpaper"
+            android:icon="@mipmap/ic_nowallpaper">
+            <intent-filter>
+                <action android:name="android.intent.action.SET_WALLPAPER" />
+                <category android:name="android.intent.category.DEFAULT" />
+            </intent-filter>
+        </activity>
+
     </application>
 </manifest>
diff --git a/res/drawable/black.png b/res/drawable/black.png
new file mode 100644
index 0000000000000000000000000000000000000000..6aaccb278c7cb83abb8c6589de7413ccc66ff4fe
GIT binary patch
literal 67
zcmeAS@N?(olHy`uVBq!ia0vp^j3CSbBp9sfW`_bPE>9Q75RU7~2|zXz1LGsbJ;p#5
NgQu&X%Q~loCIDSW3`GC{

literal 0
HcmV?d00001

diff --git a/res/drawable/ic_nowallpaper_foreground.xml b/res/drawable/ic_nowallpaper_foreground.xml
new file mode 100644
index 0000000..4a57763
--- /dev/null
+++ b/res/drawable/ic_nowallpaper_foreground.xml
@@ -0,0 +1,12 @@
+<vector xmlns:android="http://schemas.android.com/apk/res/android"
+        android:width="108dp"
+        android:height="108dp"
+        android:viewportWidth="48"
+        android:viewportHeight="48">
+    <group android:translateX="12"
+            android:translateY="12">
+        <path
+            android:fillColor="#FFFFFF"
+            android:pathData="M4,4h7L11,2L4,2c-1.1,0 -2,0.9 -2,2v7h2L4,4zM10,13l-4,5h12l-3,-4 -2.03,2.71L10,13zM17,8.5c0,-0.83 -0.67,-1.5 -1.5,-1.5S14,7.67 14,8.5s0.67,1.5 1.5,1.5S17,9.33 17,8.5zM20,2h-7v2h7v7h2L22,4c0,-1.1 -0.9,-2 -2,-2zM20,20h-7v2h7c1.1,0 2,-0.9 2,-2v-7h-2v7zM4,13L2,13v7c0,1.1 0.9,2 2,2h7v-2L4,20v-7z"/>
+    </group>
+</vector>
diff --git a/res/layout/wallpaper_preview.xml b/res/layout/wallpaper_preview.xml
new file mode 100644
index 0000000..5837227
--- /dev/null
+++ b/res/layout/wallpaper_preview.xml
@@ -0,0 +1,34 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2016 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+
+<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
+    android:layout_width="match_parent"
+    android:layout_height="wrap_content"
+
+    android:layout_gravity="center_horizontal|bottom"
+    style="?android:attr/buttonBarStyle">
+
+    <Button
+        android:layout_width="0dip"
+        android:layout_height="wrap_content"
+        android:layout_weight="1"
+        android:layout_gravity="center_vertical"
+
+        android:text="@string/wallpaper_instructions"
+
+        android:onClick="setWallpaper"
+        style="?android:attr/buttonBarButtonStyle" />
+</LinearLayout>
diff --git a/res/mipmap/ic_nowallpaper.xml b/res/mipmap/ic_nowallpaper.xml
new file mode 100644
index 0000000..471fd95
--- /dev/null
+++ b/res/mipmap/ic_nowallpaper.xml
@@ -0,0 +1,5 @@
+<?xml version="1.0" encoding="utf-8"?>
+<adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
+    <background android:drawable="@color/icon_background_nowallpaper"/>
+    <foreground android:drawable="@drawable/ic_nowallpaper_foreground"/>
+</adaptive-icon>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
new file mode 100644
index 0000000..d8d98e9
--- /dev/null
+++ b/res/values/cm_strings.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/*
+* Copyright (C) 2017 The LineageOS Project
+*
+* Licensed under the Apache License, Version 2.0 (the "License");
+* you may not use this file except in compliance with the License.
+* You may obtain a copy of the License at
+*
+*      http://www.apache.org/licenses/LICENSE-2.0
+*
+* Unless required by applicable law or agreed to in writing, software
+* distributed under the License is distributed on an "AS IS" BASIS,
+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+* See the License for the specific language governing permissions and
+* limitations under the License.
+*/
+-->
+
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+    <string name="no_wallpaper">No wallpaper</string>
+</resources>
diff --git a/res/values/lineage_colors.xml b/res/values/lineage_colors.xml
index ae8ecdc..42e3e02 100644
--- a/res/values/lineage_colors.xml
+++ b/res/values/lineage_colors.xml
@@ -16,4 +16,5 @@
 -->
 <resources>
     <color name="icon_background_launcher_wallpaper">#43A047</color>
+    <color name="icon_background_nowallpaper">#000000</color>
 </resources>
diff --git a/res/values/styles.xml b/res/values/styles.xml
index d8efcac..962cd3d 100644
--- a/res/values/styles.xml
+++ b/res/values/styles.xml
@@ -39,4 +39,9 @@
         <item name="android:textColor">#ffffffff</item>
         <item name="android:background">?android:attr/selectableItemBackground</item>
     </style>
+    <style name="NoWallpaperStyle" parent="WallpaperTheme.Picker">
+        <item name="android:windowBackground">@android:color/black</item>
+        <item name="android:windowTranslucentNavigation">true</item>
+        <item name="android:fitsSystemWindows">true</item>
+    </style>
 </resources>
diff --git a/src/com/android/wallpaperpicker/NoWallpaper.java b/src/com/android/wallpaperpicker/NoWallpaper.java
new file mode 100644
index 0000000..bfff899
--- /dev/null
+++ b/src/com/android/wallpaperpicker/NoWallpaper.java
@@ -0,0 +1,65 @@
+/*
+ * Copyright (C) 2011 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.wallpaperpicker;
+
+import android.app.Activity;
+import android.app.AlertDialog;
+import android.app.WallpaperManager;
+import android.content.DialogInterface;
+import android.os.Bundle;
+import android.view.View;
+import android.view.WindowManager;
+import java.io.IOException;
+
+public class NoWallpaper extends Activity {
+    public void onCreate(Bundle bundle) {
+        super.onCreate(bundle);
+
+        setContentView(R.layout.wallpaper_preview);
+
+        getWindow().clearFlags(WindowManager.LayoutParams.FLAG_SHOW_WALLPAPER);
+    }
+
+    public void setWallpaper(View v) {
+        WallpaperManager wm = WallpaperManager.getInstance(this);
+        new AlertDialog.Builder(this)
+            .setTitle(R.string.wallpaper_instructions)
+            .setItems(R.array.which_wallpaper_options, new DialogInterface.OnClickListener() {
+            @Override
+            public void onClick(DialogInterface dialog, int selectedItemIndex) {
+                int whichWallpaper;
+                if (selectedItemIndex == 0) {
+                    whichWallpaper = WallpaperManager.FLAG_SYSTEM;
+                } else if (selectedItemIndex == 1) {
+                    whichWallpaper = WallpaperManager.FLAG_LOCK;
+                } else {
+                    whichWallpaper = WallpaperManager.FLAG_SYSTEM
+                            | WallpaperManager.FLAG_LOCK;
+                }
+
+                try {
+                    wm.setResource(R.drawable.black, whichWallpaper);
+                } catch (IOException e) {
+                }
+
+                setResult(RESULT_OK);
+                finish();
+            }
+        })
+        .show();
+    }
+}
-- 
2.17.1

