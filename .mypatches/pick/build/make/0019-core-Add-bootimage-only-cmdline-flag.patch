From b3fbec4f9a2f15f219a681bca50cb55d97c2e641 Mon Sep 17 00:00:00 2001
From: Rashed Abdel-Tawab <rashed@linux.com>
Date: Mon, 30 Jul 2018 00:29:16 -0700
Subject: [PATCH 19/20] core: Add bootimage only cmdline flag

Sometimes we want to include cmdline options only for the bootimage,
not for the recovery image, so add a new flag for it

Change-Id: I05107536a75150b1f5ca40aa39499cfe011b6139
---
 core/Makefile | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/core/Makefile b/core/Makefile
index 177c5926a..bb079c911 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -663,8 +663,9 @@ endif
 endif
 
 INTERNAL_KERNEL_CMDLINE := $(strip $(BOARD_KERNEL_CMDLINE) buildvariant=$(TARGET_BUILD_VARIANT) $(VERITY_KEYID))
+INTERNAL_BOOTIMAGE_CMDLINE := $(strip $(INTERNAL_KERNEL_CMDLINE) $(BOARD_BOOTIMAGE_CMDLINE))
 ifdef INTERNAL_KERNEL_CMDLINE
-INTERNAL_BOOTIMAGE_ARGS += --cmdline "$(INTERNAL_KERNEL_CMDLINE)"
+INTERNAL_BOOTIMAGE_ARGS += --cmdline "$(INTERNAL_BOOTIMAGE_CMDLINE)"
 endif
 
 INTERNAL_MKBOOTIMG_VERSION_ARGS := \
@@ -1702,7 +1703,7 @@ define build-boottarball-target
     $(hide) echo "Target boot fs tarball: $(INSTALLED_BOOTTARBALL_TARGET)"
     $(hide) mkdir -p $(PRODUCT_OUT)/boot
     $(hide) cp -f $(INTERNAL_BOOTIMAGE_FILES) $(PRODUCT_OUT)/boot/.
-    $(hide) echo $(INTERNAL_KERNEL_CMDLINE) > $(PRODUCT_OUT)/boot/cmdline
+    $(hide) echo $(INTERNAL_BOOTIMAGE_CMDLINE) > $(PRODUCT_OUT)/boot/cmdline
     $(hide) $(MKTARBALL) $(FS_GET_STATS) \
                  $(PRODUCT_OUT) boot $(PRIVATE_BOOT_TAR) \
                  $(INSTALLED_BOOTTARBALL_TARGET) $(TARGET_OUT)
@@ -2509,8 +2510,8 @@ endif
 ifdef INSTALLED_2NDBOOTLOADER_TARGET
 	$(hide) cp $(INSTALLED_2NDBOOTLOADER_TARGET) $(zip_root)/BOOT/second
 endif
-ifdef INTERNAL_KERNEL_CMDLINE
-	$(hide) echo "$(INTERNAL_KERNEL_CMDLINE)" > $(zip_root)/BOOT/cmdline
+ifdef INTERNAL_BOOTIMAGE_CMDLINE
+	$(hide) echo "$(INTERNAL_BOOTIMAGE_CMDLINE)" > $(zip_root)/BOOT/cmdline
 endif
 ifdef BOARD_KERNEL_BASE
 	$(hide) echo "$(BOARD_KERNEL_BASE)" > $(zip_root)/BOOT/base
-- 
2.17.1

