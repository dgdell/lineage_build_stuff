From deba8f5a3da790afbc845f6b675e0a3b659012cc Mon Sep 17 00:00:00 2001
From: Rashed Abdel-Tawab <rashed@linux.com>
Date: Sat, 3 Mar 2018 10:26:14 -0800
Subject: [PATCH 4/5] build: Add ability for device to specify additional
 targets

Some devices (cough berkeley) need some additional targets like say
an image with just the kernel binary in it. Allow devices to specify
an "extension" to the main Makefile in their device trees.

Why do this whenwe have BOARD_CUSTOM_BOOTIMG_MK you might ask? Using
BOARD_CUSTOM_BOOTIMG_MK means you would have to duplicate the
bootimage and ramdiskimage generation code even if you're not changing
it, which is nasty. So add this and avoid any code duplication.

Change-Id: Ic34181518838c31716ea6a32e18545e7e93c6964
---
 core/Makefile | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/core/Makefile b/core/Makefile
index 3a2c23df7..5fa4dcb6a 100644
--- a/core/Makefile
+++ b/core/Makefile
@@ -726,8 +726,10 @@ INTERNAL_BOOTIMAGE_ARGS := \
 	--kernel $(INSTALLED_KERNEL_TARGET)
 
 ifneq ($(BOARD_BUILD_SYSTEM_ROOT_IMAGE),true)
+ifndef BOARD_CUSTOM_BUILD_MAKEFILE
 INTERNAL_BOOTIMAGE_ARGS += --ramdisk $(INSTALLED_RAMDISK_TARGET)
 endif
+endif
 
 INTERNAL_BOOTIMAGE_FILES := $(filter-out --%,$(INTERNAL_BOOTIMAGE_ARGS))
 
@@ -1590,6 +1592,10 @@ ifdef BOARD_CUSTOM_BOOTIMG_MK
 include $(BOARD_CUSTOM_BOOTIMG_MK)
 endif
 
+ifdef BOARD_CUSTOM_BUILD_MAKEFILE
+include $(BOARD_CUSTOM_BUILD_MAKEFILE)
+endif
+
 
 # -----------------------------------------------------------------
 # system image
-- 
2.17.1

