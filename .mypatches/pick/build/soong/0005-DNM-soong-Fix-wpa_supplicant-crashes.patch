From 1f44f0e6d432878bde3ef95c6b28139942e8ddb4 Mon Sep 17 00:00:00 2001
From: Danny Baumann <dannybaumann@web.de>
Date: Wed, 5 Sep 2018 14:14:35 +0200
Subject: [PATCH 5/7] [DNM]soong: Fix wpa_supplicant crashes

Change-Id: Iaea9ab6e98952ebe214ce7fafb6819f313b2d76b
---
 cc/sanitize.go | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/cc/sanitize.go b/cc/sanitize.go
index de970352..49c679c8 100644
--- a/cc/sanitize.go
+++ b/cc/sanitize.go
@@ -34,9 +34,9 @@ var (
 	asanLdflags = []string{"-Wl,-u,__asan_preinit"}
 	asanLibs    = []string{"libasan"}
 
-	cfiCflags = []string{"-flto", "-fsanitize-cfi-cross-dso",
+	cfiCflags = []string{"-flto", "-fsanitize-cfi-cross-dso", "-fsanitize-recover=cfi", "-fno-sanitize-trap=cfi",
 		"-fsanitize-blacklist=external/compiler-rt/lib/cfi/cfi_blacklist.txt"}
-	cfiLdflags = []string{"-flto", "-fsanitize-cfi-cross-dso", "-fsanitize=cfi",
+	cfiLdflags = []string{"-flto", "-fsanitize-cfi-cross-dso", "-fsanitize=cfi", "-fsanitize-recover=cfi", "-fno-sanitize-trap=cfi",
 		"-Wl,-plugin-opt,O1"}
 	cfiExportsMapPath  = "build/soong/cc/config/cfi_exports.map"
 	cfiStaticLibsMutex sync.Mutex
-- 
2.17.1

