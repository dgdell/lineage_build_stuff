From a02549d9786e3f9e42300ffdd3aff49096287cb0 Mon Sep 17 00:00:00 2001
From: "Christopher N. Hesse" <raymanfx@gmail.com>
Date: Wed, 4 Apr 2018 12:15:13 +0200
Subject: [PATCH 1/2] recovery/ui: Hide emulated storage for encrypted devices

We do not support decryption of data partitions, so get
rid of the option in the UI.

Change-Id: Idcccba84ea0ba42c24f8a52b7f0994ed4545475d
---
 recovery.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/recovery.cpp b/recovery.cpp
index ecc2df7f..a02ff0ea 100644
--- a/recovery.cpp
+++ b/recovery.cpp
@@ -1177,6 +1177,11 @@ refresh:
     items.push_back(MenuItem("Apply from ADB")); // Index 0
 
     for (auto& vol : volumes) {
+        // On devices where /data is encrypted (FDE or FBE), we cannot install from
+        // internal (aka emulated) storage because we do not support decryption.
+        if ((vol.mLabel == "emulated") && (ensure_path_mounted("/data") != 0)) {
+            continue;
+        }
         items.push_back(MenuItem("Choose from " + vol.mLabel));
     }
 
-- 
2.17.0

