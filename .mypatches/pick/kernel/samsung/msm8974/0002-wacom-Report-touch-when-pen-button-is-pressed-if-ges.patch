From cadcf627ccd2475e35695b105527ab3e322def59 Mon Sep 17 00:00:00 2001
From: Paul Keith <javelinanddart@gmail.com>
Date: Sat, 31 Mar 2018 10:06:48 +0200
Subject: [PATCH 02/17] wacom: Report touch when pen button is pressed if
 gestures are off

* Some applications, like Squid, allow interpreting input differently
  when the pen button is pressed, so allow users to keep that behavior

Change-Id: Ifce2f509646c7676c931f4f04ff482acdf5ac990
Signed-off-by: Paul Keith <javelinanddart@gmail.com>
---
 drivers/input/touchscreen/wacom/wacom_i2c_func.c | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/input/touchscreen/wacom/wacom_i2c_func.c b/drivers/input/touchscreen/wacom/wacom_i2c_func.c
index cabc64c3a0c..7c868607aae 100644
--- a/drivers/input/touchscreen/wacom/wacom_i2c_func.c
+++ b/drivers/input/touchscreen/wacom/wacom_i2c_func.c
@@ -1113,7 +1113,7 @@ int wacom_i2c_coord(struct wacom_i2c *wac_i2c)
 #endif
 			input_report_key(wac_i2c->input_dev,
 					 BTN_STYLUS, stylus);
-			if (!stylus && !wac_i2c->side_pressed) {
+			if (!wac_i2c->enabled_gestures || (!stylus && !wac_i2c->side_pressed)) {
 				input_report_key(wac_i2c->input_dev, BTN_TOUCH, prox);
 			}
 			input_report_key(wac_i2c->input_dev, wac_i2c->tool, 1);
@@ -1176,11 +1176,9 @@ int wacom_i2c_coord(struct wacom_i2c *wac_i2c)
 				key = compute_gesture(x, y, ktime_get(), wac_i2c);
 				if (key && (wac_i2c->enabled_gestures
 						& GEST_KEY2BIT(key))) {
-					input_report_key(wac_i2c->input_dev,
-							wac_i2c->gesture_key, 1);
+					input_report_key(wac_i2c->input_dev, key, 1);
 					input_sync(wac_i2c->input_dev);
-					input_report_key(wac_i2c->input_dev,
-							wac_i2c->gesture_key, 0);
+					input_report_key(wac_i2c->input_dev, key, 0);
 					input_sync(wac_i2c->input_dev);
 				}
 			}
-- 
2.17.0

