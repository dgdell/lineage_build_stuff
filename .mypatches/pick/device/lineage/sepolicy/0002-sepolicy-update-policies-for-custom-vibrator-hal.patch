From 58f9db4965e4374c4516d309e01ae87fa26902a1 Mon Sep 17 00:00:00 2001
From: Demon Singur <demonsingur@gmail.com>
Date: Fri, 3 Aug 2018 08:17:52 +0000
Subject: [PATCH 2/2] sepolicy: update policies for custom vibrator hal

Change-Id: I03662dbd094c017e7978b6f2639231fdaa4ec9b7
---
 common/private/file_contexts          | 2 +-
 common/vendor/file_contexts           | 2 +-
 common/vendor/hal_vibrator_default.te | 2 ++
 common/vendor/hwservice_contexts      | 2 ++
 common/vendor/property.te             | 1 +
 common/vendor/property_contexts       | 1 +
 6 files changed, 8 insertions(+), 2 deletions(-)
 create mode 100644 common/vendor/property.te
 create mode 100644 common/vendor/property_contexts

diff --git a/common/private/file_contexts b/common/private/file_contexts
index 2c1a42c..f572548 100644
--- a/common/private/file_contexts
+++ b/common/private/file_contexts
@@ -24,7 +24,7 @@
 /system/etc/init\.d/90userinit          u:object_r:userinit_exec:s0
 
 # Vibrator control
+/sys/devices/virtual/timed_output/vibrator/vtg_default u:object_r:sysfs_vibrator:s0
 /sys/devices/virtual/timed_output/vibrator/vtg_level u:object_r:sysfs_vibrator:s0
 /sys/devices/virtual/timed_output/vibrator/vtg_min u:object_r:sysfs_vibrator:s0
 /sys/devices/virtual/timed_output/vibrator/vtg_max u:object_r:sysfs_vibrator:s0
-
diff --git a/common/vendor/file_contexts b/common/vendor/file_contexts
index d8b9d3b..15a69ba 100644
--- a/common/vendor/file_contexts
+++ b/common/vendor/file_contexts
@@ -9,4 +9,4 @@
 /(vendor|system/vendor)/bin/hw/vendor\.lineage\.livedisplay@1\.0-service-sdm u:object_r:hal_livedisplay_default_exec:s0
 
 # Vibrator HAL
-/(vendor|system/vendor)/bin/hw/android\.hardware\.vibrator@1\.0-service\.lineage u:object_r:hal_vibrator_default_exec:s0
+/(vendor|system/vendor)/bin/hw/vendor\.lineage\.vibrator@1\.0-service u:object_r:hal_vibrator_default_exec:s0
diff --git a/common/vendor/hal_vibrator_default.te b/common/vendor/hal_vibrator_default.te
index cd92236..d7641c0 100644
--- a/common/vendor/hal_vibrator_default.te
+++ b/common/vendor/hal_vibrator_default.te
@@ -1 +1,3 @@
 hwbinder_use(hal_vibrator_default)
+
+set_prop(hal_vibrator_default, vibrator_prop)
diff --git a/common/vendor/hwservice_contexts b/common/vendor/hwservice_contexts
index 193b712..0724cfd 100644
--- a/common/vendor/hwservice_contexts
+++ b/common/vendor/hwservice_contexts
@@ -1,3 +1,5 @@
 vendor.lineage.livedisplay::IColor       u:object_r:hal_lineage_livedisplay_hwservice:s0
 
 vendor.lineage.power::ILineagePower      u:object_r:hal_lineage_power_hwservice:s0
+
+vendor.lineage.vibrator::IVibrator       u:object_r:hal_vibrator_hwservice:s0
diff --git a/common/vendor/property.te b/common/vendor/property.te
new file mode 100644
index 0000000..00d017a
--- /dev/null
+++ b/common/vendor/property.te
@@ -0,0 +1 @@
+type vibrator_prop, property_type;
diff --git a/common/vendor/property_contexts b/common/vendor/property_contexts
new file mode 100644
index 0000000..5bf282b
--- /dev/null
+++ b/common/vendor/property_contexts
@@ -0,0 +1 @@
+vendor.lineage.vibrator.      u:object_r:vibrator_prop:s0
-- 
2.17.1

