From d4a793c1bbb20ec3dda31fdc4b1b05ac3aaee40a Mon Sep 17 00:00:00 2001
From: Ricardo Cerqueira <arcee@cyanogenmod.org>
Date: Tue, 16 Dec 2014 19:27:32 +0000
Subject: [PATCH 06/11] sepolicy: Add policies for the new superuser sockets.

Change-Id: Ia3e1044616bee95eb4774254fb098487d983b5db
---
 common/public/file_contexts | 3 +--
 common/public/su.te         | 2 ++
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/common/public/file_contexts b/common/public/file_contexts
index 298f5a2..5e64c94 100644
--- a/common/public/file_contexts
+++ b/common/public/file_contexts
@@ -1,3 +1,2 @@
 # Superuser's control sockets
-/dev/com.android.settings.daemon(/.*)?   u:object_r:superuser_device:s0
-/dev/com.android.settings(/.*)?   u:object_r:superuser_device:s0
+/dev/socket/su-daemon(/.*)?   u:object_r:superuser_device:s0
diff --git a/common/public/su.te b/common/public/su.te
index 8e63b2f..c2c68fd 100644
--- a/common/public/su.te
+++ b/common/public/su.te
@@ -6,6 +6,8 @@ type sudaemon, domain;
 
 userdebug_or_eng(`
   domain_trans(init, su_exec, sudaemon)
+
+  type_transition sudaemon socket_device:sock_file superuser_device;
   # The userspace app uses /dev sockets to control per-app access
   allow sudaemon superuser_device:dir { create rw_dir_perms setattr unlink };
   allow sudaemon superuser_device:sock_file { create setattr unlink write };
-- 
2.7.4

