From 1e3e1ba9390c515aaa7715cd9ca5a6d5fbd11c23 Mon Sep 17 00:00:00 2001
From: Steve Kondik <steve@cyngn.com>
Date: Sun, 6 Sep 2015 13:53:29 -0700
Subject: [PATCH 14/14] sepolicy: SELinux policy for persistent properties API

 * Set up persistent properties for devices with a /persist partition.

Change-Id: I78974dd4e25831338462c91fc25e36e343795510
---
 common/private/file.te          | 3 +++
 common/private/file_contexts    | 3 +++
 common/private/system_server.te | 4 ++++
 3 files changed, 10 insertions(+)

diff --git a/common/private/file.te b/common/private/file.te
index eb469cc..f021333 100644
--- a/common/private/file.te
+++ b/common/private/file.te
@@ -2,3 +2,6 @@
 type exfat, sdcard_type, fs_type, mlstrustedobject;
 type fuseblk, sdcard_type, fs_type, mlstrustedobject;
 type ntfs, sdcard_type, fs_type, mlstrustedobject;
+
+# Persistent property storage
+type persist_property_file, file_type;
diff --git a/common/private/file_contexts b/common/private/file_contexts
index 8429f15..7dbb43d 100644
--- a/common/private/file_contexts
+++ b/common/private/file_contexts
@@ -8,6 +8,9 @@
 # OTA packages
 /data/lineageos_updates(/.*)?           u:object_r:ota_package_file:s0
 
+# Persistent properties
+/persist/properties                     u:object_r:persist_property_file:s0
+
 # Sysinit
 /system/bin/sysinit                     u:object_r:sysinit_exec:s0
 
diff --git a/common/private/system_server.te b/common/private/system_server.te
index 0a3f565..458f2dc 100644
--- a/common/private/system_server.te
+++ b/common/private/system_server.te
@@ -1 +1,5 @@
 allow system_server storage_stub_file:dir getattr;
+
+# Persistent properties
+allow system_server persist_property_file:dir rw_dir_perms;
+allow system_server persist_property_file:file { create_file_perms unlink };
-- 
2.7.4

