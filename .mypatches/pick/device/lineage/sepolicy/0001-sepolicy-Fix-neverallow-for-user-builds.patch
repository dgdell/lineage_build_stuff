From 535a634410aa45126a70efd2075ca472668aa4f0 Mon Sep 17 00:00:00 2001
From: Paul Keith <javelinanddart@gmail.com>
Date: Sat, 30 Jun 2018 17:06:48 +0200
Subject: [PATCH] sepolicy: Fix neverallow for user builds

Change-Id: Ic3c732419df86536de28c774b1cee3566093d9dc
---
 common/private/update_engine.te | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/common/private/update_engine.te b/common/private/update_engine.te
index 309699a..df8378d 100644
--- a/common/private/update_engine.te
+++ b/common/private/update_engine.te
@@ -1,4 +1,7 @@
-allow update_engine self:capability { dac_override dac_read_search sys_rawio };
+allow update_engine self:capability { dac_override dac_read_search };
+userdebug_or_eng(`
+allow update_engine self:capability sys_rawio;
+')
 
 r_dir_file(update_engine, mnt_user_file)
 r_dir_file(update_engine, storage_file)
@@ -10,4 +13,7 @@ allow update_engine labeledfs:filesystem { mount unmount };
 allow update_engine { media_rw_data_file rootfs sdcardfs system_data_file system_file }:dir create_dir_perms;
 allow update_engine { media_rw_data_file rootfs sdcardfs system_data_file system_file }:{ file lnk_file } create_file_perms;
 allow update_engine { otapreopt_chroot_exec rootfs system_file toolbox_exec }:file rx_file_perms;
-allow update_engine { rootfs system_file }:file { relabelfrom relabelto };
+allow update_engine system_file:file { relabelfrom relabelto };
+userdebug_or_eng(`
+allow update_engine rootfs:file { relabelfrom relabelto };
+')
-- 
2.17.1

