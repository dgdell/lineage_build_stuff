From 6282bc72bbe057b893ca807a1b5175089562daa8 Mon Sep 17 00:00:00 2001
From: Georg Veichtlbauer <georg.veichtlbauer@gmail.com>
Date: Wed, 4 Feb 2015 18:17:31 +0100
Subject: [PATCH 10/15] sepolicy: allow userinit to set its property

Change-Id: I9d8270d889566d169077a1b1fdaee43059d11ee1
---
 common/private/file_contexts     | 3 +++
 common/private/property.te       | 1 +
 common/private/property_contexts | 1 +
 common/private/userinit.te       | 3 +++
 4 files changed, 8 insertions(+)
 create mode 100644 common/private/userinit.te

diff --git a/common/private/file_contexts b/common/private/file_contexts
index af9314b..8034040 100644
--- a/common/private/file_contexts
+++ b/common/private/file_contexts
@@ -11,6 +11,9 @@
 # Sysinit
 /system/bin/sysinit                     u:object_r:sysinit_exec:s0
 
+# Userinit
+/system/etc/init\.d/90userinit          u:object_r:userinit_exec:s0
+
 # Vibrator control
 /sys/devices/virtual/timed_output/vibrator/vtg_level u:object_r:sysfs_vibrator:s0
 /sys/devices/virtual/timed_output/vibrator/vtg_min u:object_r:sysfs_vibrator:s0
diff --git a/common/private/property.te b/common/private/property.te
index 6892010..8f1cc9e 100644
--- a/common/private/property.te
+++ b/common/private/property.te
@@ -1 +1,2 @@
 type adbtcp_prop, property_type;
+type userinit_prop, property_type;
diff --git a/common/private/property_contexts b/common/private/property_contexts
index 65911da..59832a3 100644
--- a/common/private/property_contexts
+++ b/common/private/property_contexts
@@ -1 +1,2 @@
 adb.network.port              u:object_r:adbtcp_prop:s0
+lineage.userinit.active       u:object_r:userinit_prop:s0
diff --git a/common/private/userinit.te b/common/private/userinit.te
new file mode 100644
index 0000000..b12167d
--- /dev/null
+++ b/common/private/userinit.te
@@ -0,0 +1,3 @@
+type userinit_exec, exec_type, file_type;
+
+set_prop(userinit_exec, userinit_prop)
-- 
2.7.4

