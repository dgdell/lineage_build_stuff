From 6143dbe60ac97472f674ef96809166c33f273424 Mon Sep 17 00:00:00 2001
From: Steve Kondik <steve@cyngn.com>
Date: Sun, 6 Sep 2015 13:53:29 -0700
Subject: [PATCH 2/6] sepolicy: SELinux policy for persistent properties API

 * Set up persistent properties for devices with a /persist partition.

Change-Id: I78974dd4e25831338462c91fc25e36e343795510
---
 common/private/file.te          | 2 ++
 common/private/file_contexts    | 3 +++
 common/private/system_server.te | 4 ++++
 3 files changed, 9 insertions(+)
 create mode 100644 common/private/file.te

diff --git a/common/private/file.te b/common/private/file.te
new file mode 100644
index 0000000..ab79eea
--- /dev/null
+++ b/common/private/file.te
@@ -0,0 +1,2 @@
+# Persistent property storage
+type persist_property_file, file_type;
diff --git a/common/private/file_contexts b/common/private/file_contexts
index 83ceb58..27e295c 100644
--- a/common/private/file_contexts
+++ b/common/private/file_contexts
@@ -8,6 +8,9 @@
 # OTA packages
 /data/lineageos_updates(/.*)?           u:object_r:ota_package_file:s0
 
+# Persistent properties
+/persist/properties                     u:object_r:persist_property_file:s0
+
 # Sysinit
 /system/bin/sysinit                     u:object_r:sysinit_exec:s0
 
diff --git a/common/private/system_server.te b/common/private/system_server.te
index 0a3f565..458f2dc 100644
--- a/common/private/system_server.te
+++ b/common/private/system_server.te
@@ -1 +1,5 @@
 allow system_server storage_stub_file:dir getattr;
+
+# Persistent properties
+allow system_server persist_property_file:dir rw_dir_perms;
+allow system_server persist_property_file:file { create_file_perms unlink };
-- 
2.7.4

