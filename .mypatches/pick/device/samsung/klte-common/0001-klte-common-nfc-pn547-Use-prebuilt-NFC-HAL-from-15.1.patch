From fb487c1889e3dea2491b678a20b02d8b3cae5515 Mon Sep 17 00:00:00 2001
From: jrior001 <jriordan001@gmail.com>
Date: Fri, 31 Aug 2018 20:49:48 -0400
Subject: [PATCH 1/6] klte-common: nfc: pn547: Use prebuilt NFC HAL from 15.1

Change-Id: I03a252ff820d5bd8dde8faac5fa293242aaef1f2
---
 common-proprietary-files-pn547.txt | 1 +
 extract-files.sh                   | 1 +
 nfc/pn547/board.mk                 | 1 -
 nfc/pn547/product.mk               | 3 +--
 setup-makefiles.sh                 | 4 ++++
 5 files changed, 7 insertions(+), 3 deletions(-)
 create mode 100644 common-proprietary-files-pn547.txt

diff --git a/common-proprietary-files-pn547.txt b/common-proprietary-files-pn547.txt
new file mode 100644
index 0000000..6c58a4b
--- /dev/null
+++ b/common-proprietary-files-pn547.txt
@@ -0,0 +1 @@
+-vendor/lib/hw/nfc_nci.msm8974.so|7dcb79a385dd1155cb9b6310a3e7b85b7dc8db13
diff --git a/extract-files.sh b/extract-files.sh
index e78298e..eec6e6c 100755
--- a/extract-files.sh
+++ b/extract-files.sh
@@ -51,6 +51,7 @@ fi
 setup_vendor "$DEVICE_COMMON" "$VENDOR" "$CM_ROOT" true
 
 extract "$MY_DIR"/common-proprietary-files.txt "$SRC"
+extract "$MY_DIR"/common-proprietary-files-pn547.txt "$SRC"
 
 COMMON_BLOB_ROOT="$CM_ROOT"/vendor/"$VENDOR"/"$DEVICE_COMMON"/proprietary
 
diff --git a/nfc/pn547/board.mk b/nfc/pn547/board.mk
index e52b1ab..548c190 100644
--- a/nfc/pn547/board.mk
+++ b/nfc/pn547/board.mk
@@ -19,4 +19,3 @@ include $(COMMON_PATH)/nfc/board.mk
 
 # PN547 specific flags
 BOARD_NFC_CHIPSET := pn547
-BOARD_NFC_HAL_SUFFIX := msm8974
diff --git a/nfc/pn547/product.mk b/nfc/pn547/product.mk
index fa341c9..d3fab9d 100644
--- a/nfc/pn547/product.mk
+++ b/nfc/pn547/product.mk
@@ -19,8 +19,7 @@ $(call inherit-product, device/samsung/klte-common/nfc/product.mk)
 
 PRODUCT_PACKAGES += \
     android.hardware.nfc@1.0-impl \
-    libpn547_fw \
-    nfc_nci.msm8974
+    libpn547_fw
 
 PRODUCT_COPY_FILES += \
     device/samsung/klte-common/nfc/pn547/libnfc-nci.conf:$(TARGET_COPY_OUT_VENDOR)/etc/libnfc-nci.conf \
diff --git a/setup-makefiles.sh b/setup-makefiles.sh
index ccea3c0..9f45c67 100755
--- a/setup-makefiles.sh
+++ b/setup-makefiles.sh
@@ -41,6 +41,10 @@ write_headers "klte klteactivexx kltechn kltechnduo klteduos kltedv kltekdi klte
 
 write_makefiles "$MY_DIR"/common-proprietary-files.txt
 
+echo "ifeq (\$(strip \$(BOARD_NFC_CHIPSET)),pn547)" >> "$ANDROIDMK"
+write_makefiles "$MY_DIR"/common-proprietary-files-pn547.txt
+echo "endif" >> "$ANDROIDMK"
+
 write_footers
 
 if [ ! -z $VARIANT_COPYRIGHT_YEAR ]; then
-- 
2.17.1

