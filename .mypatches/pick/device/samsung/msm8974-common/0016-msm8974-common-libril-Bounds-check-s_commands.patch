From 1fcb41727274cf41cc6e3ced8cd63a8e710195b2 Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Sun, 9 Sep 2018 10:45:58 +0800
Subject: [PATCH 16/16] msm8974-common: libril: Bounds check s_commands

* We shouldn't be assuming this is always going to be valid

Change-Id: I186d618dd8e24cd6be2cc4a25595ac8228cc6999
---
 ril/libril/ril.cpp | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/ril/libril/ril.cpp b/ril/libril/ril.cpp
index c8dab21..729dba1 100644
--- a/ril/libril/ril.cpp
+++ b/ril/libril/ril.cpp
@@ -235,6 +235,11 @@ addRequestToList(int serial, int slotId, int request) {
 #endif
 #endif
 
+    if (request >= (int)NUM_ELEMS(s_commands)) {
+        RLOGE("Request %s not supported", requestToString(request));
+        return NULL;
+    }
+
     pRI = (RequestInfo *)calloc(1, sizeof(RequestInfo));
     if (pRI == NULL) {
         RLOGE("Memory allocation failed for request %s", requestToString(request));
-- 
2.17.1

