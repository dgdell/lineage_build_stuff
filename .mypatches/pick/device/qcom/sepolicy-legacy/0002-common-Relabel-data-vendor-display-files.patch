From e359a674a6320d2127f1ced41d53c14ab8f8758a Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Sun, 16 Sep 2018 23:23:14 +0100
Subject: [PATCH 2/2] common: Relabel /data/vendor/display files

 * This matches non-legacy QC sepolicies

Change-Id: If12de9ac506f6f4260c789d0bbe6bed83d064a40
---
 common/file.te                  | 2 +-
 common/file_contexts            | 2 +-
 common/hal_graphics_composer.te | 4 ++--
 common/mm-pp-daemon.te          | 4 ++--
 common/surfaceflinger.te        | 6 +++---
 5 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/common/file.te b/common/file.te
index baf075f..32d6053 100644
--- a/common/file.te
+++ b/common/file.te
@@ -156,7 +156,7 @@ type sysfs_usb_uicc, sysfs_type, fs_type;
 type qlogd_socket, file_type, mlstrustedobject;
 type qlogd_data_file, file_type, data_file_type;
 #Defines the files (configs, dumps, etc) used by display processes
-type display_misc_file, file_type, data_file_type;
+type display_vendor_data_file, file_type, data_file_type;
 
 #Define the files for the operation of QDCM
 type persist_display_file, file_type;
diff --git a/common/file_contexts b/common/file_contexts
index 21d3fc6..9e3e732 100644
--- a/common/file_contexts
+++ b/common/file_contexts
@@ -525,7 +525,7 @@
 /data/vendor/perfd(/.*)?                                            u:object_r:mpctl_data_file:s0
 /data/vendor/iop(/.*)?                                                u:object_r:iop_data_file:s0
 /data/vendor/lm(/.*)?                                               u:object_r:lm_data_file:s0
-/data/vendor/display(/.*)?                                          u:object_r:display_misc_file:s0
+/data/vendor/display(/.*)?                                          u:object_r:display_vendor_data_file:s0
 /data/vendor/ipa(/.*)?                                              u:object_r:ipa_vendor_data_file:s0
 /data/misc/qsee(/.*)?                                               u:object_r:data_qsee_file:s0
 /data/vendor/qtee(/.*)?                                             u:object_r:data_qtee_file:s0
diff --git a/common/hal_graphics_composer.te b/common/hal_graphics_composer.te
index 5b6379b..fc1b0f7 100644
--- a/common/hal_graphics_composer.te
+++ b/common/hal_graphics_composer.te
@@ -53,8 +53,8 @@ allow hal_graphics_composer video_device:chr_file rw_file_perms;
 allow hal_graphics_composer video_device:dir r_dir_perms;
 
 # Allow reading/writing to '/data/vendor/display/*'
-allow hal_graphics_composer display_misc_file:dir create_dir_perms;
-allow hal_graphics_composer display_misc_file:file create_file_perms;
+allow hal_graphics_composer display_vendor_data_file:dir create_dir_perms;
+allow hal_graphics_composer display_vendor_data_file:file create_file_perms;
 
 # Allow reading/writing to 'persist/display/*'
 allow hal_graphics_composer persist_display_file:dir rw_dir_perms;
diff --git a/common/mm-pp-daemon.te b/common/mm-pp-daemon.te
index 20a47f6..ad8850e 100644
--- a/common/mm-pp-daemon.te
+++ b/common/mm-pp-daemon.te
@@ -16,8 +16,8 @@ allow mm-pp-daemon persist_display_file:file create_file_perms;
 allow mm-pp-daemon persist_file:dir search;
 
 # Allow reading/writing data config files
-allow mm-pp-daemon display_misc_file:dir create_dir_perms;
-allow mm-pp-daemon display_misc_file:file create_file_perms;
+allow mm-pp-daemon display_vendor_data_file:dir create_dir_perms;
+allow mm-pp-daemon display_vendor_data_file:file create_file_perms;
 
 # Allow read to sensor device and read/write to sensor socket
 allow mm-pp-daemon sensors_device:chr_file r_file_perms;
diff --git a/common/surfaceflinger.te b/common/surfaceflinger.te
index 86e4618..c9a551b 100644
--- a/common/surfaceflinger.te
+++ b/common/surfaceflinger.te
@@ -15,9 +15,9 @@ binder_call(surfaceflinger, tee)
 
 hal_client_domain(surfaceflinger, hal_display_config)
 
-# access to /data/misc/display for dumping input frames
-allow surfaceflinger display_misc_file:dir create_dir_perms;
-allow surfaceflinger display_misc_file:file create_file_perms;
+# access to /data/vendor/display for dumping input frames
+allow surfaceflinger display_vendor_data_file:dir create_dir_perms;
+allow surfaceflinger display_vendor_data_file:file create_file_perms;
 
 # Allows access to dpps daemon in calibration mode
 #unix_socket_connect(surfaceflinger, pps, mm-pp-daemon)
-- 
2.17.1

