From f6df69348d1df3038daeb1fd0fe8e71e6e870eee Mon Sep 17 00:00:00 2001
From: Sridhar Parasuram <sridhar@codeaurora.org>
Date: Fri, 2 Feb 2018 16:09:10 -0800
Subject: [PATCH 19/21] Change to compile due to hostapd.te removal

Change-Id: Ic06cb6002d816c477cf8eac5cb87fb882911193f
---
 common/file.te    |  1 +
 common/hostapd.te | 10 ++++++++--
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/common/file.te b/common/file.te
index 0522f12..a66973c 100644
--- a/common/file.te
+++ b/common/file.te
@@ -242,6 +242,7 @@ type dynamic_nv_data_file, file_type, data_file_type;
 # Wifi Data file
 type wifi_vendor_data_file, file_type, data_file_type;
 type wifi_vendor_wpa_socket, file_type, data_file_type;
+type hostapd_socket, file_type, data_file_type;
 
 # wififtmd socket file
 type wififtmd_socket, file_type;
diff --git a/common/hostapd.te b/common/hostapd.te
index 307bb11..ef624f5 100644
--- a/common/hostapd.te
+++ b/common/hostapd.te
@@ -27,6 +27,12 @@
 
 # Allow hostapd_cli to work. hostapd_cli creates a socket in
 # /data/misc/wifi/sockets which hostapd communicates with.
+#
+
+# userspace wifi access points
+type hostapd, domain;
+type hostapd_exec, exec_type, vendor_file_type, file_type;
+
 userdebug_or_eng(`
   unix_socket_send(hostapd, wifi_vendor_wpa, su)
 ')
@@ -44,8 +50,8 @@ allow hostapd smem_log_device:chr_file rw_file_perms;
 allow hostapd fstman:unix_dgram_socket sendto;
 allow hostapd wifi_vendor_data_file:dir w_dir_perms;
 allow hostapd wifi_vendor_data_file:file create_file_perms;
-allow hostapd wifi_vendor_hostapd_socket:dir w_dir_perms;
-allow hostapd wifi_vendor_hostapd_socket:sock_file { unlink create setattr };
+allow hostapd hostapd_data_file:dir w_dir_perms;
+allow hostapd hostapd_data_file:sock_file create_file_perms;
 # wigig_hostapd has its own directory for sockets,
 # in order to prevent conflicts with wifi hostapd
 # allow wigig_hostapd to create the directory holding its control socket
-- 
2.17.1

