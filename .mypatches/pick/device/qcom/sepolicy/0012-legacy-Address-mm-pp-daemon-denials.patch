From cac690ab97b7021868acb179153e93c364f56fc3 Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Wed, 28 Feb 2018 09:56:48 +0000
Subject: [PATCH 12/19] legacy: Address mm-pp-daemon denials

Change-Id: I9b5f18936b3b7dc362b81750b24af41810ea847e
---
 legacy-common/mm-pp-daemon.te   | 4 ++++
 legacy-common/property.te       | 1 +
 legacy-common/property_contexts | 2 ++
 legacy-common/surfaceflinger.te | 2 ++
 4 files changed, 9 insertions(+)
 create mode 100644 legacy-common/property.te

diff --git a/legacy-common/mm-pp-daemon.te b/legacy-common/mm-pp-daemon.te
index 8385911..09f17e0 100644
--- a/legacy-common/mm-pp-daemon.te
+++ b/legacy-common/mm-pp-daemon.te
@@ -10,3 +10,7 @@ allow mm-pp-daemon {
 allow mm-pp-daemon { shell_exec zygote_exec }:file rx_file_perms;
 
 allow mm-pp-daemon system_server:unix_stream_socket rw_socket_perms;
+
+allow mm-pp-daemon ion_device:chr_file w_file_perms;
+
+set_prop(mm-pp-daemon, postprocessing_prop)
diff --git a/legacy-common/property.te b/legacy-common/property.te
new file mode 100644
index 0000000..d0db41a
--- /dev/null
+++ b/legacy-common/property.te
@@ -0,0 +1 @@
+type postprocessing_prop, property_type;
diff --git a/legacy-common/property_contexts b/legacy-common/property_contexts
index c755d81..923c989 100644
--- a/legacy-common/property_contexts
+++ b/legacy-common/property_contexts
@@ -1 +1,3 @@
 ctl.msm_irqbalance         u:object_r:msm_irqbalance_prop:s0
+hw.cabl                    u:object_r:postprocessing_prop:s0
+hw.pp.                     u:object_r:postprocessing_prop:s0
diff --git a/legacy-common/surfaceflinger.te b/legacy-common/surfaceflinger.te
index 4522d88..a18a104 100644
--- a/legacy-common/surfaceflinger.te
+++ b/legacy-common/surfaceflinger.te
@@ -4,3 +4,5 @@ unix_socket_connect(surfaceflinger, mpctl, perfd)
 unix_socket_send(surfaceflinger, mpctl, mpdecision)
 unix_socket_connect(surfaceflinger, mpctl, mpdecision)
 unix_socket_connect(surfaceflinger, pps, mm-pp-daemon)
+
+set_prop(surfaceflinger, postprocessing_prop)
-- 
2.15.1

