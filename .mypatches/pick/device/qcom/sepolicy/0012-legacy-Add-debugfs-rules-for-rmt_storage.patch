From f061029e779976d59b1a3749043b1f796dc432f5 Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Wed, 28 Feb 2018 09:52:12 +0000
Subject: [PATCH 12/17] legacy: Add debugfs rules for rmt_storage

Change-Id: Id29dbfe25a979ff8257ba5f4f6fe94ec2c2b471c
---
 legacy-common/file.te        | 1 +
 legacy-common/genfs_contexts | 1 +
 legacy-common/rmt_storage.te | 6 ++++++
 3 files changed, 8 insertions(+)
 create mode 100644 legacy-common/genfs_contexts

diff --git a/legacy-common/file.te b/legacy-common/file.te
index f2e2ad1..fd0ce04 100644
--- a/legacy-common/file.te
+++ b/legacy-common/file.te
@@ -1 +1,2 @@
+type debugfs_rmt, debugfs_type, fs_type;
 type sysfs_runtime_status, sysfs_type, fs_type;
diff --git a/legacy-common/genfs_contexts b/legacy-common/genfs_contexts
new file mode 100644
index 0000000..f94e9eb
--- /dev/null
+++ b/legacy-common/genfs_contexts
@@ -0,0 +1 @@
+genfscon debugfs /rmt_storage u:object_r:debugfs_rmt:s0
diff --git a/legacy-common/rmt_storage.te b/legacy-common/rmt_storage.te
index 7303b7e..81aa950 100644
--- a/legacy-common/rmt_storage.te
+++ b/legacy-common/rmt_storage.te
@@ -1 +1,7 @@
 allow rmt_storage self:capability sys_admin;
+
+# debugfs access
+userdebug_or_eng(`
+  allow rmt_storage debugfs_rmt:dir search;
+  allow rmt_storage debugfs_rmt:file rw_file_perms;
+')
-- 
2.7.4

