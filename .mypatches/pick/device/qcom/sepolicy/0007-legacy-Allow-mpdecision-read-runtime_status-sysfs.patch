From 3980eab7daa98f9da9e22cb3d8ba7a6d9d288b24 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Thu, 25 Jan 2018 23:54:24 +0200
Subject: [PATCH 07/13] legacy: Allow mpdecision read runtime_status sysfs

* Required by msm8974 mpdecision

Change-Id: I8b2e3483e7ebfe589c602bcd1c85ea6421f4171d
---
 legacy-common/file.te       | 1 +
 legacy-common/file_contexts | 3 +++
 legacy-common/mpdecision.te | 1 +
 3 files changed, 5 insertions(+)
 create mode 100644 legacy-common/file.te

diff --git a/legacy-common/file.te b/legacy-common/file.te
new file mode 100644
index 0000000..f2e2ad1
--- /dev/null
+++ b/legacy-common/file.te
@@ -0,0 +1 @@
+type sysfs_runtime_status, sysfs_type, fs_type;
diff --git a/legacy-common/file_contexts b/legacy-common/file_contexts
index f924b32..f5429e1 100644
--- a/legacy-common/file_contexts
+++ b/legacy-common/file_contexts
@@ -56,3 +56,6 @@
 /sys/devices/[a-f0-9]+\.qcom,kgsl-3d0/kgsl/kgsl-3d0(/.*)?                     u:object_r:sysfs_kgsl:s0
 /sys/devices/[a-f0-9]+\.qcom,kgsl-3d0/devfreq/[a-f0-9]+.qcom,kgsl-3d0(/.*)?   u:object_r:sysfs_kgsl:s0
 /sys/devices/[a-f0-9]+\.qcom,kgsl-3d0/kgsl/kgsl-3d0/gpuclk                    u:object_r:sysfs_kgsl_gpuclk:s0
+
+# Runtime status
+/sys/devices/mdp\.0/power/runtime_status                                      u:object_r:sysfs_runtime_status:s0
diff --git a/legacy-common/mpdecision.te b/legacy-common/mpdecision.te
index e21df98..953856c 100644
--- a/legacy-common/mpdecision.te
+++ b/legacy-common/mpdecision.te
@@ -1,4 +1,5 @@
 allow mpdecision cgroup:file r_file_perms;
 allow mpdecision sysfs_kgsl:file rw_file_perms;
+allow mpdecision sysfs_runtime_status:file r_file_perms;
 
 get_prop(mpdecision, freq_prop)
-- 
2.7.4

