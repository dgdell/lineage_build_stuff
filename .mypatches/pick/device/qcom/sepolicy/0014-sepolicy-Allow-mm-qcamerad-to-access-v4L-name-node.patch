From 9794771cb7bdb8632c79ccbd8ad5ba05f203fdd0 Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Mon, 4 Jun 2018 21:11:32 +0100
Subject: [PATCH 14/15] sepolicy: Allow mm-qcamerad to access v4L "name" node

 * Label additional nodes and add it as common rule, since it doesn't
   apply only to msm8953.

Change-Id: I42b329d782795feed776b09d5c12d89be9bac868
---
 vendor/common/file_contexts  | 2 ++
 vendor/common/mm-qcamerad.te | 3 +++
 2 files changed, 5 insertions(+)

diff --git a/vendor/common/file_contexts b/vendor/common/file_contexts
index a0ea67b2..038fd376 100644
--- a/vendor/common/file_contexts
+++ b/vendor/common/file_contexts
@@ -449,6 +449,8 @@
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,mdss_mdp/bw_mode_bitmap             u:object_r:sysfs_graphics:s0
 /sys/devices/soc.0/[a-z0-9]+.qcom,mdss_mdp/bw_mode_bitmap            u:object_r:sysfs_graphics:s0
 /sys/devices/soc.0/[a-z0-9]+.qcom,mdss_mdp/caps                      u:object_r:sysfs_graphics:s0
+/sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,fd/video4linux/video[0-9]+/name(/.*)?   u:object_r:sysfs_graphics:s0
+/sys/devices(/platform)?/soc/[a-z0-9]+\.qcom,msm-cam/video4linux/video[0-9]+/name(/.*)?   u:object_r:sysfs_graphics:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,mdss_cam/video4linux/video[0-9]+/name(/.*)?   u:object_r:sysfs_graphics:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,mdss_rotator/video4linux/video[0-9]+/name(/.*)?   u:object_r:sysfs_graphics:s0
 /sys/devices(/platform)?/soc/[a-z0-9]+.qcom,mdss_rotator/caps       u:object_r:sysfs_graphics:s0
diff --git a/vendor/common/mm-qcamerad.te b/vendor/common/mm-qcamerad.te
index 4277d56c..9cfd5d9c 100644
--- a/vendor/common/mm-qcamerad.te
+++ b/vendor/common/mm-qcamerad.te
@@ -75,3 +75,6 @@ allow mm-qcamerad self:socket create_socket_perms;
 allowxperm mm-qcamerad self:socket ioctl msm_sock_ipc_ioctls;
 
 allow mm-qcamerad sysfs_data:file r_file_perms;
+
+#for v4L node "name" access
+allow mm-qcamerad sysfs_graphics:file rw_file_perms;
-- 
2.17.1

