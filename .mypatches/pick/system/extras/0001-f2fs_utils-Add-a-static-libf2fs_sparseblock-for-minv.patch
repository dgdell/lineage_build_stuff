From e95c0577b02a840652f36714c62503236b939397 Mon Sep 17 00:00:00 2001
From: Ricardo Cerqueira <ricardo@cyngn.com>
Date: Fri, 7 Nov 2014 01:21:24 +0000
Subject: [PATCH 1/3] f2fs_utils: Add a static libf2fs_sparseblock for minvold

Change-Id: Id0947eb304cabbe59c21b8c2e2b81a03cceed619
---
 f2fs_utils/Android.bp         | 21 +++++++++++++++++++++
 f2fs_utils/f2fs_sparseblock.c |  2 ++
 2 files changed, 23 insertions(+)

diff --git a/f2fs_utils/Android.bp b/f2fs_utils/Android.bp
index 7a832780..d553e2e3 100644
--- a/f2fs_utils/Android.bp
+++ b/f2fs_utils/Android.bp
@@ -1,5 +1,26 @@
 // Copyright 2017 The Android Open Source Project
 
+cc_library_static {
+    name: "libf2fs_sparseblock_static",
+    defaults: ["system-extras-cflags-defaults"],
+
+    srcs: ["f2fs_sparseblock.c"],
+
+    shared_libs: [
+        "liblog",
+        "libcutils",
+    ],
+
+    include_dirs: [
+        "external/f2fs-tools/include",
+        "system/core/include/log",
+    ],
+
+    cflags: ["-DSTATIC_LIB"],
+
+    export_include_dirs: ["."]
+}
+
 cc_library_shared {
     name: "libf2fs_sparseblock",
     defaults: ["system-extras-cflags-defaults"],
diff --git a/f2fs_utils/f2fs_sparseblock.c b/f2fs_utils/f2fs_sparseblock.c
index 27225c62..aa86895b 100644
--- a/f2fs_utils/f2fs_sparseblock.c
+++ b/f2fs_utils/f2fs_sparseblock.c
@@ -591,6 +591,7 @@ int copy_used(u64 pos, void *data)
     return 0;
 }
 
+#ifndef STATIC_LIB
 int main(int argc, char **argv)
 {
     if (argc != 3)
@@ -634,3 +635,4 @@ int main(int argc, char **argv)
     close(outfd);
     return 0;
 }
+#endif
-- 
2.17.1

