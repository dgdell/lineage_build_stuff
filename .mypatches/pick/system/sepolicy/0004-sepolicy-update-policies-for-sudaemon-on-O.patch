From c1096b76677aee607b505405ffa6bdead826a0c3 Mon Sep 17 00:00:00 2001
From: jrior001 <jriordan001@gmail.com>
Date: Mon, 8 Jan 2018 01:15:22 -0500
Subject: [PATCH 4/5] sepolicy: update policies for sudaemon on O

Change-Id: I552e6b0d5358d4bce20164e67721e319abcd16ce
---
 public/domain.te | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/public/domain.te b/public/domain.te
index 01abfd1..5af5140 100644
--- a/public/domain.te
+++ b/public/domain.te
@@ -654,6 +654,8 @@ full_treble_only(`
     -init
     -ueventd
     -socket_between_core_and_vendor_violators
+    -sudaemon
+    -system_app
   } {
     file_type
     dev_type
@@ -805,7 +807,7 @@ neverallow * { file_type fs_type dev_type }:{ lnk_file fifo_file sock_file } mou
 # Nobody should be able to execute su on user builds.
 # On userdebug/eng builds, only dumpstate, shell, and
 # su itself execute su.
-neverallow { domain userdebug_or_eng(`-dumpstate -shell -su -sudaemon') } su_exec:file no_x_file_perms;
+neverallow { domain userdebug_or_eng(`-dumpstate -shell -su -sudaemon -init') } su_exec:file no_x_file_perms;
 
 # Do not allow the introduction of new execmod rules. Text relocations
 # and modification of executable pages are unsafe.
@@ -909,7 +911,7 @@ neverallow {
 
 # Only domains spawned from zygote and runas may have the appdomain attribute.
 neverallow { domain -runas -webview_zygote -zygote } {
-  appdomain -shell userdebug_or_eng(`-su')
+  appdomain -shell userdebug_or_eng(`-su -sudaemon')
 }:process { transition dyntransition };
 
 # Minimize read access to shell- or app-writable symlinks.
-- 
2.7.4

