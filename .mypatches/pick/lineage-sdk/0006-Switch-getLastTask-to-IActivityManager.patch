From 21100e918c2ec8c34a0e42cd0b544be14705d7bf Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Thu, 30 Aug 2018 21:26:26 +0200
Subject: [PATCH 6/6] Switch getLastTask to IActivityManager

Change-Id: I752c2445c3ffc0933dfe6290c99d839a036e4bc3
---
 sdk/src/java/org/lineageos/internal/util/ActionUtils.java | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/sdk/src/java/org/lineageos/internal/util/ActionUtils.java b/sdk/src/java/org/lineageos/internal/util/ActionUtils.java
index c00cc17..f7ccc04 100644
--- a/sdk/src/java/org/lineageos/internal/util/ActionUtils.java
+++ b/sdk/src/java/org/lineageos/internal/util/ActionUtils.java
@@ -120,9 +120,9 @@ public class ActionUtils {
     private static ActivityManager.RecentTaskInfo getLastTask(Context context, int userId)
             throws RemoteException {
         final String defaultHomePackage = resolveCurrentLauncherPackage(context, userId);
-        final ActivityManager am = (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
-        final List<ActivityManager.RecentTaskInfo> tasks = am.getRecentTasksForUser(5,
-                ActivityManager.RECENT_IGNORE_UNAVAILABLE, userId);
+        final IActivityManager iam = ActivityManager.getService();
+        final List<ActivityManager.RecentTaskInfo> tasks = iam.getRecentTasks(5,
+                ActivityManager.RECENT_IGNORE_UNAVAILABLE, userId).getList();
 
         for (int i = 1; i < tasks.size(); i++) {
             ActivityManager.RecentTaskInfo task = tasks.get(i);
-- 
2.17.1

