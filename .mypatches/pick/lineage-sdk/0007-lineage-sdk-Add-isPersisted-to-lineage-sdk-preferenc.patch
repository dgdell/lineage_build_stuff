From e9145ab71220b2122fd75cc662ca96f54f450422 Mon Sep 17 00:00:00 2001
From: Sam Mortimer <sam@mortimer.me.uk>
Date: Thu, 9 Aug 2018 11:10:44 -0700
Subject: [PATCH 07/13] lineage-sdk: Add isPersisted() to lineage-sdk
 preferences

Replaces the need for:
https://review.lineageos.org/#/c/LineageOS/android_frameworks_support/+/223152/

Change-Id: Ide3417019ccf8bde5dca3b2aec3d2075e7c8b597
---
 .../preference/SelfRemovingDropDownPreference.java         | 7 +++++++
 .../lineageos/preference/SelfRemovingListPreference.java   | 6 ++++++
 .../java/lineageos/preference/SelfRemovingPreference.java  | 7 +++++++
 .../lineageos/preference/SelfRemovingSwitchPreference.java | 7 +++++++
 4 files changed, 27 insertions(+)

diff --git a/sdk/src/java/lineageos/preference/SelfRemovingDropDownPreference.java b/sdk/src/java/lineageos/preference/SelfRemovingDropDownPreference.java
index 03097cf..3f678a4 100644
--- a/sdk/src/java/lineageos/preference/SelfRemovingDropDownPreference.java
+++ b/sdk/src/java/lineageos/preference/SelfRemovingDropDownPreference.java
@@ -62,4 +62,11 @@ public class SelfRemovingDropDownPreference extends DropDownPreference {
     public boolean isAvailable() {
         return mConstraints.isAvailable();
     }
+
+    /**
+     * Returns whether the preference can be found in persistent storage
+     */
+    protected boolean isPersisted() {
+        return getSharedPreferences().contains(getKey());
+    }
 }
diff --git a/sdk/src/java/lineageos/preference/SelfRemovingListPreference.java b/sdk/src/java/lineageos/preference/SelfRemovingListPreference.java
index 0b8c798..cc07890 100644
--- a/sdk/src/java/lineageos/preference/SelfRemovingListPreference.java
+++ b/sdk/src/java/lineageos/preference/SelfRemovingListPreference.java
@@ -63,4 +63,10 @@ public class SelfRemovingListPreference extends ListPreference {
         return mConstraints.isAvailable();
     }
 
+    /**
+     * Returns whether the preference can be found in persistent storage
+     */
+    protected boolean isPersisted() {
+        return getSharedPreferences().contains(getKey());
+    }
 }
diff --git a/sdk/src/java/lineageos/preference/SelfRemovingPreference.java b/sdk/src/java/lineageos/preference/SelfRemovingPreference.java
index 5271f56..c687397 100644
--- a/sdk/src/java/lineageos/preference/SelfRemovingPreference.java
+++ b/sdk/src/java/lineageos/preference/SelfRemovingPreference.java
@@ -67,4 +67,11 @@ public class SelfRemovingPreference extends Preference {
     public boolean isAvailable() {
         return mConstraints.isAvailable();
     }
+
+    /**
+     * Returns whether the preference can be found in persistent storage
+     */
+    protected boolean isPersisted() {
+        return getSharedPreferences().contains(getKey());
+    }
 }
diff --git a/sdk/src/java/lineageos/preference/SelfRemovingSwitchPreference.java b/sdk/src/java/lineageos/preference/SelfRemovingSwitchPreference.java
index a637f22..e841793 100644
--- a/sdk/src/java/lineageos/preference/SelfRemovingSwitchPreference.java
+++ b/sdk/src/java/lineageos/preference/SelfRemovingSwitchPreference.java
@@ -62,4 +62,11 @@ public class SelfRemovingSwitchPreference extends SwitchPreference {
     public boolean isAvailable() {
         return mConstraints.isAvailable();
     }
+
+    /**
+     * Returns whether the preference can be found in persistent storage
+     */
+    protected boolean isPersisted() {
+        return getSharedPreferences().contains(getKey());
+    }
 }
-- 
2.17.1

