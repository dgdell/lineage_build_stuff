From 22121e61c1a443015ff93d4e6a6446fce56a639b Mon Sep 17 00:00:00 2001
From: Steve Pfetsch <spfetsch@google.com>
Date: Mon, 9 Oct 2017 12:33:47 -0700
Subject: [PATCH] libgralloc: Fix adding offset to the mapped base address

Bug: 63662821
Change-Id: I722ed2560efd66e2e61a3054d7db7f6241e8e911
---
 libgralloc/mapper.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/libgralloc/mapper.cpp b/libgralloc/mapper.cpp
index 8464d8619..1d8ac8090 100644
--- a/libgralloc/mapper.cpp
+++ b/libgralloc/mapper.cpp
@@ -73,7 +73,7 @@ static int gralloc_map(gralloc_module_t const* /*module*/,
             return -errno;
         }
 
-        hnd->base = intptr_t(mappedAddress) + hnd->offset;
+        hnd->base = intptr_t(mappedAddress);
         mappedAddress = MAP_FAILED;
         size = ROUND_UP_PAGESIZE(sizeof(MetaData_t));
         err = memalloc->map_buffer(&mappedAddress, size,
@@ -84,7 +84,7 @@ static int gralloc_map(gralloc_module_t const* /*module*/,
             hnd->base_metadata = 0;
             return -errno;
         }
-        hnd->base_metadata = intptr_t(mappedAddress) + hnd->offset_metadata;
+        hnd->base_metadata = intptr_t(mappedAddress);
     }
     return 0;
 }
-- 
2.17.1

