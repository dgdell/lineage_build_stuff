From 0b84b3abb23cb1b67eeb3b98b432b5ceb4bdad56 Mon Sep 17 00:00:00 2001
From: Steve Kondik <steve@cyngn.com>
Date: Thu, 30 Nov 2017 15:06:46 +0100
Subject: [PATCH] msm8974: hwc: Set ioprio for vsync thread
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

 * We're not doing this automatically anymore.

Change-Id: I7f80e2ab862816809dd2b26f10ea8bf1aaea5020
Signed-off-by: D. Andrei Măceș <Andrei.Maces@alumni.nd.edu>
---
 msm8974/libhwcomposer/Android.mk    | 2 +-
 msm8974/libhwcomposer/hwc_vsync.cpp | 2 ++
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/msm8974/libhwcomposer/Android.mk b/msm8974/libhwcomposer/Android.mk
index d0038039b..e6566045f 100644
--- a/msm8974/libhwcomposer/Android.mk
+++ b/msm8974/libhwcomposer/Android.mk
@@ -12,7 +12,7 @@ LOCAL_C_INCLUDES              := $(common_includes) $(kernel_includes)
 LOCAL_SHARED_LIBRARIES        := $(common_libs) libEGL liboverlay \
                                  libexternal libqdutils libhardware_legacy \
                                  libdl libmemalloc libqservice libsync \
-                                 libbinder libmedia
+                                 libbinder libmedia libbfqio_vendor
 LOCAL_CFLAGS                  := $(common_flags) -DLOG_TAG=\"qdhwcomposer\"
 LOCAL_ADDITIONAL_DEPENDENCIES := $(common_deps)
 LOCAL_SRC_FILES               := hwc.cpp          \
diff --git a/msm8974/libhwcomposer/hwc_vsync.cpp b/msm8974/libhwcomposer/hwc_vsync.cpp
index 65d842c1d..34c2c59b2 100644
--- a/msm8974/libhwcomposer/hwc_vsync.cpp
+++ b/msm8974/libhwcomposer/hwc_vsync.cpp
@@ -19,6 +19,7 @@
  */
 
 #include <cutils/properties.h>
+#include <bfqio/bfqio.h>
 #include <utils/Log.h>
 #include <fcntl.h>
 #include <sys/ioctl.h>
@@ -56,6 +57,7 @@ static void *vsync_loop(void *param)
     prctl(PR_SET_NAME, (unsigned long) &thread_name, 0, 0, 0);
     setpriority(PRIO_PROCESS, 0, HAL_PRIORITY_URGENT_DISPLAY +
                 android::PRIORITY_MORE_FAVORABLE);
+    android_set_rt_ioprio(0, 1);
 
     const int MAX_DATA = 64;
     char vdata[MAX_DATA];
-- 
2.17.0

