From 0eff2e4a838836f96913774c53078b5601163dc0 Mon Sep 17 00:00:00 2001
From: Craig Tatlor <ctatlor97@gmail.com>
Date: Mon, 21 May 2018 17:06:59 +0100
Subject: [PATCH 1/3] Build mm-video-v4l2 with BOARD_VNDK_VERSION

Includes needed (header) libs and adds missing includes.

Change-Id: Idc14dcd0d26b98cb68e6b5e1b3c0322bdf73b45d
---
 mm-video-v4l2/vidc/vdec/Android.mk      |  8 +++++++-
 mm-video-v4l2/vidc/vdec/inc/ts_parser.h |  1 +
 mm-video-v4l2/vidc/venc/Android.mk      | 11 ++++++++++-
 3 files changed, 18 insertions(+), 2 deletions(-)

diff --git a/mm-video-v4l2/vidc/vdec/Android.mk b/mm-video-v4l2/vidc/vdec/Android.mk
index e848b97ce..601bf41f3 100755
--- a/mm-video-v4l2/vidc/vdec/Android.mk
+++ b/mm-video-v4l2/vidc/vdec/Android.mk
@@ -135,8 +135,14 @@ LOCAL_VENDOR_MODULE             := true
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                += $(libmm-vdec-inc)
 
+LOCAL_HEADER_LIBRARIES := \
+    libnativebase_headers \
+    libhardware_headers \
+    media_plugin_headers \
+
 LOCAL_PRELINK_MODULE    := false
-LOCAL_SHARED_LIBRARIES  := liblog libutils libbinder libcutils libdl
+LOCAL_SHARED_LIBRARIES  := libui libhardware liblog libutils libbinder \
+                           libcutils libdl
 
 LOCAL_SHARED_LIBRARIES  += libqdMetaData
 
diff --git a/mm-video-v4l2/vidc/vdec/inc/ts_parser.h b/mm-video-v4l2/vidc/vdec/inc/ts_parser.h
index 2d5d1a40f..0b02104de 100644
--- a/mm-video-v4l2/vidc/vdec/inc/ts_parser.h
+++ b/mm-video-v4l2/vidc/vdec/inc/ts_parser.h
@@ -33,6 +33,7 @@ ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 #include "qc_omx_component.h"
 
 #include<stdlib.h>
+#include <pthread.h>
 
 #include <stdio.h>
 #include <inttypes.h>
diff --git a/mm-video-v4l2/vidc/venc/Android.mk b/mm-video-v4l2/vidc/venc/Android.mk
index 341d9a242..683eb6d8f 100644
--- a/mm-video-v4l2/vidc/venc/Android.mk
+++ b/mm-video-v4l2/vidc/venc/Android.mk
@@ -97,6 +97,9 @@ libmm-venc-inc      += frameworks/av/include/media/stagefright
 libmm-venc-inc      += $(TARGET_OUT_HEADERS)/qcom/display/
 libmm-venc-inc      += $(venc-inc)
 
+LOCAL_HEADER_LIBRARIES := \
+        media_plugin_headers
+
 LOCAL_MODULE                    := libOmxVenc
 LOCAL_MODULE_TAGS               := optional
 LOCAL_VENDOR_MODULE             := true
@@ -104,7 +107,7 @@ LOCAL_CFLAGS                    := $(libmm-venc-def)
 LOCAL_C_INCLUDES                := $(libmm-venc-inc)
 
 LOCAL_PRELINK_MODULE      := false
-LOCAL_SHARED_LIBRARIES    := liblog libutils libbinder libcutils \
+LOCAL_SHARED_LIBRARIES    := liblog libutils libhardware libbinder libcutils \
                              libc2dcolorconvert libdl
 
 LOCAL_SRC_FILES   := src/omx_video_base.cpp
@@ -134,6 +137,9 @@ mm-venc-test720p-inc            += $(call project-path-for,qcom-media)/mm-core/i
 mm-venc-test720p-inc            += $(call project-path-for,qcom-display)/libgralloc
 mm-venc-test720p-inc            += $(venc-inc)
 
+LOCAL_HEADER_LIBRARIES := \
+        media_plugin_headers
+
 LOCAL_MODULE                    := mm-venc-omx-test720p
 LOCAL_MODULE_TAGS               := optional
 LOCAL_VENDOR_MODULE             := true
@@ -160,6 +166,9 @@ venc-test-inc                   += $(LOCAL_PATH)/inc
 venc-test-inc                   += $(call project-path-for,qcom-display)/libgralloc
 venc-test-inc                   += $(venc-inc)
 
+LOCAL_HEADER_LIBRARIES := \
+        media_plugin_headers
+
 LOCAL_MODULE                    := mm-video-encdrv-test
 LOCAL_MODULE_TAGS               := optional
 LOCAL_VENDOR_MODULE             := true
-- 
2.17.1

