From 130956d79b621f9cc0613082aabf1aadfca82939 Mon Sep 17 00:00:00 2001
From: dianlujitao <dianlujitao@lineageos.org>
Date: Thu, 18 Jan 2018 22:05:14 +0800
Subject: [PATCH 2/6] power: Remove mutex to camera hints

 * No longer needed.

Change-Id: I09fc90b4e5399b3f3b8a409edf3f57361da90100
---
 power-660.c  | 5 -----
 power-8953.c | 5 -----
 2 files changed, 10 deletions(-)

diff --git a/power-660.c b/power-660.c
index 24cd6b0..304eaff 100644
--- a/power-660.c
+++ b/power-660.c
@@ -55,7 +55,6 @@ static int display_hint_sent;
 static int video_encode_hint_sent;
 static int cam_preview_hint_sent;
 
-pthread_mutex_t camera_hint_mutex = PTHREAD_MUTEX_INITIALIZER;
 static int camera_hint_ref_count;
 static void process_video_encode_hint(void *metadata);
 //static void process_cam_preview_hint(void *metadata);
@@ -259,7 +258,6 @@ static void process_video_encode_hint(void *metadata)
                 memcpy(resource_values, res, MIN_VAL(sizeof(resource_values), sizeof(res)));
                 num_resources = sizeof(res)/sizeof(res[0]);
             }
-            pthread_mutex_lock(&camera_hint_mutex);
             camera_hint_ref_count++;
             if (camera_hint_ref_count == 1) {
                 if (!video_encode_hint_sent) {
@@ -268,19 +266,16 @@ static void process_video_encode_hint(void *metadata)
                     video_encode_hint_sent = 1;
                 }
            }
-           pthread_mutex_unlock(&camera_hint_mutex);
         }
     } else if (video_encode_metadata.state == 0) {
         if ((strncmp(governor, INTERACTIVE_GOVERNOR,
             strlen(INTERACTIVE_GOVERNOR)) == 0) &&
             (strlen(governor) == strlen(INTERACTIVE_GOVERNOR))) {
-            pthread_mutex_lock(&camera_hint_mutex);
             camera_hint_ref_count--;
             if (!camera_hint_ref_count) {
                 undo_hint_action(video_encode_metadata.hint_id);
                 video_encode_hint_sent = 0;
             }
-            pthread_mutex_unlock(&camera_hint_mutex);
             return ;
         }
     }
diff --git a/power-8953.c b/power-8953.c
index 8867016..1cda9c3 100644
--- a/power-8953.c
+++ b/power-8953.c
@@ -53,7 +53,6 @@ static int display_hint_sent;
 static int video_encode_hint_sent;
 static int cam_preview_hint_sent;
 
-pthread_mutex_t camera_hint_mutex = PTHREAD_MUTEX_INITIALIZER;
 static int camera_hint_ref_count;
 static void process_video_encode_hint(void *metadata);
 //static void process_cam_preview_hint(void *metadata);
@@ -169,7 +168,6 @@ static void process_video_encode_hint(void *metadata)
                                      0x41434000, 0x1,
                                      0x41424000, 0x28,
                                      };
-            pthread_mutex_lock(&camera_hint_mutex);
             camera_hint_ref_count++;
             if (camera_hint_ref_count == 1) {
                 if (!video_encode_hint_sent) {
@@ -179,19 +177,16 @@ static void process_video_encode_hint(void *metadata)
                     video_encode_hint_sent = 1;
                 }
            }
-           pthread_mutex_unlock(&camera_hint_mutex);
         }
     } else if (video_encode_metadata.state == 0) {
         if ((strncmp(governor, INTERACTIVE_GOVERNOR,
             strlen(INTERACTIVE_GOVERNOR)) == 0) &&
             (strlen(governor) == strlen(INTERACTIVE_GOVERNOR))) {
-            pthread_mutex_lock(&camera_hint_mutex);
             camera_hint_ref_count--;
             if (!camera_hint_ref_count) {
                 undo_hint_action(video_encode_metadata.hint_id);
                 video_encode_hint_sent = 0;
             }
-            pthread_mutex_unlock(&camera_hint_mutex);
             return ;
         }
     }
-- 
2.7.4

