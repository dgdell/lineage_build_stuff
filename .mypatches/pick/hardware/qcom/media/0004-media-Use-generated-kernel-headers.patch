From 492c1cbaec94df97e9a11108d6dd6a864d1452c2 Mon Sep 17 00:00:00 2001
From: razorloves <razorloves@gmail.com>
Date: Wed, 3 Oct 2018 12:39:23 -0500
Subject: [PATCH 4/7] media: Use generated kernel headers

Change-Id: I8d7184523c5e24a43f38efb8192c50186462991f

# Conflicts:
#	msm8974/libc2dcolorconvert/Android.mk
---
 msm8974/libc2dcolorconvert/Android.mk | 2 +-
 msm8974/mm-video-legacy/vidc/vdec.mk  | 6 ++++++
 msm8974/mm-video-legacy/vidc/venc.mk  | 6 ++++++
 msm8974/mm-video-v4l2/vidc/vdec.mk    | 8 ++++++++
 msm8974/mm-video-v4l2/vidc/venc.mk    | 2 ++
 5 files changed, 23 insertions(+), 1 deletion(-)

diff --git a/msm8974/libc2dcolorconvert/Android.mk b/msm8974/libc2dcolorconvert/Android.mk
index 09d9d4eb7..406111258 100644
--- a/msm8974/libc2dcolorconvert/Android.mk
+++ b/msm8974/libc2dcolorconvert/Android.mk
@@ -10,7 +10,7 @@ LOCAL_CFLAGS += -Wno-error
 LOCAL_C_INCLUDES := \
     $(TARGET_OUT_HEADERS)/qcom/display
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
+LOCAL_HEADER_LIBRARIES := generated_kernel_headers
 
 LOCAL_SHARED_LIBRARIES := liblog libdl
 
diff --git a/msm8974/mm-video-legacy/vidc/vdec.mk b/msm8974/mm-video-legacy/vidc/vdec.mk
index 2fa9529a7..bb35c1763 100644
--- a/msm8974/mm-video-legacy/vidc/vdec.mk
+++ b/msm8974/mm-video-legacy/vidc/vdec.mk
@@ -72,6 +72,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                += $(libmm-vdec-inc)
 
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES  := liblog libutils libbinder libcutils libdl
 
 LOCAL_SHARED_LIBRARIES  += libdivxdrmdecrypt
@@ -106,6 +108,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                := $(mm-vdec-test-inc)
 
+LOCAL_HEADER_LIBRARIES    := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES    := libutils liblog libOmxCore libOmxVdec libbinder
 
 LOCAL_SRC_FILES           := vdec/src/queue.c
@@ -129,6 +133,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                := $(mm-vdec-drv-test-inc)
 
+LOCAL_HEADER_LIBRARIES          := generated_kernel_headers
+
 LOCAL_SRC_FILES                 := vdec/src/message_queue.c
 LOCAL_SRC_FILES                 += vdec/test/decoder_driver_test.c
 
diff --git a/msm8974/mm-video-legacy/vidc/venc.mk b/msm8974/mm-video-legacy/vidc/venc.mk
index dfb4da2f9..d6c846ea0 100644
--- a/msm8974/mm-video-legacy/vidc/venc.mk
+++ b/msm8974/mm-video-legacy/vidc/venc.mk
@@ -64,6 +64,8 @@ LOCAL_CFLAGS                    := $(libmm-venc-def)
 LOCAL_CFLAGS                    += -Wno-error
 LOCAL_C_INCLUDES                := $(libmm-venc-inc)
 
+LOCAL_HEADER_LIBRARIES    := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES    := liblog libutils libbinder libcutils \
                              libc2dcolorconvert libdl
 
@@ -100,6 +102,9 @@ LOCAL_MODULE                    := mm-venc-omx-test720p
 LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libmm-venc-def)
 LOCAL_C_INCLUDES                := $(mm-venc-test720p-inc)
+
+LOCAL_HEADER_LIBRARIES          := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES          := libmm-omxcore libOmxVenc libbinder
 
 LOCAL_SRC_FILES                 := venc/test/venc_test.cpp
@@ -125,6 +130,7 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_C_INCLUDES                := $(venc-test-inc)
 LOCAL_C_INCLUDES                += $(call project-path-for,qcom-media)/mm-core/inc
 
+LOCAL_HEADER_LIBRARIES          := generated_kernel_headers
 
 LOCAL_SRC_FILES                 := venc/test/video_encoder_test.c
 LOCAL_SRC_FILES                 += venc/test/queue.c
diff --git a/msm8974/mm-video-v4l2/vidc/vdec.mk b/msm8974/mm-video-v4l2/vidc/vdec.mk
index 8b80e7e54..e809fe3f3 100644
--- a/msm8974/mm-video-v4l2/vidc/vdec.mk
+++ b/msm8974/mm-video-v4l2/vidc/vdec.mk
@@ -117,6 +117,8 @@ LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_CFLAGS                    += -Wno-error
 LOCAL_C_INCLUDES                += $(libmm-vdec-inc)
 
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES  := liblog libutils libui libbinder libcutils libdl
 
 LOCAL_SHARED_LIBRARIES  += libdivxdrmdecrypt
@@ -162,6 +164,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                += $(libmm-vdec-inc)
 
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES  := liblog libutils libui libbinder libcutils libdl
 
 LOCAL_SHARED_LIBRARIES  += libdivxdrmdecrypt
@@ -199,6 +203,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                := $(mm-vdec-test-inc)
 
+LOCAL_HEADER_LIBRARIES    := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES    := libutils libui libOmxCore libOmxVdec libbinder libcutils
 
 LOCAL_SRC_FILES           := vdec/src/queue.c
@@ -220,6 +226,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libOmxVdec-def)
 LOCAL_C_INCLUDES                := $(mm-vdec-drv-test-inc)
 
+LOCAL_HEADER_LIBRARIES          := generated_kernel_headers
+
 LOCAL_SRC_FILES                 := vdec/src/message_queue.c
 LOCAL_SRC_FILES                 += vdec/test/decoder_driver_test.c
 
diff --git a/msm8974/mm-video-v4l2/vidc/venc.mk b/msm8974/mm-video-v4l2/vidc/venc.mk
index 608fa9ae2..acb3f8c01 100644
--- a/msm8974/mm-video-v4l2/vidc/venc.mk
+++ b/msm8974/mm-video-v4l2/vidc/venc.mk
@@ -95,6 +95,8 @@ LOCAL_MODULE_TAGS               := optional
 LOCAL_CFLAGS                    := $(libmm-venc-def)
 LOCAL_C_INCLUDES                := $(libmm-venc-inc)
 
+LOCAL_HEADER_LIBRARIES    := generated_kernel_headers
+
 LOCAL_SHARED_LIBRARIES    := liblog libutils libbinder libcutils \
                              libc2dcolorconvert libdl libgui
 
-- 
2.17.1

