From 7f2c1bf9885e3876daddae2118052c59c1457654 Mon Sep 17 00:00:00 2001
From: "Christopher N. Hesse" <raymanfx@gmail.com>
Date: Fri, 16 Feb 2018 12:40:06 +0100
Subject: [PATCH 08/35] ril: Add support for imsType parcel member

This is needed for Samsung devices like the Galaxy A5 2017.

Change-Id: I3b89cf8ac232fef5629b439dbf5d2f21bdb264a2
---
 ril/libril/Android.mk      | 4 ++++
 ril/libril/ril_service.cpp | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/ril/libril/Android.mk b/ril/libril/Android.mk
index 46a596c..eb23fd1 100644
--- a/ril/libril/Android.mk
+++ b/ril/libril/Android.mk
@@ -54,6 +54,10 @@ ifeq ($(BOARD_NEEDS_ROAMING_PROTOCOL_FIELD), true)
 LOCAL_CFLAGS += -DNEEDS_ROAMING_PROTOCOL_FIELD
 endif
 
+ifeq ($(BOARD_NEEDS_IMS_TYPE_FIELD), true)
+LOCAL_CFLAGS += -DNEEDS_IMS_TYPE_FIELD
+endif
+
 LOCAL_C_INCLUDES += $(LOCAL_PATH)/include
 LOCAL_C_INCLUDES += external/nanopb-c
 LOCAL_C_INCLUDES += $(LOCAL_PATH)/../include
diff --git a/ril/libril/ril_service.cpp b/ril/libril/ril_service.cpp
index d1fa581..f4f06d5 100644
--- a/ril/libril/ril_service.cpp
+++ b/ril/libril/ril_service.cpp
@@ -1948,6 +1948,10 @@ Return<void> RadioImpl::setInitialAttachApn(int32_t serial, const DataProfileInf
         }
 #endif
 
+#ifdef NEEDS_IMS_TYPE_FIELD
+        iaa.imsType = 0;
+#endif
+
         CALL_ONREQUEST(RIL_REQUEST_SET_INITIAL_ATTACH_APN, &iaa, sizeof(iaa), pRI, mSlotId);
 
         memsetAndFreeStrings(4, iaa.apn, iaa.protocol, iaa.username, iaa.password);
-- 
2.17.1

