From 91d16ecc535fc535dde912666d2b8318c877e518 Mon Sep 17 00:00:00 2001
From: "Christopher N. Hesse" <raymanfx@gmail.com>
Date: Thu, 12 Jul 2018 13:51:43 +0200
Subject: [PATCH 2/3] audio: improve log message to support for devices that
 dont have an amp

Change-Id: I3fe824c4dbdb57bb0d63b395cfcef2f9dbbe556b
Signed-off-by: Abhay Ruparel <abhayruparel2000@gmail.com>
---
 audio/audio_hw.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/audio/audio_hw.c b/audio/audio_hw.c
index ab7d122..24fbb72 100644
--- a/audio/audio_hw.c
+++ b/audio/audio_hw.c
@@ -219,6 +219,10 @@ static int amplifier_open(void)
     rc = hw_get_module(AMPLIFIER_HARDWARE_MODULE_ID,
             (const hw_module_t **) &module);
     if (rc) {
+        if (rc == -ENOENT) {
+            // no amplifier HAL present
+            return -ENOENT;
+        }
         ALOGV("%s: Failed to obtain reference to amplifier module: %s\n",
                 __func__, strerror(-rc));
         return -ENODEV;
@@ -4403,7 +4407,7 @@ static int adev_open(const hw_module_t *module, const char *name,
     }
 
 #ifdef DEVICE_HAS_AMPLIFIER_SUPPORT
-    if (amplifier_open() != 0) {
+    if (amplifier_open() != -ENOENT) {
         ALOGE("Amplifier initialization failed");
     }
 #endif
-- 
2.17.1

