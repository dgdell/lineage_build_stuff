From d8f757b5f4ed2718161fda499b9930b27c81678a Mon Sep 17 00:00:00 2001
From: dianlujitao <dianlujitao@lineageos.org>
Date: Sat, 23 Dec 2017 18:15:26 +0800
Subject: [PATCH 1/3] lineage/interfaces: Add binderized LiveDisplay HAL

 * Add initial API definition

Change-Id: I5873361a07480b7836056de4b40a2127abff6ba5
---
 livedisplay/1.0/Android.bp |  89 ++++++++++++
 livedisplay/1.0/Android.mk | 270 +++++++++++++++++++++++++++++++++++++
 livedisplay/1.0/IColor.hal |  46 +++++++
 livedisplay/1.0/types.hal  |  52 +++++++
 livedisplay/Android.bp     |   4 +
 5 files changed, 461 insertions(+)
 create mode 100644 livedisplay/1.0/Android.bp
 create mode 100644 livedisplay/1.0/Android.mk
 create mode 100644 livedisplay/1.0/IColor.hal
 create mode 100644 livedisplay/1.0/types.hal
 create mode 100644 livedisplay/Android.bp

diff --git a/livedisplay/1.0/Android.bp b/livedisplay/1.0/Android.bp
new file mode 100644
index 0000000..f24dbae
--- /dev/null
+++ b/livedisplay/1.0/Android.bp
@@ -0,0 +1,89 @@
+// This file is autogenerated by hidl-gen. Do not edit manually.
+
+filegroup {
+    name: "vendor.lineage.livedisplay@1.0_hal",
+    srcs: [
+        "types.hal",
+        "IColor.hal",
+    ],
+}
+
+genrule {
+    name: "vendor.lineage.livedisplay@1.0_genc++",
+    tools: ["hidl-gen"],
+    cmd: "$(location hidl-gen) -o $(genDir) -Lc++-sources -randroid.hidl:system/libhidl/transport -rvendor.lineage:hardware/lineage/interfaces vendor.lineage.livedisplay@1.0",
+    srcs: [
+        ":vendor.lineage.livedisplay@1.0_hal",
+    ],
+    out: [
+        "vendor/lineage/livedisplay/1.0/types.cpp",
+        "vendor/lineage/livedisplay/1.0/ColorAll.cpp",
+    ],
+}
+
+genrule {
+    name: "vendor.lineage.livedisplay@1.0_genc++_headers",
+    tools: ["hidl-gen"],
+    cmd: "$(location hidl-gen) -o $(genDir) -Lc++-headers -randroid.hidl:system/libhidl/transport -rvendor.lineage:hardware/lineage/interfaces vendor.lineage.livedisplay@1.0",
+    srcs: [
+        ":vendor.lineage.livedisplay@1.0_hal",
+    ],
+    out: [
+        "vendor/lineage/livedisplay/1.0/types.h",
+        "vendor/lineage/livedisplay/1.0/hwtypes.h",
+        "vendor/lineage/livedisplay/1.0/IColor.h",
+        "vendor/lineage/livedisplay/1.0/IHwColor.h",
+        "vendor/lineage/livedisplay/1.0/BnHwColor.h",
+        "vendor/lineage/livedisplay/1.0/BpHwColor.h",
+        "vendor/lineage/livedisplay/1.0/BsColor.h",
+    ],
+}
+
+cc_library {
+    name: "vendor.lineage.livedisplay@1.0",
+    defaults: ["hidl-module-defaults"],
+    generated_sources: ["vendor.lineage.livedisplay@1.0_genc++"],
+    generated_headers: ["vendor.lineage.livedisplay@1.0_genc++_headers"],
+    export_generated_headers: ["vendor.lineage.livedisplay@1.0_genc++_headers"],
+    vendor_available: true,
+    vndk: {
+        enabled: true,
+    },
+    shared_libs: [
+        "libhidlbase",
+        "libhidltransport",
+        "libhwbinder",
+        "liblog",
+        "libutils",
+        "libcutils",
+    ],
+    export_shared_lib_headers: [
+        "libhidlbase",
+        "libhidltransport",
+        "libhwbinder",
+        "libutils",
+    ],
+}
+
+cc_library {
+    name: "vendor.lineage.livedisplay@1.0_vendor",
+    defaults: ["hidl-module-defaults"],
+    generated_sources: ["vendor.lineage.livedisplay@1.0_genc++"],
+    generated_headers: ["vendor.lineage.livedisplay@1.0_genc++_headers"],
+    export_generated_headers: ["vendor.lineage.livedisplay@1.0_genc++_headers"],
+    vendor: true,
+    shared_libs: [
+        "libhidlbase",
+        "libhidltransport",
+        "libhwbinder",
+        "liblog",
+        "libutils",
+        "libcutils",
+    ],
+    export_shared_lib_headers: [
+        "libhidlbase",
+        "libhidltransport",
+        "libhwbinder",
+        "libutils",
+    ],
+}
diff --git a/livedisplay/1.0/Android.mk b/livedisplay/1.0/Android.mk
new file mode 100644
index 0000000..f62d96c
--- /dev/null
+++ b/livedisplay/1.0/Android.mk
@@ -0,0 +1,270 @@
+# This file is autogenerated by hidl-gen. Do not edit manually.
+
+LOCAL_PATH := $(call my-dir)
+
+################################################################################
+
+include $(CLEAR_VARS)
+LOCAL_MODULE := vendor.lineage.livedisplay-V1.0-java
+LOCAL_MODULE_CLASS := JAVA_LIBRARIES
+
+intermediates := $(call local-generated-sources-dir, COMMON)
+
+HIDL := $(HOST_OUT_EXECUTABLES)/hidl-gen$(HOST_EXECUTABLE_SUFFIX)
+
+LOCAL_JAVA_LIBRARIES := \
+    android.hidl.base-V1.0-java \
+
+
+#
+# Build types.hal (DisplayMode)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/DisplayMode.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.DisplayMode
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (Feature)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/Feature.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.Feature
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (FloatRange)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/FloatRange.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.FloatRange
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (HSIC)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/HSIC.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.HSIC
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (Range)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/Range.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.Range
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build IColor.hal
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/IColor.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/IColor.hal
+$(GEN): PRIVATE_DEPS += $(LOCAL_PATH)/types.hal
+$(GEN): $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::IColor
+
+$(GEN): $(LOCAL_PATH)/IColor.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+include $(BUILD_JAVA_LIBRARY)
+
+
+################################################################################
+
+include $(CLEAR_VARS)
+LOCAL_MODULE := vendor.lineage.livedisplay-V1.0-java-static
+LOCAL_MODULE_CLASS := JAVA_LIBRARIES
+
+intermediates := $(call local-generated-sources-dir, COMMON)
+
+HIDL := $(HOST_OUT_EXECUTABLES)/hidl-gen$(HOST_EXECUTABLE_SUFFIX)
+
+LOCAL_STATIC_JAVA_LIBRARIES := \
+    android.hidl.base-V1.0-java-static \
+
+
+#
+# Build types.hal (DisplayMode)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/DisplayMode.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.DisplayMode
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (Feature)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/Feature.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.Feature
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (FloatRange)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/FloatRange.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.FloatRange
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (HSIC)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/HSIC.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.HSIC
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build types.hal (Range)
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/Range.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::types.Range
+
+$(GEN): $(LOCAL_PATH)/types.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+
+#
+# Build IColor.hal
+#
+GEN := $(intermediates)/vendor/lineage/livedisplay/V1_0/IColor.java
+$(GEN): $(HIDL)
+$(GEN): PRIVATE_HIDL := $(HIDL)
+$(GEN): PRIVATE_DEPS := $(LOCAL_PATH)/IColor.hal
+$(GEN): PRIVATE_DEPS += $(LOCAL_PATH)/types.hal
+$(GEN): $(LOCAL_PATH)/types.hal
+$(GEN): PRIVATE_OUTPUT_DIR := $(intermediates)
+$(GEN): PRIVATE_CUSTOM_TOOL = \
+        $(PRIVATE_HIDL) -o $(PRIVATE_OUTPUT_DIR) \
+        -Ljava \
+        -randroid.hidl:system/libhidl/transport \
+        -rvendor.lineage:hardware/lineage/interfaces \
+        vendor.lineage.livedisplay@1.0::IColor
+
+$(GEN): $(LOCAL_PATH)/IColor.hal
+	$(transform-generated-source)
+LOCAL_GENERATED_SOURCES += $(GEN)
+include $(BUILD_STATIC_JAVA_LIBRARY)
+
+
+
+include $(call all-makefiles-under,$(LOCAL_PATH))
diff --git a/livedisplay/1.0/IColor.hal b/livedisplay/1.0/IColor.hal
new file mode 100644
index 0000000..c5788ea
--- /dev/null
+++ b/livedisplay/1.0/IColor.hal
@@ -0,0 +1,46 @@
+/*
+ * Copyright (C) 2017-2018 The LineageOS Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package vendor.lineage.livedisplay@1.0;
+
+interface IColor {
+    getSupportedFeatures() generates (Features features);
+
+    getDisplayModes() generates (vec<DisplayMode> modes);
+    getCurrentDisplayMode() generates (DisplayMode mode);
+    getDefaultDisplayMode() generates (DisplayMode mode);
+    setDisplayMode(int32_t modeID, bool makeDefault) generates (bool rc);
+
+    setAdaptiveBacklightEnabled(bool enabled) generates (bool rc);
+    isAdaptiveBacklightEnabled() generates (bool rc);
+
+    setOutdoorModeEnabled(bool enabled) generates (bool rc);
+    isOutdoorModeEnabled() generates (bool rc);
+
+    getColorBalanceRange() generates (Range range);
+    getColorBalance() generates (int32_t value);
+    setColorBalance(int32_t value) generates (bool rc);
+
+    setPictureAdjustment(HSIC hsic) generates (bool rc);
+    getPictureAdjustment() generates (HSIC hsic);
+    getDefaultPictureAdjustment() generates (HSIC hsic);
+
+    getHueRange() generates (Range range);
+    getSaturationRange() generates (FloatRange range);
+    getIntensityRange() generates (FloatRange range);
+    getContrastRange() generates (FloatRange range);
+    getSaturationThresholdRange() generates (FloatRange range);
+};
diff --git a/livedisplay/1.0/types.hal b/livedisplay/1.0/types.hal
new file mode 100644
index 0000000..637e197
--- /dev/null
+++ b/livedisplay/1.0/types.hal
@@ -0,0 +1,52 @@
+/*
+ * Copyright (C) 2017-2018 The LineageOS Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package vendor.lineage.livedisplay@1.0;
+
+struct Range {
+    int32_t max;
+    int32_t min;
+    uint32_t step;
+};
+
+struct FloatRange {
+    float max;
+    float min;
+    float step;
+};
+
+struct HSIC {
+    int32_t hue;
+    float saturation;
+    float intensity;
+    float contrast;
+    float saturationThreshold;
+};
+
+struct DisplayMode {
+    int32_t id;
+    string name;
+};
+
+enum Feature : uint32_t {
+    DISPLAY_MODES = 0x1,
+    COLOR_BALANCE = 0x2,
+    OUTDOOR_MODE = 0x4,
+    ADAPTIVE_BACKLIGHT = 0x8,
+    PICTURE_ADJUSTMENT = 0x10,
+    MAX = PICTURE_ADJUSTMENT
+};
+typedef bitfield<Feature> Features;
diff --git a/livedisplay/Android.bp b/livedisplay/Android.bp
new file mode 100644
index 0000000..bbb3e4b
--- /dev/null
+++ b/livedisplay/Android.bp
@@ -0,0 +1,4 @@
+// This is an autogenerated file, do not edit.
+subdirs = [
+    "1.0",
+]
-- 
2.17.0

