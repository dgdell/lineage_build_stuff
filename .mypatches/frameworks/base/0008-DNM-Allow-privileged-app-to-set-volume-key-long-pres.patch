From 41623bcb2182ec88d47077e40008513782c15cce Mon Sep 17 00:00:00 2001
From: nx111 <gd.zhangdz@gmail.com>
Date: Thu, 4 Jan 2018 00:43:26 +0800
Subject: [PATCH 8/8] [DNM]Allow privileged app to set volume key long-press
 listener, skip permission check.

Change-Id: I1cf5eba0c26c2047cb84a29659308c8647a44a1f
---
 services/core/java/com/android/server/media/MediaSessionService.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/services/core/java/com/android/server/media/MediaSessionService.java b/services/core/java/com/android/server/media/MediaSessionService.java
index aa65244..359be4d 100644
--- a/services/core/java/com/android/server/media/MediaSessionService.java
+++ b/services/core/java/com/android/server/media/MediaSessionService.java
@@ -1020,12 +1020,12 @@ public class MediaSessionService extends SystemService implements Monitor {
             final long token = Binder.clearCallingIdentity();
             try {
                 // Enforce SET_VOLUME_KEY_LONG_PRESS_LISTENER permission.
-                if (getContext().checkPermission(
+/*                if (getContext().checkPermission(
                         android.Manifest.permission.SET_VOLUME_KEY_LONG_PRESS_LISTENER, pid, uid)
                             != PackageManager.PERMISSION_GRANTED) {
                     throw new SecurityException("Must hold the SET_VOLUME_KEY_LONG_PRESS_LISTENER" +
                             " permission.");
-                }
+                } */
 
                 synchronized (mLock) {
                     int userId = UserHandle.getUserId(uid);
-- 
2.7.4

