From 8136baf0ad69767843a3048823d5a8504df85ff4 Mon Sep 17 00:00:00 2001
From: Steve Pfetsch <spfetsch@google.com>
Date: Mon, 9 Oct 2017 12:33:47 -0700
Subject: [PATCH 6/8] msm8974: libgralloc: Fix adding offset to the mapped base
 address
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Bug: 63662821
Change-Id: I722ed2560efd66e2e61a3054d7db7f6241e8e911
Keep msm8974 in sync with msm8994, post removal
Signed-off-by: D. Andrei Măceș <Andrei.Maces@alumni.nd.edu>
---
 msm8974/libgralloc/mapper.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/msm8974/libgralloc/mapper.cpp b/msm8974/libgralloc/mapper.cpp
index 4f43d4015..15831e3b6 100644
--- a/msm8974/libgralloc/mapper.cpp
+++ b/msm8974/libgralloc/mapper.cpp
@@ -72,7 +72,7 @@ static int gralloc_map(gralloc_module_t const* module,
             return -errno;
         }
 
-        hnd->base = intptr_t(mappedAddress) + hnd->offset;
+        hnd->base = intptr_t(mappedAddress);
         mappedAddress = MAP_FAILED;
         size = ROUND_UP_PAGESIZE(sizeof(MetaData_t));
         err = memalloc->map_buffer(&mappedAddress, size,
@@ -83,7 +83,7 @@ static int gralloc_map(gralloc_module_t const* module,
             hnd->base_metadata = 0;
             return -errno;
         }
-        hnd->base_metadata = intptr_t(mappedAddress) + hnd->offset_metadata;
+        hnd->base_metadata = intptr_t(mappedAddress);
     }
     return 0;
 }
-- 
2.17.1

