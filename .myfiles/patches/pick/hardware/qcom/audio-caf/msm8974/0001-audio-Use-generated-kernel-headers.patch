From 8b22550272daa569200938856f1377ecde5151bf Mon Sep 17 00:00:00 2001
From: Arne Coucheron <arco68@gmail.com>
Date: Sun, 21 Oct 2018 00:30:05 +0200
Subject: [PATCH] audio: Use generated kernel headers

Change-Id: Id710357361aa3204766d137e77e40cdd7a666a77
---
 audiod/Android.mk                      | 3 +--
 hal/Android.mk                         | 8 ++++----
 hal_mpq/Android.mk                     | 3 +--
 mm-audio/aenc-aac/qdsp6/Android.mk     | 3 +--
 mm-audio/aenc-amrnb/qdsp6/Android.mk   | 3 +--
 mm-audio/aenc-evrc/qdsp6/Android.mk    | 3 +--
 mm-audio/aenc-qcelp13/qdsp6/Android.mk | 4 +---
 post_proc/Android.mk                   | 3 +--
 8 files changed, 11 insertions(+), 19 deletions(-)

diff --git a/audiod/Android.mk b/audiod/Android.mk
index aeff39079..672ec39d8 100644
--- a/audiod/Android.mk
+++ b/audiod/Android.mk
@@ -14,8 +14,7 @@ LOCAL_SHARED_LIBRARIES := \
 	libbinder \
 	libmedia
 
-
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES := generated_kernel_headers
 
 LOCAL_MODULE:= audiod
 
diff --git a/hal/Android.mk b/hal/Android.mk
index 6557c367a..134c9ab9a 100644
--- a/hal/Android.mk
+++ b/hal/Android.mk
@@ -34,8 +34,8 @@ LOCAL_SRC_FILES := \
 
 LOCAL_SRC_FILES += audio_extn/audio_extn.c
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES := generated_kernel_headers
+
 LOCAL_CFLAGS += -DUSE_VENDOR_EXTN
 LOCAL_CFLAGS += -Wno-error
 
@@ -203,10 +203,10 @@ LOCAL_C_INCLUDES += \
 	$(call include-path-for, audio-effects) \
 	$(LOCAL_PATH)/$(AUDIO_PLATFORM) \
 	$(LOCAL_PATH)/audio_extn \
-	$(LOCAL_PATH)/voice_extn \
-	$(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
+	$(LOCAL_PATH)/voice_extn
 
 LOCAL_HEADER_LIBRARIES := libhardware_headers
+LOCAL_HEADER_LIBRARIES += generated_kernel_headers
 
 ifeq ($(strip $(AUDIO_FEATURE_ENABLED_LISTEN)),true)
     LOCAL_CFLAGS += -DAUDIO_LISTEN_ENABLED
diff --git a/hal_mpq/Android.mk b/hal_mpq/Android.mk
index d6bbd272a..8e86c9195 100644
--- a/hal_mpq/Android.mk
+++ b/hal_mpq/Android.mk
@@ -45,8 +45,7 @@ LOCAL_C_INCLUDES := \
 	$(LOCAL_PATH)/$(AUDIO_PLATFORM)
 
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES := generated_kernel_headers
 
 LOCAL_MODULE := audio.primary.$(TARGET_BOARD_PLATFORM)
 
diff --git a/mm-audio/aenc-aac/qdsp6/Android.mk b/mm-audio/aenc-aac/qdsp6/Android.mk
index 5e88c3efe..9cb96e993 100644
--- a/mm-audio/aenc-aac/qdsp6/Android.mk
+++ b/mm-audio/aenc-aac/qdsp6/Android.mk
@@ -38,8 +38,7 @@ LOCAL_SHARED_LIBRARIES  := libutils liblog
 LOCAL_SRC_FILES         := src/aenc_svr.c
 LOCAL_SRC_FILES         += src/omx_aac_aenc.cpp
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
 
 include $(BUILD_SHARED_LIBRARY)
 
diff --git a/mm-audio/aenc-amrnb/qdsp6/Android.mk b/mm-audio/aenc-amrnb/qdsp6/Android.mk
index 8c5ef1fd4..af4c1b0ef 100644
--- a/mm-audio/aenc-amrnb/qdsp6/Android.mk
+++ b/mm-audio/aenc-amrnb/qdsp6/Android.mk
@@ -38,8 +38,7 @@ LOCAL_SHARED_LIBRARIES  := libutils liblog
 LOCAL_SRC_FILES         := src/aenc_svr.c
 LOCAL_SRC_FILES         += src/omx_amr_aenc.cpp
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
 
 include $(BUILD_SHARED_LIBRARY)
 
diff --git a/mm-audio/aenc-evrc/qdsp6/Android.mk b/mm-audio/aenc-evrc/qdsp6/Android.mk
index 575b844e4..026e617c7 100644
--- a/mm-audio/aenc-evrc/qdsp6/Android.mk
+++ b/mm-audio/aenc-evrc/qdsp6/Android.mk
@@ -38,8 +38,7 @@ LOCAL_SHARED_LIBRARIES  := libutils liblog
 LOCAL_SRC_FILES         := src/aenc_svr.c
 LOCAL_SRC_FILES         += src/omx_evrc_aenc.cpp
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
 
 include $(BUILD_SHARED_LIBRARY)
 
diff --git a/mm-audio/aenc-qcelp13/qdsp6/Android.mk b/mm-audio/aenc-qcelp13/qdsp6/Android.mk
index c8ca8a545..b86143f39 100644
--- a/mm-audio/aenc-qcelp13/qdsp6/Android.mk
+++ b/mm-audio/aenc-qcelp13/qdsp6/Android.mk
@@ -38,9 +38,7 @@ LOCAL_SHARED_LIBRARIES  := libutils liblog
 LOCAL_SRC_FILES         := src/aenc_svr.c
 LOCAL_SRC_FILES         += src/omx_qcelp13_aenc.cpp
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
-
+LOCAL_HEADER_LIBRARIES  := generated_kernel_headers
 
 include $(BUILD_SHARED_LIBRARY)
 
diff --git a/post_proc/Android.mk b/post_proc/Android.mk
index 6a2956f6b..d36e8b972 100644
--- a/post_proc/Android.mk
+++ b/post_proc/Android.mk
@@ -35,8 +35,7 @@ LOCAL_C_INCLUDES := \
 	external/tinyalsa/include \
 	$(call include-path-for, audio-effects)
 
-LOCAL_C_INCLUDES += $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include
-LOCAL_ADDITIONAL_DEPENDENCIES := $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
+LOCAL_HEADER_LIBRARIES := generated_kernel_headers
 
 include $(BUILD_SHARED_LIBRARY)
 
-- 
2.17.1

