From f28e0caff1367b85aa9291406e4925ad7c534da8 Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Tue, 6 Nov 2018 15:28:08 +0100
Subject: [PATCH 6/6] [SQUSH][DNM] Merge tag 'android-9.0.0_r16' into
 lineage-16.0

commit a6f9ca4aaeb141dd12011d50b0803e0de9e609a6
Merge: 198362110 cc3646113
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Sep 10 23:21:40 2018 +0000

    Merge cherrypicks of [4986743, 4986744, 4987539, 4987168, 4986376, 4986377, 4986378, 4986889, 4986745, 4986746, 4986747, 4986748, 4986749, 4986750, 4986773, 4987169, 4987170, 4987611, 4987631, 4987632, 4987633, 4987634, 4986890, 4987612, 4987651, 4987598, 4987613, 4987614, 4987615, 4987599, 4986379, 4986380, 4987652, 4987653, 4987691, 4986774] into pi-qpr1-release

    Change-Id: Ie47fef4ae26050a4b811814aef26157108434cd5

commit cc364611362cc5bc896b400bdc471a617d1ac628
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Wed Sep 5 18:21:31 2018 -0700

    Check data length when parsing AVRCP vendor specific command responses

    Bug: 111450531
    Bug: 111896861
    Test: PoC test program
    Change-Id: I564bee8f05efabc29383659a75e695b4da76c6aa
    (cherry picked from commit 7439ea940354f65a147c4ecfce3bada49c688047)

commit 99d54d0c7dbab6c80f15bbf886ed203b2a547453
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Thu Sep 6 15:41:27 2018 -0700

    Check AVRCP data length when parsing inside avrc_ctrl_pars_vendor_rsp()

    Bug: 111450417
    Test: PoC test program
    Change-Id: Idd619e52dc7a2944d0d08af824505580e299c163
    (cherry picked from commit 1c14e10cac53d5a5724dcf34c5679ad8819f9442)
    (cherry picked from commit f779ebe368d245c0d9ac954cf7b2b102e7da56be)

commit e3fbbdeb251dc59890e469c627fce322614944c0
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Sep 5 16:39:16 2018 -0700

    HID Device: Fix OOB in register_app

    Bug: 113037220
    Bug: 113111784
    Test: manual
    Change-Id: I91bcd5032959458b926c479160c7e391b8de313b
    (cherry picked from commit 6aa2d0a5fab28c8829aab4099da0ad450e451c1e)

commit 1983621106184ccb03370fe0523ff550a59d6220
Merge: 7b7ce469b 1ccb7c348
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Thu Aug 23 03:06:34 2018 +0000

    Snap for 4972147 from 1ccb7c3489d6775821921ce97bf8b98eb7f7a70c to pi-qpr1-release

    Change-Id: Icfd7be2d5dd59b922d98f315ea4bcf5d46a9077c

commit 1ccb7c3489d6775821921ce97bf8b98eb7f7a70c
Author: Ted <tedwang@google.com>
Date:   Fri Aug 17 18:49:37 2018 +0800

    Fix "Disable Absolute Volume" Bluetooth develop option work

    Do not report device support absolute volume while
    "Disable Absolute Volume" in developer option is enabled or
    the remote device is listed in the interoperability database.

    Test: manually adjust volume when Disable Absolute Volume is enabled
    Bug: 112193362
    Change-Id: Id63a22dba0d8a871035774fc86b66d32e9225b48
    Merged-In: Id63a22dba0d8a871035774fc86b66d32e9225b48

commit 7b7ce469b6f88a2945a4905e676ccc33c551b200
Merge: 7c030ce8d f827e9fc3
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 17 03:09:19 2018 +0000

    Snap for 4959688 from f827e9fc320861552d884a2706c5a93fe33c69e3 to pi-qpr1-release

    Change-Id: I0e9322114dbe429b0ba475702cf5f0e590534fe9

commit 7c030ce8d2ca15dbf90b8cac09fb8c389a5523db
Merge: aaf2b2109 206134dc6
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Mon Aug 13 03:02:37 2018 +0000

    Snap for 4949382 from 206134dc653cffaed0008da80b53eb860ef96670 to pi-qpr1-release

    Change-Id: Iff31803cb311922fb70df7e273dfc0b7d2d67fe2

commit f827e9fc320861552d884a2706c5a93fe33c69e3
Author: Ugo Yu <ugoyu@google.com>
Date:   Mon Aug 13 10:12:40 2018 +0800

    Fix wrong UUID mask when doing BLE filter scan

    bug: 112350218
    Test: manual
    Change-Id: I9e4297b936e7a7db164e7ff3bf680c43600c5bda
    (cherry picked from commit 04433372392a3c50558cb96f076757472dac2cec)

commit 206134dc653cffaed0008da80b53eb860ef96670
Merge: 8e2028efe c019726c6
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:56:16 2018 -0700

    Merge "Add packet length checks in mca_ccb_hdl_req" into oc-dev am: 816107b1e3 am: 57cde1b147
    am: c019726c62

    Change-Id: Ie0d10696cff7d8da694c96af8b224fe4d9061383

commit 8e2028efe4f62492d427443f6be81e0788a72b63
Merge: 0f963125d 02482e1ed
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:55:49 2018 -0700

    [automerger skipped] Merge changes from topic "am-dcf0c368-3f3f-440a-998e-f94bd1924189" into oc-dev am: 1718736f85  -s ours am: 3d14101b52  -s ours
    am: 02482e1edd  -s ours

    Change-Id: I69d112ec62826799d275e32cf5499083e84d13fe

commit c019726c62bae892b0b33e57d58841c1e14b466e
Merge: 02482e1ed 57cde1b14
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:27:54 2018 -0700

    Merge "Add packet length checks in mca_ccb_hdl_req" into oc-dev am: 816107b1e3
    am: 57cde1b147

    Change-Id: I05d1d2af205963afcd1c6bf77c8ca097662e0fc8

commit 02482e1edd6cae969c7051b13f5ba770155fbb9e
Merge: 4b3d08fa4 3d14101b5
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:27:34 2018 -0700

    [automerger skipped] Merge changes from topic "am-dcf0c368-3f3f-440a-998e-f94bd1924189" into oc-dev am: 1718736f85  -s ours
    am: 3d14101b52  -s ours

    Change-Id: Iceb020184e799318eb665e19544c1c8012f2b9f9

commit 57cde1b147e83629db24017d292d1f41e87c61c1
Merge: 3d14101b5 816107b1e
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:11:43 2018 -0700

    Merge "Add packet length checks in mca_ccb_hdl_req" into oc-dev
    am: 816107b1e3

    Change-Id: Ic37e076a0e89dc449071b6e715c1ba13034b48e8

commit 3d14101b52cf057bfa7d80f8ebd2e23512b82f9f
Merge: a2d197761 1718736f8
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 17:11:22 2018 -0700

    [automerger skipped] Merge changes from topic "am-dcf0c368-3f3f-440a-998e-f94bd1924189" into oc-dev
    am: 1718736f85  -s ours

    Change-Id: Id71e8b3945f0d2051c2b642c6ed83c293f5d31fb

commit 816107b1e329782d6c2faf762c8d0bb0930eb599
Merge: 1718736f8 4de7ccdd9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 23:29:21 2018 +0000

    Merge "Add packet length checks in mca_ccb_hdl_req" into oc-dev

commit 0f963125d2d39ad4ef366a2f9b9f47759b05b265
Merge: bd5c196e7 4b3d08fa4
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 16:16:31 2018 -0700

    [automerger skipped] Merge "Checks the SMP length to fix OOB read" into oc-dev am: a0f6200e5f am: a2d1977617
    am: 4b3d08fa40  -s ours

    Change-Id: I28d07e232999bdda412c4263bd23e78aff2c27d5

commit 1718736f85d329f48162864135b4fc353a5912b4
Merge: a0f6200e5 02bb8f49b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 23:13:53 2018 +0000

    Merge changes from topic "am-dcf0c368-3f3f-440a-998e-f94bd1924189" into oc-dev

    * changes:
      [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808 am: 4bf5cf2228 skipped: 3d75dd009b
      [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808 am: 4bf5cf2228
      [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808
      [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3
      [automerger] Checks the SMP length to fix OOB read am: 353faee793
      Checks the SMP length to fix OOB read

commit 4b3d08fa40a6dfa1d37ab412fbbbf5397cdee5d5
Merge: 9d9702120 a2d197761
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 16:12:26 2018 -0700

    Merge "Checks the SMP length to fix OOB read" into oc-dev am: a0f6200e5f
    am: a2d1977617

    Change-Id: I04f3e39f4900203999ee16a30540c16698fa1100

commit bd5c196e7b56e1cc224fb751047de5ec570302df
Merge: 8c7e83859 fceb753bd
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Aug 10 22:50:24 2018 +0000

    Merge "Checks the SMP length to fix OOB read" into pi-dev

commit fceb753bda651c4135f3f93a510e5fcb4c7542b8
Author: Cheney Ni <cheneyni@google.com>
Date:   Wed Aug 8 22:20:08 2018 +0800

    Checks the SMP length to fix OOB read

    Bug: 111937065
    Test: manual
    Change-Id: I330880a6e1671d0117845430db4076dfe1aba688
    Merged-In: I330880a6e1671d0117845430db4076dfe1aba688

commit a2d197761765bc126a03909a3bb3ece7fcf9809a
Merge: 039526080 a0f6200e5
Author: Cheney Ni <cheneyni@google.com>
Date:   Fri Aug 10 15:36:13 2018 -0700

    Merge "Checks the SMP length to fix OOB read" into oc-dev
    am: a0f6200e5f

    Change-Id: I878e9a56d3a8f6044fe1922711a50e09861eae08

commit a0f6200e5fec323e11edd3a64b66d89f7a97ef89
Merge: 7390441c6 4978acce4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 22:20:14 2018 +0000

    Merge "Checks the SMP length to fix OOB read" into oc-dev

commit 8c7e8385969d46f03ceeccd9830706c8fcbb6c9e
Merge: 8beb16554 9d9702120
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 15:13:33 2018 -0700

    Merge "Add packet length check in smp_proc_master_id" into oc-dev am: 7390441c63 am: 039526080b
    am: 9d97021204

    Change-Id: I44ebb7389fa0c4603991b0e7f6aff8ed114556e9

commit 8beb16554814a9450281cf471c9b917f5160f9b6
Merge: d274f6de3 91f21014e
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 15:13:08 2018 -0700

    Merge "Add missing AVRCP message length checks inside avrc_msg_cback" into oc-dev am: a33d897e8a am: d6f875028c
    am: 91f21014e1

    Change-Id: If813c8360bc6f7d3e9320f4b700ea1fc41eafb3b

commit d274f6de38b04f05c89b41f117667c9fd29abda8
Merge: 91860e267 8a49e7f22
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 15:12:41 2018 -0700

    Merge changes from topic "am-df95a56f-528f-434c-972e-bb492348a21a" into oc-dev am: ab4b63e6ad am: 23d8fb31be
    am: 8a49e7f22d

    Change-Id: I2e94fdce6511d63f26ad680361b74bdd3a6c5ec0

commit 91860e267a27586b1844e9ae3ca318381fcbb7e8
Merge: cfbf784ef 1b9264d12
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 15:11:58 2018 -0700

    [automerger skipped] Merge "DO NOT MERGE Fix OOB read before buffer length check" into oc-dev am: 1503110a53 am: 26b6a7cbf4
    am: 1b9264d128  -s ours

    Change-Id: I7d24941f1309ddc65e60fbc84e6354e414185ba6

commit cfbf784ef5aabec81a1ce2b5f50d3242c86c552d
Merge: a64a9a422 4d0f5bead
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 15:11:43 2018 -0700

    Merge "Check packet length in bta_av_proc_meta_cmd" into oc-dev am: 7e52dc116c am: ccc3cab119
    am: 4d0f5bead6

    Change-Id: Ifa7a555b5a5cf8b016c7e92a832a55429e435584

commit a64a9a42285783244ae0ca350d35daa26a9c19d1
Merge: 7d2f0bb17 ff19b6e11
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 15:11:18 2018 -0700

    Merge changes from topic "bt-avrcp-check-avrc_msg_cback-nyc-dev" into oc-dev am: 3834cbd1e6 am: abf4e82057
    am: ff19b6e112

    Change-Id: I35f75a3cf59ab1bae7921241eb7825305c4ccc6e

commit 7d2f0bb173d5ad5c33aa47f46fc667f96c732556
Merge: e21e0225b cbfe0fff8
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 15:10:39 2018 -0700

    Merge changes from topic "am-c2d9879f-e9d2-44f3-9012-53037ab580a0" into oc-dev am: ee9315f84c am: 76ad7b5439
    am: cbfe0fff84

    Change-Id: I49d299a85b3e3a00f58dadd3f8af169eab0ca7e4

commit e21e0225b8b248e27436eb0d19642ae6f82ef0a5
Merge: d0d2d83b5 52c5bfffb
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 15:10:06 2018 -0700

    Merge changes from topic "am-a988fd47-73ee-44e9-929f-5374e8851656" into oc-dev am: cb0cdcc7ab am: 7e719a45da
    am: 52c5bfffba

    Change-Id: I5b6d62d23ab555cc25a44ad302da5045247a1662

commit 9d97021204376845d5d81099fcb2d2a74a13e788
Merge: 91f21014e 039526080
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:47:15 2018 -0700

    Merge "Add packet length check in smp_proc_master_id" into oc-dev am: 7390441c63
    am: 039526080b

    Change-Id: I42e6c4c2599151607b089452cc2e25d6e5103d47

commit 91f21014e11af005a12533e2858d76094451fd1c
Merge: 8a49e7f22 d6f875028
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 14:46:46 2018 -0700

    Merge "Add missing AVRCP message length checks inside avrc_msg_cback" into oc-dev am: a33d897e8a
    am: d6f875028c

    Change-Id: Ic28bad0cc518cf908765980c361454c2eeb4fa6d

commit 039526080bf50bf0c87006544ce774de3d563f55
Merge: d6f875028 7390441c6
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:46:09 2018 -0700

    Merge "Add packet length check in smp_proc_master_id" into oc-dev
    am: 7390441c63

    Change-Id: I273c233acac3bca1b37c937f8cf65b004048b451

commit d6f875028c260f7f7aa7523a7eecfa2c4a536ae5
Merge: 23d8fb31b a33d897e8
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 14:45:45 2018 -0700

    Merge "Add missing AVRCP message length checks inside avrc_msg_cback" into oc-dev
    am: a33d897e8a

    Change-Id: If510886dfb48fe6c741ae6766bcb97d8fa3e482e

commit 7390441c636efd387da350e6838f7cc5f2309c1f
Merge: a33d897e8 c8294662d
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 21:27:38 2018 +0000

    Merge "Add packet length check in smp_proc_master_id" into oc-dev

commit 8a49e7f22d2ce1283c239c958f8782407efc1f47
Merge: 1b9264d12 23d8fb31b
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:15:56 2018 -0700

    Merge changes from topic "am-df95a56f-528f-434c-972e-bb492348a21a" into oc-dev am: ab4b63e6ad
    am: 23d8fb31be

    Change-Id: I57612c50ca73f7bb4a1192c66976af3053eb78b7

commit 1b9264d12835332011829bd07a50de9be5cee20c
Merge: 4d0f5bead 26b6a7cbf
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:15:28 2018 -0700

    Merge "DO NOT MERGE Fix OOB read before buffer length check" into oc-dev am: 1503110a53
    am: 26b6a7cbf4

    Change-Id: I0b56adc51b64cb6c56d531a4357066c43c87d09d

commit 4d0f5bead673e374ac2e4d1222afb75c71216619
Merge: ff19b6e11 ccc3cab11
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 14:15:07 2018 -0700

    Merge "Check packet length in bta_av_proc_meta_cmd" into oc-dev am: 7e52dc116c
    am: ccc3cab119

    Change-Id: Ied0904860f58347e9cc5cf96ab486c0fce75443d

commit ff19b6e1125bd0240f737ac741dbb89272f57e67
Merge: cbfe0fff8 abf4e8205
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 14:14:46 2018 -0700

    Merge changes from topic "bt-avrcp-check-avrc_msg_cback-nyc-dev" into oc-dev am: 3834cbd1e6
    am: abf4e82057

    Change-Id: I7126caabc99fc2767c63593e938a3510fa6ed187

commit cbfe0fff84785953a6b9fc7cc9860811fb5eabd7
Merge: 52c5bfffb 76ad7b543
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 14:14:13 2018 -0700

    Merge changes from topic "am-c2d9879f-e9d2-44f3-9012-53037ab580a0" into oc-dev am: ee9315f84c
    am: 76ad7b5439

    Change-Id: Ia183f05e8f3601b9969f7de86033dbd39b974495

commit 52c5bfffbaa55a65b12c6a3f1a2999f860d929ea
Merge: 705173972 7e719a45d
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:13:35 2018 -0700

    Merge changes from topic "am-a988fd47-73ee-44e9-929f-5374e8851656" into oc-dev am: cb0cdcc7ab
    am: 7e719a45da

    Change-Id: Ibfba8a0de4b8eb7ba7905724b742ea1ced2770a5

commit a33d897e8a87415f376d9c8ef0f6006a573dacbe
Merge: ab4b63e6a 007868d05
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 21:13:03 2018 +0000

    Merge "Add missing AVRCP message length checks inside avrc_msg_cback" into oc-dev

commit 23d8fb31beb09396dd34fd173937407fb4d20d76
Merge: 26b6a7cbf ab4b63e6a
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:04:01 2018 -0700

    Merge changes from topic "am-df95a56f-528f-434c-972e-bb492348a21a" into oc-dev
    am: ab4b63e6ad

    Change-Id: I510afbc60770cf5d4d272567716d2642154c94ae

commit 26b6a7cbf4ef67c8afc36e7bc04484db83d98732
Merge: ccc3cab11 1503110a5
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 14:03:21 2018 -0700

    Merge "DO NOT MERGE Fix OOB read before buffer length check" into oc-dev
    am: 1503110a53

    Change-Id: I06c98bfac27663e6b443c15b0eb02a04f91f48b7

commit ab4b63e6ad4fc19530f7b8828b73e3366c2959fa
Merge: 1503110a5 ab16bfd71
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 20:55:20 2018 +0000

    Merge changes from topic "am-df95a56f-528f-434c-972e-bb492348a21a" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af am: ae3bb5ff30 skipped: 9d3bb2eacf
      [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af am: ae3bb5ff30
      [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af
      [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120
      [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db
      DO NOT MERGE Add packet length check in smp_proc_master_id

commit 1503110a53025ce11423d53ad1746e7229b89248
Merge: 7e52dc116 4548f34c9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 20:51:47 2018 +0000

    Merge "DO NOT MERGE Fix OOB read before buffer length check" into oc-dev

commit ccc3cab1190ab2ec4066723f93af8251eab97f5b
Merge: abf4e8205 7e52dc116
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 13:49:16 2018 -0700

    Merge "Check packet length in bta_av_proc_meta_cmd" into oc-dev
    am: 7e52dc116c

    Change-Id: I95920813d302cc3c363b3339189292efc79d7596

commit 7e52dc116cc8ff36aa3d1c8e57bc3462b52c2050
Merge: 3834cbd1e ed51887f9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 20:38:50 2018 +0000

    Merge "Check packet length in bta_av_proc_meta_cmd" into oc-dev

commit abf4e820574dd9a8b4436e246491edd2b3ec5335
Merge: 76ad7b543 3834cbd1e
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Fri Aug 10 13:21:59 2018 -0700

    Merge changes from topic "bt-avrcp-check-avrc_msg_cback-nyc-dev" into oc-dev
    am: 3834cbd1e6

    Change-Id: If2a42522be7e34cc5cc5f6ab516c91542ba96b0b

commit 76ad7b5439d936b8dc7190ed814af3b0d73623be
Merge: 7e719a45d ee9315f84
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Fri Aug 10 13:21:02 2018 -0700

    Merge changes from topic "am-c2d9879f-e9d2-44f3-9012-53037ab580a0" into oc-dev
    am: ee9315f84c

    Change-Id: Idd7c2b6716d1b820bc1a5ccdac29b4c3e5d76ba7

commit 7e719a45da0879ba834325286c89287bd5d851ff
Merge: 6354a16d8 cb0cdcc7a
Author: Ugo Yu <ugoyu@google.com>
Date:   Fri Aug 10 13:20:20 2018 -0700

    Merge changes from topic "am-a988fd47-73ee-44e9-929f-5374e8851656" into oc-dev
    am: cb0cdcc7ab

    Change-Id: If7b0787b082c30363a12a33af0591f83e2017d8e

commit 3834cbd1e6bc1a9a7133c5b9a165566c60d6cf8e
Merge: ee9315f84 d7d7ab17b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 20:06:42 2018 +0000

    Merge changes from topic "bt-avrcp-check-avrc_msg_cback-nyc-dev" into oc-dev

    * changes:
      [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef am: 30c2ddb520 skipped: 2c2b3674f0
      [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef am: 30c2ddb520
      [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef
      [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103
      [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36
      DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback

commit ee9315f84c0b637ce6ebe0404712ad8f43aae71b
Merge: cb0cdcc7a be8f73dcb
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 19:52:34 2018 +0000

    Merge changes from topic "am-c2d9879f-e9d2-44f3-9012-53037ab580a0" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489 am: 24e9e1f47a skipped: b4b40d8fb3
      [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489 am: 24e9e1f47a
      [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489
      [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad
      [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498
      DO NOT MERGE Check packet length in bta_av_proc_meta_cmd

commit cb0cdcc7abe7bd5cb183035109f8190c8f22b7d7
Merge: 682936d05 81a2af185
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 19:43:29 2018 +0000

    Merge changes from topic "am-a988fd47-73ee-44e9-929f-5374e8851656" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02 am: aa9c254357 skipped: de319d0416
      [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02 am: aa9c254357
      [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02
      [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975
      [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0
      DO NOT MERGE Fix OOB read before buffer length check

commit ab16bfd713c90be0d0d4cb2fff28a5346bd37de2
Merge: 682936d05 9d3bb2eac
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 19:18:24 2018 +0000

    [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af am: ae3bb5ff30 skipped: 9d3bb2eacf

    Change-Id: I1229e8ac6d350832ba6ff099a49f5d27f92636d1

commit 9d3bb2eacf40f58b9c8b1763875f0c4239fa62e3
Merge: ea23ff560 ae3bb5ff3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 19:18:23 2018 +0000

    [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af am: ae3bb5ff30

    Change-Id: Iefb6c5578e42fa8487e92307cd8f515c88860fd7

commit ae3bb5ff3079c21dbe199dd0b77820d59dda2f4b
Merge: 427c2c778 b0d91a38a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 19:18:21 2018 +0000

    [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120 am: b0d91a38af

    Change-Id: I93138feb34fb1128ce81876f0e9dbfee54093cdd

commit b0d91a38afd5a7a3324ae02dbf70292aa9722ae2
Merge: 78014df47 141409e12
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 19:18:20 2018 +0000

    [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db am: 141409e120

    Change-Id: I8bd45139ee30783cc528062308fdf42d686251f3

commit 141409e120920188f435521510400bf52eb69c11
Merge: fc08bac22 36bbbbf8d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 19:18:18 2018 +0000

    [automerger] DO NOT MERGE Add packet length check in smp_proc_master_id am: 36bbbbf8db

    Change-Id: If6f2f87162f61fd58492dc5bea9485757fe0e695

commit 36bbbbf8db31aaea5e03fb50c8b64f5773d5c1e0
Author: Ugo Yu <ugoyu@google.com>
Date:   Wed Aug 8 16:18:08 2018 +0800

    DO NOT MERGE Add packet length check in smp_proc_master_id

    Bug: 111937027
    Test: manual
    Change-Id: I2009b6be38f9733931e625379b035e84371fdcaf

commit c8294662d07a98e9b8b1cab1ab681ec0805ce4e8
Author: Ugo Yu <ugoyu@google.com>
Date:   Wed Aug 8 16:09:58 2018 +0800

    Add packet length check in smp_proc_master_id

    Bug: 111937027
    Test: manual

    Change-Id: I1144c9879e84fa79d68ad9d5fece4f58e2a3b075

commit 4978acce4af0c3975ffde9386b7da38f88bb1711
Author: Cheney Ni <cheneyni@google.com>
Date:   Wed Aug 8 22:40:27 2018 +0800

    Checks the SMP length to fix OOB read

    Bug: 111937065
    Test: manual
    Change-Id: I330880a6e1671d0117845430db4076dfe1aba688
    Merged-In: I330880a6e1671d0117845430db4076dfe1aba688

commit 02bb8f49b125692c44ac48790837071e72966171
Merge: 682936d05 3d75dd009
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 18:00:41 2018 +0000

    [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808 am: 4bf5cf2228 skipped: 3d75dd009b

    Change-Id: I94ee54a9955023586e6b8d8f3a6a35a709bfd1c1

commit 3d75dd009b76ff7a23454fb5ec85cf6d8fd4c234
Merge: ea23ff560 4bf5cf222
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 17:43:56 2018 +0000

    [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808 am: 4bf5cf2228

    Change-Id: Ifaae2e4562c49bb94e6619384bb6298693d4c61a

commit 4bf5cf22286621eb0ca7da61073861e828b5eca6
Merge: 427c2c778 4df8c2080
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 17:43:55 2018 +0000

    [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3 am: 4df8c20808

    Change-Id: I021f0cf3d6d7da12f09b7fcd61720a112d789dba

commit 4df8c208081468faa91bc561e9e4ae8ecfc65b96
Merge: 78014df47 9343dda4d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 17:43:53 2018 +0000

    [automerger] Checks the SMP length to fix OOB read am: 353faee793 am: 9343dda4d3

    Change-Id: Ib0dd794d01ce85e30c1665b45733befa4af59dda

commit 9343dda4d3b93e8b90249a0d9e18dcd38f6299be
Merge: fc08bac22 353faee79
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 17:43:52 2018 +0000

    [automerger] Checks the SMP length to fix OOB read am: 353faee793

    Change-Id: I897f7f6dec710a102f8fcf0b307be6973eedf994

commit 353faee793b4f0ce349ef2c950902be561b64827
Author: Cheney Ni <cheneyni@google.com>
Date:   Wed Aug 8 22:40:27 2018 +0800

    Checks the SMP length to fix OOB read

    Bug: 111937065
    Test: manual
    Change-Id: I330880a6e1671d0117845430db4076dfe1aba688
    Merged-In: I330880a6e1671d0117845430db4076dfe1aba688

commit d0d2d83b52cae741366254976d759b62ebcb39ae
Merge: 0a6600b19 705173972
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Aug 10 02:05:28 2018 -0700

    [automerger skipped] [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470 am: 427c2c7783 skipped: ea23ff5608 am: 682936d05d  -s ours am: 6354a16d8e  -s ours
    am: 7051739728  -s ours

    Change-Id: I9f1d009af5c3cbc397c3b9f49261bd67ae4607a7

commit 70517397288e87bc2422e5dc97bed2180a475e1d
Merge: 39caefd0d 6354a16d8
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Aug 10 01:58:24 2018 -0700

    [automerger skipped] [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470 am: 427c2c7783 skipped: ea23ff5608 am: 682936d05d  -s ours
    am: 6354a16d8e  -s ours

    Change-Id: I59fb0d9115ae761af37f0b4749288a224e08b71c

commit 6354a16d8e187c3e65b76501987fca2928042eef
Merge: ce16531db 682936d05
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Aug 10 01:53:18 2018 -0700

    [automerger skipped] [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470 am: 427c2c7783 skipped: ea23ff5608
    am: 682936d05d  -s ours

    Change-Id: I03b13f5f9d93f1c2ad07cfc6338b8a65917078f9

commit 682936d05d813db9a410b6608ab97d2ce201b016
Merge: 014a36a1f ea23ff560
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 07:04:56 2018 +0000

    [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470 am: 427c2c7783 skipped: ea23ff5608

    Change-Id: I5ee4cb73177c56e7adfe4a96a22f7d1a49248f19

commit ea23ff5608bb1eedabc0e18351974566b09a6af3
Merge: dec8f3eff 427c2c778
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 07:04:30 2018 +0000

    [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470 am: 427c2c7783

    Change-Id: I37cb9240f3e471768d454e41a37143f16bd4f4e7

commit 427c2c77831cab341459d78cfa257ce6436ec10f
Merge: 1dad7047f 78014df47
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 07:04:27 2018 +0000

    [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226 am: 78014df470

    Change-Id: I3b15e7664fac9d395b07a13365af57379ef6bfac

commit 78014df470a625e3340657a4d73a3ee9af7a1885
Merge: 38fa59c7f fc08bac22
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 07:04:24 2018 +0000

    [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac am: fc08bac226

    Change-Id: I6eb912e2613ec8549f9a8a579d7440ed876fd0e7

commit fc08bac2267960c8c8c019e769410e78c9029abc
Merge: 41d65bb82 1a0571a4a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Aug 10 07:04:22 2018 +0000

    [automerger] Fix copy length calculation in sdp_copy_raw_data am: 1a0571a4ac

    Change-Id: I8334874f9f3037833a60c0b84c9fea593b7daffa

commit 1a0571a4aca9d597a8f79665aa220decf0d45ce1
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Mon Jul 16 06:40:35 2018 -0700

    Fix copy length calculation in sdp_copy_raw_data

    Test: compilation
    Bug: 110216176
    Change-Id: Ic4a19c9f0fe8cd592bc6c25dcec7b1da49ff7459
    Merged-In: Ic4a19c9f0fe8cd592bc6c25dcec7b1da49ff7459

commit aaf2b21097cfe777e08c143f7a4e10cbb557cb28
Merge: 1980d6787 55cbfc014
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Aug 10 03:01:37 2018 +0000

    Snap for 4945494 from 55cbfc0145103ea34fd90c98f408c678e4b068e6 to pi-qpr1-release

    Change-Id: I4696e8ccbfbd4a64b65f4563e0e56fcc5e5a1c75

commit 0a6600b190d6d48d35a2a683d7b8870b97ca8cfd
Merge: 55cbfc014 39caefd0d
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 19:10:02 2018 -0700

    Merge "Fix OOB read in avrc_ctrl_pars_vendor_rsp" into oc-dev am: 014a36a1f7 am: ce16531dbc
    am: 39caefd0d4

    Change-Id: Ifc68c195e1ffe987e46a5340abfa09212ee73504

commit 39caefd0d444cc20020ff44c52d3cd1eed6d4224
Merge: 66403af3c ce16531db
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 19:04:58 2018 -0700

    Merge "Fix OOB read in avrc_ctrl_pars_vendor_rsp" into oc-dev am: 014a36a1f7
    am: ce16531dbc

    Change-Id: Id3669fa2cb1a4c45f5f0f92903b857d0fa2b7ba9

commit ce16531dbc1c62dd60887e921e00e49435f2641d
Merge: 23996390b 014a36a1f
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 18:59:05 2018 -0700

    Merge "Fix OOB read in avrc_ctrl_pars_vendor_rsp" into oc-dev
    am: 014a36a1f7

    Change-Id: I073b4b96930ecd4150f6515fe64485a1dce1370d

commit 014a36a1f77bf32c4b2766bf764415f40c8ad3c2
Merge: b01b82b03 d945ada50
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 01:46:44 2018 +0000

    Merge "Fix OOB read in avrc_ctrl_pars_vendor_rsp" into oc-dev

commit 55cbfc0145103ea34fd90c98f408c678e4b068e6
Merge: 3884f2f03 66403af3c
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:59:10 2018 -0700

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into oc-dev am: b01b82b03a am: 23996390b5
    am: 66403af3c6

    Change-Id: Id362dab356a51c43b095d8cbfee8a05016033597

commit 66403af3c602294012eed79b50418a1a4fc8c2c3
Merge: 7df3c3123 23996390b
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:55:35 2018 -0700

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into oc-dev am: b01b82b03a
    am: 23996390b5

    Change-Id: Id9bdba718f4ec07658f8a306ebb4c59e435d6051

commit 23996390b54b7ee4b512319eb473cdb209911d55
Merge: 597d46d81 b01b82b03
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:51:46 2018 -0700

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into oc-dev
    am: b01b82b03a

    Change-Id: I42f2e51fbff12afc07f01690bc9f18b99b84eda9

commit dec8f3efffaddbc1d5d56109e24afffe5b4da9d2
Merge: 14db3b68c 14494bb41
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac am: e653bb9a14
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14
      DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

commit 1dad7047f3e3b61c453c2b5f8a8f36e5f0ba4b75
Merge: 976a23cd4 e653bb9a1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into cw-f-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14
      DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

commit 38fa59c7fe34441d112bf2e35b867004fb0b7a9f
Merge: 8a6961131 b672ba6ca
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into nyc-mr1-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14
      DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

commit 41d65bb82cf2c5319c642f48963b84cfbb9b7047
Merge: ab038438d 03c98acc3
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into nyc-dr1-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14
      DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

commit 00565f6e43fdd42e28478e47a7eb9e99c57fa787
Merge: 90ec1c94a 082353ad1
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge "DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp" into nyc-dev

commit b01b82b03acc679257211b7f290b9c31f1f9c643
Merge: a57247b56 67a7b4291
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Aug 10 00:39:29 2018 +0000

    Merge changes from topic "am-49bd153a-ceb2-41b6-8588-4e6a6475d94a" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac am: e653bb9a14 skipped: 14494bb416
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac am: e653bb9a14
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31
      [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14
      DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

commit 3884f2f0329025b27b0c6ba0faa057de35c4b564
Merge: d59828d58 7df3c3123
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:10:24 2018 -0700

    Merge changes from topic "am-aa78d1e3-f74a-4cdb-b5c4-c931b7a0997b" into oc-dev am: a57247b56c am: 597d46d81d
    am: 7df3c31238

    Change-Id: I3e4b460e0c44f57c7bb92b18ad60153d0df5b9e0

commit d59828d58f35e81d0251409f9f2f5361f220f4a6
Merge: 4b4855ac5 45be325db
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:09:54 2018 -0700

    Merge "Check remaining frame length in rfc_process_mx_message" into oc-dev am: ae8509d9b7 am: 9cb1e4b72a
    am: 45be325db1

    Change-Id: I87a16a0543eb7e17f1e121086bddbb7674c7a3fe

commit 7df3c31238893c79546322fa5fffa71db835be72
Merge: 45be325db 597d46d81
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:06:16 2018 -0700

    Merge changes from topic "am-aa78d1e3-f74a-4cdb-b5c4-c931b7a0997b" into oc-dev am: a57247b56c
    am: 597d46d81d

    Change-Id: Ia97c64fc4911fd8e209d3223b220008230e57a97

commit 45be325db180c6eed42a11ca06605959577ad516
Merge: 6a1fafd1a 9cb1e4b72
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 17:05:49 2018 -0700

    Merge "Check remaining frame length in rfc_process_mx_message" into oc-dev am: ae8509d9b7
    am: 9cb1e4b72a

    Change-Id: Iffa1f2640e3192dafe94bd26879c4080055cdd20

commit 597d46d81d4360df1d58e1ffcc1fa9609b7ab842
Merge: 9cb1e4b72 a57247b56
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 16:53:06 2018 -0700

    Merge changes from topic "am-aa78d1e3-f74a-4cdb-b5c4-c931b7a0997b" into oc-dev
    am: a57247b56c

    Change-Id: I6165f5f7aebd63c0eb4c00e2e918d6ee260643b2

commit 9cb1e4b72a9fbadb0c6add705c1ce087065b468f
Merge: 455910d97 ae8509d9b
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 16:52:28 2018 -0700

    Merge "Check remaining frame length in rfc_process_mx_message" into oc-dev
    am: ae8509d9b7

    Change-Id: I00abf83f15bc4859deaa6283e0b8e26b8f069cbd

commit 90ec1c94a17da163cde5e97ddd8a5c4d2432c0c4
Merge: fb5115a9f 53e8b941f
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 23:43:44 2018 +0000

    Merge "DO NOT MERGE Check remaining frame length in rfc_process_mx_message" into nyc-dev

commit a57247b56c9d886d7bc887870cac4f9729f319d6
Merge: ae8509d9b 008158c9e
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Aug 9 23:43:44 2018 +0000

    Merge changes from topic "am-aa78d1e3-f74a-4cdb-b5c4-c931b7a0997b" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b am: 976a23cd4b skipped: 14db3b68c0
      [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b am: 976a23cd4b
      [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b
      [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc
      [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd
      DO NOT MERGE Check remaining frame length in rfc_process_mx_message

commit ae8509d9b730a9a35c156e7db52fcdc7383fe402
Merge: b7b580578 0471355c8
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 9 23:28:49 2018 +0000

    Merge "Check remaining frame length in rfc_process_mx_message" into oc-dev

commit 4b4855ac5e0b5a3935f4e59174cc4e15c6da0248
Merge: d8d7b5665 6a1fafd1a
Author: Cheney Ni <cheneyni@google.com>
Date:   Thu Aug 9 16:05:31 2018 -0700

    Merge changes from topic "am-1ac1c997-3571-4fd2-87bd-bb10887070b7" into oc-dev am: b7b580578b am: 455910d972
    am: 6a1fafd1a8

    Change-Id: I995ae90bbe586d32eb1796544a6b284b90fc9b2b

commit 6a1fafd1a880dabb29b7ebab2d6d4f389fb8b590
Merge: e2f657b72 455910d97
Author: Cheney Ni <cheneyni@google.com>
Date:   Thu Aug 9 16:00:26 2018 -0700

    Merge changes from topic "am-1ac1c997-3571-4fd2-87bd-bb10887070b7" into oc-dev am: b7b580578b
    am: 455910d972

    Change-Id: Ica42916bc91579c5275dd7bdcd4a873adb3e8a1e

commit 455910d972d1ad568b05e445576b0a6c4cc17706
Merge: 06d127395 b7b580578
Author: Cheney Ni <cheneyni@google.com>
Date:   Thu Aug 9 15:57:33 2018 -0700

    Merge changes from topic "am-1ac1c997-3571-4fd2-87bd-bb10887070b7" into oc-dev
    am: b7b580578b

    Change-Id: If36b04bb774713d6223939fbdc8100d17a9b8831

commit 008158c9ed79d6e01269c8901393d1bfcbf0890e
Merge: b7b580578 14db3b68c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 22:55:53 2018 +0000

    [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b am: 976a23cd4b skipped: 14db3b68c0

    Change-Id: I9b391091a3b315cc63ffd9473de4f2355bea7120

commit 14db3b68c0d9051e093a58872ee08356135d64ad
Merge: c1bf22d91 976a23cd4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 22:55:51 2018 +0000

    [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b am: 976a23cd4b

    Change-Id: Id44e7d201010b92d57251b517abac83c0c280d7f

commit 976a23cd4bb813b416f14743eca65199d9aa8219
Merge: 86ae4a64a 8a6961131
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 22:55:50 2018 +0000

    [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc am: 8a6961131b

    Change-Id: Icce80ed02b3a56f870be1f10cc28acc3217c2dee

commit 8a6961131b99343176c52a4d4593d1741fb2513a
Merge: 87005c456 ab038438d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 22:55:49 2018 +0000

    [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd am: ab038438dc

    Change-Id: I39245a2ad5f7a25817312a839dc380c65d5c6bc7

commit ab038438dc69bcdcaf565bda0b56c3a535db7830
Merge: 1ced84f75 53e8b941f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 22:55:47 2018 +0000

    [automerger] DO NOT MERGE Check remaining frame length in rfc_process_mx_message am: 53e8b941fd

    Change-Id: Icf15e5062606fb69a632d136dbbb4257802bbef2

commit 53e8b941fd918b6f03667e1bdd38fc73ac84396b
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Aug 8 11:38:30 2018 -0700

    DO NOT MERGE Check remaining frame length in rfc_process_mx_message

    Bug: 111936792
    Bug: 80432928
    Test: manual
    Change-Id: Ie2c09f3d598fb230ce060c9043f5a88c241cdd79

commit b7b580578b1124fc4942176ac28ef5d2700a10db
Merge: 9e8972b88 90a3b4598
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 9 22:28:43 2018 +0000

    Merge changes from topic "am-1ac1c997-3571-4fd2-87bd-bb10887070b7" into oc-dev

    * changes:
      [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f am: 86ae4a64a7 skipped: c1bf22d912
      [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f am: 86ae4a64a7
      [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f
      [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755
      [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8
      DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req

commit d8d7b56650e7571d0fb726d122ac6fb792b22844
Merge: 432c496c8 e2f657b72
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Aug 9 14:27:55 2018 -0700

    Merge "Fix copy length calculation in sdp_copy_raw_data" into oc-dev am: 9e8972b882 am: 06d127395d
    am: e2f657b725

    Change-Id: Ieb06eb975b8a3c7d19e8501d0e4035a1617e0f73

commit e2f657b7254419262d921eb721bfdab35327a85e
Merge: a7d532c77 06d127395
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Aug 9 14:23:48 2018 -0700

    Merge "Fix copy length calculation in sdp_copy_raw_data" into oc-dev am: 9e8972b882
    am: 06d127395d

    Change-Id: Ic9c78e0cbf3b3386029883ba88e4c786fcb27832

commit 06d127395d9d7ca29fa2682581ff57f36a5d850d
Merge: a9fc38bcb 9e8972b88
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Aug 9 14:19:48 2018 -0700

    Merge "Fix copy length calculation in sdp_copy_raw_data" into oc-dev
    am: 9e8972b882

    Change-Id: Ic8e44e7546ba67ef3500d4d7d13de2ddd1382261

commit 9e8972b8825f055aa6d2663a0f8bcbd8bbed3939
Merge: 0d4898a05 23aa15743
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Aug 9 21:06:30 2018 +0000

    Merge "Fix copy length calculation in sdp_copy_raw_data" into oc-dev

commit 007868d05f4b761842c7345161aeda6fd40dd245
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Thu Aug 9 13:07:48 2018 -0700

    Add missing AVRCP message length checks inside avrc_msg_cback

    Explicitly check the length of the received message before
    accessing the data.

    Bug: 111803925
    Bug: 79883824
    Test: POC scripts
    Change-Id: I00b1c6bd6dd7e18ac2c469ef2032c7ff10dcaecb
    Merged-In: I00b1c6bd6dd7e18ac2c469ef2032c7ff10dcaecb
    (cherry picked from commit 282deb3e27407aaa88b8ddbdbd7bb7d56ddc635f)

commit d7d7ab17b08ccf4374f19a602fb3e5aeb3eec1a8
Merge: 0d4898a05 2c2b3674f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:44:25 2018 +0000

    [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef am: 30c2ddb520 skipped: 2c2b3674f0

    Change-Id: I7e80d5ae521c7de703b2300c7e0da014151fa549

commit 2c2b3674f072954466056f6b86cfd24496746913
Merge: 1dd65db25 30c2ddb52
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:44:23 2018 +0000

    [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef am: 30c2ddb520

    Change-Id: I8f2524656ae5cf349100abbc057cdd9acc842838

commit 30c2ddb5207425dd51869757c647fd9386cfbafd
Merge: 992fc965c de283c02e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:44:22 2018 +0000

    [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103 am: de283c02ef

    Change-Id: I474abf5e66800878b06f5dff40925259a11b6f90

commit de283c02efad05db9ba994d311e3b2ae292882bd
Merge: aea0b2937 750f17310
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:44:20 2018 +0000

    [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36 am: 750f173103

    Change-Id: I4758c0dc8b2c91707ee4941e6139a07985a65115

commit 750f173103c61d6c1e714fede4a1acbfe3c8ef6b
Merge: b44c50401 b78d265f3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 20:44:19 2018 +0000

    [automerger] DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback am: b78d265f36

    Change-Id: Id40969f4067b99036b17e8880e1b8c5f9602fbca

commit b78d265f362dab7df559883617dd766bcc60ad43
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Thu Aug 9 13:40:54 2018 -0700

    DO NOT MERGE: Add missing AVRCP message length checks inside avrc_msg_cback

    Explicitly check the length of the received message before
    accessing the data.

    Bug: 111803925
    Bug: 79883824
    Test: POC scripts
    Change-Id: I50d1d1f7dd7038ffcd5f0d5975ab1db43178067f
    Merged-In: I00b1c6bd6dd7e18ac2c469ef2032c7ff10dcaecb

commit 0471355c8b035aaa2ce07a33eecad60ad49c5ad0
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Aug 8 11:31:28 2018 -0700

    Check remaining frame length in rfc_process_mx_message

    Bug: 111936792
    Bug: 80432928
    Test: manual
    Change-Id: Ie2c09f3d598fb230ce060c9043f5a88c241cdd79

commit 90a3b4598eb2b3319b0087711873e0feff7b2e87
Merge: 0d4898a05 c1bf22d91
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 05:31:35 2018 +0000

    [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f am: 86ae4a64a7 skipped: c1bf22d912

    Change-Id: I8e04165542a70a421799042c1854d6e7622c4e2d

commit c1bf22d912ac3276f10b7d83b5a9bdf10fd98e95
Merge: 1dd65db25 86ae4a64a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 05:31:31 2018 +0000

    [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f am: 86ae4a64a7

    Change-Id: Ib82a2509ca23e101935302247ac1cf440723fb56

commit 86ae4a64a7cb1da6edab8eed73cf7d32a271ed11
Merge: 992fc965c 87005c456
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 05:31:28 2018 +0000

    [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755 am: 87005c456f

    Change-Id: Ifac068eadc58e0ec110d7e014489c0412971e870

commit 87005c456f8a9b0ac3dea16db5fd40d641cd144f
Merge: aea0b2937 1ced84f75
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 05:31:25 2018 +0000

    [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8 am: 1ced84f755

    Change-Id: Ie0aaf223c4a572094bdf93c09fb24fcb0b3d67e4

commit 1ced84f7553fe69e6f21f80c14e36859c9063dba
Merge: b44c50401 fb5115a9f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Aug 9 05:31:21 2018 +0000

    [automerger] DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req am: fb5115a9f8

    Change-Id: I5863c4cf1a923c99cc00ad5d802e88d4e08eb6dc

commit fb5115a9f8782cc27b2ba860f9855d3fe882e0fc
Author: Cheney Ni <cheneyni@google.com>
Date:   Tue Aug 7 21:32:07 2018 +0800

    DO NOT MERGE: Add packet length checks in mca_ccb_hdl_req

    Bug: 110791536
    Test: manual
    Change-Id: Ica5d8037246682fdb190b2747a86ed8d44c2869a

commit 4de7ccdd914b7a178df9180d15f675b257ea6e02
Author: Cheney Ni <cheneyni@google.com>
Date:   Tue Aug 7 21:32:07 2018 +0800

    Add packet length checks in mca_ccb_hdl_req

    Bug: 110791536
    Test: manual
    Change-Id: Ica5d8037246682fdb190b2747a86ed8d44c2869a

commit be8f73dcbde904f66e2ae103a68352b75e6786b8
Merge: 0d4898a05 b4b40d8fb
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 08:17:26 2018 +0000

    [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489 am: 24e9e1f47a skipped: b4b40d8fb3

    Change-Id: I361778a1be3c1006e72e002f44c6d5ef94649b23

commit b4b40d8fb33420df2b05280302ca2de1ccfcc858
Merge: 1dd65db25 24e9e1f47
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 08:17:23 2018 +0000

    [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489 am: 24e9e1f47a

    Change-Id: I6d8230e0ffb578230cdbaba0794dad3a6f1d8893

commit 24e9e1f47aa18a21f6c5d40c3b6d99d93e1afdce
Merge: 992fc965c ba9017048
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 08:17:20 2018 +0000

    [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad am: ba90170489

    Change-Id: I6bc0048722d4c66fa90efd422293fdeefeb4cf39

commit ba901704893ed7dcf9233b1111e80bc372d7b353
Merge: aea0b2937 1bf18942a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 08:17:16 2018 +0000

    [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498 am: 1bf18942ad

    Change-Id: I7e08942760476ff7a7555ae389fe2125d82058cb

commit 1bf18942addecf7c9549c889d7cf33e2b79d0f9c
Merge: b44c50401 82815f449
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 08:17:13 2018 +0000

    [automerger] DO NOT MERGE Check packet length in bta_av_proc_meta_cmd am: 82815f4498

    Change-Id: I1884a8a5b2f36debd0e1e8d2dd2a62f839d70dbb

commit 82815f4498d35dcf8798ed6834e3a7f7212016d7
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Wed Aug 8 16:15:21 2018 +0800

    DO NOT MERGE Check packet length in bta_av_proc_meta_cmd

    Bug: 111893951
    Test: manual
    Change-Id: Ie562c393e949c275203617972d43bb005190b32b

commit 81a2af185bf45cd15d6d55a6a1214992ba8f7f31
Merge: 0d4898a05 de319d041
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 06:58:28 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02 am: aa9c254357 skipped: de319d0416

    Change-Id: I4c0f83da8f39ff3339098f43152badba470b7182

commit de319d041631508ad8ea11f983d146159dc940e9
Merge: 1dd65db25 aa9c25435
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 06:58:25 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02 am: aa9c254357

    Change-Id: I816d8bb946c890cce0062e66f0aa751fed606570

commit aa9c254357e1a3505c9238a047d4efd2a5939b9c
Merge: 992fc965c a999037d0
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 06:58:22 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975 am: a999037d02

    Change-Id: Ibdafac859df4977b41e954ce0c2d1f7cc30cf12e

commit a999037d0200246c4af6bfafe0f111394b2f7f8d
Merge: aea0b2937 d952a3697
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 06:58:18 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0 am: d952a36975

    Change-Id: I06022c8ab062e4422b443d49869293b777058b20

commit d952a36975c98e6b6099a04d5475252bf1278579
Merge: b44c50401 e64b4a38b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Wed Aug 8 06:58:15 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read before buffer length check am: e64b4a38b0

    Change-Id: Id645cb892c2bef5f985f9bc9d770617c4feb0a97

commit e64b4a38b049853b8e6e2f8e16dd15765e290f42
Author: Ugo Yu <ugoyu@google.com>
Date:   Wed Aug 8 14:57:25 2018 +0800

    DO NOT MERGE Fix OOB read before buffer length check

    Bug: 111936834
    Test: manual
    Change-Id: I60c500651f130876934a7b80889f4e021055fe73

commit 4548f34c90803c6544f6bed03399f2eabeab2a8e
Author: Ugo Yu <ugoyu@google.com>
Date:   Wed Aug 8 14:46:42 2018 +0800

    DO NOT MERGE Fix OOB read before buffer length check

    Bug: 111936834
    Test: manual
    Change-Id: Ib98528fb62db0d724ebd9112d071e367f78e369d

commit ed51887f921263219bcd2fbf6650ead5ec8d334e
Author: Chienyuan <chienyuanhuang@google.com>
Date:   Wed Aug 8 11:21:28 2018 +0800

    Check packet length in bta_av_proc_meta_cmd

    Bug: 111893951
    Test: manual - connect A2DP
    Change-Id: Ibbf347863dfd29ea3385312e9dde1082bc90d2f3

commit d945ada503ed9c9ea24e092df51faba57f5d589a
Author: Hansong Zhang <hsz@google.com>
Date:   Mon Aug 6 14:40:37 2018 -0700

    Fix OOB read in avrc_ctrl_pars_vendor_rsp

    Bug: 78526423
    Test: manual
    Change-Id: I0eeacc6a25b12f4b999098375d0d032cfa462a91

commit 67a7b42912730c6120950660c49150d12d70702b
Merge: 0d4898a05 14494bb41
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Mon Aug 6 21:37:30 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac am: e653bb9a14 skipped: 14494bb416

    Change-Id: I7f9a2f42d3ea07f36ce2f8d068da69029cd32890

commit 14494bb4164ab604bde802fa4939bcf2187b7006
Merge: 1dd65db25 e653bb9a1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Mon Aug 6 21:37:29 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac am: e653bb9a14

    Change-Id: I6fdb008f5e6187507d2a0a7c5426188dda0c3cff

commit e653bb9a145703be075884cdfdab2858e7c84378
Merge: 992fc965c b672ba6ca
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Mon Aug 6 21:37:28 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31 am: b672ba6cac

    Change-Id: I80ae25af3a3b9be071837cab835c3bc91c90829f

commit b672ba6cace4290f8ffb70cb189da49620b8cd04
Merge: aea0b2937 03c98acc3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Mon Aug 6 21:37:26 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14 am: 03c98acc31

    Change-Id: I6b5e1c9082af1fddaaee8944b7ae661f429c483c

commit 03c98acc31d3cc8ce2604bf12bcfedd4010e65b3
Merge: b44c50401 082353ad1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Mon Aug 6 21:37:25 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp am: 082353ad14

    Change-Id: I0ab8cc738023d77e040d3b3ffc159001f13a531e

commit 082353ad14082babaf8bcb1fba000b3cf1450c11
Author: Hansong Zhang <hsz@google.com>
Date:   Mon Aug 6 14:36:41 2018 -0700

    DO NOT MERGE Fix OOB read in avrc_ctrl_pars_vendor_rsp

    Bug: 78526423
    Test: manual
    Change-Id: I0eeacc6a25b12f4b999098375d0d032cfa462a91

commit 1980d67877fa03ce50c5baa9cffd83d2aad961c8
Merge: 61e75414f 432c496c8
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Tue Jul 31 03:10:11 2018 +0000

    Snap for 4922203 from 432c496c8ee1349b84166c6873c7a4a2957c0910 to pi-qpr1-release

    Change-Id: I9637eb53d2dc079f443932ff694308a93293f35b

commit 432c496c8ee1349b84166c6873c7a4a2957c0910
Merge: 83640ac13 4addcbf11
Author: Chris Fries <cfries@google.com>
Date:   Mon Jul 30 22:59:57 2018 +0000

    Merge "Ignore SDP failure while bonding if SDP was not attempted" into pi-dev

commit 61e75414f8e3cd4283701a87f9624626496ff070
Merge: 3ff7033b2 83640ac13
Author: android-build-team Robot <android-build-team-robot@google.com>
Date:   Fri Jul 27 03:04:14 2018 +0000

    Snap for 4916303 from 83640ac13fc546924fc2146520b0e074db615c82 to pi-qpr1-release

    Change-Id: If2f2ac3c6e25124b813042a9c65ebdcf5761a425

commit 83640ac13fc546924fc2146520b0e074db615c82
Merge: 91ff5fdae c65e920e0
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 25 17:38:24 2018 +0000

    Merge "HFP: Reset BTA SCO control block when bta_ag_create_sco failed" into pi-dev

commit 4addcbf1113f78e4c94c61582e8c267ed1498af9
Author: Cheney Ni <cheneyni@google.com>
Date:   Tue Jul 17 19:27:59 2018 +0800

    Ignore SDP failure while bonding if SDP was not attempted

    When bonding, there is an ACL_UP event to the upper layers and some apps
    may want to fetch SDP in return. This can break pairing. In cases SDP fails,
    it causes the procedure to be finished before the LinkKey is generated.
    And thus the LinkKey is not committed to NVRAM and the device is not paired.

    Bug: 111189110
    Test: : Pair / Unpair BT accessories manually
    Change-Id: Iaefbe8b6c1fc3e78f0f120220992df84699a2eb8
    Merged-In: Iaefbe8b6c1fc3e78f0f120220992df84699a2eb8
    (cherry picked from commit 5492af2d0ee3a9c810f001cfc9a29283a76b4438)

commit 91ff5fdae5de7dd7fac7933fb741666fd1876165
Merge: 58351acf5 a7d532c77
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:39:40 2018 -0700

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into oc-dev am: 0d4898a05d am: a9fc38bcbf
    am: a7d532c77c

    Change-Id: Ic3bbfdf73d39b1455f6d27bf9294fb56011d0829

commit 58351acf5b0d34153c02e22bcb3c5bd59dcee7a4
Merge: 3ff7033b2 024d0e1d5
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:39:07 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e am: d3bb538dc8 skipped: 00dad61a16 am: c898c9c6a4 am: 37e8dd3c55
    am: 024d0e1d5b  -s ours

    Change-Id: Idb00a9bfd6c501c90ce4aa4361a586f9cf422f0d

commit a7d532c77cf628892e9a6ee05ce7a922807e2b77
Merge: 024d0e1d5 a9fc38bcb
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:32:52 2018 -0700

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into oc-dev am: 0d4898a05d
    am: a9fc38bcbf

    Change-Id: I70a95eb32638425b21e5bef29a0a02b370277bac

commit 024d0e1d5b5adc9e4b9c037528a23a46b809755d
Merge: 4a8e14e16 37e8dd3c5
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:32:21 2018 -0700

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e am: d3bb538dc8 skipped: 00dad61a16 am: c898c9c6a4
    am: 37e8dd3c55

    Change-Id: I94485d850eee68f7434b3f8f20332c243ceae2a1

commit a9fc38bcbf43fde350f2306bf9abd4a1b849c32e
Merge: 37e8dd3c5 0d4898a05
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:30:04 2018 -0700

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into oc-dev
    am: 0d4898a05d

    Change-Id: Id277c1b6c5b105a492d03980d5cf7e958128b505

commit 37e8dd3c55384c453f2839dde5daf06a2ad5a06e
Merge: a7992011a c898c9c6a
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 11:29:19 2018 -0700

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e am: d3bb538dc8 skipped: 00dad61a16
    am: c898c9c6a4

    Change-Id: If8c3042504c65bb244b253f822409457fadb096e

commit 28a63ac9d87f7a103297fa9f7f0ca53ab846717f
Merge: 5addfc4d9 51b656f12
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge "DO NOT MERGE SDP: Fix the param_len recalculation" into nyc-dev

commit 0d4898a05dda44555595714a25d4f945e49205bd
Merge: c898c9c6a c8c2f9389
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into oc-dev

    * changes:
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41 am: f066a42e32 skipped: 72d1557fe0
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41 am: f066a42e32
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b
      DO NOT MERGE SDP: Fix the param_len recalculation

commit 1dd65db25fe7907bf93639dc824057f1dd662781
Merge: 00dad61a1 72d1557fe
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41 am: f066a42e32
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b
      DO NOT MERGE SDP: Fix the param_len recalculation

commit 992fc965c4301c973e3668dd53ef041e2d9c961c
Merge: d3bb538dc f066a42e3
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into cw-f-dev

    * changes:
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b
      DO NOT MERGE SDP: Fix the param_len recalculation

commit aea0b2937ef166deb0404ee638bcbc32a5386b94
Merge: f74d7ad31 38961f6b4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into nyc-mr1-dev

    * changes:
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b
      DO NOT MERGE SDP: Fix the param_len recalculation

commit b44c504016b2f331798919a04d4ac511c362f218
Merge: 20558f53c d305a203c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 20 18:25:33 2018 +0000

    Merge changes from topic "am-2c2c464f-fb3a-4c93-8661-57c986c3e069-nyc-dev" into nyc-dr1-dev

    * changes:
      [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b
      DO NOT MERGE SDP: Fix the param_len recalculation

commit c8c2f93897e50ecd14c8452cb853de3688f62850
Merge: e6d78b9c3 72d1557fe
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:45 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41 am: f066a42e32 skipped: 72d1557fe0

    Change-Id: Ia2aafdffd87d9f7a00429d50783e64864fe92db3

commit 72d1557fe08151b3efde3592ce115495d33ac92c
Merge: 54cb89ba1 f066a42e3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:44 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41 am: f066a42e32

    Change-Id: I036429bc438f3713148c44668c9030d9968bbb71

commit f066a42e32b2b5e9f51403762cf3151dcf57278c
Merge: fd37563ba 38961f6b4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:43 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce am: 38961f6b41

    Change-Id: I2b54ca809d16ca1df0a9061301f76cf64c16243e

commit 38961f6b41f370ead9df07f3717ae03d062b9941
Merge: 78f26ef5c d305a203c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:41 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b am: d305a203ce

    Change-Id: I792c9737e3ba5ac8ab173e7675ddde50383a97b8

commit d305a203ceedb04f9d77a375999960367afd96e9
Merge: 220ef97d5 51b656f12
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:40 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 51b656f12b

    Change-Id: Ic935bcfa40526b5f6dbd8714552b6420a35cf29a

commit 51b656f12b82e47130c4a5b1d976ec1e2ab8e72b
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 10:16:14 2018 -0700

    DO NOT MERGE SDP: Fix the param_len recalculation

    Bug: 78136869
    Test: manual connection to an A2DP device
    Change-Id: If32b848696180ab2fd33f514de89cb8c3d202e39

commit c898c9c6a4652955d570c6a585e595bfa99aa331
Merge: e6d78b9c3 00dad61a1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:24 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e am: d3bb538dc8 skipped: 00dad61a16

    Change-Id: I4f5e848e72f9ae77371c2d4e596a882581d8fe7b

commit 00dad61a1690855a436945635bf7a9beda543ead
Merge: 54cb89ba1 d3bb538dc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:23 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e am: d3bb538dc8

    Change-Id: I8705f0d81fba1027c7a9b506f447482901227c40

commit d3bb538dc836cb1759df4a6af5635384831299b9
Merge: fd37563ba f74d7ad31
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:22 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4 am: f74d7ad31e

    Change-Id: I53e95354ae4b588f11e57fc6e5aef741177becfe

commit f74d7ad31eab08785b5864977b2cf1bf32bba0a8
Merge: 78f26ef5c 20558f53c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:20 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a am: 20558f53c4

    Change-Id: I0693e632de44e6781f7435a730dcd485e27e4cab

commit 20558f53c4679979f9ddaacb99054a0c1815c0d2
Merge: 220ef97d5 5addfc4d9
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:19 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233 am: 5addfc4d9a

    Change-Id: I54d6a6295dcb5791aa339ffaa23ac2f319acd667

commit 5addfc4d9af952c89c8cb17665d9fce71cabdb74
Merge: 4cea93894 58417f923
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:18 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23 skipped: 58417f9233

    Change-Id: I5429442640a203df07ba448e8b9837fb8017eb6d

commit 58417f923359c4f1ed8e27c4c51ba8637702acb5
Merge: b1f262ed4 7d92fdbb2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:17 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb am: 7d92fdbb23

    Change-Id: Ie9d7f0209ad248035cb65c9e6d04236ba61a9264

commit 7d92fdbb23e0a8820274ee703af18453e1ce457b
Merge: aa697e3f8 43d4bf00e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:15 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e am: 43d4bf00eb

    Change-Id: Iea2346e652fe6bb086e894615bb409491d60457d

commit 43d4bf00eb545d8ca28c4ad96722659843f885f0
Merge: 5741c6951 7b2d711d9
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 20 17:17:14 2018 +0000

    [automerger] DO NOT MERGE SDP: Fix the param_len recalculation am: 7b2d711d9e

    Change-Id: I1adfd8dd7cd684e5d9af4a1967f0630e53fe035f

commit 7b2d711d9ed178d227d5c1b46a67d05ce3c06612
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 20 10:16:14 2018 -0700

    DO NOT MERGE SDP: Fix the param_len recalculation

    Bug: 78136869
    Test: manual connection to an A2DP device
    Change-Id: If32b848696180ab2fd33f514de89cb8c3d202e39

commit 3ff7033b27e3d58a560c408e64ac0a25bcee4024
Merge: e84112ce6 a3113f134
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 18 18:58:15 2018 +0000

    Merge "AVRCP: Reject SetAddressedPlayer command only if remote set invalid player ID" into pi-dev

commit 23aa15743397b345f3d948289fe90efa2a2e2b3e
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Mon Jul 16 06:40:35 2018 -0700

    Fix copy length calculation in sdp_copy_raw_data

    Test: compilation
    Bug: 110216176
    Change-Id: Ic4a19c9f0fe8cd592bc6c25dcec7b1da49ff7459

commit e84112ce6af6c4590d32743312350407dbd119ca
Merge: 3bd185c06 4a8e14e16
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:20:24 2018 -0700

    Merge "Fix a wrong check in rfc_parse_data" into oc-dev am: e6d78b9c37 am: a7992011a4
    am: 4a8e14e16b

    Change-Id: Iab5a146f0f22780a38192c1e5294350738daf0a7

commit 3bd185c062db7f05b088035faea4bc4fc18bd37b
Merge: 3d564ba04 05211b194
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:19:59 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9 am: fd37563baf skipped: 54cb89ba14 am: 93110a553e am: aa7175ae97
    am: 05211b1947  -s ours

    Change-Id: If80c66ab182419dbe22d455dd332ec20c3670da9

commit 3d564ba040b4aac16aacda9b48ad875ce3efb06a
Merge: b07d6f48b af35291d4
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:19:47 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc am: c359938d3c skipped: cdcca17caa am: d88cfe6530  -s ours am: 85a799bff2  -s ours
    am: af35291d41  -s ours

    Change-Id: I01cde7e51e2ebf2482746aa19f23ba3d925923ef

commit 4a8e14e16b7ba3fec74bdbacab4f79c687c9a48b
Merge: 05211b194 a7992011a
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:07:40 2018 -0700

    Merge "Fix a wrong check in rfc_parse_data" into oc-dev am: e6d78b9c37
    am: a7992011a4

    Change-Id: I2dbe619f4db2afd28f1426265e2e43c5ede9efd3

commit 05211b194792b6ed402c70b9c1caf997c0a06dea
Merge: af35291d4 aa7175ae9
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:07:13 2018 -0700

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9 am: fd37563baf skipped: 54cb89ba14 am: 93110a553e
    am: aa7175ae97

    Change-Id: Ic9876c6ff2c1919976e2409970f02f61f4c4db20

commit af35291d41aa4e5d81334571fc9c8c7f302c87f7
Merge: 8729bc8b2 85a799bff
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 17:06:42 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc am: c359938d3c skipped: cdcca17caa am: d88cfe6530  -s ours
    am: 85a799bff2  -s ours

    Change-Id: I5cf4f65085bc701e75af5556d0315e2923b8f1ea

commit a7992011a4876f39753534f4893c6e5ebd321e98
Merge: aa7175ae9 e6d78b9c3
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 16:12:06 2018 -0700

    Merge "Fix a wrong check in rfc_parse_data" into oc-dev
    am: e6d78b9c37

    Change-Id: Id4bc567e478860b199e7cbea2c91fc163b0cc01f

commit e6d78b9c372dccc135a78fa6ce0a69af59a9250b
Merge: 93110a553 d1ced302c
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 23:00:24 2018 +0000

    Merge "Fix a wrong check in rfc_parse_data" into oc-dev

commit aa7175ae970b8732f61fd375a51ffc5e5044fdd1
Merge: 85a799bff 93110a553
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 15:31:26 2018 -0700

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9 am: fd37563baf skipped: 54cb89ba14
    am: 93110a553e

    Change-Id: I6e00c18146c048be020c8077b9b3ba7a8aabe2a0

commit 85a799bff2644cbe624ec81bb4fab9b31cb78417
Merge: 262a81d32 d88cfe653
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 15:30:55 2018 -0700

    [automerger skipped] [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc am: c359938d3c skipped: cdcca17caa
    am: d88cfe6530  -s ours

    Change-Id: I2d99954f7ee5fd5f246eae2158a01fb4f4c679a6

commit c65e920e0af994b937ec5ba5dd3b481d25bee841
Author: Benson Li <bensonli@google.com>
Date:   Wed Jul 4 20:41:58 2018 +0800

    HFP: Reset BTA SCO control block when bta_ag_create_sco failed

    * When trying to connect SCO to non-active and active device back to
      back, the first connection to non-active device must fail gracefully
    * Otherwise, BTA SCO state machine may stuck in a irrecoverable state
    * Schedule to send AUDIO_CONNECTING state before starting SCO connection
      to avoid race condition between connecting state and connection
      failure

    Bug: 111101075
    Test: Manual test, make a call and switch path A->speaker->B on phone UI
    Change-Id: I9bfa389e04863944d88f2bca49d27f1247fa072b
    (cherry picked from commit 5360d6ac01702aa0657a10e561fae760fd6a151d)

commit d1ced302cd1066087588c891027b1756be31db46
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 13:45:46 2018 -0700

    Fix a wrong check in rfc_parse_data

    Bug: 78288018
    Bug: 111436796
    Test: manual
    Change-Id: I16e6026acbaac230fe1453bbac040d1b75bcea2a

commit 93110a553ec59f3c7163227ffa011bb6c6867206
Merge: d88cfe653 54cb89ba1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 20:44:17 2018 +0000

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9 am: fd37563baf skipped: 54cb89ba14

    Change-Id: I26b9980c190e11ac0676e4ca3d24766614653d96

commit 54cb89ba14cec61079462bbdd3f51320ad554a18
Merge: cdcca17ca fd37563ba
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 20:44:15 2018 +0000

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9 am: fd37563baf

    Change-Id: I81864bd4e4a97b50a9e22ba426e336717463496f

commit fd37563baf77124e8db834285703d7d8c3b120a0
Merge: c359938d3 78f26ef5c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 20:44:13 2018 +0000

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53 am: 78f26ef5c9

    Change-Id: I7b018c136700d25e8a4905d0245d802979ea8c78

commit 78f26ef5c93bf32603a3bcd99adf7424cca0dbf9
Merge: fdb84d21d 220ef97d5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 20:44:12 2018 +0000

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942 am: 220ef97d53

    Change-Id: I58c883eeac2c4a6db16ed70ba54cade1e548e549

commit 220ef97d534491928eb8f440ee1dbb24d6e7fe32
Merge: cbb88ee35 4cea93894
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 20:44:10 2018 +0000

    [automerger] DO NOT MERGE Fix a wrong check in rfc_parse_data am: 4cea938942

    Change-Id: Ic4a9218144a8c88e8bc84177d0f85c976fae1844

commit 4cea9389422b1936ebdc2fcd78a0b71f419c6497
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 13:43:27 2018 -0700

    DO NOT MERGE Fix a wrong check in rfc_parse_data

    Bug: 78288018
    Bug: 111436796
    Test: manual
    Change-Id: I16e6026acbaac230fe1453bbac040d1b75bcea2a

commit b07d6f48b0f3c4ebe1ab81c48c1d138d41dd7de1
Merge: 5631a81bd 8729bc8b2
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 10:20:02 2018 -0700

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714 skipped: 99381269de skipped: fff4962f67 am: 8e51fb603d  -s ours am: 262a81d328  -s ours
    am: 8729bc8b2a  -s ours

    Change-Id: If2af5bbcbf0036810c76d2f5920742c8965c38fa

commit 8729bc8b2af96babfb8ac532cb8ef39cc520e73c
Merge: 007ae2dd8 262a81d32
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 09:51:51 2018 -0700

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714 skipped: 99381269de skipped: fff4962f67 am: 8e51fb603d  -s ours
    am: 262a81d328  -s ours

    Change-Id: Ic909e32a9c23540ac149709e4686f9d705bae687

commit 262a81d3286dd07a72708d220d96565998dda839
Merge: 1e89f1d35 8e51fb603
Author: Hansong Zhang <hsz@google.com>
Date:   Fri Jul 13 09:32:45 2018 -0700

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714 skipped: 99381269de skipped: fff4962f67
    am: 8e51fb603d  -s ours

    Change-Id: Ic2a62fcfb00d4a25a97c505e15926cc4bd806066

commit d88cfe6530479e32a0ade33366c3ed86147a4bad
Merge: 8e51fb603 cdcca17ca
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:18:37 2018 +0000

    [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc am: c359938d3c skipped: cdcca17caa

    Change-Id: Ifcbc63cb72a2cc8659792d9e1a02c8241d97b8b2

commit cdcca17caa2dd01bc3568b1fb543fa01e289c867
Merge: fff4962f6 c359938d3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:18:35 2018 +0000

    [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc am: c359938d3c

    Change-Id: I103f98d8725fa7e12dad4a89a66e691e20cd4651

commit c359938d3c632af2eba0415da83d39fed7bbe56c
Merge: 99381269d fdb84d21d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:18:33 2018 +0000

    [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c am: fdb84d21dc

    Change-Id: Ia0ef6e7edf06eee0e01e88451b9b4c162620e145

commit fdb84d21dc44845d1becaa3d77d36e90811d95a7
Merge: 226e8be71 cbb88ee35
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:18:31 2018 +0000

    [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4 am: cbb88ee35c

    Change-Id: I8a01f6d1b1a0555c98fa72d27c796cd5756eb1bf

commit cbb88ee35c5c3474edfacade82ea6058c8bb51dd
Merge: 14a18f65e ee82a400c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:18:30 2018 +0000

    [automerger] DO NOT MERGE Add bound check for rfc_parse_data am: ee82a400c4

    Change-Id: I56a6a6281f816339d4028f84c1c720426863c21f

commit ee82a400c41fd7b141098e3f8659c44efa449e72
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 16:11:27 2018 -0700

    DO NOT MERGE Add bound check for rfc_parse_data

    Bug: 78288018
    Test: manual
    Change-Id: I44349cd22c141483d01bce0f5a2131b727d0feb0
    Merged-In: I44349cd22c141483d01bce0f5a2131b727d0feb0
    (cherry picked from commit 1b9a465eea85e86984bb1e53be69880159e59c69)

commit 8e51fb603d116190f446e8c65257ea908121da12
Merge: 15eee6efe fff4962f6
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:25 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714 skipped: 99381269de skipped: fff4962f67

    Change-Id: Ia28843cf75c09affea13d302054e9b31943b4247

commit fff4962f67044777c8276b46f117e8dfae952998
Merge: e6e84901a 99381269d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:23 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714 skipped: 99381269de

    Change-Id: Ib634ea6caddad254fa971dc5993fb66697855e05

commit 99381269de921d54948908bcc1d738c63ef8b17f
Merge: bde49a9c6 226e8be71
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:20 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2 skipped: 226e8be714

    Change-Id: I4a1b737c01d4a2a0aac153dfa857a4e91b8858b8

commit 226e8be714d9e5ec87eeb04c15ac798cc1ca12dc
Merge: ebee1a865 14a18f65e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:19 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c skipped: 14a18f65e2

    Change-Id: I9529f804880eb014a2e40b71e19af49a369d0c40

commit 14a18f65e2bca0e6cbd70384870fd41e44dc961e
Merge: dee921631 7c03b49a3
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:17 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40 skipped: 7c03b49a3c

    Change-Id: I93bd0e643f666e1f2c2af36fb56186e725ab6e03

commit 7c03b49a3cbb3658fa17b84cdf6b5a69bb6cd341
Merge: c4a845712 b1f262ed4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:15 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87 skipped: b1f262ed40

    Change-Id: I7b848bbdf257721c4f653daeb531ec2f6be4a6ad

commit b1f262ed4028b8ffa7dbb7ee930dad7db201ded8
Merge: e4460d953 aa697e3f8
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:13 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e skipped: aa697e3f87

    Change-Id: Ibc434fafa8043a4c9b42e26a80d893441a4cef27

commit aa697e3f87785f345e8c9b9f9705f5a644855630
Merge: 2e08a1447 5741c6951
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:11 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea skipped: 5741c6951e

    Change-Id: I0e691f7030013c84b90a10e20e67274ac2408025

commit 5741c6951e7219768ed7e919c2577428945e447f
Merge: 4a370bbdc 1b9a465ee
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 16:16:09 2018 +0000

    [automerger skipped] Add bound check for rfc_parse_data skipped: 1b9a465eea

    Change-Id: I4c80ed01bf081bfe6ab6d27fcbb5b685309fb2a2

commit 1b9a465eea85e86984bb1e53be69880159e59c69
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 16:11:27 2018 -0700

    Add bound check for rfc_parse_data

    Bug: 78288018
    Test: manual
    Change-Id: I44349cd22c141483d01bce0f5a2131b727d0feb0
    Merged-In: I44349cd22c141483d01bce0f5a2131b727d0feb0

commit 5631a81bd2208ac70b831c3abbe0a3a7339ebb0d
Merge: 2ee9b1867 007ae2dd8
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 06:48:15 2018 -0700

    [automerger skipped] [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658 am: bde49a9c60 am: e6e84901aa am: 15eee6efec  -s ours am: 1e89f1d35c  -s ours
    am: 007ae2dd82  -s ours

    Change-Id: I18f2b5ca397f3c1a4182e78416e85aa8d3712860

commit 007ae2dd822a7812bbae5d36a7a14f86d4ec0590
Merge: 5456b634a 1e89f1d35
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 06:43:08 2018 -0700

    [automerger skipped] [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658 am: bde49a9c60 am: e6e84901aa am: 15eee6efec  -s ours
    am: 1e89f1d35c  -s ours

    Change-Id: I25c5dc87c61f64e82ed57a8df85d52fff2ceee29

commit 1e89f1d35c43ddc52e7f6e7594567361f4ee4f61
Merge: ebd4902d0 15eee6efe
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 06:38:07 2018 -0700

    [automerger skipped] [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658 am: bde49a9c60 am: e6e84901aa
    am: 15eee6efec  -s ours

    Change-Id: I97207737c29cf988b2ae3c564a5deeb77ef136b5

commit 2ee9b1867bb49ad8973b9a4c7a574db8dac03358
Merge: c4e0b1701 5456b634a
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 05:55:59 2018 -0700

    [automerger skipped] Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into oc-dev am: c61957fc79  -s ours am: ebd4902d00  -s ours
    am: 5456b634ad  -s ours

    Change-Id: I65ae561b74373966a705f2a4f4f5ac6ba0149104

commit 5456b634ad7401e1db9c87e3c5f9b5b046f11933
Merge: 3476c0672 ebd4902d0
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 05:51:54 2018 -0700

    [automerger skipped] Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into oc-dev am: c61957fc79  -s ours
    am: ebd4902d00  -s ours

    Change-Id: I653f9c6173defe2936d0529ee1aef350671ceec5

commit ebd4902d00c8c018db002bb05226861cec2e52e3
Merge: abceaf0fe c61957fc7
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 05:47:49 2018 -0700

    [automerger skipped] Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into oc-dev
    am: c61957fc79  -s ours

    Change-Id: I80698043abd89109bb84f53051e56f75066ae78c

commit 15eee6efec852383983002dee166633453ddcddc
Merge: c61957fc7 e6e84901a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:22 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658 am: bde49a9c60 am: e6e84901aa

    Change-Id: If9a5923dbf999be582acef19405470a76c97bce2

commit e6e84901aa0232e160654fe511339376e99822ee
Merge: dcf98180e bde49a9c6
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:19 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658 am: bde49a9c60

    Change-Id: Ib1dc3304c1a85aa4161a4e4798ce6f992493f03f

commit bde49a9c60952d92a0b8ddc1f87be7e767b879f0
Merge: 635c8139e ebee1a865
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:16 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a am: ebee1a8658

    Change-Id: I965d8a637b3f56bc26d95f70afd2ab25750f1aa9

commit ebee1a8658c7f593b604a2b0c962778950a1855b
Merge: 13c31c150 dee921631
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:13 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124 am: dee921631a

    Change-Id: I79eb82aa7df90484eae4167ea6524035b3fe07dc

commit dee921631a116a98621449a4e3b88fe2d9fd65d9
Merge: 411376cca c4a845712
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:10 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d am: c4a8457124

    Change-Id: I85f2fa39093ea9b37782ff2d7d1f13e640a8532b

commit c4a84571243d3814758ca93aeb9e2f12bcfe0650
Merge: 4b0815162 e4460d953
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:47:07 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470 skipped: e4460d953d

    Change-Id: I0f7cd1a1d7e309db38eee7ae86ed761710a9bfb0

commit c4e0b1701ab6abf30f6d429b2f3942fac70fe09e
Merge: 093fd122e 3476c0672
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Fri Jul 13 05:44:56 2018 -0700

    [automerger skipped] [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a am: ebc968f44e skipped: eac1fcbb72 am: 53f2d61220  -s ours am: abceaf0fe7  -s ours
    am: 3476c0672b  -s ours

    Change-Id: If8eb29889e7503c5c004ba1796aaf317fdc4cca2

commit e4460d953db219030a9f54330193ef89e385fda1
Merge: 36f5050f2 2e08a1447
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:43:31 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5 am: 2e08a14470

    Change-Id: I6cd95ab6a7bf2509ef888134ff6a4d0aa18f4ac5

commit 2e08a14470312b40b7a26d1cda534e36cabca361
Merge: ba7e4b88c 4a370bbdc
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:43:29 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683 am: 4a370bbdc5

    Change-Id: I289ef3ff584a174372e89b692aee08076e7f97ed

commit 4a370bbdc59f3436b0dfa3a86af4748318355ed7
Merge: ee283d67b 9bf8cb268
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 12:43:26 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 9bf8cb2683

    Change-Id: Ia857465d9a103a44d6219f90bcf606e23a712166

commit 9bf8cb26831e07cd0527ea6e687c870cb49769aa
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 02:57:19 2018 -0700

    Fix out of bounds read in l2c_rcv_acl_data

    Test: none
    Bug: 80432895
    Change-Id: I7807d00c02a84c545476e84bc1b71e0718df1f24
    Merged-In: I7807d00c02a84c545476e84bc1b71e0718df1f24

commit c61957fc79d8460a19f628f0a43d8fd26d6e6366
Merge: 53f2d6122 172d2ba59
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into oc-dev

    * changes:
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec am: d4b2b3b5d7 skipped: cf56f96043
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec am: d4b2b3b5d7
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b
      Fix out of bounds read in l2c_rcv_acl_data

commit dcf98180e31df1cfdb358d26c2c2d144d4229e58
Merge: eac1fcbb7 cf56f9604
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into nyc-mr2-dev

    * changes:
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec am: d4b2b3b5d7
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b
      Fix out of bounds read in l2c_rcv_acl_data

commit 635c8139e2403685e8503d74719119b77cd50e18
Merge: ebc968f44 d4b2b3b5d
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into cw-f-dev

    * changes:
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b
      Fix out of bounds read in l2c_rcv_acl_data

commit 13c31c1506da0352edf205831ec022cf486863b9
Merge: 9bcc43603 81a867b3e
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into nyc-mr1-dev

    * changes:
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b
      Fix out of bounds read in l2c_rcv_acl_data

commit 411376ccaf2f09ac59c3cd896feab7c1777f20ea
Merge: 88c4c789a 7b75ed303
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge changes from topic "am-2044de95-4296-4a37-b01a-af14ae6c2920" into nyc-dr1-dev

    * changes:
      [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b
      Fix out of bounds read in l2c_rcv_acl_data

commit 4b0815162e0bc185be4b582b1bebe442a1109c46
Merge: e25f07401 32b472675
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 12:42:53 2018 +0000

    Merge "Fix out of bounds read in l2c_rcv_acl_data" into nyc-dev

commit 3476c0672b856fc6fd2e671768bceb21594e5425
Merge: d82b5627f abceaf0fe
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Fri Jul 13 05:40:20 2018 -0700

    [automerger skipped] [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a am: ebc968f44e skipped: eac1fcbb72 am: 53f2d61220  -s ours
    am: abceaf0fe7  -s ours

    Change-Id: I867caf50190cb0fc7585d93f0b5d0721f773d19e

commit abceaf0fe785289b5dd81662a64c622e3dbbdd7b
Merge: 2f2259ce1 53f2d6122
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Fri Jul 13 05:38:17 2018 -0700

    [automerger skipped] [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a am: ebc968f44e skipped: eac1fcbb72
    am: 53f2d61220  -s ours

    Change-Id: I230f807224d71e74bb0c4d662e6c8594831a15aa

commit 093fd122e141e6c1f1bcd8554a3e86b046e063ca
Merge: d8c44a86d d82b5627f
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 03:37:57 2018 -0700

    [automerger skipped] Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into oc-dev am: 2008b8b0f1  -s ours am: 2f2259ce16  -s ours
    am: d82b5627f2  -s ours

    Change-Id: I1e5065efe5d41ace502712ba9178a65273a98caf

commit d82b5627f26e9c1b267149e460a607f410d56707
Merge: 258d293e4 2f2259ce1
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 03:33:24 2018 -0700

    [automerger skipped] Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into oc-dev am: 2008b8b0f1  -s ours
    am: 2f2259ce16  -s ours

    Change-Id: Id5a567c7296bbefcf29d1a65b19548e53bd4c1bf

commit 2f2259ce16685fe0ce593b4b5ff1db162451cdc0
Merge: 21ac2d290 2008b8b0f
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 03:28:19 2018 -0700

    [automerger skipped] Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into oc-dev
    am: 2008b8b0f1  -s ours

    Change-Id: Id81106ed4eef109645758d85ee01e0cc78b84627

commit 53f2d61220d4262f5d185679d1dcfedeb027d80e
Merge: 2008b8b0f eac1fcbb7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:22:46 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a am: ebc968f44e skipped: eac1fcbb72

    Change-Id: I63533f7e0ec803b590fdf8c294248eb356a2ad59

commit eac1fcbb7278c7951ea7d535c23da0443eb31d30
Merge: 6f40eb86f ebc968f44
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:22:05 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a am: ebc968f44e

    Change-Id: Ia5da8d8fa0f9e3d0835b7eb6ec5c52182624dc18

commit ebc968f44e7f9af961985350819452c243a575a4
Merge: 8b08e8759 9bcc43603
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:22:03 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8 am: 9bcc43603a

    Change-Id: Iddc60e5f6966d6a7216839cf6b3fed8ff2e83849

commit 9bcc43603ab2933dbaaebc38481f0d98d9ebba92
Merge: 5711e0c7d 88c4c789a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:22:00 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013 am: 88c4c789a8

    Change-Id: Iac287ef4964fa4ad8b08bc40c89d8a6b6d5a6ee5

commit 88c4c789a88210d3c663a4751c3dae485762abe6
Merge: 0849546c0 e25f07401
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:21:57 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23 am: e25f074013

    Change-Id: Ia0a11c3f24a7b6e6a4f892c568513a3bfad987e4

commit e25f074013b41e0f3f8fe9d58ae80396e46f5af4
Merge: 12860b6d4 36f5050f2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:21:54 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca am: 36f5050f23

    Change-Id: If437e47efd744648d5549e23793894de40281b10

commit 36f5050f2361eed8c9710ff626bbf19d401a6e9d
Merge: d5ef3c9e7 ba7e4b88c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:21:51 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf am: ba7e4b88ca

    Change-Id: I4d7c71a8cec14b94039657bd8de3679a776c473e

commit ba7e4b88ca5e4a7480a5a6072b9a633cec828e90
Merge: 98366e0b0 ee283d67b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:21:48 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d am: ee283d67bf

    Change-Id: I2dcc552158cfc27c73dec217d7f3e2581adf2426

commit ee283d67bf3acf756821ae6fce0c798e072999bb
Merge: 497f11b0f 6c7c67817
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 10:21:46 2018 +0000

    [automerger] BLE: Don't access freed buffer in log message am: 6c7c67817d

    Change-Id: I9f5c4155c1def43351058c6cbda5f1258e3888d5

commit 6c7c67817d426b243eba4b12cd8e13c6041d37a1
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Tue Feb 6 18:18:37 2018 +0530

    BLE: Don't access freed buffer in log message

    When GATT fail to write data on L2CAP, buffer is freed by L2CAP.
    Accessing the buffer leads to fatal failure while printing the message info.

    Test: BLE discover services and BT off test cases

    Fixes: 73018520
    Change-Id: I661398fd1321f6e68026b3720db4965fd6584d70
    Merged-In: I661398fd1321f6e68026b3720db4965fd6584d70

commit 2008b8b0f15ef920a12f035eb6d5dc67609e0da0
Merge: 1cf96b6d8 36a7b9cc8
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 10:19:15 2018 +0000

    Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into oc-dev

    * changes:
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2 am: f4df487103 am: 1e25b32159
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2 am: f4df487103
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f
      Add packet length checks in l2cble_process_sig_cmd

commit 6f40eb86f436a8b64f91bfceba283d70c5a407a1
Merge: e544181d7 1e25b3215
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 10:19:15 2018 +0000

    Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into nyc-mr2-dev

    * changes:
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2 am: f4df487103
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f
      Add packet length checks in l2cble_process_sig_cmd

commit 8b08e87591a3e6c5ac3b22b4d765274b9cd63972
Merge: 57d2775cd f4df48710
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 10:19:15 2018 +0000

    Merge changes from topic "am-687d0d76-1eea-4aa7-85c2-727a2127c13f" into cw-f-dev

    * changes:
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd
      [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f
      Add packet length checks in l2cble_process_sig_cmd

commit 172d2ba590ba79b69e1a671855ec3013db31b952
Merge: 1cf96b6d8 cf56f9604
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:41:08 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec am: d4b2b3b5d7 skipped: cf56f96043

    Change-Id: I2653a755060aeb2276fa7b1b98d775a85b11cca3

commit cf56f96043e87481243f9aa39992db08ac2d8034
Merge: e544181d7 d4b2b3b5d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:40:39 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec am: d4b2b3b5d7

    Change-Id: Id57bca4555cbf458d4b39f4f8ab8d52dcd7188fa

commit d4b2b3b5d775588412be53ed1aabaa84e2426bc6
Merge: 57d2775cd 81a867b3e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:40:36 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034 am: 81a867b3ec

    Change-Id: I80b0aa3927f54a56c87ecad76351a075c5478c7b

commit 81a867b3ec802c7e0de1655bccafe17a0809641d
Merge: 9b5d5d42a 7b75ed303
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:40:33 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b am: 7b75ed3034

    Change-Id: I82e38c97577588ebe8738858011ec77ebba0d1ae

commit 7b75ed303475e52c9845f008e2d45a01a6d31cdf
Merge: 453054938 32b472675
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:40:31 2018 +0000

    [automerger] Fix out of bounds read in l2c_rcv_acl_data am: 32b472675b

    Change-Id: I7b64ae357697d390972d6c991ab73a4b518bc504

commit 32b472675b381106f9b59b5673483842d0f12521
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 02:57:19 2018 -0700

    Fix out of bounds read in l2c_rcv_acl_data

    Test: none
    Bug: 80432895
    Change-Id: I7807d00c02a84c545476e84bc1b71e0718df1f24
    Merged-In: I7807d00c02a84c545476e84bc1b71e0718df1f24

commit d8c44a86d07474925a5f0784683896f550e786dc
Merge: 4f710eae4 258d293e4
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:39:07 2018 -0700

    Merge changes from topic "am-8746f172-81c8-4cc5-8040-4c8a62f52edd" into oc-dev am: 1cf96b6d8f am: 21ac2d2901
    am: 258d293e43

    Change-Id: Ifb0319a039bf46bc646ae404214235a6d3c34c1d

commit 258d293e4372a0ed357a50b5bebcacbe8a61cffb
Merge: a69fbd8de 21ac2d290
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:34:58 2018 -0700

    Merge changes from topic "am-8746f172-81c8-4cc5-8040-4c8a62f52edd" into oc-dev am: 1cf96b6d8f
    am: 21ac2d2901

    Change-Id: Iaeed625216dc42e9650e068fcf3c1ebb092e13a5

commit 21ac2d2901554bfec14452133e3f51a956fa4300
Merge: 67d1e89fc 1cf96b6d8
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:30:59 2018 -0700

    Merge changes from topic "am-8746f172-81c8-4cc5-8040-4c8a62f52edd" into oc-dev
    am: 1cf96b6d8f

    Change-Id: Ice288c4814e0ca8e48a625bb2af43121b4a9336b

commit 1cf96b6d8f502df19881ccb7e7097744b147258e
Merge: 128001f32 a44a52db7
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 09:24:02 2018 +0000

    Merge changes from topic "am-8746f172-81c8-4cc5-8040-4c8a62f52edd" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Build fix for cw-f-dev branch am: 4842682057 skipped: 3b7da00cbd
      [automerger] DO NOT MERGE Build fix for cw-f-dev branch am: 4842682057
      DO NOT MERGE Build fix for cw-f-dev branch

commit e544181d73227dd85ed74b842420c91f24876bb3
Merge: 20da1f749 3b7da00cb
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 09:24:02 2018 +0000

    Merge changes from topic "am-8746f172-81c8-4cc5-8040-4c8a62f52edd" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE Build fix for cw-f-dev branch am: 4842682057
      DO NOT MERGE Build fix for cw-f-dev branch

commit 57d2775cdcdcdc0ccfab49efb52f9e2850f52487
Merge: 05d1bec1f 484268205
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 09:24:02 2018 +0000

    Merge "DO NOT MERGE Build fix for cw-f-dev branch" into cw-f-dev

commit 4f710eae4562d4461728074c815c8cf02042f374
Merge: ae516b35a a69fbd8de
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:19:06 2018 -0700

    [automerger skipped] Merge changes from topic "am-0faa2c83-9779-430a-b81c-34246f31544a" into oc-dev am: 128001f32c  -s ours am: 67d1e89fc6  -s ours
    am: a69fbd8deb  -s ours

    Change-Id: Ia44a7c9c17e6a21eef3cf6ed55a3c745e50175b3

commit 36a7b9cc8511336a999a10641032fbb43ced48be
Merge: 128001f32 1e25b3215
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:30 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2 am: f4df487103 am: 1e25b32159

    Change-Id: Ib4b60710673fe2af18f608d1c49276770bb6d58a

commit 1e25b321596bead8048bdaf585a7e194a01917eb
Merge: 20da1f749 f4df48710
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:28 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2 am: f4df487103

    Change-Id: I3889ad16fb79dc57692ce9edae27db44f6aa8839

commit f4df487103e68d4bf7522c6f3fb09ea53548d224
Merge: 05d1bec1f 5711e0c7d
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:25 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02 am: 5711e0c7d2

    Change-Id: I529a523e300a88ebc88e37ebeb53a00cd0275872

commit 5711e0c7d2bbc6a09b6cdb18605a1c88a4e9a291
Merge: 9b5d5d42a 0849546c0
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:22 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40 am: 0849546c02

    Change-Id: I48680fbb3425ac46b276c15675cef1f0af9cad90

commit 0849546c026759cbccf76f14ebde62e201ed2e8b
Merge: 453054938 12860b6d4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:20 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76 am: 12860b6d40

    Change-Id: I9f2e6e495a1af2d31fe6b32feff78dc20d88b4d0

commit 12860b6d409b275159dec84ab87a0ad37b94307d
Merge: 228712652 d5ef3c9e7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:17:18 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06 skipped: d5ef3c9e76

    Change-Id: I88b6879652a667ace51c8e304eeeb0f394493b58

commit d5ef3c9e760d6487d31d72d0d477127024b74e97
Merge: 99c9a4b57 98366e0b0
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:16:03 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd am: 98366e0b06

    Change-Id: Iebe8378ad968c488cbc4b88a986566d40c4bae07

commit 98366e0b0628725392ab5b31c0d6c7e7f45beea2
Merge: 3fa5897ee 497f11b0f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:16:01 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f am: 497f11b0fd

    Change-Id: Ia9dfcc76e8a3a464d1d000e59c998d7958119e83

commit 497f11b0fdf582654759834a641d1599bad17645
Merge: 78d473b76 3a0aab555
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 09:15:58 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 3a0aab555f

    Change-Id: If6a5bdde9eee5540844938956063199c9e640da3

commit 3a0aab555f650ac46b33e4b0f0918dd34785474b
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jun 21 22:56:11 2018 -0700

    Add packet length checks in l2cble_process_sig_cmd

    Bug: 80261585
    Test: compilation
    Change-Id: Icf55747dc948bcce140a12658237554938e2d717
    Merged-In: Icf55747dc948bcce140a12658237554938e2d717

commit a69fbd8deb0f6ba27167c44eb0c3534a29630124
Merge: f32a969ec 67d1e89fc
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:14:31 2018 -0700

    [automerger skipped] Merge changes from topic "am-0faa2c83-9779-430a-b81c-34246f31544a" into oc-dev am: 128001f32c  -s ours
    am: 67d1e89fc6  -s ours

    Change-Id: Ia23f6c04a1d10ab49234b485518048b1d0767eec

commit 67d1e89fc62dc4095545f603b9fee1eb378631ee
Merge: 3756c5aa7 128001f32
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 02:10:28 2018 -0700

    [automerger skipped] Merge changes from topic "am-0faa2c83-9779-430a-b81c-34246f31544a" into oc-dev
    am: 128001f32c  -s ours

    Change-Id: Ife565af8784c81d713186375b4eae708a42298e7

commit 128001f32c450dc243888b5be2bc73c9756dbd1f
Merge: dffb75f19 8d9c01ba9
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 09:02:19 2018 +0000

    Merge changes from topic "am-0faa2c83-9779-430a-b81c-34246f31544a" into oc-dev

    * changes:
      [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9 am: 05d1bec1f5 skipped: 20da1f749e
      [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9 am: 05d1bec1f5
      [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9
      [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386
      [automerger] Don't use Address after it was deleted am: 228712652a
      Don't use Address after it was deleted

commit ae516b35a718b60d26e90060025ce1676b1f7eee
Merge: c6beae055 f32a969ec
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:30:17 2018 -0700

    [automerger skipped] Merge "Fix out of bounds read in l2c_rcv_acl_data" into oc-dev am: dffb75f19c am: 3756c5aa7e
    am: f32a969ecf  -s ours

    Change-Id: I48ff3b074c9f81bc08e82eeb5d24b1a51016855a

commit c6beae05535786661e9f9c1193ac3ea1805cfcea
Merge: 5751a4a2f 7abcd322c
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:29:45 2018 -0700

    [automerger skipped] Merge "Don't use Address after it was deleted" into oc-dev am: 28fcaa1b86  -s ours am: 2d028b47a1  -s ours
    am: 7abcd322c5  -s ours

    Change-Id: Ib40a61baa9c8a5770ea03fc4784beb3c509e5e4b

commit f32a969ecfba88d308fc5b48166f3212109013ee
Merge: 7abcd322c 3756c5aa7
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:25:06 2018 -0700

    Merge "Fix out of bounds read in l2c_rcv_acl_data" into oc-dev am: dffb75f19c
    am: 3756c5aa7e

    Change-Id: I127e333244e25e8f3bfe9517fce9d65a9af8c3cf

commit 7abcd322c561ff7e125ba94589a79a620e6c5429
Merge: 095ee1c9a 2d028b47a
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:24:40 2018 -0700

    [automerger skipped] Merge "Don't use Address after it was deleted" into oc-dev am: 28fcaa1b86  -s ours
    am: 2d028b47a1  -s ours

    Change-Id: I076b32ad9ed9013923817163a33ac492962efef3

commit 3756c5aa7e3a53c78bb95c9d636bf6a040a6a010
Merge: 2d028b47a dffb75f19
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:19:10 2018 -0700

    Merge "Fix out of bounds read in l2c_rcv_acl_data" into oc-dev
    am: dffb75f19c

    Change-Id: I4e712aaf2bd8b278f6a7a179d62dc9dd43a63b02

commit 2d028b47a1a6857076c5b304ea592c06f0753a78
Merge: 7a5283878 28fcaa1b8
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:18:38 2018 -0700

    [automerger skipped] Merge "Don't use Address after it was deleted" into oc-dev
    am: 28fcaa1b86  -s ours

    Change-Id: I694cbab464170d643cba6f8f6b7ff72e95ca2dd7

commit 5751a4a2fd89ff764e2d6e1828118f287d06e4ad
Merge: 1ec22d2ed 095ee1c9a
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:06:45 2018 -0700

    [automerger skipped] Merge "BLE: Don't access freed buffer in log message" into oc-dev am: 7ff736d81e am: 7a5283878f  -s ours
    am: 095ee1c9ad  -s ours

    Change-Id: Ib469df8fc27d959054821e63df88811da99ef11c

commit a44a52db70d740a80dd6641ce37d1e69f25c04ed
Merge: dffb75f19 3b7da00cb
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 07:04:53 2018 +0000

    [automerger] DO NOT MERGE Build fix for cw-f-dev branch am: 4842682057 skipped: 3b7da00cbd

    Change-Id: Ieadbff966f81983412fa9fa22a4fa9d7ac83f870

commit 3b7da00cbdc3d459afd735bf61c7d6e838bbaaa9
Merge: 1703d7ed2 484268205
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 07:04:50 2018 +0000

    [automerger] DO NOT MERGE Build fix for cw-f-dev branch am: 4842682057

    Change-Id: I88132fa1372be353122839d83069869e9232afd4

commit 48426820579492f32e79b23108f8d252ed2570dc
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 23:48:11 2018 -0700

    DO NOT MERGE Build fix for cw-f-dev branch

    Change-Id: I04cc8ccd4d53cefa204755bbcd264fd28f5d7591

commit 095ee1c9ada72913b1245fb4453ca3d69a646729
Merge: 81f8c5b46 7a5283878
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 00:03:12 2018 -0700

    [automerger skipped] Merge "BLE: Don't access freed buffer in log message" into oc-dev am: 7ff736d81e
    am: 7a5283878f  -s ours

    Change-Id: I3173dfdb3cf7b441ddb65654734de2750b9b59e2

commit dffb75f19c6151d8d619450b4077842ccebd076b
Merge: 28fcaa1b8 a23e0d0a0
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 07:01:05 2018 +0000

    Merge "Fix out of bounds read in l2c_rcv_acl_data" into oc-dev

commit 8d9c01ba975443a5a4bf75554f94af3c78f930ef
Merge: 28fcaa1b8 20da1f749
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:58:49 2018 +0000

    [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9 am: 05d1bec1f5 skipped: 20da1f749e

    Change-Id: I30a6041066630d884da6628b9762cfdfedc119b8

commit 20da1f749e7879eee3b11e3198f89730ac57753a
Merge: 1703d7ed2 05d1bec1f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:58:21 2018 +0000

    [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9 am: 05d1bec1f5

    Change-Id: I9aa11ef1a622f29e976aa2217d4ac91a508065e8

commit 05d1bec1f59e9f7efed27630dbbc0f95ef0d9897
Merge: 5f29768b7 9b5d5d42a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:58:19 2018 +0000

    [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386 am: 9b5d5d42a9

    Change-Id: Iddf2d0d17974a58e44aa52035a48f336ac4a9f46

commit 9b5d5d42a91d762cdb23d4ec681daf98004e764e
Merge: 24255e38b 453054938
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:58:15 2018 +0000

    [automerger] Don't use Address after it was deleted am: 228712652a am: 4530549386

    Change-Id: I29002bb4e25f3c026c144f03db577fbdf7ebddf4

commit 4530549386f99dd0795028d539d488b0acebf2ff
Merge: 5af2cd518 228712652
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 06:58:12 2018 +0000

    [automerger] Don't use Address after it was deleted am: 228712652a

    Change-Id: Iecd6906bc9eb7ca9376a5094377e25e41bf2dd67

commit 228712652abbd605023849f60d603e96c6948816
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 02:57:07 2018 -0700

    Don't use Address after it was deleted

    Bug: 110216173
    Change-Id: Id3364cf53153eafed478546d7347ed1673217e91
    Merged-In: Id3364cf53153eafed478546d7347ed1673217e91

commit 7a5283878fc8e6a2c6ca3b26abfe58bfd5690bcd
Merge: a8fef9b05 7ff736d81
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 23:57:45 2018 -0700

    Merge "BLE: Don't access freed buffer in log message" into oc-dev
    am: 7ff736d81e

    Change-Id: I024b9dea0a7a6137410910f35e296b8cbec0a17e

commit 28fcaa1b867b6c309682df52ada91218585724f6
Merge: 7ff736d81 629cc9773
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Fri Jul 13 06:46:34 2018 +0000

    Merge "Don't use Address after it was deleted" into oc-dev

commit 7ff736d81e815f9d6bf6cb355a3681f47319466a
Merge: 62d297d23 b351278b9
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jul 13 06:44:12 2018 +0000

    Merge "BLE: Don't access freed buffer in log message" into oc-dev

commit 1ec22d2ede7bd9347e01370adde0c4b467f3891a
Merge: d46b92765 81f8c5b46
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 23:12:15 2018 -0700

    [automerger skipped] [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5 am: 5f29768b74 skipped: 1703d7ed24 am: 62d297d230  -s ours am: a8fef9b05a  -s ours
    am: 81f8c5b46a  -s ours

    Change-Id: I238dc41b152f0c99621398469a368d241205f8f2

commit 81f8c5b46aef5757317e668160f7a0d05b1dce24
Merge: 5691cf921 a8fef9b05
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 23:08:13 2018 -0700

    [automerger skipped] [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5 am: 5f29768b74 skipped: 1703d7ed24 am: 62d297d230  -s ours
    am: a8fef9b05a  -s ours

    Change-Id: I3fbb25fa40fe978b23f8e299ff046cdf87edb05d

commit a8fef9b05a7a8f49dc323237848b9bfd042c14bf
Merge: 12f4de2ee 62d297d23
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 23:04:37 2018 -0700

    [automerger skipped] [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5 am: 5f29768b74 skipped: 1703d7ed24
    am: 62d297d230  -s ours

    Change-Id: Ic82c4a595872d8aaf89fcb79d2697529f0d8d522

commit b351278b9203f2375b7210139f3a21c1c17cc138
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Tue Feb 6 18:18:37 2018 +0530

    BLE: Don't access freed buffer in log message

    When GATT fail to write data on L2CAP, buffer is freed by L2CAP.
    Accessing the buffer leads to fatal failure while printing the message info.

    Test: BLE discover services and BT off test cases

    Fixes: 73018520
    Change-Id: I661398fd1321f6e68026b3720db4965fd6584d70
    Merged-In: I661398fd1321f6e68026b3720db4965fd6584d70

commit 629cc9773a9f2948a5a69729b29fd87a8e49539e
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 02:57:07 2018 -0700

    Don't use Address after it was deleted

    Bug: 110216173
    Change-Id: Id3364cf53153eafed478546d7347ed1673217e91
    Merged-In: Id3364cf53153eafed478546d7347ed1673217e91

commit 62d297d230d2f93f2c1c139df4ed4437d8bdc700
Merge: 89cb224e8 1703d7ed2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 04:47:38 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5 am: 5f29768b74 skipped: 1703d7ed24

    Change-Id: I7de9dac1523542bc7e9568f3167a89afd976bf52

commit a23e0d0a0da2347c929d6c9b51c63b8afe526aa5
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 02:57:19 2018 -0700

    Fix out of bounds read in l2c_rcv_acl_data

    Test: none
    Bug: 80432895
    Change-Id: I7807d00c02a84c545476e84bc1b71e0718df1f24
    Merged-In: I7807d00c02a84c545476e84bc1b71e0718df1f24

commit 1703d7ed24cc2b244fc5aea2f38f4561fd8dc286
Merge: 18b32b3bf 5f29768b7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 04:46:42 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5 am: 5f29768b74

    Change-Id: Ie383d28b38e48ab437d52f0f353ca4ac68090905

commit 5f29768b740bbc480ed92a4855cda3760cedf672
Merge: 5b1b862e9 24255e38b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 04:46:39 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182 am: 24255e38b5

    Change-Id: If5bf9b19b73fc89a7e0e0c5bc979075df15576ca

commit 24255e38b559999b12d05db5683fca8bb28197a0
Merge: 2beef20d9 5af2cd518
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 04:46:36 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44 am: 5af2cd5182

    Change-Id: I0878b36f993fd8650c1af39bb3ec86f8ba39721b

commit 5af2cd5182e678c81f1e770175e755add4380225
Merge: 29bc06366 329b7cfb4
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Fri Jul 13 04:46:33 2018 +0000

    [automerger] Add packet length checks in l2cble_process_sig_cmd am: 329b7cfb44

    Change-Id: I978797eaf4d4b72432b1b5c1cd91c6374ff39f6a

commit 329b7cfb446ed34a2b67e31267ff61ce12f1d70c
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jun 21 22:56:11 2018 -0700

    Add packet length checks in l2cble_process_sig_cmd

    Bug: 80261585
    Test: compilation
    Change-Id: Icf55747dc948bcce140a12658237554938e2d717
    Merged-In: Icf55747dc948bcce140a12658237554938e2d717

commit d46b9276500e146f4e20fb8f6d82f825c046c8aa
Merge: 19c844c15 5691cf921
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 21:19:44 2018 -0700

    Merge "HID Host: Check L2CAP packet data length" into oc-dev am: 89cb224e85 am: 12f4de2eef
    am: 5691cf9210

    Change-Id: I9828be04a35383aba40bf447d379e5c9328047bf

commit 19c844c15db5e7b3e98aa5fffd100b9ff02fb465
Merge: 20a4f62b8 bf5915d4f
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 21:19:10 2018 -0700

    Merge "Add bound check for rfc_parse_data" into oc-dev am: 0a5838d047 am: 6e587e5c9b
    am: bf5915d4fe

    Change-Id: I571e6531ff65aaf23629c2204c96f9ac3cc4acd1

commit 20a4f62b897a4ab3b30a232f7751c11d651dd318
Merge: 605aba74f 8d388bffd
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 21:18:47 2018 -0700

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into oc-dev am: c5830db06a am: 953bd8df9b
    am: 8d388bffd3

    Change-Id: I8dc48fc386c29b5fabdb339a70056cef541d1e5b

commit 605aba74fb6b35f7e719f3f22004dbbbed3ec424
Merge: c9add8385 26ad0f649
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 21:18:17 2018 -0700

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into oc-dev am: 91aa6dd927 am: 2291879cbf
    am: 26ad0f6493

    Change-Id: Ieb6c195e14f1359af1afe88bed0e7f28532fc8c6

commit c9add83857a5df60860b698efbf90020682b1b99
Merge: 87d588b7f 88cca4d5e
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 20:59:39 2018 -0700

    Merge changes from topic "am-849ff548-1de9-4e50-a013-4d02bb85a1d2" into oc-dev am: 15b3c81008 am: 08374e2cc6
    am: 88cca4d5e0

    Change-Id: I87fe47071e4014c3025310baa137501a190f2ff4

commit 87d588b7fdd92daa81b5e1568ce9f9565875f8a4
Merge: b64c0e047 00e4ac12e
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 20:57:59 2018 -0700

    [automerger skipped] Merge "DO NOT MERGE Fix OOB read in process_l2cap_cmd" into oc-dev am: f867aa6b14 am: 539f871a6a
    am: 00e4ac12ed  -s ours

    Change-Id: I647c38554500c476b083ff669d9140390c8185af

commit 5691cf921099700388ecf50c10c72988eb13a971
Merge: bf5915d4f 12f4de2ee
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:37:36 2018 -0700

    Merge "HID Host: Check L2CAP packet data length" into oc-dev am: 89cb224e85
    am: 12f4de2eef

    Change-Id: I8a85b900e7c8317b49cf0197d8bd5b5052380b34

commit bf5915d4fe8c241c5f3e0f5d642d8b9953a4dc97
Merge: 8d388bffd 6e587e5c9
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:37:14 2018 -0700

    Merge "Add bound check for rfc_parse_data" into oc-dev am: 0a5838d047
    am: 6e587e5c9b

    Change-Id: Ib22851ee7c8e68ec43c14b640c58b286f08f16bd

commit 8d388bffd3539ccd57038ce84917bdd58533a684
Merge: 26ad0f649 953bd8df9
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:36:51 2018 -0700

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into oc-dev am: c5830db06a
    am: 953bd8df9b

    Change-Id: I32011dd85bcde1c550058eacd1bb8649a6c2b3c1

commit 26ad0f6493b8c2ca8a260720aafae9239ca0e1c0
Merge: 88cca4d5e 2291879cb
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:36:17 2018 -0700

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into oc-dev am: 91aa6dd927
    am: 2291879cbf

    Change-Id: Ic36e1cb7841cf5770ef7b524c35b0bb3b7266c40

commit 88cca4d5e0749e9041041aa4a76ff00611541112
Merge: 00e4ac12e 08374e2cc
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:35:43 2018 -0700

    Merge changes from topic "am-849ff548-1de9-4e50-a013-4d02bb85a1d2" into oc-dev am: 15b3c81008
    am: 08374e2cc6

    Change-Id: Ifd0e87e2a6e104f0c7da974662990a73b3b806b5

commit 00e4ac12edca7495e113798017064ead6fac18b4
Merge: f05dc5871 539f871a6
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 18:35:07 2018 -0700

    Merge "DO NOT MERGE Fix OOB read in process_l2cap_cmd" into oc-dev am: f867aa6b14
    am: 539f871a6a

    Change-Id: Iaccd79bedcb973757fe04daba941074df0ff1bc7

commit 12f4de2eef3dc580b45ef13d2ae72eb6df9a03f4
Merge: 6e587e5c9 89cb224e8
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 17:31:23 2018 -0700

    Merge "HID Host: Check L2CAP packet data length" into oc-dev
    am: 89cb224e85

    Change-Id: I7933dec63587b3a9b97db9754216e6de86c01ea6

commit 6e587e5c9beefe9232a1cf53979abee8f20818d0
Merge: 953bd8df9 0a5838d04
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 17:29:57 2018 -0700

    Merge "Add bound check for rfc_parse_data" into oc-dev
    am: 0a5838d047

    Change-Id: Ie179b9e57a8aa42251cab8ed0dcf5ef91fe1a244

commit 89cb224e85016626cdaec681f8c8d176d067a07a
Merge: 0a5838d04 ca47a05ac
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 23:46:02 2018 +0000

    Merge "HID Host: Check L2CAP packet data length" into oc-dev

commit 0a5838d0471f20e39fa37806487e0e8d58f2370f
Merge: c5830db06 6039cb722
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 23:44:27 2018 +0000

    Merge "Add bound check for rfc_parse_data" into oc-dev

commit 953bd8df9b90a15d4cf98298d891fa5ccaee322e
Merge: 2291879cb c5830db06
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 16:31:02 2018 -0700

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into oc-dev
    am: c5830db06a

    Change-Id: I9c42d24c941977bf803df7c1411622c1a921c7fa

commit 2291879cbf72e8bcd11e1b30fb8f772573123b11
Merge: 08374e2cc 91aa6dd92
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 16:30:22 2018 -0700

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into oc-dev
    am: 91aa6dd927

    Change-Id: I34949e1ee58489ac2c690f023672a749bdcb2698

commit 08374e2cc6151ef42b738e90220bd41c30ce07fe
Merge: 539f871a6 15b3c8100
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 16:29:34 2018 -0700

    Merge changes from topic "am-849ff548-1de9-4e50-a013-4d02bb85a1d2" into oc-dev
    am: 15b3c81008

    Change-Id: I692f9c4d27a6f3d2594828b96928e3f50bb1d111

commit 539f871a6a4e6c41684e6ab57e6e764d2086925d
Merge: 18519969e f867aa6b1
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 16:28:48 2018 -0700

    Merge "DO NOT MERGE Fix OOB read in process_l2cap_cmd" into oc-dev
    am: f867aa6b14

    Change-Id: I79868f8b17f4fed7294bc6064f082f8f93b2d272

commit b64c0e047d0b276cc3793a33c843405594be1850
Merge: b48b20670 f05dc5871
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Thu Jul 12 16:12:39 2018 -0700

    [automerger skipped] BLE: Don't access freed buffer in log message
    am: f05dc58714  -s ours

    Change-Id: I1a9bf5afb246b292bc0b260770a040b8004b2ed2

commit b48b20670de8a5403fc8e1c9389145ca4e5705c2
Merge: 4fe38a5c3 a27876d95
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 15:34:27 2018 -0700

    Merge "Add packet length checks in l2cble_process_sig_cmd" into oc-dev am: b20fe49eda am: 18519969e6
    am: a27876d956

    Change-Id: I305b7e5d2428d55adc82fdbd34dfc67460b8e3d5

commit 18b32b3bf6af25e5fd93a72d63c43079734c200b
Merge: 1050dfca7 668d01896
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8 am: 601d0100e1
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 5b1b862e9eaa92b50216424d8d2a075bd16c0eb1
Merge: 64b30a7ba 601d0100e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into cw-f-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 2beef20d933b536ae2a8f79a7c5a7550b5250271
Merge: b72f40169 5866f8bfd
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into nyc-mr1-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 29bc0636620a75a71c9eb84ac0696a53f0b413aa
Merge: 9d9c0fdc1 ece21d257
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into nyc-dr1-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit bdb5135092736e980dbb6c2f9893f1d1840055ff
Merge: c878a2703 4344cfb76
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge "DO NOT MERGE HID Host: Check L2CAP packet data length" into nyc-dev

commit c5830db06a148b53f9c0329580e645d93093fd7e
Merge: 91aa6dd92 63b4582ac
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:28:54 2018 +0000

    Merge changes from topic "am-3e56facc-2987-45a7-902e-643b62b0dad3" into oc-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8 am: 601d0100e1 skipped: 668d018967
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8 am: 601d0100e1
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 4fe38a5c323b812cb8e042dc3cab3233d26a0169
Merge: 633d8726b 5850c0879
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 22:20:02 2018 +0000

    Merge "Fix out of bounds read in l2c_rcv_acl_data" into pi-dev

commit 99c9a4b573fe913cc91d963f2121ba825e5dd6c7
Merge: 05ba05199 a8668154b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into mnc-dr1.5-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 3fa5897ee30f0d3e73d684163f995c748b5f581b
Merge: 1c4f9c962 56c5b8f06
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into cw-e-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 78d473b764ef71a93fbe6df3164375b45a615aea
Merge: 67c78b25c 7d941ad3a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into mnc-dr-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 041649e0436005e7d2f6a0f106ed8d9925051c85
Merge: 3565eaf72 2da73209f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge "DO NOT MERGE HID Host: Check L2CAP packet data length" into mnc-dev

commit 91aa6dd9273ece9b73dce0db969969982030e9fe
Merge: 15b3c8100 1fa652c36
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into oc-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a am: 6b3dd6bb73 skipped: 24328f30a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a am: 6b3dd6bb73
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 1050dfca7c0744cd0fa7b7febfeaa7528339af3c
Merge: f4cfe4802 24328f30a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a am: 6b3dd6bb73
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 64b30a7ba9fafed9fc5f49a0cfff2b81ab02473a
Merge: 898cf0616 6b3dd6bb7
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into cw-f-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit b72f40169d2d27bbb5a6351feeb3d8157acd63e7
Merge: 9c82c5a58 cb4a2ef45
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into nyc-mr1-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit 9d9c0fdc1f082355aeb3d39cc414fe126dfd80e7
Merge: 09a872112 549ece211
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into nyc-dr1-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit c878a27036c4737285c69073b5bec953032971a2
Merge: 3a9f08a1a f2648df34
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 22:17:26 2018 +0000

    Merge changes from topic "am-de483eec-fa20-48e1-8e14-9d6660359644" into nyc-dev

    * changes:
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2
      [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2
      DO NOT MERGE HID Host: Check L2CAP packet data length

commit f05dc587146ff809e9180f4907c8cab7e87449cb
Author: Nitin Shivpure <nshivpur@codeaurora.org>
Date:   Tue Feb 6 18:18:37 2018 +0530

    BLE: Don't access freed buffer in log message

    When GATT fail to write data on L2CAP, buffer is freed by L2CAP.
    Accessing the buffer leads to fatal failure while printing the message info.

    Test: BLE discover services and BT off test cases

    Fixes: 73018520
    Change-Id: I661398fd1321f6e68026b3720db4965fd6584d70
    Merged-In: I661398fd1321f6e68026b3720db4965fd6584d70

commit 15b3c81008348ac46c5fc3796f85f30935f0379d
Merge: f867aa6b1 fd15ace4f
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 21:10:42 2018 +0000

    Merge changes from topic "am-849ff548-1de9-4e50-a013-4d02bb85a1d2" into oc-dev

    * changes:
      [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589 am: 898cf06169 skipped: f4cfe48029
      [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589 am: 898cf06169
      [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589
      [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127
      [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27
      DO NOT MERGE Fix OOB read in process_l2cap_cmd

commit 3a9f08a1a0078959641c91a2ca61bd3ef582232c
Merge: 612ba99b0 55afdafb2
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 21:10:42 2018 +0000

    Merge "DO NOT MERGE Fix OOB read in process_l2cap_cmd" into nyc-dev

commit f867aa6b14588a956b8f4d36f761a23ad98c6a72
Merge: b20fe49ed 54c6a9dfd
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 21:10:21 2018 +0000

    Merge "DO NOT MERGE Fix OOB read in process_l2cap_cmd" into oc-dev

commit 633d8726b78d081ae5841cb6cd45cc646d37d5dc
Merge: 278151661 5bb66307b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 21:10:02 2018 +0000

    Merge "Fix OOB read in process_l2cap_cmd" into pi-dev

commit a27876d956f919d84aeb22bfece606673ae23a6e
Merge: e4b316e18 18519969e
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 13:53:46 2018 -0700

    Merge "Add packet length checks in l2cble_process_sig_cmd" into oc-dev am: b20fe49eda
    am: 18519969e6

    Change-Id: I7c5e86edf816862b61974c50f91c184afcab51cc

commit 5850c0879a25b3eab02a027a9b06465050fc9039
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 02:57:19 2018 -0700

    Fix out of bounds read in l2c_rcv_acl_data

    Test: none
    Bug: 80432895
    Change-Id: I7807d00c02a84c545476e84bc1b71e0718df1f24

commit 278151661b2677b7a1c4ff800f29a2221f86b014
Merge: 0ee755d9f e4b316e18
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 13:26:03 2018 -0700

    Merge "Don't use Address after it was deleted" into oc-mr1-dev
    am: e4b316e18c

    Change-Id: I0acb68a5b11f5a40e3ba27a504f02561e7be3ede

commit 18519969e6041fca8631462ee0c7d4793fd742e4
Merge: 9600a8ce0 b20fe49ed
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 13:19:37 2018 -0700

    Merge "Add packet length checks in l2cble_process_sig_cmd" into oc-dev
    am: b20fe49eda

    Change-Id: I4fd9e4c93bc35fb27c2ef880a3429bdb57245368

commit b20fe49eda101c24cb3feb315b73e9a32ad60092
Merge: b76242282 02f47a752
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:57:41 2018 +0000

    Merge "Add packet length checks in l2cble_process_sig_cmd" into oc-dev

commit e4b316e18c71f1be26fe3bb40df02980c0e51f45
Merge: 72d86860a 9930f6f4e
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 19:51:18 2018 +0000

    Merge "Don't use Address after it was deleted" into oc-mr1-dev

commit fd15ace4fc3092aee018a707f26815d1d079212a
Merge: b76242282 f4cfe4802
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 18:01:34 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589 am: 898cf06169 skipped: f4cfe48029

    Change-Id: I98ecf9ab16e9c9c24ff7a1781e36a9fadeb42115

commit f4cfe48029aebc0a01144168166f823f368fcc1b
Merge: 529df1e98 898cf0616
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 18:01:32 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589 am: 898cf06169

    Change-Id: I378c40e92e859a4cc56cc9f829548f87ec428229

commit 898cf0616923f7e3cccb65fcf35e70fc9ea33b86
Merge: 038f86e4b 9c82c5a58
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 18:01:30 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127 am: 9c82c5a589

    Change-Id: Id65e168ed91b72a4044597dd31f7e2fde17d9d0b

commit 9c82c5a589394cc274e8bc45118761a922cc7be4
Merge: be55f2997 09a872112
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 18:01:28 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27 am: 09a8721127

    Change-Id: Iafc38d72f8e320249fc81c423b83aa119bcc3a01

commit 09a8721127fb86dbe9b67a070606ad3ae3d58d05
Merge: 0e36165a5 55afdafb2
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 18:01:25 2018 +0000

    [automerger] DO NOT MERGE Fix OOB read in process_l2cap_cmd am: 55afdafb27

    Change-Id: I285fea77251b0f7734969ba989a0d40d26e95bd3

commit 55afdafb272737a54bc629dbe4fdd4111ebb08f5
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 11:00:53 2018 -0700

    DO NOT MERGE Fix OOB read in process_l2cap_cmd

    Test: manual
    Bug: 79488381
    Change-Id: I723866ed40d3647fed99875f659bb95df96a6969

commit 54c6a9dfd52ac6711d6f2101d233b276b2e3bb53
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 10:51:30 2018 -0700

    DO NOT MERGE Fix OOB read in process_l2cap_cmd

    Test: manual
    Bug: 79488381
    Change-Id: I723866ed40d3647fed99875f659bb95df96a6969

commit 5bb66307b555b17d1764e116316ce50c687c9653
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jul 12 10:44:29 2018 -0700

    Fix OOB read in process_l2cap_cmd

    Test: manual
    Bug: 79488381
    Change-Id: I723866ed40d3647fed99875f659bb95df96a6969

commit 0ee755d9fdf4585b2071dc43f08e262c0feaa2a6
Merge: cdba4e6dc 5f54726c9
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jul 12 17:37:49 2018 +0000

    Merge "AVRCP: Reject when CT sends invalid RegisterNotification" into pi-dev

commit 5f54726c90f9541adbadf7692a2a470b56bd28aa
Author: Hansong Zhang <hsz@google.com>
Date:   Tue Jul 10 12:37:58 2018 -0700

    AVRCP: Reject when CT sends invalid RegisterNotification

    Check whether the RegisterNotification request from CT is valid, and
    safely reject invalid request

    Bug: 111260441
    Test: manually test with RIVA WAND speaker and run net_test_avrcp
    Change-Id: Ia2edd94e50fa7cb5b61be54f297adf971060a924
    Merged-In: Ia2edd94e50fa7cb5b61be54f297adf971060a924
    (cherry picked from commit db61e462645d2787d5a05f6fa0d0fe9511523c0f)

commit cdba4e6dcd77870d7f177a31423900d2ad8f7ef8
Merge: a3d3f1292 72d86860a
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 02:24:35 2018 -0700

    [automerger skipped] [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975 am: 038f86e4b2 skipped: 529df1e98d am: b762422828  -s ours am: 9600a8ce06  -s ours
    am: 72d86860ac  -s ours

    Change-Id: Ib93613543c84e381605f6689d0f439731650053f

commit 72d86860ac634f4c8493a05255a5713fc75d030c
Merge: d9273e6d6 9600a8ce0
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 02:20:56 2018 -0700

    [automerger skipped] [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975 am: 038f86e4b2 skipped: 529df1e98d am: b762422828  -s ours
    am: 9600a8ce06  -s ours

    Change-Id: I772f355ae6699136699dff7ebcee574ba4affa92

commit 9600a8ce06c7b5639cc11966ed5a37f179969156
Merge: e5e17f0c1 b76242282
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jul 12 02:18:02 2018 -0700

    [automerger skipped] [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975 am: 038f86e4b2 skipped: 529df1e98d
    am: b762422828  -s ours

    Change-Id: I39b1ceb8ebb02b5a05d7d7a5d086624b9d7a4d1c

commit b762422828378f678c5698545b74d4a82814136e
Merge: 6208c7956 529df1e98
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:42:03 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975 am: 038f86e4b2 skipped: 529df1e98d

    Change-Id: If7e8de188370113ced4bb81c9a31b73eb6669512

commit 529df1e98dfe344292aa5c7c1d0d6ac0dfe631b6
Merge: 2b83b53d1 038f86e4b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:26 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975 am: 038f86e4b2

    Change-Id: I4d8b0fd5c2b026105e169eb35b3e34de72f5b503

commit 038f86e4b21c399c8f455051e85d33386a852d1f
Merge: 74de3ffb1 be55f2997
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:24 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54 am: be55f29975

    Change-Id: Iddf996897230996becbf4f1975fb97b80edbd71a

commit be55f2997594b620e58859182a9d865211e8286d
Merge: 2bddcfa92 0e36165a5
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:21 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05 am: 0e36165a54

    Change-Id: I4aa5b4cd6f852466c6233c9afb51165c06c4616b

commit 0e36165a542aa3db6ed73feffc178b5979c1baa5
Merge: fecf34739 612ba99b0
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:18 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c am: 612ba99b05

    Change-Id: Ie004d032313f29c4124c2a114469886429c4cccd

commit 612ba99b057085aa87f4716ea2779618dbb5d08f
Merge: f1be73b88 05ba05199
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:15 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624 am: 05ba05199c

    Change-Id: I95b70f63b81df6f58b516b83853fc0bbef7eccc8

commit 05ba05199c7ffc7f2bb6291a3d4e2f1347069bf2
Merge: c4d802659 1c4f9c962
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:12 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca am: 1c4f9c9624

    Change-Id: Idb5ac3b18ec180a90eca120754d601c1ba68edbf

commit 1c4f9c9624963e90fe98049c67a4d46abddd7e6c
Merge: 690cc6b25 67c78b25c
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:10 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d am: 67c78b25ca

    Change-Id: I3e68fbd29ce151c4829fe6077d76bc3822915c8f

commit 67c78b25ca7d61b21c77f32ed3496b52acb33719
Merge: 4d0793435 3565eaf72
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jul 12 07:41:07 2018 +0000

    [automerger] SDP: return error on offset bigger than atribute length am: 3565eaf72d

    Change-Id: Ic7b10e46c591edff7f86c06dee6beb8ca8798121

commit 3565eaf72d810688bf91f75002da1f25039996df
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 04:46:39 2018 -0700

    SDP: return error on offset bigger than atribute length

    Test: none
    Bug: 79217770
    Change-Id: I8b594882dd07644b1a747c53d6166db466b7e998
    Merged-In: I8b594882dd07644b1a747c53d6166db466b7e998

commit a3d3f1292d114f6caed6d161f3c6168c5c571bb2
Merge: b2a26da8e d9273e6d6
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 14:42:35 2018 -0700

    [automerger skipped] Merge "HFP: Fix out of bound access in phone number processing" into oc-dev am: 6208c7956b  -s ours am: e5e17f0c15  -s ours
    am: d9273e6d60  -s ours

    Change-Id: I238cd63a04e1cc4fefbb2a0d2d05fd6acbecf4e3

commit d9273e6d605d40a03ab07df90bc52b26fcc5f647
Merge: 3705504f1 e5e17f0c1
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 14:28:57 2018 -0700

    [automerger skipped] Merge "HFP: Fix out of bound access in phone number processing" into oc-dev am: 6208c7956b  -s ours
    am: e5e17f0c15  -s ours

    Change-Id: I5099a757887f9ce0bae4deef4b907633f959607a

commit e5e17f0c15c5acb0cbd6ba12899b41ae1c19ee9a
Merge: ff7a2e259 6208c7956
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 14:16:23 2018 -0700

    [automerger skipped] Merge "HFP: Fix out of bound access in phone number processing" into oc-dev
    am: 6208c7956b  -s ours

    Change-Id: If89074b33649f8956290d26ce9471a36806b9706

commit b2a26da8ea9311cb2f00017f6147ada2803d5b95
Merge: c047368dd 3705504f1
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 14:14:29 2018 -0700

    SDP: return error on offset bigger than atribute length am: 0a74ffa44c am: ff7a2e2592
    am: 3705504f14

    Change-Id: I24311f5a87dbf5dc8e42516ece159013aa241da8

commit 3705504f14b1cb92015a2da0538d5ea21b26bf40
Merge: 554ff6982 ff7a2e259
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 14:06:23 2018 -0700

    SDP: return error on offset bigger than atribute length am: 0a74ffa44c
    am: ff7a2e2592

    Change-Id: Id673cf366e28adbd86943caf52d324e23ac95ad8

commit 6208c7956b68b1535e84e15c33d2fae5d3d7fb91
Merge: 0a74ffa44 820b4327b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 21:02:39 2018 +0000

    Merge "HFP: Fix out of bound access in phone number processing" into oc-dev

commit ff7a2e2592dbd3fb59313587715a7d3af16ad97f
Merge: 0a352983a 0a74ffa44
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 13:56:08 2018 -0700

    SDP: return error on offset bigger than atribute length
    am: 0a74ffa44c

    Change-Id: If4811a2a90eec03ab430420ff830aac96abb1590

commit 0a74ffa44cbe48f674387cc951e6011c28ca003c
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Fri Jun 22 04:46:39 2018 -0700

    SDP: return error on offset bigger than atribute length

    Test: none
    Bug: 79217770
    Change-Id: I8b594882dd07644b1a747c53d6166db466b7e998

commit c047368dd33a320ccbc0f3a566c0ee68f6887a5f
Merge: 76ab61dc2 554ff6982
Author: Jack He <siyuanh@google.com>
Date:   Wed Jul 11 10:53:49 2018 -0700

    [automerger skipped] Merge changes from topic "bt-hfp-fix-phone-number-buffer-underflow-nyc-dev" into oc-dev am: 68f3762633 am: 0a352983a9
    am: 554ff6982b  -s ours

    Change-Id: I35939f88eb27e519438bf2e8a6424e2cd051bda1

commit 554ff6982b82909f9b478994cf051f87102cd882
Merge: fc512cb29 0a352983a
Author: Jack He <siyuanh@google.com>
Date:   Wed Jul 11 10:51:41 2018 -0700

    Merge changes from topic "bt-hfp-fix-phone-number-buffer-underflow-nyc-dev" into oc-dev am: 68f3762633
    am: 0a352983a9

    Change-Id: I0ab90774f01847db0fd45c611ed5a78c51282abb

commit 0a352983a905e8f87ed33019f003bf935cadf0f0
Merge: 91d327b4a 68f376263
Author: Jack He <siyuanh@google.com>
Date:   Wed Jul 11 10:44:52 2018 -0700

    Merge changes from topic "bt-hfp-fix-phone-number-buffer-underflow-nyc-dev" into oc-dev
    am: 68f3762633

    Change-Id: I9a3b92eac44c572db7efc30b937f499808098bd6

commit 76ab61dc2f2e94a838fe30598bb31c27fc7177b7
Merge: 0696a3f4b fc512cb29
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 10:42:32 2018 -0700

    Merge "HIDD: Prevent integer underflow in bta_hd_act" into oc-dev am: 7845f60787 am: 91d327b4af
    am: fc512cb299

    Change-Id: I497e0a98cbd008f5e10ed30f2a9712cd1162b469

commit fc512cb29994313fdba40b2ca6ee2153bb433022
Merge: d2aca7831 91d327b4a
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 10:38:26 2018 -0700

    Merge "HIDD: Prevent integer underflow in bta_hd_act" into oc-dev am: 7845f60787
    am: 91d327b4af

    Change-Id: I8871cc22dd5a5166e3a63c412b1f22039f6ecf84

commit 820b4327b1359fb1b389e07fc0f8c5e1304a7bfa
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 27 14:26:40 2018 -0700

    HFP: Fix out of bound access in phone number processing

    * Write at most sizeof(dialnum) chars into dialnum array in ClccResponse
      method
    * Write at most sizeof(ag_res.str) - 5 chars into ag_res.str array in
      PhoneStateChange method

    Bug: 79431031
    Bug: 79266386
    Test: make call with super long phone numbers
    Change-Id: I98e7687ac4055800aa46626c6b1c866e52e474df
    Merged-In: I98e7687ac4055800aa46626c6b1c866e52e474df

commit f1be73b88bb2bb4a335d044a081ea39bd07500ec
Merge: 606183327 82371c120
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 17:36:21 2018 +0000

    Merge "DO NOT MERGE HFP: Fix out of bound access in phone number processing" into nyc-dev

commit 68f3762633094cb21075386542fd5040ac6dbf77
Merge: 7845f6078 298382552
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 17:36:21 2018 +0000

    Merge changes from topic "bt-hfp-fix-phone-number-buffer-underflow-nyc-dev" into oc-dev

    * changes:
      [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923 am: 74de3ffb10 skipped: 2b83b53d14
      [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923 am: 74de3ffb10
      [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923
      [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394
      [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204
      DO NOT MERGE HFP: Fix out of bound access in phone number processing

commit 0696a3f4b409ca73da3cf538d0923dc4471fc5ca
Merge: 1fb08a860 5c0888d42
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 17:35:50 2018 +0000

    Merge "HFP: Fix out of bound access in phone number processing" into pi-dev

commit 91d327b4af89c990e5ca7d9b0a58f6cf10e91059
Merge: 248fd6200 7845f6078
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jul 11 10:33:27 2018 -0700

    Merge "HIDD: Prevent integer underflow in bta_hd_act" into oc-dev
    am: 7845f60787

    Change-Id: I3a100ebcb66a89ba3092c9bb3c4ff02adee3a59d

commit 7845f607879205d98593830f22ae61511f638b24
Merge: 1d9a58768 74a639287
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jul 11 17:30:33 2018 +0000

    Merge "HIDD: Prevent integer underflow in bta_hd_act" into oc-dev

commit 9930f6f4e14e64966869b119994126283d645fd0
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Wed Jul 11 02:57:07 2018 -0700

    Don't use Address after it was deleted

    Bug: 110216173
    Change-Id: Id3364cf53153eafed478546d7347ed1673217e91

commit 5c0888d42d9aa29dbecd77d3443fa066cdb4e13d
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 27 14:21:40 2018 -0700

    HFP: Fix out of bound access in phone number processing

    * Write at most sizeof(dialnum) chars into dialnum array in ClccResponse
      method
    * Write at most sizeof(ag_res.str) - 5 chars into ag_res.str array in
      PhoneStateChange method

    Bug: 79431031
    Bug: 79266386
    Test: make call with super long phone numbers
    Change-Id: I98e7687ac4055800aa46626c6b1c866e52e474df

commit 1fb08a86068968fd4ed082fa152a7326cd843ac8
Author: Ugo Yu <ugoyu@google.com>
Date:   Mon Jul 9 13:49:44 2018 +0800

    Fix stack not acking status to audio when A2DP start failed

    Add a missing ack in A2DP start failed case when A2DP offload is
    enabled.

    Bug: 111207927
    Test: Manual

    Change-Id: I96a7ad322ea7ce6da5084a48fdd3dec980ce57b8
    (cherry picked from commit 0616cc7ed4cc2c76aa68639ed046f44ae891978f)

commit a3113f13442f48d9c5dc33dedf4416b565dd68fb
Author: Benson Li <bensonli@google.com>
Date:   Mon Jun 25 14:11:20 2018 +0800

    AVRCP: Reject SetAddressedPlayer command only if remote set invalid player ID

    Implement HandleSetAddressedPlayer() to check if remote set valid
    player ID and properly respond to remote.

    Bug: 110632860
    Test: PTS Test AVRCP/TG/MPS/BI-01-C AVRCP/TG/MPS/BV-02-C
    Change-Id: Ice13e7ea97cdac369c4d021171a24bf9d96c9da8
    Merged-In: Ice13e7ea97cdac369c4d021171a24bf9d96c9da8

commit 74a6392875166698b64b624d12b6d2e404b75d72
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 21 16:53:41 2018 -0700

    HIDD: Prevent integer underflow in bta_hd_act

    Bug: 109757435
    Bug: 109757168
    Bug: 110846194
    Bug: 109757986
    Test: manual
    Change-Id: I80a6f3f931ac7512f1ba801cc5d8de6ac04f3422

commit bb8496ae763c3a3a2edb2f7eec13fe41f6090cdf
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Thu Jun 28 20:10:36 2018 -0700

    Don't trigger AVDTP Suspend in response to AVDTP Suspend+Start from remote

    If the remote device sent us AVDTP Suspend, and then AVDTP Start, don't
    trigger AVDTP Suspend from the local device in response to the AVDTP Start.

    Also:
     * Add a call btif_av_stream_start_offload() inside btif_a2dp_on_started()
       if we were started remotely.
     * Fix the order of calling btif_a2dp_on_started() and triggering
       an internal BTIF_AV_SUSPEND_STREAM_REQ_EVT event. Otherwise,
       BTA Suspend might be called before btif_av_stream_start_offload()

    Bug: 110015851
    Bug: 110186160
    Test: Manual
    Change-Id: I908d19f8caf5130b96a64153ff39bd4b52879713
    Merged-In: I908d19f8caf5130b96a64153ff39bd4b52879713
    (cherry picked from commit 7e425cef6df8fc45b1aa54fb5d39d3afeb7bb369)

commit 525e7031abe6a55446fcfe0a643d691b39da0926
Merge: b2f2f53d8 4e2c62c11
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 18:24:36 2018 +0000

    Merge "A2DP Offload: Log audio duration and codec metrics" into pi-dev

commit b2f2f53d837af7af727fad560c092ccad600bdd8
Merge: 30f66021d f2768a032
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 18:24:34 2018 +0000

    Merge "HFP: Don't use mSBC for HF devices not supporting Codec Negotiation" into pi-dev

commit 30f66021db5661831dee7f920e22c7002dffcb8b
Merge: 4ede0e8da adda1ec2a
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 28 18:24:19 2018 +0000

    Merge "Multi-A2DP: Fix timing and codec measurement in metrics" into pi-dev

commit 2983825528a9787f7d09207274267ccdd1ddf482
Merge: 1d9a58768 2b83b53d1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 28 00:11:29 2018 +0000

    [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923 am: 74de3ffb10 skipped: 2b83b53d14

    Change-Id: Ia010cee89c1922b01dd34e439830190561461bbf

commit 2b83b53d140ac063e175985f806cba14f2b7fee1
Merge: 10d45832e 74de3ffb1
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 28 00:11:27 2018 +0000

    [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923 am: 74de3ffb10

    Change-Id: Idb6c305daa5fcded453a2e9f53c0bb6c6cce20a7

commit 74de3ffb10bf1fd8d8aa34655a5895be5f600fd0
Merge: b149002cf 2bddcfa92
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 28 00:11:25 2018 +0000

    [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394 am: 2bddcfa923

    Change-Id: If5bf4635d837d15ab593d96c116489057e212710

commit 2bddcfa9233928021d053b994a13573dde6dd30e
Merge: e7d35076f fecf34739
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 28 00:11:23 2018 +0000

    [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204 am: fecf347394

    Change-Id: I1a6a4a91c9f926af586675cc8f8a290f4e312945

commit fecf34739408895606ebe379d9bc978ec0a1cd28
Merge: 1a7119586 82371c120
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 28 00:11:12 2018 +0000

    [automerger] DO NOT MERGE HFP: Fix out of bound access in phone number processing am: 82371c1204

    Change-Id: Ie6f3408d074604cf89aa9c8dc5f63447fdba8b64

commit 82371c1204cc0b48941ec1d41c516c4b40093879
Author: Jack He <siyuanh@google.com>
Date:   Tue Jun 26 17:53:24 2018 -0700

    DO NOT MERGE HFP: Fix out of bound access in phone number processing

    * Write at most sizeof(dialnum) chars into dialnum array in ClccResponse
      method
    * Write at most sizeof(ag_res.str) - 5 chars into ag_res.str array in
      PhoneStateChange method

    Bug: 79431031
    Bug: 79266386
    Test: make call with super long phone numbers
    Change-Id: I98e7687ac4055800aa46626c6b1c866e52e474df
    Merged-In: I98e7687ac4055800aa46626c6b1c866e52e474df

commit 4ede0e8da3a2d74d564a2caf9b63dfc2a25310ef
Merge: 5d7374c10 d2aca7831
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 27 15:23:07 2018 -0700

    [automerger skipped] DO NOT MERGE AVRC: Copy browse.p_browse_data in btif_av_event_deep_copy am: 1d9a58768e am: 248fd6200b
    am: d2aca78317  -s ours

    Change-Id: I3496b8ea2c661618d27087b94427423faa3ddd51

commit d2aca78317eaae8e16e261e789492763b4fdc4ac
Merge: 20b2bc080 248fd6200
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 27 15:19:49 2018 -0700

    DO NOT MERGE AVRC: Copy browse.p_browse_data in btif_av_event_deep_copy am: 1d9a58768e
    am: 248fd6200b

    Change-Id: I786d844e462ea06f18083f4d47a2f6c786bfc466

commit 248fd6200b02faa3db290d1a7d049103a95bb9e0
Merge: 427aebe54 1d9a58768
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 27 15:16:12 2018 -0700

    DO NOT MERGE AVRC: Copy browse.p_browse_data in btif_av_event_deep_copy
    am: 1d9a58768e

    Change-Id: I7f9ca99de72d0e142210943163a6a3d4b1f61c1d

commit 4e2c62c115bb4f461ef123493e3702ee0e44321a
Author: Jack He <siyuanh@google.com>
Date:   Thu Jun 14 18:04:12 2018 -0700

    A2DP Offload: Log audio duration and codec metrics

    * Add A2dpOffloadAudioStats class to store metrics for A2DP offload
    * Add logging statements to log A2DP start/suspend/stop events when A2DP
      offload is enabled
    * Separate software encoding logging from hardware encoding logging

    Bug: 109953464
    Test: make, run A2DP in offload mode and dump metrics
    Change-Id: I1a19c64c6b1ee530e5927dd3d13e31b00729850b
    Merged-In: I1a19c64c6b1ee530e5927dd3d13e31b00729850b
    (cherry picked from commit dd069366fe69f2a38ef90512e7c5215e3d9d0eb2)

commit adda1ec2aead31198dc21ca03265098a7a286c61
Author: Jack He <siyuanh@google.com>
Date:   Fri Jun 8 20:13:23 2018 -0700

    Multi-A2DP: Fix timing and codec measurement in metrics

    * Copy BtifMediaStats and SchedulingStats when updating metrics
      to avoid race conditions
    * Do not log audio_duration_ms if session_end_us <= session_start_us
    * Clear cached A2DP metrics when LogBluetoothSessionEnd() is called
    * Log codec information along-side A2DP metrics
    * Log whether A2DP offload is enabled along-side A2DP metrics

    Multi-A2DP:
    * Log LogBluetoothSessionStart at btif_a2dp_source_start_session_delayed
    * Log LogBluetoothSessionEnd at btif_a2dp_source_end_session_delayed

    Unit Test:
    * Wrote A2DPSessionTwoUpdatesSeparatedbyEndTest that will fail if A2DP
      metrics are not cleared when LogBluetoothSessionEnd is called

    Bug: 109953464
    Test: make, net_test_osi::BluetoothMetricsLoggerTest,
          net_test_osi::BluetoothA2DPSessionMetricsTest
    Change-Id: I6a311dce8035ce2e3f39773c260ea9eaef73e45b
    Merged-In: I6a311dce8035ce2e3f39773c260ea9eaef73e45b
    (cherry picked from commit feeaf5f8cf31394d6f737543f1d0572ca91d487c)

commit 5d7374c10bc521ee2238a1930c849ec0a8bb1cee
Merge: 14cb1ba6d 1b8eefe23
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Wed Jun 27 21:02:09 2018 +0000

    Merge "Add missing btif_a2dp_audio_interface_end_session() call during disconnect" into pi-dev

commit 14cb1ba6d65ca9033bd5b8dc2f59d8185dd2d27b
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Wed Jun 20 18:28:33 2018 -0700

    If command_timed_out() is triggered don't get blocked by a deadlock

    If command_timed_out() is triggered and we cannot acquire the
    commands_pending_response_mutex to print the debug info, then proceed
    with the rest of the operations until the process aborts.

    Similarly, if startup_timer_expired() is triggered and we are blocked
    by a deadlock, just abort() because there is no way to recover.

    Bug: 110441099
    Test: Code compilation
    Change-Id: I367332bbbd9c1d887bd2bc829b9f617114fc96fc
    Merged-In: I367332bbbd9c1d887bd2bc829b9f617114fc96fc
    (cherry picked from commit 2838b32ce424a6f8c8025175aaf9b6fd8cab313f)

commit 1b8eefe23d91f61acd788071d9aafe4956fb61a4
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Mon Jun 25 16:34:17 2018 -0700

    Add missing btif_a2dp_audio_interface_end_session() call during disconnect

    Update the logic inside btif_a2dp_source_end_session_delayed() to make
    sure that btif_a2dp_audio_interface_end_session() is called when device
    is disconnected.

    Also, update existing log messages to make it easier to identify similar
    issues in the future.

    Bug: 110176990
    Test: Manual: Pair with two headsets, start/suspend/stop/switch active
          device
    Change-Id: I248e5c3e2c4cf0ad820cef34ba859e9adc8dec8e
    Merged-In: I248e5c3e2c4cf0ad820cef34ba859e9adc8dec8e
    (cherry picked from commit f40b85b46c873530f4e6c01c81be8e3b0ff486db)

commit 02f47a752c818277b31852e3ff940764d5c7f9c7
Author: Jakub Pawlowski <jpawlowski@google.com>
Date:   Thu Jun 21 22:56:11 2018 -0700

    Add packet length checks in l2cble_process_sig_cmd

    Bug: 80261585
    Test: compilation
    Change-Id: Icf55747dc948bcce140a12658237554938e2d717

commit 22f8446614341cadb975a6d762c695294c58ffd1
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Tue Jun 19 19:10:43 2018 -0700

    Gracefully handle A2DP hardware offload Audio HAL service death

    Register for Audio HAL service death, and restart the Audio HAL session
    if necessary.

    Bug: 77926419
    Test: Manual: stream Bluetooth audio and kill -9 the audioserver
    Change-Id: I45e83aea0fb95301e6ceadee74661dd55f8c0f66
    Merged-In: I45e83aea0fb95301e6ceadee74661dd55f8c0f66
    (cherry picked from commit 5c80c8653a61780f8047413d5ad9f939a8a397f3)

commit f2768a032f27fbe8b44dae7fb242d472b7cb5964
Author: weichinweng <weichinweng@google.com>
Date:   Thu Jun 21 14:28:25 2018 +0800

    HFP: Don't use mSBC for HF devices not supporting Codec Negotiation

    * Some misbehaving HF devices (e.g. Sony XAV AX100 carkit, Sony MW600)
      indicate their support on WBS but not support on Codec Negotiation.
      In this condition, if Fluoride chooses mSBC will result in big noise or SCO
      no sound.
    * This CL adds a workaround for checking if HF device indicate codec negotiation is
      not supported, Fluoride will assume CVSD codec by default.

    Bug: 101592600
    Test: make, connect SCO and check voice on carkit and headset.
    Change-Id: If0d8779bcfd55b87852f56f0448fd1b585ee45ad
    (cherry picked from commit e4b9dead3c6be05f111fb710f9e4d7c436b65ed4)

commit 00c890f61fb6667cc0553f21bf3be0b3921d9dd5
Author: Pavlin Radoslavov <pavlin@google.com>
Date:   Thu Jun 14 16:27:54 2018 -0700

    Correctly initialize A2DP Sink codecs if A2DP Source HW offload is enabled

    This also fixes unit test failures if A2DP Source HW offload is enabled.

    Bug: 110228602
    Test: Failing unit tests now succeed
    Change-Id: I36678738bfcfcce0f2e8a055f10c86cc6b3e682a
    Merged-In: I36678738bfcfcce0f2e8a055f10c86cc6b3e682a
    (cherry picked from commit af66441fecd1b56c26d5c25866d6fc7677ec0c2a)

commit 796062b73f4977aa1a7b0daaabc6d1cc4a47f41e
Author: cheneyni <cheneyni@google.com>
Date:   Mon Jun 11 21:19:26 2018 +0800

    Clear local suspending flag when the BTA_AV_STOP_EVT event received

    The Stack would set the pending flag when received the Stop request but
    did not clear it even state became Opened.  This would cuase Stack
    replied Suspended immediately to Audio HAL but kept peer at Started
    state and failed to handle Start request again.

    This change clears the local suspending flag when BTA_AV_STOP_EVT
    received and also reset all pending status when becomes Opened so it
    will take effect only when Stack is changing state from Started.

    Bug: 110022304
    Test: Manual: (1) Play A2DP music and switch codec
                  (2) Play A2DP music and change active device

    Change-Id: I4b9aca33eb7eb6c40038e2082d23eb22e5830714
    Merged-In: I4b9aca33eb7eb6c40038e2082d23eb22e5830714
    (cherry picked from commit e643d30249256461fd1c0a132b48c65e2eac18ba)

commit 1d9a58768e6573899c7e80c2b3f52e22f2d8f58b
Author: Hansong Zhang <hsz@google.com>
Date:   Wed Jun 13 17:33:23 2018 -0700

    DO NOT MERGE AVRC: Copy browse.p_browse_data in btif_av_event_deep_copy

    p_msg_src->browse.p_browse_data is not copied, but used after the
    original pointer is freed

    Bug: 109699112
    Test: manual
    Change-Id: I1d014eb9a8911da6913173a9b11218bf1c89e16e

commit ca47a05acb66218ff2123f8d4642961f7f2eb5e2
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 14:25:09 2018 -0700

    HID Host: Check L2CAP packet data length

    Bug: 80493272
    Test: manual
    Change-Id: I8b1acd11616684729752195fabb4fa34c46a508d

commit 6039cb7225733195192b396ad19c528800feb735
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 16:18:52 2018 -0700

    Add bound check for rfc_parse_data

    Bug: 78288018
    Test: manual
    Change-Id: I44349cd22c141483d01bce0f5a2131b727d0feb0

commit 63b4582ac6a3a3a991332bd1b33e06566170b8bb
Merge: 0cda12380 668d01896
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:31 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8 am: 601d0100e1 skipped: 668d018967

    Change-Id: I23f2433c33cb3cba8983b747d0dddc75c8f36b35

commit 668d01896720380cf82a5ba5c4bce65e82fb9072
Merge: 10d45832e 601d0100e
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:29 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8 am: 601d0100e1

    Change-Id: Ia01ca5d72edd9ce5b2d7f4c1167617e071bd561b

commit 601d0100e1369f63bc60db14dea23533cce41fd8
Merge: b149002cf 5866f8bfd
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:27 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579 am: 5866f8bfd8

    Change-Id: I5b5bd8bd129b8c701edd493c05781fe3882d41f9

commit 5866f8bfd8b155c9caa1845a53e1303ee9e504c3
Merge: e7d35076f ece21d257
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:26 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a am: ece21d2579

    Change-Id: I3107e274bb5d0198b62e6cdcb855f40c7cd93c3e

commit ece21d25797f8c019958b6691eb78bf170451a88
Merge: 1a7119586 4344cfb76
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:24 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 4344cfb76a

    Change-Id: Iabccbce010c9c418b63a638c8936cc8616799070

commit 4344cfb76ad4c1c660d00a7b306acccde9bdef77
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 14:18:22 2018 -0700

    DO NOT MERGE HID Host: Check L2CAP packet data length

    Bug: 80493272
    Test: manual
    Change-Id: I8b1acd11616684729752195fabb4fa34c46a508d

commit 1fa652c36686b08ef2360d7bb6a6be547dea69f2
Merge: 0cda12380 24328f30a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:02 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a am: 6b3dd6bb73 skipped: 24328f30a2

    Change-Id: Ida38220c78ad818c56c3612953756103e26f6dda

commit 24328f30a20b4cc8d29f5e30d0c842d97a1c7036
Merge: 10d45832e 6b3dd6bb7
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:28:00 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a am: 6b3dd6bb73

    Change-Id: Iebdc3fb5a6f70d839a74a99cf1e8ebfe4db8685e

commit 6b3dd6bb732ee1f373656e4270a97d2d1f0f0d32
Merge: b149002cf cb4a2ef45
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:58 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e am: cb4a2ef45a

    Change-Id: Ica74756564341daf401b83cea73403b241bfee9b

commit cb4a2ef45ae85a025bc66fa603436dff0fe3c12e
Merge: e7d35076f 549ece211
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:56 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349 am: 549ece211e

    Change-Id: Ib6307c6693628529f49cf313db92a0076b0abe03

commit 549ece211e120b3fda0cf6f0c9b843c780bfb576
Merge: 1a7119586 f2648df34
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:54 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7 am: f2648df349

    Change-Id: Ib7c331322571106ffee638bc2deb2f2392df3a66

commit f2648df349f54526c065511968732c6cfa98ace4
Merge: 606183327 a8668154b
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:51 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060 skipped: a8668154b7

    Change-Id: Ib12a006ee1c5d3ed781e674e2091b7bf8c30036b

commit a8668154b7277086ff079ce1d465f396c9ee460c
Merge: c4d802659 56c5b8f06
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:49 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2 am: 56c5b8f060

    Change-Id: I999dbbc621168887e993159271c59aa526af4d8e

commit 56c5b8f0608bf754a0bd313b96315b7bd664af47
Merge: 690cc6b25 7d941ad3a
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:47 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2 am: 7d941ad3a2

    Change-Id: I98eea999519f71f72df32c82a42ebcaae9aeb95f

commit 7d941ad3a266f59550a0d7e7ffe7eedadd077174
Merge: 4d0793435 2da73209f
Author: Android Build Merger (Role) <noreply-android-build-merger@google.com>
Date:   Thu Jun 7 21:27:45 2018 +0000

    [automerger] DO NOT MERGE HID Host: Check L2CAP packet data length am: 2da73209f2

    Change-Id: I4356335c6ee6b0e3717e22d94ff9e8bb0574e663

commit 2da73209f213a24fe397eabadc914a432fc4edf7
Author: Hansong Zhang <hsz@google.com>
Date:   Thu Jun 7 14:02:30 2018 -0700

    DO NOT MERGE HID Host: Check L2CAP packet data length

    Bug: 80493272
    Test: manual
    Change-Id: I8b1acd11616684729752195fabb4fa34c46a508d

commit 60618332767b9b5a412f00a04e8424e493b84da0
Merge: f294bdbb9 ecef51ee8
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 7 01:53:54 2018 +0000

    Merge "DO NOT MERGE: Don't reuse buffer when building response" into nyc-dev

commit 10d45832ea80e4a5ce381eb0dabb39030b091237
Merge: 66c6a114a 052add83b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 7 01:53:54 2018 +0000

    Merge changes from topic "am-662f3e36-36cc-485d-824b-f28c01eea384" into nyc-mr2-dev

    * changes:
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311 am: 3a9eca8d4c am: 2f532ef9b0
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311 am: 3a9eca8d4c
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f
      DO NOT MERGE: Don't reuse buffer when building response

commit e7d35076fc146a1213b9683e3b8ba57e04631fb9
Merge: ce6884eb3 3a9eca8d4
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 7 01:53:54 2018 +0000

    Merge changes from topic "am-662f3e36-36cc-485d-824b-f28c01eea384" into nyc-mr1-dev

    * changes:
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f
      DO NOT MERGE: Don't reuse buffer when building response

commit 1a71195865dd68ac971661923fbeb475340a5373
Merge: 54ef7ee93 cf7d3de31
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 7 01:53:54 2018 +0000

    Merge changes from topic "am-662f3e36-36cc-485d-824b-f28c01eea384" into nyc-dr1-dev

    * changes:
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f
      DO NOT MERGE: Don't reuse buffer when building response

commit b149002cf8f4de5ba439249736be6f7c33863c91
Merge: 5d335dfb7 2f532ef9b
Author: TreeHugger Robot <treehugger-gerrit@google.com>
Date:   Thu Jun 7 01:53:53 2018 +0000

    Merge changes from topic "am-662f3e36-36cc-485d-824b-f28c01eea384" into cw-f-dev

    * changes:
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311 am: 3a9eca8d4c
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f am: cf7d3de311
      [automerger] DO NOT MERGE: Don't reuse buffer when building response am: ecef51ee8f
      DO NOT MERGE: Don't reuse buffer when building response

Change-Id: I3d94d1730fb53449b41af4f6be39aaf416dc9d07
---
 bta/ag/bta_ag_sco.cc                          |   6 +
 bta/hd/bta_hd_api.cc                          |   5 +
 btif/Android.bp                               |   3 +
 btif/src/btif_a2dp.cc                         |  11 +-
 btif/src/btif_a2dp_audio_interface.cc         | 147 +++++++++++++-
 btif/src/btif_a2dp_source.cc                  | 183 +++++++++++------
 btif/src/btif_av.cc                           |  17 +-
 btif/src/btif_dm.cc                           |  13 +-
 btif/src/btif_hd.cc                           |  24 ++-
 btif/src/btif_hf.cc                           |   4 +-
 hci/src/hci_layer.cc                          |  57 ++++--
 osi/include/metrics.h                         |   2 +
 osi/src/metrics.cc                            |  34 +++-
 osi/test/metrics_test.cc                      | 131 +++++++++++-
 packet/tests/avrcp/avrcp_test_packets.h       |  10 +-
 .../avrcp/set_addressed_player_packet_test.cc |   4 +-
 profile/avrcp/Android.bp                      |   4 +-
 profile/avrcp/device.cc                       |  32 ++-
 profile/avrcp/device.h                        |   5 +
 profile/avrcp/tests/avrcp_device_test.cc      |  35 +++-
 proto/bluetooth/metrics/bluetooth.proto       |  15 ++
 stack/a2dp/a2dp_codec_config.cc               |   4 +-
 stack/avrc/avrc_pars_ct.cc                    | 187 ++++++++++++++++--
 stack/btm/btm_ble_adv_filter.cc               |   2 +-
 stack/l2cap/l2c_main.cc                       |   3 -
 25 files changed, 799 insertions(+), 139 deletions(-)

diff --git a/bta/ag/bta_ag_sco.cc b/bta/ag/bta_ag_sco.cc
index 083108b35..94825ea4c 100644
--- a/bta/ag/bta_ag_sco.cc
+++ b/bta/ag/bta_ag_sco.cc
@@ -370,6 +370,12 @@ static void bta_ag_create_sco(tBTA_AG_SCB* p_scb, bool is_orig) {
   if (!bta_ag_sco_is_active_device(p_scb->peer_addr)) {
     LOG(WARNING) << __func__ << ": device " << p_scb->peer_addr
                  << " is not active, active_device=" << active_device_addr;
+    if (bta_ag_cb.sco.p_curr_scb != nullptr &&
+        bta_ag_cb.sco.p_curr_scb->in_use && p_scb == bta_ag_cb.sco.p_curr_scb) {
+      do_in_bta_thread(
+          FROM_HERE, base::Bind(&bta_ag_sm_execute, p_scb, BTA_AG_SCO_CLOSE_EVT,
+                                tBTA_AG_DATA::kEmpty));
+    }
     return;
   }
   /* Make sure this SCO handle is not already in use */
diff --git a/bta/hd/bta_hd_api.cc b/bta/hd/bta_hd_api.cc
index 54597475f..40963cce2 100644
--- a/bta/hd/bta_hd_api.cc
+++ b/bta/hd/bta_hd_api.cc
@@ -27,6 +27,7 @@
 
 #if defined(BTA_HD_INCLUDED) && (BTA_HD_INCLUDED == TRUE)
 
+#include <log/log.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -124,6 +125,10 @@ extern void BTA_HdRegisterApp(tBTA_HD_APP_INFO* p_app_info,
 
   p_buf->subclass = p_app_info->subclass;
 
+  if (p_app_info->descriptor.dl_len > BTA_HD_APP_DESCRIPTOR_LEN) {
+    p_app_info->descriptor.dl_len = BTA_HD_APP_DESCRIPTOR_LEN;
+    android_errorWriteLog(0x534e4554, "113111784");
+  }
   p_buf->d_len = p_app_info->descriptor.dl_len;
   memcpy(p_buf->d_data, p_app_info->descriptor.dsc_list,
          p_app_info->descriptor.dl_len);
diff --git a/btif/Android.bp b/btif/Android.bp
index f9177a7dd..4b2dc3005 100644
--- a/btif/Android.bp
+++ b/btif/Android.bp
@@ -121,6 +121,7 @@ cc_test {
     header_libs: ["libbluetooth_headers"],
     shared_libs: [
         "libaudioclient",
+        "android.hardware.bluetooth.a2dp@1.0",
         "libhidlbase",
         "liblog",
         "libprotobuf-cpp-lite",
@@ -132,7 +133,9 @@ cc_test {
         "libbtcore",
         "libbt-stack",
         "libbt-sbc-encoder",
+        "libbt-utils",
         "libFraunhoferAAC",
+        "libg722codec",
         "libbtdevice",
         "libbt-hci",
         "libudrv-uipc",
diff --git a/btif/src/btif_a2dp.cc b/btif/src/btif_a2dp.cc
index 7bb79eb81..86485d4fc 100644
--- a/btif/src/btif_a2dp.cc
+++ b/btif/src/btif_a2dp.cc
@@ -88,6 +88,11 @@ bool btif_a2dp_on_started(const RawAddress& peer_addr,
           }
           ack = true;
         }
+      } else {
+        // We were started remotely
+        if (btif_av_is_a2dp_offload_enabled()) {
+          btif_av_stream_start_offload();
+        }
       }
 
       /* media task is autostarted upon a2dp audiopath connection */
@@ -95,7 +100,11 @@ bool btif_a2dp_on_started(const RawAddress& peer_addr,
   } else if (pending_start) {
     LOG_ERROR(LOG_TAG, "%s: peer %s A2DP start request failed: status = %d",
               __func__, peer_addr.ToString().c_str(), p_av_start->status);
-    btif_a2dp_command_ack(A2DP_CTRL_ACK_FAILURE);
+    if (btif_av_is_a2dp_offload_enabled()) {
+      btif_a2dp_audio_on_started(p_av_start->status);
+    } else {
+      btif_a2dp_command_ack(A2DP_CTRL_ACK_FAILURE);
+    }
     ack = true;
   }
   return ack;
diff --git a/btif/src/btif_a2dp_audio_interface.cc b/btif/src/btif_a2dp_audio_interface.cc
index 56adb9bfb..7343bbe0a 100644
--- a/btif/src/btif_a2dp_audio_interface.cc
+++ b/btif/src/btif_a2dp_audio_interface.cc
@@ -19,6 +19,9 @@
 #define LOG_TAG "btif_a2dp_audio_interface"
 
 #include "btif_a2dp_audio_interface.h"
+
+#include <mutex>
+
 #include <a2dp_vendor.h>
 #include <a2dp_vendor_ldac_constants.h>
 #include <android/hardware/bluetooth/a2dp/1.0/IBluetoothAudioHost.h>
@@ -37,8 +40,12 @@
 #include "btif_av.h"
 #include "btif_av_co.h"
 #include "btif_hf.h"
+#include "osi/include/metrics.h"
 #include "osi/include/osi.h"
 
+using system_bt_osi::A2dpSessionMetrics;
+using system_bt_osi::BluetoothMetricsLogger;
+
 using android::hardware::bluetooth::a2dp::V1_0::IBluetoothAudioOffload;
 using android::hardware::bluetooth::a2dp::V1_0::IBluetoothAudioHost;
 using android::hardware::bluetooth::a2dp::V1_0::Status;
@@ -50,8 +57,10 @@ using android::hardware::bluetooth::a2dp::V1_0::ChannelMode;
 using android::hardware::ProcessState;
 using ::android::hardware::Return;
 using ::android::hardware::Void;
+using ::android::hardware::hidl_death_recipient;
 using ::android::hardware::hidl_vec;
 using ::android::sp;
+using ::android::wp;
 android::sp<IBluetoothAudioOffload> btAudio;
 
 #define CASE_RETURN_STR(const) \
@@ -63,11 +72,67 @@ uint8_t btif_a2dp_audio_process_request(uint8_t cmd);
 
 static void btif_a2dp_audio_send_start_req();
 static void btif_a2dp_audio_send_suspend_req();
+static void btif_a2dp_audio_send_stop_req();
 static void btif_a2dp_audio_interface_init();
 static void btif_a2dp_audio_interface_deinit();
+static void btif_a2dp_audio_interface_restart_session();
 // Delay reporting
 // static void btif_a2dp_audio_send_sink_latency();
 
+class A2dpOffloadAudioStats {
+ public:
+  A2dpOffloadAudioStats() { Reset(); }
+  void Reset() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    ResetPreserveSession();
+    codec_index_ = -1;
+  }
+  void ResetPreserveSession() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    audio_start_time_ms_ = -1;
+    audio_stop_time_ms_ = -1;
+  }
+  void StoreMetrics() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    if (audio_start_time_ms_ < 0 || audio_stop_time_ms_ < 0) {
+      return;
+    }
+    A2dpSessionMetrics metrics;
+    metrics.codec_index = codec_index_;
+    metrics.is_a2dp_offload = true;
+    if (audio_stop_time_ms_ > audio_start_time_ms_) {
+      metrics.audio_duration_ms = audio_stop_time_ms_ - audio_start_time_ms_;
+    }
+    BluetoothMetricsLogger::GetInstance()->LogA2dpSession(metrics);
+  }
+  void LogAudioStart() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    audio_start_time_ms_ = time_get_os_boottime_ms();
+  }
+  void LogAudioStop() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    audio_stop_time_ms_ = time_get_os_boottime_ms();
+  }
+  void LogAudioStopMetricsAndReset() {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    LogAudioStop();
+    StoreMetrics();
+    ResetPreserveSession();
+  }
+  void SetCodecIndex(int64_t codec_index) {
+    std::lock_guard<std::recursive_mutex> lock(lock_);
+    codec_index_ = codec_index;
+  }
+
+ private:
+  std::recursive_mutex lock_;
+  int64_t audio_start_time_ms_ = -1;
+  int64_t audio_stop_time_ms_ = -1;
+  int64_t codec_index_ = -1;
+};
+
+static A2dpOffloadAudioStats a2dp_offload_audio_stats;
+
 class BluetoothAudioHost : public IBluetoothAudioHost {
  public:
   Return<void> startStream() {
@@ -79,7 +144,7 @@ class BluetoothAudioHost : public IBluetoothAudioHost {
     return Void();
   }
   Return<void> stopStream() {
-    btif_a2dp_audio_process_request(A2DP_CTRL_CMD_STOP);
+    btif_a2dp_audio_send_stop_req();
     return Void();
   }
 
@@ -91,6 +156,20 @@ class BluetoothAudioHost : public IBluetoothAudioHost {
       }*/
 };
 
+class BluetoothAudioDeathRecipient : public hidl_death_recipient {
+ public:
+  virtual void serviceDied(
+      uint64_t /*cookie*/,
+      const wp<::android::hidl::base::V1_0::IBase>& /*who*/) {
+    LOG_ERROR(LOG_TAG, "%s", __func__);
+    // Restart the session on the correct thread
+    do_in_bta_thread(FROM_HERE,
+                     base::Bind(&btif_a2dp_audio_interface_restart_session));
+  }
+};
+sp<BluetoothAudioDeathRecipient> bluetoothAudioDeathRecipient =
+    new BluetoothAudioDeathRecipient();
+
 static Status mapToStatus(uint8_t resp) {
   switch (resp) {
     case A2DP_CTRL_ACK_SUCCESS:
@@ -118,6 +197,7 @@ static void btif_a2dp_get_codec_configuration(
   a2dpCodecConfig->getCodecSpecificConfig(&a2dp_offload);
   btav_a2dp_codec_config_t codec_config;
   codec_config = a2dpCodecConfig->getCodecConfig();
+  a2dp_offload_audio_stats.SetCodecIndex(a2dpCodecConfig->codecIndex());
   switch (codec_config.codec_type) {
     case BTAV_A2DP_CODEC_INDEX_SOURCE_SBC:
       p_codec_info->codecType =
@@ -190,6 +270,12 @@ static void btif_a2dp_audio_interface_init() {
   btAudio = IBluetoothAudioOffload::getService();
   CHECK(btAudio != nullptr);
 
+  auto death_link = btAudio->linkToDeath(bluetoothAudioDeathRecipient, 0);
+  if (!death_link.isOk()) {
+    LOG_ERROR(LOG_TAG, "%s: Cannot observe the Bluetooth Audio HAL's death",
+              __func__);
+  }
+
   LOG_DEBUG(
       LOG_TAG, "%s: IBluetoothAudioOffload::getService() returned %p (%s)",
       __func__, btAudio.get(), (btAudio->isRemote() ? "remote" : "local"));
@@ -199,11 +285,22 @@ static void btif_a2dp_audio_interface_init() {
 
 static void btif_a2dp_audio_interface_deinit() {
   LOG_INFO(LOG_TAG, "%s: start", __func__);
+  if (btAudio != nullptr) {
+    auto death_unlink = btAudio->unlinkToDeath(bluetoothAudioDeathRecipient);
+    if (!death_unlink.isOk()) {
+      LOG_ERROR(LOG_TAG,
+                "%s: Error unlinking death observer from Bluetooth Audio HAL",
+                __func__);
+    }
+  }
   btAudio = nullptr;
 }
 
 void btif_a2dp_audio_interface_start_session() {
   LOG_INFO(LOG_TAG, "%s", __func__);
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionStart(
+      system_bt_osi::CONNECTION_TECHNOLOGY_TYPE_BREDR, 0);
+  a2dp_offload_audio_stats.Reset();
   btif_a2dp_audio_interface_init();
   CHECK(btAudio != nullptr);
   CodecConfiguration codec_info;
@@ -214,6 +311,10 @@ void btif_a2dp_audio_interface_start_session() {
 
 void btif_a2dp_audio_interface_end_session() {
   LOG_INFO(LOG_TAG, "%s", __func__);
+  a2dp_offload_audio_stats.LogAudioStopMetricsAndReset();
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionEnd(
+      system_bt_osi::DISCONNECT_REASON_UNKNOWN, 0);
+  a2dp_offload_audio_stats.Reset();
   if (btAudio == nullptr) return;
   auto ret = btAudio->endSession();
   if (!ret.isOk()) {
@@ -222,12 +323,28 @@ void btif_a2dp_audio_interface_end_session() {
   btif_a2dp_audio_interface_deinit();
 }
 
+// Conditionally restart the session only if it was started before
+static void btif_a2dp_audio_interface_restart_session() {
+  LOG_INFO(LOG_TAG, "%s", __func__);
+  if (btAudio == nullptr) {
+    LOG_INFO(LOG_TAG, "%s: nothing to restart - session was not started",
+             __func__);
+    return;
+  }
+  btAudio = nullptr;
+  btif_a2dp_audio_interface_start_session();
+}
+
 void btif_a2dp_audio_on_started(tBTA_AV_STATUS status) {
   LOG_INFO(LOG_TAG, "%s: status = %d", __func__, status);
   if (btAudio != nullptr) {
     if (a2dp_cmd_pending == A2DP_CTRL_CMD_START) {
       LOG_INFO(LOG_TAG, "%s: calling method onStarted", __func__);
-      btAudio->streamStarted(mapToStatus(status));
+      auto hal_status = mapToStatus(status);
+      btAudio->streamStarted(hal_status);
+      if (hal_status == Status::SUCCESS) {
+        a2dp_offload_audio_stats.LogAudioStart();
+      }
     }
   }
 }
@@ -237,7 +354,11 @@ void btif_a2dp_audio_on_suspended(tBTA_AV_STATUS status) {
   if (btAudio != nullptr) {
     if (a2dp_cmd_pending == A2DP_CTRL_CMD_SUSPEND) {
       LOG_INFO(LOG_TAG, "calling method onSuspended");
-      btAudio->streamSuspended(mapToStatus(status));
+      auto hal_status = mapToStatus(status);
+      btAudio->streamSuspended(hal_status);
+      if (hal_status == Status::SUCCESS) {
+        a2dp_offload_audio_stats.LogAudioStopMetricsAndReset();
+      }
     }
   }
 }
@@ -248,6 +369,7 @@ void btif_a2dp_audio_on_stopped(tBTA_AV_STATUS status) {
     LOG_INFO(LOG_TAG, "%s: Remote disconnected when start under progress",
              __func__);
     btAudio->streamStarted(mapToStatus(A2DP_CTRL_ACK_DISCONNECT_IN_PROGRESS));
+    a2dp_offload_audio_stats.LogAudioStopMetricsAndReset();
   }
 }
 void btif_a2dp_audio_send_start_req() {
@@ -255,7 +377,11 @@ void btif_a2dp_audio_send_start_req() {
   uint8_t resp;
   resp = btif_a2dp_audio_process_request(A2DP_CTRL_CMD_START);
   if (btAudio != nullptr) {
-    auto ret = btAudio->streamStarted(mapToStatus(resp));
+    auto status = mapToStatus(resp);
+    auto ret = btAudio->streamStarted(status);
+    if (status == Status::SUCCESS) {
+      a2dp_offload_audio_stats.LogAudioStart();
+    }
     if (!ret.isOk()) LOG_ERROR(LOG_TAG, "HAL server died");
   }
 }
@@ -264,10 +390,21 @@ void btif_a2dp_audio_send_suspend_req() {
   uint8_t resp;
   resp = btif_a2dp_audio_process_request(A2DP_CTRL_CMD_SUSPEND);
   if (btAudio != nullptr) {
-    auto ret = btAudio->streamSuspended(mapToStatus(resp));
+    auto status = mapToStatus(resp);
+    auto ret = btAudio->streamSuspended(status);
+    if (status == Status::SUCCESS) {
+      a2dp_offload_audio_stats.LogAudioStopMetricsAndReset();
+    }
     if (!ret.isOk()) LOG_ERROR(LOG_TAG, "HAL server died");
   }
 }
+
+void btif_a2dp_audio_send_stop_req() {
+  LOG_INFO(LOG_TAG, "%s", __func__);
+  btif_a2dp_audio_process_request(A2DP_CTRL_CMD_STOP);
+  a2dp_offload_audio_stats.LogAudioStopMetricsAndReset();
+}
+
 /*void btif_a2dp_audio_send_sink_latency()
 {
   LOG_INFO(LOG_TAG, "%s", __func__);
diff --git a/btif/src/btif_a2dp_source.cc b/btif/src/btif_a2dp_source.cc
index 2a4ec8f04..efd842b7f 100644
--- a/btif/src/btif_a2dp_source.cc
+++ b/btif/src/btif_a2dp_source.cc
@@ -132,6 +132,7 @@ class BtifMediaStats {
     media_read_total_underflow_bytes = 0;
     media_read_total_underflow_count = 0;
     media_read_last_underflow_us = 0;
+    codec_index = -1;
   }
 
   uint64_t session_start_us;
@@ -160,6 +161,8 @@ class BtifMediaStats {
   size_t media_read_total_underflow_bytes;
   size_t media_read_total_underflow_count;
   uint64_t media_read_last_underflow_us;
+
+  int codec_index = -1;
 };
 
 class BtWorkerThread {
@@ -282,6 +285,19 @@ class BtifA2dpSource {
   }
 
   BtifA2dpSource::RunState State() const { return state_; }
+  std::string StateStr() const {
+    switch (state_) {
+      case kStateOff:
+        return "STATE_OFF";
+      case kStateStartingUp:
+        return "STATE_STARTING_UP";
+      case kStateRunning:
+        return "STATE_RUNNING";
+      case kStateShuttingDown:
+        return "STATE_SHUTTING_DOWN";
+    }
+  }
+
   void SetState(BtifA2dpSource::RunState state) { state_ = state; }
 
   fixed_queue_t* tx_audio_queue;
@@ -380,6 +396,7 @@ void btif_a2dp_source_accumulate_stats(BtifMediaStats* src,
   dst->media_read_total_underflow_count +=
       src->media_read_total_underflow_count;
   dst->media_read_last_underflow_us = src->media_read_last_underflow_us;
+  if (dst->codec_index < 0) dst->codec_index = src->codec_index;
   btif_a2dp_source_accumulate_scheduling_stats(&src->tx_queue_enqueue_stats,
                                                &dst->tx_queue_enqueue_stats);
   btif_a2dp_source_accumulate_scheduling_stats(&src->tx_queue_dequeue_stats,
@@ -403,7 +420,8 @@ static void btif_a2dp_source_init_delayed(void) {
 }
 
 bool btif_a2dp_source_startup(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if (btif_a2dp_source_cb.State() != BtifA2dpSource::kStateOff) {
     LOG_ERROR(LOG_TAG, "%s: A2DP Source media task already running", __func__);
@@ -422,18 +440,18 @@ bool btif_a2dp_source_startup(void) {
 }
 
 static void btif_a2dp_source_startup_delayed(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   raise_priority_a2dp(TASK_HIGH_MEDIA);
   btif_a2dp_control_init();
   btif_a2dp_source_cb.SetState(BtifA2dpSource::kStateRunning);
-  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionStart(
-      system_bt_osi::CONNECTION_TECHNOLOGY_TYPE_BREDR, 0);
 }
 
 bool btif_a2dp_source_start_session(const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
   btif_a2dp_source_setup_codec(peer_address);
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE,
@@ -443,14 +461,18 @@ bool btif_a2dp_source_start_session(const RawAddress& peer_address) {
 
 static void btif_a2dp_source_start_session_delayed(
     const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
   if (btif_a2dp_source_cb.State() != BtifA2dpSource::kStateRunning) {
     LOG_ERROR(LOG_TAG, "%s: A2DP Source media task is not running", __func__);
     return;
   }
   if (btif_av_is_a2dp_offload_enabled()) {
     btif_a2dp_audio_interface_start_session();
+  } else {
+    BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionStart(
+        system_bt_osi::CONNECTION_TECHNOLOGY_TYPE_BREDR, 0);
   }
 }
 
@@ -458,9 +480,11 @@ bool btif_a2dp_source_restart_session(const RawAddress& old_peer_address,
                                       const RawAddress& new_peer_address) {
   bool is_streaming = alarm_is_scheduled(btif_a2dp_source_cb.media_alarm);
   LOG_INFO(LOG_TAG,
-           "%s: old_peer_address=%s new_peer_address=%s is_streaming=%s",
+           "%s: old_peer_address=%s new_peer_address=%s is_streaming=%s "
+           "state=%s",
            __func__, old_peer_address.ToString().c_str(),
-           new_peer_address.ToString().c_str(), logbool(is_streaming).c_str());
+           new_peer_address.ToString().c_str(), logbool(is_streaming).c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
 
   CHECK(!new_peer_address.IsEmpty());
 
@@ -487,8 +511,9 @@ bool btif_a2dp_source_restart_session(const RawAddress& old_peer_address,
 }
 
 bool btif_a2dp_source_end_session(const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE,
       base::Bind(&btif_a2dp_source_end_session_delayed, peer_address));
@@ -497,20 +522,26 @@ bool btif_a2dp_source_end_session(const RawAddress& peer_address) {
 
 static void btif_a2dp_source_end_session_delayed(
     const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
-  if (btif_a2dp_source_cb.State() != BtifA2dpSource::kStateRunning) {
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
+  if (!btif_av_is_a2dp_offload_enabled()) {
+    BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionEnd(
+        system_bt_osi::DISCONNECT_REASON_UNKNOWN, 0);
+  }
+  if (btif_a2dp_source_cb.State() == BtifA2dpSource::kStateRunning) {
+    btif_av_stream_stop(peer_address);
+  } else {
     LOG_ERROR(LOG_TAG, "%s: A2DP Source media task is not running", __func__);
-    return;
   }
-  btif_av_stream_stop(peer_address);
   if (btif_av_is_a2dp_offload_enabled()) {
     btif_a2dp_audio_interface_end_session();
   }
 }
 
 void btif_a2dp_source_shutdown(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if ((btif_a2dp_source_cb.State() == BtifA2dpSource::kStateOff) ||
       (btif_a2dp_source_cb.State() == BtifA2dpSource::kStateShuttingDown)) {
@@ -525,7 +556,8 @@ void btif_a2dp_source_shutdown(void) {
 }
 
 static void btif_a2dp_source_shutdown_delayed(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   // Stop the timer
   alarm_free(btif_a2dp_source_cb.media_alarm);
@@ -538,12 +570,11 @@ static void btif_a2dp_source_shutdown_delayed(void) {
   btif_a2dp_source_cb.tx_audio_queue = nullptr;
 
   btif_a2dp_source_cb.SetState(BtifA2dpSource::kStateOff);
-  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionEnd(
-      system_bt_osi::DISCONNECT_REASON_UNKNOWN, 0);
 }
 
 void btif_a2dp_source_cleanup(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   // Make sure the source is shutdown
   btif_a2dp_source_shutdown();
@@ -556,7 +587,8 @@ void btif_a2dp_source_cleanup(void) {
 }
 
 static void btif_a2dp_source_cleanup_delayed(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
   // Nothing to do
 }
 
@@ -573,8 +605,9 @@ bool btif_a2dp_source_is_streaming(void) {
 }
 
 static void btif_a2dp_source_setup_codec(const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
 
   // Check to make sure the platform has 8 bits/byte since
   // we're using that in frame size calculations now.
@@ -588,8 +621,9 @@ static void btif_a2dp_source_setup_codec(const RawAddress& peer_address) {
 
 static void btif_a2dp_source_setup_codec_delayed(
     const RawAddress& peer_address) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
 
   tA2DP_ENCODER_INIT_PEER_PARAMS peer_params;
   bta_av_co_get_peer_params(peer_address, &peer_params);
@@ -623,37 +657,27 @@ static void btif_a2dp_source_setup_codec_delayed(
 }
 
 void btif_a2dp_source_start_audio_req(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE, base::Bind(&btif_a2dp_source_audio_tx_start_event));
-  btif_a2dp_source_cb.stats.Reset();
-  // Assign session_start_us to 1 when time_get_os_boottime_us() is 0 to
-  // indicate btif_a2dp_source_start_audio_req() has been called
-  btif_a2dp_source_cb.stats.session_start_us = time_get_os_boottime_us();
-  if (btif_a2dp_source_cb.stats.session_start_us == 0) {
-    btif_a2dp_source_cb.stats.session_start_us = 1;
-  }
-  btif_a2dp_source_cb.stats.session_end_us = 0;
 }
 
 void btif_a2dp_source_stop_audio_req(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE, base::Bind(&btif_a2dp_source_audio_tx_stop_event));
-
-  btif_a2dp_source_cb.stats.session_end_us = time_get_os_boottime_us();
-  btif_a2dp_source_update_metrics();
-  btif_a2dp_source_accumulate_stats(&btif_a2dp_source_cb.stats,
-                                    &btif_a2dp_source_cb.accumulated_stats);
 }
 
 void btif_a2dp_source_encoder_user_config_update_req(
     const RawAddress& peer_address,
     const btav_a2dp_codec_config_t& codec_user_config) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE, base::Bind(&btif_a2dp_source_encoder_user_config_update_event,
                             peer_address, codec_user_config));
@@ -662,8 +686,9 @@ void btif_a2dp_source_encoder_user_config_update_req(
 static void btif_a2dp_source_encoder_user_config_update_event(
     const RawAddress& peer_address,
     const btav_a2dp_codec_config_t& codec_user_config) {
-  LOG_INFO(LOG_TAG, "%s: peer_address=%s", __func__,
-           peer_address.ToString().c_str());
+  LOG_INFO(LOG_TAG, "%s: peer_address=%s state=%s", __func__,
+           peer_address.ToString().c_str(),
+           btif_a2dp_source_cb.StateStr().c_str());
   if (!bta_av_co_set_codec_user_config(peer_address, codec_user_config)) {
     LOG_ERROR(LOG_TAG, "%s: cannot update codec user configuration", __func__);
   }
@@ -671,7 +696,8 @@ static void btif_a2dp_source_encoder_user_config_update_event(
 
 void btif_a2dp_source_feeding_update_req(
     const btav_a2dp_codec_config_t& codec_audio_config) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE, base::Bind(&btif_a2dp_source_audio_feeding_update_event,
                             codec_audio_config));
@@ -679,7 +705,8 @@ void btif_a2dp_source_feeding_update_req(
 
 static void btif_a2dp_source_audio_feeding_update_event(
     const btav_a2dp_codec_config_t& codec_audio_config) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
   if (!bta_av_co_set_codec_audio_config(codec_audio_config)) {
     LOG_ERROR(LOG_TAG, "%s: cannot update codec audio feeding parameters",
               __func__);
@@ -687,7 +714,8 @@ static void btif_a2dp_source_audio_feeding_update_event(
 }
 
 void btif_a2dp_source_on_idle(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
   if (btif_a2dp_source_cb.State() == BtifA2dpSource::kStateOff) return;
 
   /* Make sure media task is stopped */
@@ -695,7 +723,8 @@ void btif_a2dp_source_on_idle(void) {
 }
 
 void btif_a2dp_source_on_stopped(tBTA_AV_SUSPEND* p_av_suspend) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if (btif_a2dp_source_cb.State() == BtifA2dpSource::kStateOff) return;
 
@@ -724,7 +753,8 @@ void btif_a2dp_source_on_stopped(tBTA_AV_SUSPEND* p_av_suspend) {
 }
 
 void btif_a2dp_source_on_suspended(tBTA_AV_SUSPEND* p_av_suspend) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if (btif_a2dp_source_cb.State() == BtifA2dpSource::kStateOff) return;
 
@@ -748,14 +778,17 @@ void btif_a2dp_source_on_suspended(tBTA_AV_SUSPEND* p_av_suspend) {
 
 /* when true media task discards any tx frames */
 void btif_a2dp_source_set_tx_flush(bool enable) {
-  LOG_INFO(LOG_TAG, "%s: enable=%s", __func__, (enable) ? "true" : "false");
+  LOG_INFO(LOG_TAG, "%s: enable=%s state=%s", __func__,
+           (enable) ? "true" : "false", btif_a2dp_source_cb.StateStr().c_str());
   btif_a2dp_source_cb.tx_flush = enable;
 }
 
 static void btif_a2dp_source_audio_tx_start_event(void) {
-  LOG_INFO(LOG_TAG, "%s: media_alarm is %srunning, streaming %s", __func__,
+  LOG_INFO(LOG_TAG, "%s: media_alarm is %srunning, streaming %s state=%s",
+           __func__,
            alarm_is_scheduled(btif_a2dp_source_cb.media_alarm) ? "" : "not ",
-           btif_a2dp_source_is_streaming() ? "true" : "false");
+           btif_a2dp_source_is_streaming() ? "true" : "false",
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if (btif_av_is_a2dp_offload_enabled()) return;
 
@@ -777,15 +810,35 @@ static void btif_a2dp_source_audio_tx_start_event(void) {
   alarm_set(btif_a2dp_source_cb.media_alarm,
             btif_a2dp_source_cb.encoder_interface->get_encoder_interval_ms(),
             btif_a2dp_source_alarm_cb, nullptr);
+
+  btif_a2dp_source_cb.stats.Reset();
+  // Assign session_start_us to 1 when time_get_os_boottime_us() is 0 to
+  // indicate btif_a2dp_source_start_audio_req() has been called
+  btif_a2dp_source_cb.stats.session_start_us = time_get_os_boottime_us();
+  if (btif_a2dp_source_cb.stats.session_start_us == 0) {
+    btif_a2dp_source_cb.stats.session_start_us = 1;
+  }
+  btif_a2dp_source_cb.stats.session_end_us = 0;
+  A2dpCodecConfig* codec_config = bta_av_get_a2dp_current_codec();
+  if (codec_config != nullptr) {
+    btif_a2dp_source_cb.stats.codec_index = codec_config->codecIndex();
+  }
 }
 
 static void btif_a2dp_source_audio_tx_stop_event(void) {
-  LOG_INFO(LOG_TAG, "%s: media_alarm is %srunning, streaming %s", __func__,
+  LOG_INFO(LOG_TAG, "%s: media_alarm is %srunning, streaming %s state=%s",
+           __func__,
            alarm_is_scheduled(btif_a2dp_source_cb.media_alarm) ? "" : "not ",
-           btif_a2dp_source_is_streaming() ? "true" : "false");
+           btif_a2dp_source_is_streaming() ? "true" : "false",
+           btif_a2dp_source_cb.StateStr().c_str());
 
   if (btif_av_is_a2dp_offload_enabled()) return;
 
+  btif_a2dp_source_cb.stats.session_end_us = time_get_os_boottime_us();
+  btif_a2dp_source_update_metrics();
+  btif_a2dp_source_accumulate_stats(&btif_a2dp_source_cb.stats,
+                                    &btif_a2dp_source_cb.accumulated_stats);
+
   uint8_t p_buf[AUDIO_STREAM_OUTPUT_BUFFER_SZ * 2];
   uint16_t event;
 
@@ -958,7 +1011,8 @@ static bool btif_a2dp_source_enqueue_callback(BT_HDR* p_buf, size_t frames_n,
 
 static void btif_a2dp_source_audio_tx_flush_event(void) {
   /* Flush all enqueued audio buffers (encoded) */
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
   if (btif_av_is_a2dp_offload_enabled()) return;
 
   if (btif_a2dp_source_cb.encoder_interface != nullptr)
@@ -974,7 +1028,8 @@ static void btif_a2dp_source_audio_tx_flush_event(void) {
 }
 
 static bool btif_a2dp_source_audio_tx_flush_req(void) {
-  LOG_INFO(LOG_TAG, "%s", __func__);
+  LOG_INFO(LOG_TAG, "%s: state=%s", __func__,
+           btif_a2dp_source_cb.StateStr().c_str());
 
   btif_a2dp_source_thread.DoInThread(
       FROM_HERE, base::Bind(&btif_a2dp_source_audio_tx_flush_event));
@@ -1212,17 +1267,21 @@ void btif_a2dp_source_debug_dump(int fd) {
 }
 
 static void btif_a2dp_source_update_metrics(void) {
-  const BtifMediaStats& stats = btif_a2dp_source_cb.stats;
-  const SchedulingStats& enqueue_stats = stats.tx_queue_enqueue_stats;
+  BtifMediaStats stats = btif_a2dp_source_cb.stats;
+  SchedulingStats enqueue_stats = stats.tx_queue_enqueue_stats;
   A2dpSessionMetrics metrics;
+  metrics.codec_index = stats.codec_index;
+  metrics.is_a2dp_offload = btif_av_is_a2dp_offload_enabled();
   // session_start_us is 0 when btif_a2dp_source_start_audio_req() is not called
   // mark the metric duration as invalid (-1) in this case
   if (stats.session_start_us != 0) {
     int64_t session_end_us = stats.session_end_us == 0
                                  ? time_get_os_boottime_us()
                                  : stats.session_end_us;
-    metrics.audio_duration_ms =
-        (session_end_us - stats.session_start_us) / 1000;
+    if (static_cast<uint64_t>(session_end_us) > stats.session_start_us) {
+      metrics.audio_duration_ms =
+          (session_end_us - stats.session_start_us) / 1000;
+    }
   }
 
   if (enqueue_stats.total_updates > 1) {
diff --git a/btif/src/btif_av.cc b/btif/src/btif_av.cc
index 9817b67ba..8d416c132 100644
--- a/btif/src/btif_av.cc
+++ b/btif/src/btif_av.cc
@@ -1684,7 +1684,8 @@ void BtifAvStateMachine::StateOpened::OnEnter() {
   BTIF_TRACE_DEBUG("%s: Peer %s", __PRETTY_FUNCTION__,
                    peer_.PeerAddress().ToString().c_str());
 
-  peer_.ClearFlags(BtifAvPeer::kFlagPendingStart |
+  peer_.ClearFlags(BtifAvPeer::kFlagLocalSuspendPending |
+                   BtifAvPeer::kFlagPendingStart |
                    BtifAvPeer::kFlagPendingStop);
 
   // Set the active peer if the first connected device.
@@ -1755,12 +1756,13 @@ bool BtifAvStateMachine::StateOpened::ProcessEvent(uint32_t event,
 
       // If remote tries to start A2DP when DUT is A2DP Source, then Suspend.
       // If A2DP is Sink and call is active, then disconnect the AVDTP channel.
-      if (peer_.IsSink() && !peer_.CheckFlags(BtifAvPeer::kFlagPendingStart)) {
+      bool should_suspend = false;
+      if (peer_.IsSink() && !peer_.CheckFlags(BtifAvPeer::kFlagPendingStart |
+                                              BtifAvPeer::kFlagRemoteSuspend)) {
         BTIF_TRACE_WARNING("%s: Peer %s : trigger Suspend as remote initiated",
                            __PRETTY_FUNCTION__,
                            peer_.PeerAddress().ToString().c_str());
-        btif_av_source_dispatch_sm_event(peer_.PeerAddress(),
-                                         BTIF_AV_SUSPEND_STREAM_REQ_EVT);
+        should_suspend = true;
       }
 
       // If peer is A2DP Source, we do not want to ACK commands on UIPC
@@ -1785,6 +1787,11 @@ bool BtifAvStateMachine::StateOpened::ProcessEvent(uint32_t event,
         btif_a2dp_on_started(peer_.PeerAddress(), nullptr, true);
         // Pending start flag will be cleared when exit current state
       }
+
+      if (should_suspend) {
+        btif_av_source_dispatch_sm_event(peer_.PeerAddress(),
+                                         BTIF_AV_SUSPEND_STREAM_REQ_EVT);
+      }
       peer_.StateMachine().TransitionTo(BtifAvStateMachine::kStateStarted);
 
     } break;
@@ -2017,6 +2024,8 @@ bool BtifAvStateMachine::StateStarted::ProcessEvent(uint32_t event,
                peer_.FlagsToString().c_str());
 
       peer_.SetFlags(BtifAvPeer::kFlagPendingStop);
+      peer_.ClearFlags(BtifAvPeer::kFlagLocalSuspendPending);
+
       btif_a2dp_on_stopped(&p_av->suspend);
 
       btif_report_audio_state(peer_.PeerAddress(), BTAV_AUDIO_STATE_STOPPED);
diff --git a/btif/src/btif_dm.cc b/btif/src/btif_dm.cc
index d1bb61c75..dd9b8130e 100644
--- a/btif/src/btif_dm.cc
+++ b/btif/src/btif_dm.cc
@@ -1395,10 +1395,15 @@ static void btif_dm_search_services_evt(uint16_t event, char* p_param) {
       if ((p_data->disc_res.result != BTA_SUCCESS) &&
           (pairing_cb.state == BT_BOND_STATE_BONDING) &&
           (pairing_cb.sdp_attempts < BTIF_DM_MAX_SDP_ATTEMPTS_AFTER_PAIRING)) {
-        BTIF_TRACE_WARNING("%s:SDP failed after bonding re-attempting",
-                           __func__);
-        pairing_cb.sdp_attempts++;
-        btif_dm_get_remote_services(bd_addr);
+        if (pairing_cb.sdp_attempts) {
+          BTIF_TRACE_WARNING("%s: SDP failed after bonding re-attempting",
+                             __func__);
+          pairing_cb.sdp_attempts++;
+          btif_dm_get_remote_services(bd_addr);
+        } else {
+          BTIF_TRACE_WARNING("%s: SDP triggered by someone failed when bonding",
+                             __func__);
+        }
         return;
       }
       prop.type = BT_PROPERTY_UUIDS;
diff --git a/btif/src/btif_hd.cc b/btif/src/btif_hd.cc
index bc0992daf..6d83167e8 100644
--- a/btif/src/btif_hd.cc
+++ b/btif/src/btif_hd.cc
@@ -25,15 +25,16 @@
  *
  *
  ***********************************************************************************/
+#define LOG_TAG "BTIF_HD"
+
 #include <errno.h>
 #include <hardware/bluetooth.h>
 #include <hardware/bt_hd.h>
+#include <log/log.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 
-#define LOG_TAG "BTIF_HD"
-
 #include "bta_api.h"
 #include "bta_hd_api.h"
 #include "bta_hh_api.h"
@@ -399,13 +400,18 @@ static bt_status_t register_app(bthd_app_param_t* p_app_param,
     return BT_STATUS_BUSY;
   }
 
-  app_info.p_name = (char*)osi_malloc(BTIF_HD_APP_NAME_LEN);
-  memcpy(app_info.p_name, p_app_param->name, BTIF_HD_APP_NAME_LEN);
-  app_info.p_description = (char*)osi_malloc(BTIF_HD_APP_DESCRIPTION_LEN);
-  memcpy(app_info.p_description, p_app_param->description,
-         BTIF_HD_APP_DESCRIPTION_LEN);
-  app_info.p_provider = (char*)osi_malloc(BTIF_HD_APP_PROVIDER_LEN);
-  memcpy(app_info.p_provider, p_app_param->provider, BTIF_HD_APP_PROVIDER_LEN);
+  if (strlen(p_app_param->name) >= BTIF_HD_APP_NAME_LEN ||
+      strlen(p_app_param->description) >= BTIF_HD_APP_DESCRIPTION_LEN ||
+      strlen(p_app_param->provider) >= BTIF_HD_APP_PROVIDER_LEN) {
+    android_errorWriteLog(0x534e4554, "113037220");
+  }
+  app_info.p_name = (char*)osi_calloc(BTIF_HD_APP_NAME_LEN);
+  strlcpy(app_info.p_name, p_app_param->name, BTIF_HD_APP_NAME_LEN);
+  app_info.p_description = (char*)osi_calloc(BTIF_HD_APP_DESCRIPTION_LEN);
+  strlcpy(app_info.p_description, p_app_param->description,
+          BTIF_HD_APP_DESCRIPTION_LEN);
+  app_info.p_provider = (char*)osi_calloc(BTIF_HD_APP_PROVIDER_LEN);
+  strlcpy(app_info.p_provider, p_app_param->provider, BTIF_HD_APP_PROVIDER_LEN);
   app_info.subclass = p_app_param->subclass;
   app_info.descriptor.dl_len = p_app_param->desc_list_len;
   app_info.descriptor.dsc_list =
diff --git a/btif/src/btif_hf.cc b/btif/src/btif_hf.cc
index 37f947166..24656c290 100644
--- a/btif/src/btif_hf.cc
+++ b/btif/src/btif_hf.cc
@@ -783,14 +783,12 @@ bt_status_t HeadsetInterface::ConnectAudio(RawAddress* bd_addr) {
     LOG(ERROR) << ": SLC not connected for " << *bd_addr;
     return BT_STATUS_NOT_READY;
   }
-  BTA_AgAudioOpen(btif_hf_cb[idx].handle);
-  // Inform the application that the audio connection has been initiated
-  // successfully
   do_in_jni_thread(base::Bind(&Callbacks::AudioStateCallback,
                               // Manual pointer management for now
                               base::Unretained(bt_hf_callbacks),
                               BTHF_AUDIO_STATE_CONNECTING,
                               &btif_hf_cb[idx].connected_bda));
+  BTA_AgAudioOpen(btif_hf_cb[idx].handle);
   return BT_STATUS_SUCCESS;
 }
 
diff --git a/hci/src/hci_layer.cc b/hci/src/hci_layer.cc
index 6d7993d63..53db452fe 100644
--- a/hci/src/hci_layer.cc
+++ b/hci/src/hci_layer.cc
@@ -78,7 +78,9 @@ static const int BT_HCI_RT_PRIORITY = 1;
 
 // Abort if there is no response to an HCI command.
 static const uint32_t COMMAND_PENDING_TIMEOUT_MS = 2000;
+static const uint32_t COMMAND_PENDING_MUTEX_ACQUIRE_TIMEOUT_MS = 500;
 static const uint32_t COMMAND_TIMEOUT_RESTART_MS = 5000;
+static const int HCI_UNKNOWN_COMMAND_TIMED_OUT = 0x00ffffff;
 
 // Our interface
 static bool interface_created;
@@ -105,7 +107,7 @@ static std::queue<base::Closure> command_queue;
 // Inbound-related
 static alarm_t* command_response_timer;
 static list_t* commands_pending_response;
-static std::recursive_mutex commands_pending_response_mutex;
+static std::recursive_timed_mutex commands_pending_response_mutex;
 static alarm_t* hci_timeout_abort_timer;
 
 // The hand-off point for data going to a higher layer, set by the higher layer
@@ -255,7 +257,8 @@ static future_t* hci_module_shut_down() {
 
   // Free the timers
   {
-    std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+    std::lock_guard<std::recursive_timed_mutex> lock(
+        commands_pending_response_mutex);
     alarm_free(command_response_timer);
     command_response_timer = NULL;
     alarm_free(startup_timer);
@@ -277,7 +280,8 @@ static future_t* hci_module_shut_down() {
   hci_close();
 
   {
-    std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+    std::lock_guard<std::recursive_timed_mutex> lock(
+        commands_pending_response_mutex);
     list_free(commands_pending_response);
     commands_pending_response = NULL;
   }
@@ -371,7 +375,8 @@ static void transmit_downward(uint16_t type, void* data) {
 
 static void event_finish_startup(UNUSED_ATTR void* context) {
   LOG_INFO(LOG_TAG, "%s", __func__);
-  std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+  std::lock_guard<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex);
   alarm_cancel(startup_timer);
   future_ready(startup_future, FUTURE_SUCCESS);
   startup_future = NULL;
@@ -380,9 +385,18 @@ static void event_finish_startup(UNUSED_ATTR void* context) {
 static void startup_timer_expired(UNUSED_ATTR void* context) {
   LOG_ERROR(LOG_TAG, "%s", __func__);
 
-  std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+  std::unique_lock<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex, std::defer_lock);
+  if (!lock.try_lock_for(std::chrono::milliseconds(
+          COMMAND_PENDING_MUTEX_ACQUIRE_TIMEOUT_MS))) {
+    LOG_ERROR(LOG_TAG, "%s: Cannot obtain the mutex", __func__);
+    // We cannot recover if the startup timer expired and we are deadlock,
+    // hence abort.
+    abort();
+  }
   future_ready(startup_future, FUTURE_FAIL);
   startup_future = NULL;
+  lock.unlock();
 }
 
 // Command/packet transmitting functions
@@ -408,7 +422,8 @@ static void enqueue_command(waiting_command_t* wait_entry) {
 static void event_command_ready(waiting_command_t* wait_entry) {
   {
     /// Move it to the list of commands awaiting response
-    std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+    std::lock_guard<std::recursive_timed_mutex> lock(
+        commands_pending_response_mutex);
     wait_entry->timestamp = std::chrono::steady_clock::now();
     list_append(commands_pending_response, wait_entry);
   }
@@ -475,10 +490,7 @@ static void hci_timeout_abort(void* unused_data) {
   exit(0);
 }
 
-// Print debugging information and quit. Don't dereference original_wait_entry.
-static void command_timed_out(void* original_wait_entry) {
-  std::unique_lock<std::recursive_mutex> lock(commands_pending_response_mutex);
-
+static void command_timed_out_log_info(void* original_wait_entry) {
   LOG_ERROR(LOG_TAG, "%s: %d commands pending response", __func__,
             get_num_waiting_commands());
 
@@ -508,7 +520,21 @@ static void command_timed_out(void* original_wait_entry) {
 
     LOG_EVENT_INT(BT_HCI_TIMEOUT_TAG_NUM, wait_entry->opcode);
   }
-  lock.unlock();
+}
+
+// Print debugging information and quit. Don't dereference original_wait_entry.
+static void command_timed_out(void* original_wait_entry) {
+  LOG_ERROR(LOG_TAG, "%s", __func__);
+  std::unique_lock<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex, std::defer_lock);
+  if (!lock.try_lock_for(std::chrono::milliseconds(
+          COMMAND_PENDING_MUTEX_ACQUIRE_TIMEOUT_MS))) {
+    LOG_ERROR(LOG_TAG, "%s: Cannot obtain the mutex", __func__);
+    LOG_EVENT_INT(BT_HCI_TIMEOUT_TAG_NUM, HCI_UNKNOWN_COMMAND_TIMED_OUT);
+  } else {
+    command_timed_out_log_info(original_wait_entry);
+    lock.unlock();
+  }
 
   // Don't request a firmware dump for multiple hci timeouts
   if (hci_timeout_abort_timer != NULL || hci_firmware_log_fd != INVALID_FD) {
@@ -675,7 +701,8 @@ static void dispatch_reassembled(BT_HDR* packet) {
 // Misc internal functions
 
 static waiting_command_t* get_waiting_command(command_opcode_t opcode) {
-  std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+  std::lock_guard<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex);
 
   for (const list_node_t* node = list_begin(commands_pending_response);
        node != list_end(commands_pending_response); node = list_next(node)) {
@@ -712,12 +739,14 @@ static waiting_command_t* get_waiting_command(command_opcode_t opcode) {
 }
 
 static int get_num_waiting_commands() {
-  std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+  std::lock_guard<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex);
   return list_length(commands_pending_response);
 }
 
 static void update_command_response_timer(void) {
-  std::lock_guard<std::recursive_mutex> lock(commands_pending_response_mutex);
+  std::lock_guard<std::recursive_timed_mutex> lock(
+      commands_pending_response_mutex);
 
   if (command_response_timer == NULL) return;
   if (list_is_empty(commands_pending_response)) {
diff --git a/osi/include/metrics.h b/osi/include/metrics.h
index 4f968d2d7..504a16a5a 100644
--- a/osi/include/metrics.h
+++ b/osi/include/metrics.h
@@ -105,6 +105,8 @@ class A2dpSessionMetrics {
   int32_t buffer_overruns_total = -1;
   float buffer_underruns_average = -1;
   int32_t buffer_underruns_count = -1;
+  int64_t codec_index = -1;
+  bool is_a2dp_offload = false;
 };
 
 class BluetoothMetricsLogger {
diff --git a/osi/src/metrics.cc b/osi/src/metrics.cc
index 96907c0b5..73450b944 100644
--- a/osi/src/metrics.cc
+++ b/osi/src/metrics.cc
@@ -29,6 +29,7 @@
 
 #include <base/base64.h>
 #include <base/logging.h>
+#include <include/hardware/bt_av.h>
 
 #include "bluetooth/metrics/bluetooth.pb.h"
 #include "osi/include/leaky_bonded_queue.h"
@@ -42,6 +43,7 @@
 namespace system_bt_osi {
 
 using bluetooth::metrics::BluetoothMetricsProto::A2DPSession;
+using bluetooth::metrics::BluetoothMetricsProto::A2dpSourceCodec;
 using bluetooth::metrics::BluetoothMetricsProto::BluetoothLog;
 using bluetooth::metrics::BluetoothMetricsProto::BluetoothSession;
 using bluetooth::metrics::BluetoothMetricsProto::
@@ -140,6 +142,12 @@ void A2dpSessionMetrics::Update(const A2dpSessionMetrics& metrics) {
       buffer_underruns_count += metrics.buffer_underruns_count;
     }
   }
+  if (codec_index < 0) {
+    codec_index = metrics.codec_index;
+  }
+  if (!is_a2dp_offload) {
+    is_a2dp_offload = metrics.is_a2dp_offload;
+  }
 }
 
 bool A2dpSessionMetrics::operator==(const A2dpSessionMetrics& rhs) const {
@@ -151,7 +159,9 @@ bool A2dpSessionMetrics::operator==(const A2dpSessionMetrics& rhs) const {
          buffer_overruns_max_count == rhs.buffer_overruns_max_count &&
          buffer_overruns_total == rhs.buffer_overruns_total &&
          buffer_underruns_average == rhs.buffer_underruns_average &&
-         buffer_underruns_count == rhs.buffer_underruns_count;
+         buffer_underruns_count == rhs.buffer_underruns_count &&
+         codec_index == rhs.codec_index &&
+         is_a2dp_offload == rhs.is_a2dp_offload;
 }
 
 static DeviceInfo_DeviceType get_device_type(device_type_t type) {
@@ -230,6 +240,23 @@ static BluetoothSession_DisconnectReasonType get_disconnect_reason_type(
   }
 }
 
+static A2dpSourceCodec get_a2dp_source_codec(int64_t codec_index) {
+  switch (codec_index) {
+    case BTAV_A2DP_CODEC_INDEX_SOURCE_SBC:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_SBC;
+    case BTAV_A2DP_CODEC_INDEX_SOURCE_AAC:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_AAC;
+    case BTAV_A2DP_CODEC_INDEX_SOURCE_APTX:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_APTX;
+    case BTAV_A2DP_CODEC_INDEX_SOURCE_APTX_HD:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_APTX_HD;
+    case BTAV_A2DP_CODEC_INDEX_SOURCE_LDAC:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_LDAC;
+    default:
+      return A2dpSourceCodec::A2DP_SOURCE_CODEC_UNKNOWN;
+  }
+}
+
 struct BluetoothMetricsLogger::impl {
   impl(size_t max_bluetooth_session, size_t max_pair_event,
        size_t max_wake_event, size_t max_scan_event)
@@ -356,6 +383,7 @@ void BluetoothMetricsLogger::LogBluetoothSessionEnd(
       get_disconnect_reason_type(disconnect_reason));
   pimpl_->bt_session_queue_->Enqueue(pimpl_->bluetooth_session_);
   pimpl_->bluetooth_session_ = nullptr;
+  pimpl_->a2dp_session_metrics_ = A2dpSessionMetrics();
   {
     std::lock_guard<std::recursive_mutex> log_lock(pimpl_->bluetooth_log_lock_);
     pimpl_->bluetooth_log_->set_num_bluetooth_session(
@@ -404,6 +432,10 @@ void BluetoothMetricsLogger::LogA2dpSession(
       pimpl_->a2dp_session_metrics_.buffer_underruns_average);
   a2dp_session->set_buffer_underruns_count(
       pimpl_->a2dp_session_metrics_.buffer_underruns_count);
+  a2dp_session->set_source_codec(
+      get_a2dp_source_codec(pimpl_->a2dp_session_metrics_.codec_index));
+  a2dp_session->set_is_a2dp_offload(
+      pimpl_->a2dp_session_metrics_.is_a2dp_offload);
 }
 
 void BluetoothMetricsLogger::LogHeadsetProfileRfcConnection(
diff --git a/osi/test/metrics_test.cc b/osi/test/metrics_test.cc
index 2c9762f5b..bfb548f63 100644
--- a/osi/test/metrics_test.cc
+++ b/osi/test/metrics_test.cc
@@ -25,6 +25,7 @@
 #include <gtest/gtest.h>
 
 #include <base/logging.h>
+#include <include/hardware/bt_av.h>
 
 #include "bluetooth/metrics/bluetooth.pb.h"
 #include "osi/include/metrics.h"
@@ -35,6 +36,7 @@
 namespace testing {
 
 using bluetooth::metrics::BluetoothMetricsProto::A2DPSession;
+using bluetooth::metrics::BluetoothMetricsProto::A2dpSourceCodec;
 using bluetooth::metrics::BluetoothMetricsProto::BluetoothLog;
 using bluetooth::metrics::BluetoothMetricsProto::BluetoothSession;
 using bluetooth::metrics::BluetoothMetricsProto::
@@ -111,7 +113,8 @@ ScanEvent* MakeScanEvent(ScanEvent_ScanEventType event_type,
   return event;
 }
 
-A2DPSession* MakeA2DPSession(const A2dpSessionMetrics& metrics) {
+A2DPSession* MakeA2DPSession(const A2dpSessionMetrics& metrics,
+                             A2dpSourceCodec source_codec) {
   A2DPSession* session = new A2DPSession();
   session->set_media_timer_min_millis(metrics.media_timer_min_ms);
   session->set_media_timer_max_millis(metrics.media_timer_max_ms);
@@ -121,6 +124,8 @@ A2DPSession* MakeA2DPSession(const A2dpSessionMetrics& metrics) {
   session->set_buffer_underruns_average(metrics.buffer_underruns_average);
   session->set_buffer_underruns_count(metrics.buffer_underruns_count);
   session->set_audio_duration_millis(metrics.audio_duration_ms);
+  session->set_source_codec(source_codec);
+  session->set_is_a2dp_offload(metrics.is_a2dp_offload);
   return session;
 }
 
@@ -187,6 +192,8 @@ void GenerateWakeEvents(size_t start, size_t end,
                 FloatNear((b).buffer_underruns_average, 0.01));              \
     (a).buffer_underruns_average = (b).buffer_underruns_average;             \
     EXPECT_EQ((a).buffer_underruns_count, (b).buffer_underruns_count);       \
+    EXPECT_EQ((a).codec_index, (b).codec_index);                             \
+    EXPECT_EQ((a).is_a2dp_offload, (b).is_a2dp_offload);                     \
   } while (0)
 
 /*
@@ -220,6 +227,12 @@ TEST(BluetoothA2DPSessionMetricsTest, TestUpdateNormal) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 113.33333333;
   metrics_sum.buffer_underruns_count = 3600;
+  metrics1.codec_index = -1;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics1.is_a2dp_offload = false;
+  metrics2.is_a2dp_offload = true;
+  metrics_sum.is_a2dp_offload = true;
   metrics1.Update(metrics2);
   COMPARE_A2DP_METRICS(metrics1, metrics_sum);
   EXPECT_TRUE(metrics1 == metrics_sum);
@@ -246,6 +259,10 @@ TEST(BluetoothA2DPSessionMetricsTest, TestUpdateNew) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 130;
   metrics_sum.buffer_underruns_count = 2400;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_APTX;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_APTX;
+  metrics2.is_a2dp_offload = true;
+  metrics_sum.is_a2dp_offload = true;
   metrics1.Update(metrics2);
   COMPARE_A2DP_METRICS(metrics1, metrics_sum);
   EXPECT_TRUE(metrics1 == metrics_sum);
@@ -272,6 +289,10 @@ TEST(BluetoothA2DPSessionMetricsTest, TestNullUpdate) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 130;
   metrics_sum.buffer_underruns_count = 2400;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_APTX_HD;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_APTX_HD;
+  metrics2.is_a2dp_offload = true;
+  metrics_sum.is_a2dp_offload = true;
   metrics2.Update(metrics1);
   COMPARE_A2DP_METRICS(metrics2, metrics_sum);
   EXPECT_TRUE(metrics2 == metrics_sum);
@@ -560,10 +581,17 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionTwoUpdatesTest) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 113.33333333;
   metrics_sum.buffer_underruns_count = 3600;
+  metrics1.codec_index = -1;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics1.is_a2dp_offload = false;
+  metrics2.is_a2dp_offload = true;
+  metrics_sum.is_a2dp_offload = true;
   DeviceInfo* info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
-  A2DPSession* session = MakeA2DPSession(metrics_sum);
+  A2DPSession* session =
+      MakeA2DPSession(metrics_sum, A2dpSourceCodec::A2DP_SOURCE_CODEC_AAC);
   bt_sessions_.push_back(MakeBluetoothSession(
       10,
       BluetoothSession_ConnectionTechnologyType::
@@ -618,10 +646,13 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionTwoUpdatesSeparatedbyDumpTest) {
   metrics1.buffer_underruns_count = 1200;
   metrics2.buffer_underruns_average = 130;
   metrics2.buffer_underruns_count = 2400;
+  metrics1.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
   DeviceInfo* info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
-  A2DPSession* session = MakeA2DPSession(metrics1);
+  A2DPSession* session =
+      MakeA2DPSession(metrics1, A2dpSourceCodec::A2DP_SOURCE_CODEC_SBC);
   bt_sessions_.push_back(MakeBluetoothSession(
       1,
       BluetoothSession_ConnectionTechnologyType::
@@ -643,7 +674,7 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionTwoUpdatesSeparatedbyDumpTest) {
   info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
-  session = MakeA2DPSession(metrics2);
+  session = MakeA2DPSession(metrics2, A2dpSourceCodec::A2DP_SOURCE_CODEC_AAC);
   bt_sessions_.push_back(MakeBluetoothSession(
       1,
       BluetoothSession_ConnectionTechnologyType::
@@ -661,6 +692,86 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionTwoUpdatesSeparatedbyDumpTest) {
   EXPECT_THAT(msg_str, StrEq(bt_log_str_));
 }
 
+/*
+ * Test Case: A2DPSessionTwoUpdatesSeparatedbyEndTest
+ *
+ * 1. Create Instance
+ * 2. LogBluetoothSessionStart
+ * 3. LogA2dpSession
+ * 4. LogBluetoothSessionEnd
+ * 5. LogBluetoothSessionStart
+ * 6. LogA2dpSession
+ * 7. LogBluetoothSessionEnd
+ * 8. WriteString
+ *
+ */
+TEST_F(BluetoothMetricsLoggerTest, A2DPSessionTwoUpdatesSeparatedbyEndTest) {
+  /* Same metrics from BluetoothA2DPSessionMetricsTest.TestUpdateNormal */
+  A2dpSessionMetrics metrics1;
+  metrics1.audio_duration_ms = 10;
+  metrics1.media_timer_min_ms = 10;
+  metrics1.media_timer_max_ms = 100;
+  metrics1.media_timer_avg_ms = 50;
+  metrics1.total_scheduling_count = 50;
+  metrics1.buffer_overruns_max_count = 70;
+  metrics1.buffer_underruns_average = 80;
+  metrics1.buffer_underruns_count = 1200;
+  metrics1.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
+  DeviceInfo* info = MakeDeviceInfo(
+      BTM_COD_MAJOR_AUDIO_TEST,
+      DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
+  A2DPSession* session =
+      MakeA2DPSession(metrics1, A2dpSourceCodec::A2DP_SOURCE_CODEC_SBC);
+  bt_sessions_.push_back(MakeBluetoothSession(
+      1,
+      BluetoothSession_ConnectionTechnologyType::
+          BluetoothSession_ConnectionTechnologyType_CONNECTION_TECHNOLOGY_TYPE_BREDR,
+      BluetoothSession_DisconnectReasonType::
+          BluetoothSession_DisconnectReasonType_UNKNOWN,
+      info, nullptr, session));
+  UpdateLog();
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionStart(
+      system_bt_osi::CONNECTION_TECHNOLOGY_TYPE_BREDR, 0);
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionDeviceInfo(
+      BTM_COD_MAJOR_AUDIO_TEST, system_bt_osi::DEVICE_TYPE_BREDR);
+  BluetoothMetricsLogger::GetInstance()->LogA2dpSession(metrics1);
+  sleep_ms(1000);
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionEnd(
+      system_bt_osi::DISCONNECT_REASON_UNKNOWN, 0);
+  std::string msg_str;
+  BluetoothMetricsLogger::GetInstance()->WriteString(&msg_str);
+  EXPECT_THAT(msg_str, StrEq(bt_log_str_));
+  ClearLog();
+  A2dpSessionMetrics metrics2;
+  metrics2.audio_duration_ms = 25;
+  metrics2.media_timer_min_ms = 25;
+  metrics2.media_timer_max_ms = 200;
+  metrics2.media_timer_avg_ms = 100;
+  metrics2.total_scheduling_count = 50;
+  metrics2.buffer_overruns_max_count = 80;
+  metrics2.buffer_underruns_average = 130;
+  metrics2.buffer_underruns_count = 2400;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  session = MakeA2DPSession(metrics2, A2dpSourceCodec::A2DP_SOURCE_CODEC_AAC);
+  bt_sessions_.push_back(MakeBluetoothSession(
+      1,
+      BluetoothSession_ConnectionTechnologyType::
+          BluetoothSession_ConnectionTechnologyType_CONNECTION_TECHNOLOGY_TYPE_BREDR,
+      BluetoothSession_DisconnectReasonType::
+          BluetoothSession_DisconnectReasonType_UNKNOWN,
+      nullptr, nullptr, session));
+  UpdateLog();
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionStart(
+      system_bt_osi::CONNECTION_TECHNOLOGY_TYPE_BREDR, 0);
+  sleep_ms(1000);
+  BluetoothMetricsLogger::GetInstance()->LogA2dpSession(metrics2);
+  BluetoothMetricsLogger::GetInstance()->LogBluetoothSessionEnd(
+      system_bt_osi::DISCONNECT_REASON_UNKNOWN, 0);
+  msg_str.clear();
+  BluetoothMetricsLogger::GetInstance()->WriteString(&msg_str);
+  EXPECT_THAT(msg_str, StrEq(bt_log_str_));
+}
+
 /*
  * Test Case 1: A2DPSessionOnlyTest
  *
@@ -700,10 +811,14 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionOnlyTest) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 113.33333333;
   metrics_sum.buffer_underruns_count = 3600;
+  metrics1.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
   DeviceInfo* info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
-  A2DPSession* session = MakeA2DPSession(metrics_sum);
+  A2DPSession* session =
+      MakeA2DPSession(metrics_sum, A2dpSourceCodec::A2DP_SOURCE_CODEC_SBC);
   bt_sessions_.push_back(MakeBluetoothSession(
       1,
       BluetoothSession_ConnectionTechnologyType::
@@ -762,6 +877,9 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionDumpBeforeTwoUpdatesTest) {
   metrics2.buffer_underruns_count = 2400;
   metrics_sum.buffer_underruns_average = 113.33333333;
   metrics_sum.buffer_underruns_count = 3600;
+  metrics1.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
+  metrics2.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_AAC;
+  metrics_sum.codec_index = BTAV_A2DP_CODEC_INDEX_SOURCE_SBC;
   DeviceInfo* info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
@@ -785,7 +903,8 @@ TEST_F(BluetoothMetricsLoggerTest, A2DPSessionDumpBeforeTwoUpdatesTest) {
   info = MakeDeviceInfo(
       BTM_COD_MAJOR_AUDIO_TEST,
       DeviceInfo_DeviceType::DeviceInfo_DeviceType_DEVICE_TYPE_BREDR);
-  A2DPSession* session = MakeA2DPSession(metrics_sum);
+  A2DPSession* session =
+      MakeA2DPSession(metrics_sum, A2dpSourceCodec::A2DP_SOURCE_CODEC_SBC);
   bt_sessions_.push_back(MakeBluetoothSession(
       1,
       BluetoothSession_ConnectionTechnologyType::
diff --git a/packet/tests/avrcp/avrcp_test_packets.h b/packet/tests/avrcp/avrcp_test_packets.h
index e7e820b0c..13994d00a 100644
--- a/packet/tests/avrcp/avrcp_test_packets.h
+++ b/packet/tests/avrcp/avrcp_test_packets.h
@@ -105,6 +105,10 @@ std::vector<uint8_t> register_volume_changed_notification = {
     0x03, 0x48, 0x00, 0x00, 0x19, 0x58, 0x31, 0x00,
     0x00, 0x05, 0x0d, 0x00, 0x00, 0x00, 0x00};
 
+// AVRCP Register Notification without any parameter
+std::vector<uint8_t> register_notification_invalid = {
+    0x03, 0x48, 0x00, 0x00, 0x19, 0x58, 0x31, 0x00, 0x00, 0x05};
+
 // AVRCP Interim Playback Status Notification
 std::vector<uint8_t> interim_play_status_notification = {
     0x0f, 0x48, 0x00, 0x00, 0x19, 0x58, 0x31, 0x00, 0x00, 0x02, 0x01, 0x00};
@@ -297,8 +301,12 @@ std::vector<uint8_t> get_item_attributes_song_response = {
     0x72, 0x74, 0x69, 0x73, 0x74, 0x00, 0x00, 0x00, 0x03, 0x00, 0x6a, 0x00,
     0x0a, 0x54, 0x65, 0x73, 0x74, 0x20, 0x41, 0x6c, 0x62, 0x75, 0x6d};
 
-// AVRCP Set Addressed Player Request with player_id = 1
+// AVRCP Set Addressed Player Request with player_id = 0
 std::vector<uint8_t> set_addressed_player_request = {
+    0x00, 0x48, 0x00, 0x00, 0x19, 0x58, 0x60, 0x00, 0x00, 0x02, 0x00, 0x00};
+
+// AVRCP Set Addressed Player Request with player_id = 1
+std::vector<uint8_t> set_addressed_player_id_1_request = {
     0x00, 0x48, 0x00, 0x00, 0x19, 0x58, 0x60, 0x00, 0x00, 0x02, 0x00, 0x01};
 
 // AVRCP Set Addressed Player Response with status success
diff --git a/packet/tests/avrcp/set_addressed_player_packet_test.cc b/packet/tests/avrcp/set_addressed_player_packet_test.cc
index 24d674ab7..a6ced9e60 100644
--- a/packet/tests/avrcp/set_addressed_player_packet_test.cc
+++ b/packet/tests/avrcp/set_addressed_player_packet_test.cc
@@ -39,7 +39,7 @@ TEST(SetAddressedPlayerRequestTest, getterTest) {
   auto test_packet =
       TestSetAddrPlayerPacket::Make(set_addressed_player_request);
 
-  ASSERT_EQ(test_packet->GetPlayerId(), 0x0001u);
+  ASSERT_EQ(test_packet->GetPlayerId(), 0x0000u);
 }
 
 TEST(SetAddressedPlayerRequestTest, validTest) {
@@ -60,4 +60,4 @@ TEST(SetAddressedPlayerRequestTest, invalidTest) {
 }
 
 }  // namespace avrcp
-}  // namespace bluetooth
\ No newline at end of file
+}  // namespace bluetooth
diff --git a/profile/avrcp/Android.bp b/profile/avrcp/Android.bp
index 35096a254..3d95e9f32 100644
--- a/profile/avrcp/Android.bp
+++ b/profile/avrcp/Android.bp
@@ -37,11 +37,11 @@ cc_test {
     static_libs: [
         "libgmock",
         "lib-bt-packets",
+        "avrcp-target-service",
+        "libbtdevice",
         "libosi",
         "liblog",
         "libcutils",
-        "libbtdevice",
-        "avrcp-target-service",
     ],
     sanitize: {
         cfi: false,
diff --git a/profile/avrcp/device.cc b/profile/avrcp/device.cc
index d2a985f98..9a31ef3f6 100644
--- a/profile/avrcp/device.cc
+++ b/profile/avrcp/device.cc
@@ -126,9 +126,9 @@ void Device::VendorPacketHandler(uint8_t label,
       // this currently since the current implementation only has one
       // player and the player will never change, but we need it for a
       // more complete implementation.
-      auto response = RejectBuilder::MakeBuilder(
-          CommandPdu::SET_ADDRESSED_PLAYER, Status::INVALID_PLAYER_ID);
-      send_message(label, false, std::move(response));
+      media_interface_->GetMediaPlayerList(base::Bind(
+          &Device::HandleSetAddressedPlayer, weak_ptr_factory_.GetWeakPtr(),
+          label, Packet::Specialize<SetAddressedPlayerRequest>(pkt)));
     } break;
 
     default: {
@@ -182,6 +182,14 @@ void Device::HandleGetCapabilities(
 
 void Device::HandleNotification(
     uint8_t label, const std::shared_ptr<RegisterNotificationRequest>& pkt) {
+  if (!pkt->IsValid()) {
+    DEVICE_LOG(ERROR) << __func__ << ": Request packet is not valid";
+    auto response = RejectBuilder::MakeBuilder(pkt->GetCommandPdu(),
+                                               Status::INVALID_PARAMETER);
+    send_message(label, false, std::move(response));
+    return;
+  }
+
   DEVICE_VLOG(4) << __func__ << ": event=" << pkt->GetEventRegistered();
 
   switch (pkt->GetEventRegistered()) {
@@ -618,6 +626,24 @@ void Device::HandlePlayItem(uint8_t label,
   send_message(label, false, std::move(response));
 }
 
+void Device::HandleSetAddressedPlayer(
+    uint8_t label, std::shared_ptr<SetAddressedPlayerRequest> pkt,
+    uint16_t curr_player, std::vector<MediaPlayerInfo> players) {
+  DEVICE_VLOG(2) << __func__ << ": PlayerId=" << pkt->GetPlayerId();
+
+  if (curr_player != pkt->GetPlayerId()) {
+    DEVICE_VLOG(2) << "Reject invalid addressed player ID";
+    auto response = RejectBuilder::MakeBuilder(CommandPdu::SET_ADDRESSED_PLAYER,
+                                               Status::INVALID_PLAYER_ID);
+    send_message(label, false, std::move(response));
+    return;
+  }
+
+  auto response =
+      SetAddressedPlayerResponseBuilder::MakeBuilder(Status::NO_ERROR);
+  send_message(label, false, std::move(response));
+}
+
 void Device::BrowseMessageReceived(uint8_t label,
                                    std::shared_ptr<BrowsePacket> pkt) {
   DEVICE_VLOG(1) << __func__ << ": pdu=" << pkt->GetPdu();
diff --git a/profile/avrcp/device.h b/profile/avrcp/device.h
index 27f7674d9..5ef886d26 100644
--- a/profile/avrcp/device.h
+++ b/profile/avrcp/device.h
@@ -210,6 +210,11 @@ class Device {
   virtual void HandlePlayItem(uint8_t label,
                               std::shared_ptr<PlayItemRequest> request);
 
+  // SET ADDRESSED PLAYER
+  virtual void HandleSetAddressedPlayer(
+      uint8_t label, std::shared_ptr<SetAddressedPlayerRequest> request,
+      uint16_t curr_player, std::vector<MediaPlayerInfo> players);
+
   /********************
    * MESSAGE REQUESTS
    ********************/
diff --git a/profile/avrcp/tests/avrcp_device_test.cc b/profile/avrcp/tests/avrcp_device_test.cc
index d50644c2a..56f03e4f4 100644
--- a/profile/avrcp/tests/avrcp_device_test.cc
+++ b/profile/avrcp/tests/avrcp_device_test.cc
@@ -713,9 +713,26 @@ TEST_F(AvrcpDeviceTest, setAddressedPlayerTest) {
 
   test_device->RegisterInterfaces(&interface, &a2dp_interface, nullptr);
 
-  auto set_addr_player_rsp = RejectBuilder::MakeBuilder(
+  MediaPlayerInfo info = {0, "Test Player", true};
+  std::vector<MediaPlayerInfo> list = {info};
+
+  EXPECT_CALL(interface, GetMediaPlayerList(_))
+      .WillRepeatedly(InvokeCb<0>(0, list));
+
+  auto set_addr_player_rej_rsp = RejectBuilder::MakeBuilder(
       CommandPdu::SET_ADDRESSED_PLAYER, Status::INVALID_PLAYER_ID);
 
+  EXPECT_CALL(response_cb,
+              Call(1, false, matchPacket(std::move(set_addr_player_rej_rsp))))
+      .Times(1);
+
+  auto player_id_1_request =
+      TestAvrcpPacket::Make(set_addressed_player_id_1_request);
+  SendMessage(1, player_id_1_request);
+
+  auto set_addr_player_rsp =
+      SetAddressedPlayerResponseBuilder::MakeBuilder(Status::NO_ERROR);
+
   EXPECT_CALL(response_cb,
               Call(1, false, matchPacket(std::move(set_addr_player_rsp))))
       .Times(1);
@@ -1031,6 +1048,22 @@ TEST_F(AvrcpDeviceTest, getInvalidItemAttributesTest) {
   SendBrowseMessage(1, request);
 }
 
+TEST_F(AvrcpDeviceTest, invalidRegisterNotificationTest) {
+  MockMediaInterface interface;
+  NiceMock<MockA2dpInterface> a2dp_interface;
+
+  test_device->RegisterInterfaces(&interface, &a2dp_interface, nullptr);
+
+  auto reg_notif_rej_rsp = RejectBuilder::MakeBuilder(
+      CommandPdu::REGISTER_NOTIFICATION, Status::INVALID_PARAMETER);
+  EXPECT_CALL(response_cb,
+              Call(1, false, matchPacket(std::move(reg_notif_rej_rsp))))
+      .Times(1);
+
+  auto reg_notif_request = TestAvrcpPacket::Make(register_notification_invalid);
+  SendMessage(1, reg_notif_request);
+}
+
 }  // namespace avrcp
 }  // namespace bluetooth
 
diff --git a/proto/bluetooth/metrics/bluetooth.proto b/proto/bluetooth/metrics/bluetooth.proto
index 67efac5cd..b1e28c3b2 100644
--- a/proto/bluetooth/metrics/bluetooth.proto
+++ b/proto/bluetooth/metrics/bluetooth.proto
@@ -133,6 +133,15 @@ message RFCommSession {
   optional int32 tx_bytes = 2;
 }
 
+enum A2dpSourceCodec {
+  A2DP_SOURCE_CODEC_UNKNOWN = 0;
+  A2DP_SOURCE_CODEC_SBC = 1;
+  A2DP_SOURCE_CODEC_AAC = 2;
+  A2DP_SOURCE_CODEC_APTX = 3;
+  A2DP_SOURCE_CODEC_APTX_HD = 4;
+  A2DP_SOURCE_CODEC_LDAC = 5;
+}
+
 // Session information that gets logged for A2DP session.
 message A2DPSession {
   // Media timer in milliseconds.
@@ -158,6 +167,12 @@ message A2DPSession {
 
   // Total audio time in this A2DP session
   optional int64 audio_duration_millis = 8;
+
+  // Audio codec used in this A2DP session in A2DP source role
+  optional A2dpSourceCodec source_codec = 9;
+
+  // Whether A2DP offload is enabled in this A2DP session
+  optional bool is_a2dp_offload = 10;
 }
 
 message PairEvent {
diff --git a/stack/a2dp/a2dp_codec_config.cc b/stack/a2dp/a2dp_codec_config.cc
index de1010b36..3a6c4bd53 100644
--- a/stack/a2dp/a2dp_codec_config.cc
+++ b/stack/a2dp/a2dp_codec_config.cc
@@ -605,8 +605,10 @@ bool A2dpCodecs::init() {
     }
 
     // In offload mode, disable the codecs based on the property
-    if (a2dp_offload_status && (offload_codec_support[i] != true))
+    if ((codec_index < BTAV_A2DP_CODEC_INDEX_SOURCE_MAX) &&
+        a2dp_offload_status && (offload_codec_support[i] != true)) {
       codec_priority = BTAV_A2DP_CODEC_PRIORITY_DISABLED;
+    }
 
     A2dpCodecConfig* codec_config =
         A2dpCodecConfig::createCodec(codec_index, codec_priority);
diff --git a/stack/avrc/avrc_pars_ct.cc b/stack/avrc/avrc_pars_ct.cc
index 909274d42..a7a42a599 100644
--- a/stack/avrc/avrc_pars_ct.cc
+++ b/stack/avrc/avrc_pars_ct.cc
@@ -29,6 +29,8 @@
  *  Global data
  ****************************************************************************/
 
+#define MIN(x, y) ((x) < (y) ? (x) : (y))
+
 /*******************************************************************************
  *
  * Function         avrc_pars_vendor_rsp
@@ -54,13 +56,33 @@ static tAVRC_STS avrc_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
   if (p_msg->vendor_len == 0) return AVRC_STS_NO_ERROR;
   if (p_msg->p_vendor_data == NULL) return AVRC_STS_INTERNAL_ERR;
 
+  if (p_msg->vendor_len < 4) {
+    android_errorWriteLog(0x534e4554, "111450531");
+    AVRC_TRACE_WARNING("%s: message length %d too short: must be at least 4",
+                       __func__, p_msg->vendor_len);
+    return AVRC_STS_INTERNAL_ERR;
+  }
   p = p_msg->p_vendor_data;
   BE_STREAM_TO_UINT8(p_result->pdu, p);
   p++; /* skip the reserved/packe_type byte */
   BE_STREAM_TO_UINT16(len, p);
-  AVRC_TRACE_DEBUG("%s ctype:0x%x pdu:0x%x, len:%d/0x%x", __func__,
-                   p_msg->hdr.ctype, p_result->pdu, len, len);
+  AVRC_TRACE_DEBUG("%s ctype:0x%x pdu:0x%x, len:%d/0x%x vendor_len=0x%x",
+                   __func__, p_msg->hdr.ctype, p_result->pdu, len, len,
+                   p_msg->vendor_len);
+  if (p_msg->vendor_len < len + 4) {
+    android_errorWriteLog(0x534e4554, "111450531");
+    AVRC_TRACE_WARNING("%s: message length %d too short: must be at least %d",
+                       __func__, p_msg->vendor_len, len + 4);
+    return AVRC_STS_INTERNAL_ERR;
+  }
+
   if (p_msg->hdr.ctype == AVRC_RSP_REJ) {
+    if (len < 1) {
+      android_errorWriteLog(0x534e4554, "111450531");
+      AVRC_TRACE_WARNING("%s: invalid parameter length %d: must be at least 1",
+                         __func__, len);
+      return AVRC_STS_INTERNAL_ERR;
+    }
     p_result->rsp.status = *p;
     return p_result->rsp.status;
   }
@@ -81,12 +103,26 @@ static tAVRC_STS avrc_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
 
     case AVRC_PDU_REGISTER_NOTIFICATION: /* 0x31 */
 #if (AVRC_ADV_CTRL_INCLUDED == TRUE)
+      if (len < 1) {
+        android_errorWriteLog(0x534e4554, "111450531");
+        AVRC_TRACE_WARNING(
+            "%s: invalid parameter length %d: must be at least 1", __func__,
+            len);
+        return AVRC_STS_INTERNAL_ERR;
+      }
       BE_STREAM_TO_UINT8(eventid, p);
       if (AVRC_EVT_VOLUME_CHANGE == eventid &&
           (AVRC_RSP_CHANGED == p_msg->hdr.ctype ||
            AVRC_RSP_INTERIM == p_msg->hdr.ctype ||
            AVRC_RSP_REJ == p_msg->hdr.ctype ||
            AVRC_RSP_NOT_IMPL == p_msg->hdr.ctype)) {
+        if (len < 2) {
+          android_errorWriteLog(0x534e4554, "111450531");
+          AVRC_TRACE_WARNING(
+              "%s: invalid parameter length %d: must be at least 2", __func__,
+              len);
+          return AVRC_STS_INTERNAL_ERR;
+        }
         p_result->reg_notif.status = p_msg->hdr.ctype;
         p_result->reg_notif.event_id = eventid;
         BE_STREAM_TO_UINT8(p_result->reg_notif.param.volume, p);
@@ -103,24 +139,35 @@ static tAVRC_STS avrc_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
   return status;
 }
 
-void avrc_parse_notification_rsp(uint8_t* p_stream,
-                                 tAVRC_REG_NOTIF_RSP* p_rsp) {
+tAVRC_STS avrc_parse_notification_rsp(uint8_t* p_stream, uint16_t len,
+                                      tAVRC_REG_NOTIF_RSP* p_rsp) {
+  uint16_t min_len = 1;
+
+  if (len < min_len) goto length_error;
   BE_STREAM_TO_UINT8(p_rsp->event_id, p_stream);
   switch (p_rsp->event_id) {
     case AVRC_EVT_PLAY_STATUS_CHANGE:
+      min_len += 1;
+      if (len < min_len) goto length_error;
       BE_STREAM_TO_UINT8(p_rsp->param.play_status, p_stream);
       break;
 
     case AVRC_EVT_TRACK_CHANGE:
+      min_len += 8;
+      if (len < min_len) goto length_error;
       BE_STREAM_TO_ARRAY(p_stream, p_rsp->param.track, 8);
       break;
 
     case AVRC_EVT_APP_SETTING_CHANGE:
+      min_len += 1;
+      if (len < min_len) goto length_error;
       BE_STREAM_TO_UINT8(p_rsp->param.player_setting.num_attr, p_stream);
       if (p_rsp->param.player_setting.num_attr > AVRC_MAX_APP_SETTINGS) {
         android_errorWriteLog(0x534e4554, "73782082");
         p_rsp->param.player_setting.num_attr = AVRC_MAX_APP_SETTINGS;
       }
+      min_len += p_rsp->param.player_setting.num_attr * 2;
+      if (len < min_len) goto length_error;
       for (int index = 0; index < p_rsp->param.player_setting.num_attr;
            index++) {
         BE_STREAM_TO_UINT8(p_rsp->param.player_setting.attr_id[index],
@@ -150,6 +197,14 @@ void avrc_parse_notification_rsp(uint8_t* p_stream,
     default:
       break;
   }
+
+  return AVRC_STS_NO_ERROR;
+
+length_error:
+  android_errorWriteLog(0x534e4554, "111450417");
+  AVRC_TRACE_WARNING("%s: invalid parameter length %d: must be at least %d",
+                     __func__, len, min_len);
+  return AVRC_STS_INTERNAL_ERR;
 }
 
 static tAVRC_STS avrc_pars_browse_rsp(tAVRC_MSG_BROWSE* p_msg,
@@ -404,16 +459,32 @@ static tAVRC_STS avrc_pars_browse_rsp(tAVRC_MSG_BROWSE* p_msg,
 static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
                                            tAVRC_RESPONSE* p_result,
                                            uint8_t* p_buf, uint16_t* buf_len) {
+  if (p_msg->vendor_len < 4) {
+    android_errorWriteLog(0x534e4554, "111450417");
+    AVRC_TRACE_WARNING("%s: message length %d too short: must be at least 4",
+                       __func__, p_msg->vendor_len);
+    return AVRC_STS_INTERNAL_ERR;
+  }
+
   uint8_t* p = p_msg->p_vendor_data;
   BE_STREAM_TO_UINT8(p_result->pdu, p);
   p++; /* skip the reserved/packe_type byte */
 
   uint16_t len;
+  uint16_t min_len = 0;
   BE_STREAM_TO_UINT16(len, p);
-  AVRC_TRACE_DEBUG("%s ctype:0x%x pdu:0x%x, len:%d", __func__, p_msg->hdr.ctype,
-                   p_result->pdu, len);
+  AVRC_TRACE_DEBUG("%s ctype:0x%x pdu:0x%x, len:%d  vendor_len=0x%x", __func__,
+                   p_msg->hdr.ctype, p_result->pdu, len, p_msg->vendor_len);
+  if (p_msg->vendor_len < len + 4) {
+    android_errorWriteLog(0x534e4554, "111450417");
+    AVRC_TRACE_WARNING("%s: message length %d too short: must be at least %d",
+                       __func__, p_msg->vendor_len, len + 4);
+    return AVRC_STS_INTERNAL_ERR;
+  }
   /* Todo: Issue in handling reject, check */
   if (p_msg->hdr.ctype == AVRC_RSP_REJ) {
+    min_len += 1;
+    if (len < min_len) goto length_error;
     p_result->rsp.status = *p;
     return p_result->rsp.status;
   }
@@ -424,8 +495,7 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
     /* case AVRC_PDU_ABORT_CONTINUATION_RSP:   0x41 */
 
     case AVRC_PDU_REGISTER_NOTIFICATION:
-      avrc_parse_notification_rsp(p, &p_result->reg_notif);
-      break;
+      return avrc_parse_notification_rsp(p, len, &p_result->reg_notif);
 
     case AVRC_PDU_GET_CAPABILITIES:
       if (len == 0) {
@@ -433,12 +503,16 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_caps.capability_id = 0;
         break;
       }
+      min_len += 2;
+      if (len < min_len) goto length_error;
       BE_STREAM_TO_UINT8(p_result->get_caps.capability_id, p);
       BE_STREAM_TO_UINT8(p_result->get_caps.count, p);
       AVRC_TRACE_DEBUG("%s cap id = %d, cap_count = %d ", __func__,
                        p_result->get_caps.capability_id,
                        p_result->get_caps.count);
       if (p_result->get_caps.capability_id == AVRC_CAP_COMPANY_ID) {
+        min_len += MIN(p_result->get_caps.count, AVRC_CAP_MAX_NUM_COMP_ID) * 3;
+        if (len < min_len) goto length_error;
         for (int xx = 0; ((xx < p_result->get_caps.count) &&
                           (xx < AVRC_CAP_MAX_NUM_COMP_ID));
              xx++) {
@@ -446,6 +520,8 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         }
       } else if (p_result->get_caps.capability_id ==
                  AVRC_CAP_EVENTS_SUPPORTED) {
+        min_len += MIN(p_result->get_caps.count, AVRC_CAP_MAX_NUM_EVT_ID);
+        if (len < min_len) goto length_error;
         for (int xx = 0; ((xx < p_result->get_caps.count) &&
                           (xx < AVRC_CAP_MAX_NUM_EVT_ID));
              xx++) {
@@ -459,6 +535,7 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->list_app_attr.num_attr = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(p_result->list_app_attr.num_attr, p);
       AVRC_TRACE_DEBUG("%s attr count = %d ", __func__,
                        p_result->list_app_attr.num_attr);
@@ -468,6 +545,8 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->list_app_attr.num_attr = AVRC_MAX_APP_ATTR_SIZE;
       }
 
+      min_len += p_result->list_app_attr.num_attr;
+      if (len < min_len) goto length_error;
       for (int xx = 0; xx < p_result->list_app_attr.num_attr; xx++) {
         BE_STREAM_TO_UINT8(p_result->list_app_attr.attrs[xx], p);
       }
@@ -478,6 +557,7 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->list_app_values.num_val = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(p_result->list_app_values.num_val, p);
       if (p_result->list_app_values.num_val > AVRC_MAX_APP_ATTR_SIZE) {
         android_errorWriteLog(0x534e4554, "78526423");
@@ -486,6 +566,8 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
 
       AVRC_TRACE_DEBUG("%s value count = %d ", __func__,
                        p_result->list_app_values.num_val);
+      min_len += p_result->list_app_values.num_val;
+      if (len < min_len) goto length_error;
       for (int xx = 0; xx < p_result->list_app_values.num_val; xx++) {
         BE_STREAM_TO_UINT8(p_result->list_app_values.vals[xx], p);
       }
@@ -496,9 +578,8 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_cur_app_val.num_val = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(p_result->get_cur_app_val.num_val, p);
-      tAVRC_APP_SETTING* app_sett = (tAVRC_APP_SETTING*)osi_malloc(
-          p_result->get_cur_app_val.num_val * sizeof(tAVRC_APP_SETTING));
       AVRC_TRACE_DEBUG("%s attr count = %d ", __func__,
                        p_result->get_cur_app_val.num_val);
 
@@ -507,6 +588,13 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_cur_app_val.num_val = AVRC_MAX_APP_ATTR_SIZE;
       }
 
+      min_len += p_result->get_cur_app_val.num_val * 2;
+      if (len < min_len) {
+        p_result->get_cur_app_val.num_val = 0;
+        goto length_error;
+      }
+      tAVRC_APP_SETTING* app_sett = (tAVRC_APP_SETTING*)osi_calloc(
+          p_result->get_cur_app_val.num_val * sizeof(tAVRC_APP_SETTING));
       for (int xx = 0; xx < p_result->get_cur_app_val.num_val; xx++) {
         BE_STREAM_TO_UINT8(app_sett[xx].attr_id, p);
         BE_STREAM_TO_UINT8(app_sett[xx].attr_val, p);
@@ -521,6 +609,7 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_app_attr_txt.num_attr = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(num_attrs, p);
       if (num_attrs > AVRC_MAX_APP_ATTR_SIZE) {
         num_attrs = AVRC_MAX_APP_ATTR_SIZE;
@@ -529,15 +618,33 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
                        p_result->get_app_attr_txt.num_attr);
       p_result->get_app_attr_txt.num_attr = num_attrs;
 
-      p_result->get_app_attr_txt.p_attrs = (tAVRC_APP_SETTING_TEXT*)osi_malloc(
+      p_result->get_app_attr_txt.p_attrs = (tAVRC_APP_SETTING_TEXT*)osi_calloc(
           num_attrs * sizeof(tAVRC_APP_SETTING_TEXT));
       for (int xx = 0; xx < num_attrs; xx++) {
+        min_len += 4;
+        if (len < min_len) {
+          for (int j = 0; j < xx; j++) {
+            osi_free(p_result->get_app_attr_txt.p_attrs[j].p_str);
+          }
+          osi_free_and_reset((void**)&p_result->get_app_attr_txt.p_attrs);
+          p_result->get_app_attr_txt.num_attr = 0;
+          goto length_error;
+        }
         BE_STREAM_TO_UINT8(p_result->get_app_attr_txt.p_attrs[xx].attr_id, p);
         BE_STREAM_TO_UINT16(p_result->get_app_attr_txt.p_attrs[xx].charset_id,
                             p);
         BE_STREAM_TO_UINT8(p_result->get_app_attr_txt.p_attrs[xx].str_len, p);
+        min_len += p_result->get_app_attr_txt.p_attrs[xx].str_len;
+        if (len < min_len) {
+          for (int j = 0; j < xx; j++) {
+            osi_free(p_result->get_app_attr_txt.p_attrs[j].p_str);
+          }
+          osi_free_and_reset((void**)&p_result->get_app_attr_txt.p_attrs);
+          p_result->get_app_attr_txt.num_attr = 0;
+          goto length_error;
+        }
         if (p_result->get_app_attr_txt.p_attrs[xx].str_len != 0) {
-          uint8_t* p_str = (uint8_t*)osi_malloc(
+          uint8_t* p_str = (uint8_t*)osi_calloc(
               p_result->get_app_attr_txt.p_attrs[xx].str_len);
           BE_STREAM_TO_ARRAY(p, p_str,
                              p_result->get_app_attr_txt.p_attrs[xx].str_len);
@@ -555,6 +662,7 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_app_val_txt.num_attr = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(num_vals, p);
       if (num_vals > AVRC_MAX_APP_ATTR_SIZE) {
         num_vals = AVRC_MAX_APP_ATTR_SIZE;
@@ -563,14 +671,32 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
       AVRC_TRACE_DEBUG("%s value count = %d ", __func__,
                        p_result->get_app_val_txt.num_attr);
 
-      p_result->get_app_val_txt.p_attrs = (tAVRC_APP_SETTING_TEXT*)osi_malloc(
+      p_result->get_app_val_txt.p_attrs = (tAVRC_APP_SETTING_TEXT*)osi_calloc(
           num_vals * sizeof(tAVRC_APP_SETTING_TEXT));
       for (int i = 0; i < num_vals; i++) {
+        min_len += 4;
+        if (len < min_len) {
+          for (int j = 0; j < i; j++) {
+            osi_free(p_result->get_app_val_txt.p_attrs[j].p_str);
+          }
+          osi_free_and_reset((void**)&p_result->get_app_val_txt.p_attrs);
+          p_result->get_app_val_txt.num_attr = 0;
+          goto length_error;
+        }
         BE_STREAM_TO_UINT8(p_result->get_app_val_txt.p_attrs[i].attr_id, p);
         BE_STREAM_TO_UINT16(p_result->get_app_val_txt.p_attrs[i].charset_id, p);
         BE_STREAM_TO_UINT8(p_result->get_app_val_txt.p_attrs[i].str_len, p);
+        min_len += p_result->get_app_val_txt.p_attrs[i].str_len;
+        if (len < min_len) {
+          for (int j = 0; j < i; j++) {
+            osi_free(p_result->get_app_val_txt.p_attrs[j].p_str);
+          }
+          osi_free_and_reset((void**)&p_result->get_app_val_txt.p_attrs);
+          p_result->get_app_val_txt.num_attr = 0;
+          goto length_error;
+        }
         if (p_result->get_app_val_txt.p_attrs[i].str_len != 0) {
-          uint8_t* p_str = (uint8_t*)osi_malloc(
+          uint8_t* p_str = (uint8_t*)osi_calloc(
               p_result->get_app_val_txt.p_attrs[i].str_len);
           BE_STREAM_TO_ARRAY(p, p_str,
                              p_result->get_app_val_txt.p_attrs[i].str_len);
@@ -592,20 +718,41 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
         p_result->get_attrs.num_attrs = 0;
         break;
       }
+      min_len += 1;
       BE_STREAM_TO_UINT8(num_attrs, p);
       p_result->get_attrs.num_attrs = num_attrs;
       if (num_attrs) {
         tAVRC_ATTR_ENTRY* p_attrs =
-            (tAVRC_ATTR_ENTRY*)osi_malloc(num_attrs * sizeof(tAVRC_ATTR_ENTRY));
+            (tAVRC_ATTR_ENTRY*)osi_calloc(num_attrs * sizeof(tAVRC_ATTR_ENTRY));
         for (int i = 0; i < num_attrs; i++) {
+          min_len += 8;
+          if (len < min_len) {
+            for (int j = 0; j < i; j++) {
+              osi_free(p_attrs[j].name.p_str);
+            }
+            osi_free(p_attrs);
+            p_result->get_attrs.num_attrs = 0;
+            goto length_error;
+          }
           BE_STREAM_TO_UINT32(p_attrs[i].attr_id, p);
           BE_STREAM_TO_UINT16(p_attrs[i].name.charset_id, p);
           BE_STREAM_TO_UINT16(p_attrs[i].name.str_len, p);
+          min_len += p_attrs[i].name.str_len;
+          if (len < min_len) {
+            for (int j = 0; j < i; j++) {
+              osi_free(p_attrs[j].name.p_str);
+            }
+            osi_free(p_attrs);
+            p_result->get_attrs.num_attrs = 0;
+            goto length_error;
+          }
           if (p_attrs[i].name.str_len > 0) {
             p_attrs[i].name.p_str =
-                (uint8_t*)osi_malloc(p_attrs[i].name.str_len);
+                (uint8_t*)osi_calloc(p_attrs[i].name.str_len);
             BE_STREAM_TO_ARRAY(p, p_attrs[i].name.p_str,
                                p_attrs[i].name.str_len);
+          } else {
+            p_attrs[i].name.p_str = NULL;
           }
         }
         p_result->get_attrs.p_attrs = p_attrs;
@@ -616,6 +763,8 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
       if (len == 0) {
         break;
       }
+      min_len += 9;
+      if (len < min_len) goto length_error;
       BE_STREAM_TO_UINT32(p_result->get_play_status.song_len, p);
       BE_STREAM_TO_UINT32(p_result->get_play_status.song_pos, p);
       BE_STREAM_TO_UINT8(p_result->get_play_status.status, p);
@@ -633,6 +782,12 @@ static tAVRC_STS avrc_ctrl_pars_vendor_rsp(tAVRC_MSG_VENDOR* p_msg,
       return AVRC_STS_BAD_CMD;
   }
   return AVRC_STS_NO_ERROR;
+
+length_error:
+  android_errorWriteLog(0x534e4554, "111450417");
+  AVRC_TRACE_WARNING("%s: invalid parameter length %d: must be at least %d",
+                     __func__, len, min_len);
+  return AVRC_STS_INTERNAL_ERR;
 }
 
 /*******************************************************************************
diff --git a/stack/btm/btm_ble_adv_filter.cc b/stack/btm/btm_ble_adv_filter.cc
index 1f68fb652..54e038efa 100644
--- a/stack/btm/btm_ble_adv_filter.cc
+++ b/stack/btm/btm_ble_adv_filter.cc
@@ -578,7 +578,7 @@ void BTM_LE_PF_uuid_filter(tBTM_BLE_SCAN_COND_OP action,
         UINT32_TO_STREAM(p, uuid_mask.As32Bit());
         len += Uuid::kNumBytes32;
       } else if (uuid_len == Uuid::kNumBytes128) {
-        const auto& tmp = uuid.To128BitLE();
+        const auto& tmp = uuid_mask.To128BitLE();
         ARRAY_TO_STREAM(p, tmp.data(), (int)Uuid::kNumBytes128);
         len += Uuid::kNumBytes128;
       }
diff --git a/stack/l2cap/l2c_main.cc b/stack/l2cap/l2c_main.cc
index a69c02942..eae77a643 100644
--- a/stack/l2cap/l2c_main.cc
+++ b/stack/l2cap/l2c_main.cc
@@ -173,9 +173,6 @@ void l2c_rcv_acl_data(BT_HDR* p_msg) {
 
   if (rcv_cid == L2CAP_CONNECTIONLESS_CID) {
     /* process_connectionless_data (p_lcb); */
-    uint16_t psm;
-    STREAM_TO_UINT16(psm, p);
-    L2CAP_TRACE_DEBUG("GOT CONNECTIONLESS DATA PSM:%d", psm);
     osi_free(p_msg);
     return;
   }
-- 
2.17.1

