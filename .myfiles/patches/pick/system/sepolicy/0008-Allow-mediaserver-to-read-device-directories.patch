From fc35282216e258d9172b9b678c8bd12ddec80165 Mon Sep 17 00:00:00 2001
From: "Kevin F. Haggerty" <haggertk@lineageos.org>
Date: Tue, 13 Nov 2018 20:18:41 -0700
Subject: [PATCH 8/8] Allow mediaserver to read device directories

* Needed both to allow ExternalCameraProvider to probe for
  video devices as well as allow access/recognition of
  external storage

* avc: denied { read } for name="/" dev="tmpfs" ino=6954
  scontext=u:r:mediaserver:s0 tcontext=u:object_r:device:s0
  tclass=dir permissive=1
* avc: denied { open } for name="/" dev="tmpfs" ino=6954
  scontext=u:r:mediaserver:s0 tcontext=u:object_r:device:s0
  tclass=dir permissive=1

Change-Id: I32540b8ec48ff61568094ec87d1bad64570a8e55
---
 public/mediaserver.te | 1 +
 1 file changed, 1 insertion(+)

diff --git a/public/mediaserver.te b/public/mediaserver.te
index 400ebcc8..731e5038 100644
--- a/public/mediaserver.te
+++ b/public/mediaserver.te
@@ -136,6 +136,7 @@ allow mediaserver media_rw_data_file:file create_file_perms;
 # Access to media in /data/preloads
 allow mediaserver preloads_media_file:file { getattr read ioctl };
 
+allow mediaserver device:dir r_dir_perms;
 allow mediaserver ion_device:chr_file r_file_perms;
 allow mediaserver hal_graphics_allocator:fd use;
 allow mediaserver hal_graphics_composer:fd use;
-- 
2.17.1

