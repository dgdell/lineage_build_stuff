From 1840ae1f1cdddfcd89f3f9bfcedb02890d6102b1 Mon Sep 17 00:00:00 2001
From: Al Viro <viro@zeniv.linux.org.uk>
Date: Thu, 29 Nov 2012 22:17:21 -0500
Subject: [PATCH 094/132] lookup_one_len: don't accept . and ..

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Change-Id: I1e7f9f49b9b1d400e5e8de2dfaf46930d7e5cf9c
---
 fs/namei.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/fs/namei.c b/fs/namei.c
index 3a543b8990e..98d42a9a694 100644
--- a/fs/namei.c
+++ b/fs/namei.c
@@ -2153,6 +2153,11 @@ struct dentry *lookup_one_len2(const char *name, struct vfsmount *mnt, struct de
 	if (!len)
 		return ERR_PTR(-EACCES);
 
+	if (unlikely(name[0] == '.')) {
+		if (len < 2 || (len == 2 && name[1] == '.'))
+			return ERR_PTR(-EACCES);
+	}
+
 	while (len--) {
 		c = *(const unsigned char *)name++;
 		if (c == '/' || c == '\0')
-- 
2.17.1

