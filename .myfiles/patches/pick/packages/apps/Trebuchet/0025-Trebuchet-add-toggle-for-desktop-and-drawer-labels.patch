From f1b9bcf682d28c80bad267eb44006e2c0ace7887 Mon Sep 17 00:00:00 2001
From: Joey <joey@lineageos.org>
Date: Wed, 10 Oct 2018 08:27:37 +0200
Subject: [PATCH 25/32] Trebuchet: add toggle for desktop and drawer labels

Change-Id: I98063b7adaf22029c4bfa50d2cac730f3612e121
Signed-off-by: Joey <joey@lineageos.org>
---
 res/values/lineage_strings.xml                  |  4 ++++
 res/xml/launcher_preferences.xml                | 12 ++++++++++++
 src/com/android/launcher3/BubbleTextView.java   | 14 +++++++++++++-
 src/com/android/launcher3/SettingsActivity.java | 14 +++++++++++---
 4 files changed, 40 insertions(+), 4 deletions(-)

diff --git a/res/values/lineage_strings.xml b/res/values/lineage_strings.xml
index 1a3c6f300..f6f5ee421 100644
--- a/res/values/lineage_strings.xml
+++ b/res/values/lineage_strings.xml
@@ -38,4 +38,8 @@
     <string name="grid_size_columns">Columns</string>
     <string name="grid_size_custom_positive">Set</string>
     <string name="grid_size_custom_message">Select custom columns and rows count</string>
+
+    <!-- Hide labels -->
+    <string name="desktop_show_labels">Show icon labels on desktop</string>
+    <string name="drawer_show_labels">Show icon labels in drawer</string>
 </resources>
diff --git a/res/xml/launcher_preferences.xml b/res/xml/launcher_preferences.xml
index 5c5fd125f..f87d0a046 100644
--- a/res/xml/launcher_preferences.xml
+++ b/res/xml/launcher_preferences.xml
@@ -62,4 +62,16 @@
         android:key="pref_grid_size"
         android:title="@string/grid_size_text"
         android:persistent="true" />
+
+    <SwitchPreference
+        android:key="pref_desktop_show_labels"
+        android:title="@string/desktop_show_labels"
+        android:defaultValue="true"
+        android:persistent="true" />
+
+    <SwitchPreference
+        android:key="pref_drawer_show_labels"
+        android:title="@string/drawer_show_labels"
+        android:defaultValue="true"
+        android:persistent="true" />
 </PreferenceScreen>
diff --git a/src/com/android/launcher3/BubbleTextView.java b/src/com/android/launcher3/BubbleTextView.java
index fb7c0ced4..6e52be968 100644
--- a/src/com/android/launcher3/BubbleTextView.java
+++ b/src/com/android/launcher3/BubbleTextView.java
@@ -18,6 +18,7 @@ package com.android.launcher3;
 
 import android.animation.ObjectAnimator;
 import android.content.Context;
+import android.content.SharedPreferences;
 import android.content.res.ColorStateList;
 import android.content.res.TypedArray;
 import android.graphics.Canvas;
@@ -65,6 +66,8 @@ public class BubbleTextView extends TextView implements ItemInfoUpdateReceiver,
 
     private static final int[] STATE_PRESSED = new int[] {android.R.attr.state_pressed};
 
+    private static final String KEY_SHOW_DESKTOP_LABELS = "pref_desktop_show_labels";
+    private static final String KEY_SHOW_DRAWER_LABELS = "pref_drawer_show_labels";
 
     private static final Property<BubbleTextView, Float> BADGE_SCALE_PROPERTY
             = new Property<BubbleTextView, Float>(Float.TYPE, "badgeScale") {
@@ -126,6 +129,8 @@ public class BubbleTextView extends TextView implements ItemInfoUpdateReceiver,
     @ViewDebug.ExportedProperty(category = "launcher")
     private boolean mDisableRelayout = false;
 
+    private boolean mShouldShowLabel;
+
     private IconLoadRequest mIconLoadRequest;
 
     public BubbleTextView(Context context) {
@@ -146,19 +151,24 @@ public class BubbleTextView extends TextView implements ItemInfoUpdateReceiver,
                 R.styleable.BubbleTextView, defStyle, 0);
         mLayoutHorizontal = a.getBoolean(R.styleable.BubbleTextView_layoutHorizontal, false);
 
+        SharedPreferences prefs = Utilities.getPrefs(context.getApplicationContext());
+
         int display = a.getInteger(R.styleable.BubbleTextView_iconDisplay, DISPLAY_WORKSPACE);
         int defaultIconSize = grid.iconSizePx;
         if (display == DISPLAY_WORKSPACE) {
             setTextSize(TypedValue.COMPLEX_UNIT_PX, grid.iconTextSizePx);
             setCompoundDrawablePadding(grid.iconDrawablePaddingPx);
+            mShouldShowLabel = prefs.getBoolean(KEY_SHOW_DESKTOP_LABELS, true);
         } else if (display == DISPLAY_ALL_APPS) {
             setTextSize(TypedValue.COMPLEX_UNIT_PX, grid.allAppsIconTextSizePx);
             setCompoundDrawablePadding(grid.allAppsIconDrawablePaddingPx);
             defaultIconSize = grid.allAppsIconSizePx;
+            mShouldShowLabel = prefs.getBoolean(KEY_SHOW_DRAWER_LABELS, true);
         } else if (display == DISPLAY_FOLDER) {
             setTextSize(TypedValue.COMPLEX_UNIT_PX, grid.folderChildTextSizePx);
             setCompoundDrawablePadding(grid.folderChildDrawablePaddingPx);
             defaultIconSize = grid.folderChildIconSizePx;
+            mShouldShowLabel = prefs.getBoolean(KEY_SHOW_DESKTOP_LABELS, true);
         }
         mCenterVertically = a.getBoolean(R.styleable.BubbleTextView_centerVertically, false);
 
@@ -235,7 +245,9 @@ public class BubbleTextView extends TextView implements ItemInfoUpdateReceiver,
         mBadgeColor = IconPalette.getMutedColor(info.iconColor, 0.54f);
 
         setIcon(iconDrawable);
-        setText(info.title);
+        if (mShouldShowLabel) {
+            setText(info.title);
+        }
         if (info.contentDescription != null) {
             setContentDescription(info.isDisabled()
                     ? getContext().getString(R.string.disabled_app_label, info.contentDescription)
diff --git a/src/com/android/launcher3/SettingsActivity.java b/src/com/android/launcher3/SettingsActivity.java
index 0b67a2fb3..990c1b358 100644
--- a/src/com/android/launcher3/SettingsActivity.java
+++ b/src/com/android/launcher3/SettingsActivity.java
@@ -78,6 +78,8 @@ public class SettingsActivity extends Activity {
 
     public static final String KEY_MINUS_ONE = "pref_enable_minus_one";
     private static final String KEY_GRID_SIZE = "pref_grid_size";
+    private static final String KEY_SHOW_DESKTOP_LABELS = "pref_desktop_show_labels";
+    private static final String KEY_SHOW_DRAWER_LABELS = "pref_drawer_show_labels";
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
@@ -243,9 +245,15 @@ public class SettingsActivity extends Activity {
 
         @Override
         public void onSharedPreferenceChanged(SharedPreferences prefs, String key) {
-            if (KEY_GRID_SIZE.equals(key)) {
-                mGridPref.setSummary(mPrefs.getString(KEY_GRID_SIZE, getDefaultGridSize()));
-                mShouldRestart = true;
+            switch (key) {
+                case KEY_GRID_SIZE:
+                    mGridPref.setSummary(mPrefs.getString(KEY_GRID_SIZE, getDefaultGridSize()));
+                    mShouldRestart = true;
+                    break;
+                case KEY_SHOW_DESKTOP_LABELS:
+                case KEY_SHOW_DRAWER_LABELS:
+                    mShouldRestart = true;
+                    break;
             }
         }
 
-- 
2.17.1

