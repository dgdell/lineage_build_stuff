From 8177a3fda6bb277296c3d8da39b21ce7e2dcf044 Mon Sep 17 00:00:00 2001
From: codeworkx <codeworkx@cyanogenmod.org>
Date: Fri, 8 Jan 2016 19:38:15 +0100
Subject: [PATCH 047/192] Snap: Restart preview when shutter-speed gets
 disabled

Change-Id: I3884b23f1c855cfffeb20ca6e2a760732370d772
---
 src/com/android/camera/PhotoModule.java | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index f2ea70680..2c23e0784 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -4193,6 +4193,19 @@ public class PhotoModule
 
         mParameters.setJpegQuality(jpegQuality);
 
+        // When shutter speed gets disabled preview needs to be restarted
+        if (CameraUtil.isSupported(mParameters, CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED)) {
+            String shutterSpeed = mPreferences.getString(CameraSettings.KEY_SHUTTER_SPEED, null);
+            if (shutterSpeed != null) {
+                String oldShutterSpeed = mParameters.get(CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED);
+                if (!shutterSpeed.equals(oldShutterSpeed) && shutterSpeed.equals("0") &&
+                        mCameraState != PREVIEW_STOPPED) {
+                    Log.v(TAG, "Shutter speed disabled. Restart Preview");
+                    mRestartPreview = true;
+                }
+            }
+        }
+
         // For the following settings, we need to check if the settings are
         // still supported by latest driver, if not, ignore the settings.
 
-- 
2.17.1

