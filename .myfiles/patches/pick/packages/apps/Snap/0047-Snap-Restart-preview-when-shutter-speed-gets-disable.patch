From 53e3f0ec3f792847b22f0e1c4d5d43b87b3f6b06 Mon Sep 17 00:00:00 2001
From: codeworkx <codeworkx@cyanogenmod.org>
Date: Fri, 8 Jan 2016 19:38:15 +0100
Subject: [PATCH 047/194] Snap: Restart preview when shutter-speed gets
 disabled

Change-Id: I3884b23f1c855cfffeb20ca6e2a760732370d772
---
 src/com/android/camera/PhotoModule.java | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index f0873a9a5..130cf64f6 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -4189,6 +4189,19 @@ public class PhotoModule
 
         mParameters.setJpegQuality(jpegQuality);
 
+        // When shutter speed gets disabled preview needs to be restarted
+        if (CameraUtil.isSupported(mParameters, CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED)) {
+            String shutterSpeed = mPreferences.getString(CameraSettings.KEY_SHUTTER_SPEED, null);
+            if (shutterSpeed != null) {
+                String oldShutterSpeed = mParameters.get(CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED);
+                if (!shutterSpeed.equals(oldShutterSpeed) && shutterSpeed.equals("0") &&
+                        mCameraState != PREVIEW_STOPPED) {
+                    Log.v(TAG, "Shutter speed disabled. Restart Preview");
+                    mRestartPreview = true;
+                }
+            }
+        }
+
         // For the following settings, we need to check if the settings are
         // still supported by latest driver, if not, ignore the settings.
 
-- 
2.17.1

