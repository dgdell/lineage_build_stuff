From 679bc98347ed048d38d9c6e66c6b7b6fd99a0ca0 Mon Sep 17 00:00:00 2001
From: Sultanxda <sultanxda@gmail.com>
Date: Sun, 6 Sep 2015 02:16:18 -0700
Subject: [PATCH 031/171] SnapdragonCamera: Reset camera state after taking
 picture

mCameraState gets stuck to SNAPSHOT_IN_PROGRESS after taking a picture using autofocus/not ZSL, thus breaking camera capture.

Properly reset the camera state after taking a picture to fix this.

Change-Id: Ie4bd629d9e1db1ed3e5b5f80c5b02fd000d88c8e
---
 src/com/android/camera/PhotoModule.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index 1b52177f7..1678af223 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -2968,6 +2968,11 @@ public class PhotoModule
         mErrorCallback.setActivity(mActivity);
         mCameraDevice.setErrorCallback(mErrorCallback);
 
+        // Reset camera state after taking a picture
+        if (mCameraState != PREVIEW_STOPPED && mCameraState != INIT) {
+            setCameraState(IDLE);
+        }
+
         if (!mSnapshotOnIdle) {
             mFocusManager.setAeAwbLock(false); // Unlock AE and AWB.
         }
-- 
2.17.1

