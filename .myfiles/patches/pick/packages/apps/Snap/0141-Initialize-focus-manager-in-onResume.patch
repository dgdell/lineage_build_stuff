From f97e3e541233a42f20b8640126e457ab1cca8ca6 Mon Sep 17 00:00:00 2001
From: Danny Baumann <dannybaumann@web.de>
Date: Wed, 30 Nov 2016 10:40:29 +0100
Subject: [PATCH 141/211] Initialize focus manager in onResume().

Since commit 87b4a40d588a7ae8a61cb353c4cff8df37f7b483 moved camera
initialization (and focus manager initialization with it) to a
background thread, the focus manager initialization now races against
the onPreviewRectChanged() call triggered by SurfaceView initialization
in the main thread, potentially leaving the focus manager in an
uninitialized state that prevented taking pictures.

Change-Id: I8cf650d6a67768acd131b3cddad175ed198e0838
---
 src/com/android/camera/PhotoModule.java | 1 +
 src/com/android/camera/VideoModule.java | 1 +
 2 files changed, 2 insertions(+)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index 93ba019ce..244453e4c 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -2544,6 +2544,7 @@ public class PhotoModule
     @Override
     public void onResumeBeforeSuper() {
         mPaused = false;
+        if (mFocusManager == null) initializeFocusManager();
     }
 
     private void openCamera() {
diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index c38cae801..a42562f38 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -1226,6 +1226,7 @@ public class VideoModule implements CameraModule,
     @Override
     public void onResumeBeforeSuper() {
         mPaused = false;
+        if (mFocusManager == null) initializeFocusManager();
     }
 
     @Override
-- 
2.17.1

