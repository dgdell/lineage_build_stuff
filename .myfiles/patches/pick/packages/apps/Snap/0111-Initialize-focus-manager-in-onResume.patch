From a0441ef96759d2b43f10acd52cc26f77bce38864 Mon Sep 17 00:00:00 2001
From: Danny Baumann <dannybaumann@web.de>
Date: Wed, 30 Nov 2016 10:40:29 +0100
Subject: [PATCH 111/173] Initialize focus manager in onResume().

Since commit 87b4a40d588a7ae8a61cb353c4cff8df37f7b483 moved camera
initialization (and focus manager initialization with it) to a
background thread, the focus manager initialization now races against
the onPreviewRectChanged() call triggered by SurfaceView initialization
in the main thread, potentially leaving the focus manager in an
uninitialized state that prevented taking pictures.

Change-Id: I8cf650d6a67768acd131b3cddad175ed198e0838
---
 src/com/android/camera/PhotoModule.java | 1 +
 src/com/android/camera/VideoModule.java | 1 +
 2 files changed, 2 insertions(+)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index 99fce54cc..4bd0e2db8 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -2554,6 +2554,7 @@ public class PhotoModule
     @Override
     public void onResumeBeforeSuper() {
         mPaused = false;
+        if (mFocusManager == null) initializeFocusManager();
     }
 
     private void openCamera() {
diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index 1d34990bd..0fdb858a1 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -1225,6 +1225,7 @@ public class VideoModule implements CameraModule,
     @Override
     public void onResumeBeforeSuper() {
         mPaused = false;
+        if (mFocusManager == null) initializeFocusManager();
     }
 
     @Override
-- 
2.17.1

