From 8363f00c7d8ec3819d01e980f800d4b63042cb8c Mon Sep 17 00:00:00 2001
From: tobigun <hennymcc@yahoo.de>
Date: Sun, 19 Jul 2015 14:15:38 +0200
Subject: [PATCH 057/172] Fix crash if Exif-Tag buffer-length and
 component-count are both 0

Change-Id: Iad9b60d135b4f682c08c3bfc9698cdd10e1086ab
---
 src/com/android/camera/exif/ExifOutputStream.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/com/android/camera/exif/ExifOutputStream.java b/src/com/android/camera/exif/ExifOutputStream.java
index 90d432769..47b95d80f 100644
--- a/src/com/android/camera/exif/ExifOutputStream.java
+++ b/src/com/android/camera/exif/ExifOutputStream.java
@@ -491,7 +491,7 @@ class ExifOutputStream extends FilterOutputStream {
         switch (tag.getDataType()) {
             case ExifTag.TYPE_ASCII:
                 byte buf[] = tag.getStringByte();
-                if (buf.length == tag.getComponentCount()) {
+                if (buf.length == tag.getComponentCount() && buf.length > 0) {
                     buf[buf.length - 1] = 0;
                     dataOutputStream.write(buf);
                 } else {
-- 
2.17.1

