From f2bad2e021b8cb3c2eadc928bc9d67f105849d09 Mon Sep 17 00:00:00 2001
From: Ketut Putu Kumajaya <ketut.kumajaya@gmail.com>
Date: Mon, 25 Apr 2016 22:46:06 +0700
Subject: [PATCH 087/201] Snap: Support override maker and model exif tag

Camera HAL not always return proper values

Change-Id: Id81fe40ac84b0ffb70560e55077d90544139e463
---
 res/values/config.xml                   |  3 +++
 src/com/android/camera/PhotoModule.java | 16 +++++++++++++++-
 2 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/res/values/config.xml b/res/values/config.xml
index 031d60896..8e33f9fd7 100644
--- a/res/values/config.xml
+++ b/res/values/config.xml
@@ -56,4 +56,7 @@
 
     <!-- Enable support for LGE HDR -->
     <bool name="lge_hdr_mode">false</bool>
+
+    <!-- Set this to true to use device manufacturer and model for exif -->
+    <bool name="override_maker_and_model_tag">false</bool>
 </resources>
diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index 47119d99b..934cdcdcc 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -1348,6 +1348,21 @@ public class PhotoModule
                 mUI.setSwipingEnabled(true);
             }
 
+            ExifInterface exif = Exif.getExif(jpegData);
+            boolean overrideMakerAndModelTag = false;
+            if (mApplicationContext != null) {
+                overrideMakerAndModelTag =
+                    mApplicationContext.getResources()
+                       .getBoolean(R.bool.override_maker_and_model_tag);
+            }
+
+            if (overrideMakerAndModelTag) {
+                ExifTag maker = exif.buildTag(ExifInterface.TAG_MAKE, Build.MANUFACTURER);
+                exif.setTag(maker);
+                ExifTag model = exif.buildTag(ExifInterface.TAG_MODEL, Build.MODEL);
+                exif.setTag(model);
+            }
+
             mReceivedSnapNum = mReceivedSnapNum + 1;
             mJpegPictureCallbackTime = System.currentTimeMillis();
             if(mSnapshotMode == CameraInfoWrapper.CAMERA_SUPPORT_MODE_ZSL) {
@@ -1435,7 +1450,6 @@ public class PhotoModule
                 }
             }
             if (!mRefocus || (mRefocus && mReceivedSnapNum == 7)) {
-                ExifInterface exif = Exif.getExif(jpegData);
                 int orientation = Exif.getOrientation(exif);
                 if(mCameraId == CameraHolder.instance().getFrontCameraId()) {
                     IconListPreference selfieMirrorPref = (IconListPreference) mPreferenceGroup
-- 
2.17.1

