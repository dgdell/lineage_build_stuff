From 9ab4602cd4e91a2f57bf1589f45b9e5738abdc72 Mon Sep 17 00:00:00 2001
From: codeworkx <codeworkx@cyanogenmod.org>
Date: Thu, 7 Jan 2016 21:36:55 +0100
Subject: [PATCH 053/211] Snap: add fallback for invalid video qualities

Might happen when updating from previous versions of Snap

Change-Id: Ib52a2daff5a45c33ede1effd7cb7bed2fe61e5cc
---
 src/com/android/camera/VideoModule.java | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index 38be63964..8f19bd8a9 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -890,6 +890,13 @@ public class VideoModule implements CameraModule,
             }
             mPreferences.edit().putString(CameraSettings.KEY_VIDEO_QUALITY, videoQuality).apply();
         }
+
+        // videoQuality must be at least 3 chars long (1x1) and contain the letter "x"
+        if (videoQuality.length() < 3 && !videoQuality.contains("x")) {
+            Log.e(TAG, "Invalid video quality " + videoQuality + ". Fallback to 352x288.");
+            videoQuality = "352x288";
+        }
+
         int quality = CameraSettings.VIDEO_QUALITY_TABLE.get(videoQuality);
 
         // Set video quality.
-- 
2.17.1

