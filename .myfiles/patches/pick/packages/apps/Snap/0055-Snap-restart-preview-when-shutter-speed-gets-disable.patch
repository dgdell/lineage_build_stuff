From aaad7a7070ae0948deb35cee1d30ebbc935e5d5b Mon Sep 17 00:00:00 2001
From: codeworkx <codeworkx@cyanogenmod.org>
Date: Fri, 8 Jan 2016 19:38:15 +0100
Subject: [PATCH 055/211] Snap: restart preview when shutter-speed gets
 disabled

Change-Id: I3884b23f1c855cfffeb20ca6e2a760732370d772
---
 src/com/android/camera/PhotoModule.java | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index 91735cf68..1dc0eaace 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -4003,7 +4003,7 @@ public class PhotoModule
             Log.v(TAG, "new picture_size = " + size.width + " x " + size.height);
             if (old_size != null && size != null) {
                 if(!size.equals(old_size) && mCameraState != PREVIEW_STOPPED) {
-                    Log.v(TAG, "Picture Size changed. Restart Preview");
+                    Log.v(TAG, "Picture Size changed. Restart Preview.");
                     mRestartPreview = true;
                 }
             }
@@ -4170,6 +4170,19 @@ public class PhotoModule
 
         mParameters.setJpegQuality(jpegQuality);
 
+        // When shutter speed gets disabled preview needs to be restarted
+        if (CameraUtil.isSupported(mParameters, CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED)) {
+            String shutterSpeed = mPreferences.getString(CameraSettings.KEY_SHUTTER_SPEED, null);
+            if (shutterSpeed != null) {
+                String oldShutterSpeed = mParameters.get(CameraSettings.KEY_SNAPCAM_SHUTTER_SPEED);
+                if(!shutterSpeed.equals(oldShutterSpeed) && shutterSpeed.equals("0")
+                        && mCameraState != PREVIEW_STOPPED) {
+                    Log.v(TAG, "Shutter speed disabled. Restart Preview.");
+                    mRestartPreview = true;
+                }
+            }
+        }
+
         // For the following settings, we need to check if the settings are
         // still supported by latest driver, if not, ignore the settings.
 
-- 
2.17.1

