From 257f6b51bbbb094589c009f59dfaa772dc35e042 Mon Sep 17 00:00:00 2001
From: Arne Coucheron <arco68@gmail.com>
Date: Sun, 11 Nov 2018 03:08:04 +0100
Subject: [PATCH 106/211] SnapdragonCamera: Lock AE and AWB for tap-to-focus in
 camcorder

Lock the auto exposure (AE) and auto white balance (AWB) when tap-to-focus
is used in the camcorder.

Change-Id: Ieb24e04b74a06b2390eb9302e74b4f69b1486951
Signed-off-by: Sultanxda <sultanxda@gmail.com>
---
 src/com/android/camera/VideoModule.java | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index d2a82b416..5a3accf0b 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -129,6 +129,8 @@ public class VideoModule implements CameraModule,
     private Parameters mParameters;
     private boolean mFocusAreaSupported;
     private boolean mMeteringAreaSupported;
+    private boolean mAeLockSupported;
+    private boolean mAwbLockSupported;
 
     private boolean mIsInReviewMode;
     private boolean mSnapshotInProgress = false;
@@ -574,6 +576,20 @@ public class VideoModule implements CameraModule,
         mPendingSwitchCameraId = -1;
     }
 
+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
+    private void setAutoExposureLockIfSupported() {
+        if (mAeLockSupported) {
+            mParameters.setAutoExposureLock(mFocusManager.getAeAwbLock());
+        }
+    }
+
+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN)
+    private void setAutoWhiteBalanceLockIfSupported() {
+        if (mAwbLockSupported) {
+            mParameters.setAutoWhiteBalanceLock(mFocusManager.getAeAwbLock());
+        }
+    }
+
     @Override
     public void waitingLocationPermissionResult(boolean result) {
         mLocationManager.waitingLocationPermissionResult(result);
@@ -615,6 +631,8 @@ public class VideoModule implements CameraModule,
             mParameters.setFocusAreas(mFocusManager.getFocusAreas());
         if (mMeteringAreaSupported)
             mParameters.setMeteringAreas(mFocusManager.getMeteringAreas());
+        setAutoExposureLockIfSupported();
+        setAutoWhiteBalanceLockIfSupported();
         if (mFocusAreaSupported || mMeteringAreaSupported) {
             mParameters.setFocusMode(mFocusManager.getFocusMode(true));
             mCameraDevice.setParameters(mParameters);
@@ -3122,6 +3140,8 @@ public class VideoModule implements CameraModule,
     private void initializeCapabilities() {
         mFocusAreaSupported = CameraUtil.isFocusAreaSupported(mParameters);
         mMeteringAreaSupported = CameraUtil.isMeteringAreaSupported(mParameters);
+        mAeLockSupported = CameraUtil.isAutoExposureLockSupported(mParameters);
+        mAwbLockSupported = CameraUtil.isAutoWhiteBalanceLockSupported(mParameters);
     }
 
     // Preview texture has been copied. Now camera can be released and the
-- 
2.17.1

