From 241a7cea53afc02d81ba9a086d14c753de7c550f Mon Sep 17 00:00:00 2001
From: maxwen <max.weninger@gmail.com>
Date: Wed, 25 May 2016 21:52:46 +0200
Subject: [PATCH 074/173] Snap: Remove storage menu if no external storage
 available

Change-Id: I9807c7f9303f17eb971ff1a82fbd35dfbdbfa529
Signed-off-by: Zdrowy Gosciu <ZdrowyGosciu+GITHUB@gmail.com>
---
 src/com/android/camera/CameraSettings.java | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/com/android/camera/CameraSettings.java b/src/com/android/camera/CameraSettings.java
index 86eede661..22d228ec4 100755
--- a/src/com/android/camera/CameraSettings.java
+++ b/src/com/android/camera/CameraSettings.java
@@ -1106,6 +1106,7 @@ public class CameraSettings {
         ListPreference seeMoreMode = group.findPreference(KEY_SEE_MORE);
         ListPreference videoEncoder = group.findPreference(KEY_VIDEO_ENCODER);
         ListPreference noiseReductionMode = group.findPreference(KEY_NOISE_REDUCTION);
+        ListPreference savePath = group.findPreference(KEY_CAMERA_SAVEPATH);
 
         // Since the screen could be loaded from different resources, we need
         // to check if the preference is available here
@@ -1220,7 +1221,7 @@ public class CameraSettings {
             final String CAMERA_SAVEPATH_SDCARD = "1";
             final int CAMERA_SAVEPATH_SDCARD_IDX = 1;
             final int CAMERA_SAVEPATH_PHONE_IDX = 0;
-            ListPreference savePath = group.findPreference(KEY_CAMERA_SAVEPATH);
+
             SharedPreferences pref = group.getSharedPreferences();
             String savePathValue = null;
             if (pref != null) {
@@ -1236,7 +1237,13 @@ public class CameraSettings {
                     Log.d(TAG, "set Phone as save path when sdCard is unavailable.");
                     savePath.setValueIndex(CAMERA_SAVEPATH_PHONE_IDX);
                 }
-           }
+            }
+        }
+        if (savePath != null) {
+            Log.d(TAG, "check storage menu " +  SDCard.instance().isWriteable());
+            if (!SDCard.instance().isWriteable()) {
+                removePreference(group, savePath.getKey());
+            }
         }
 
         qcomInitPreferences(group);
-- 
2.17.1

