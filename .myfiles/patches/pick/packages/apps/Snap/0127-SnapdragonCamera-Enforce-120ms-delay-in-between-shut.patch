From 2cbe03d32f5c77e22eb82fe0e550f20daa977292 Mon Sep 17 00:00:00 2001
From: Sultanxda <sultanxda@gmail.com>
Date: Sun, 18 Dec 2016 10:58:42 -0800
Subject: [PATCH 127/173] SnapdragonCamera: Enforce 120ms delay in between
 shutter clicks

To prevent unintentional duplicate photo captures.

Change-Id: I5b24d834ba6eb7e2f606d656a71f5878ab8d08f5
Signed-off-by: Alex Naidis <alex.naidis@linux.com>
---
 src/com/android/camera/PhotoModule.java | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index a7fbfa662..03e5cb5a7 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -160,6 +160,7 @@ public class PhotoModule
     private static final int SET_PHOTO_UI_PARAMS = 11;
     private static final int SWITCH_TO_GCAM_MODULE = 12;
     private static final int ON_PREVIEW_STARTED = 13;
+    private static final int UNLOCK_CAM_SHUTTER = 14;
 
     // The subset of parameters we need to update in setCameraParameters().
     private static final int UPDATE_PARAM_INITIALIZE = 1;
@@ -548,6 +549,11 @@ public class PhotoModule
                     onPreviewStarted();
                     break;
                 }
+
+                case UNLOCK_CAM_SHUTTER: {
+                    mUI.enableShutter(true);
+                    break;
+                }
             }
         }
     }
@@ -1835,10 +1841,12 @@ public class PhotoModule
         mPreviewRestartSupport &= PIXEL_FORMAT_JPEG.equalsIgnoreCase(
                 pictureFormat);
 
+        mUI.enableShutter(false);
+
         // We don't want user to press the button again while taking a
         // multi-second HDR photo. For longshot, no need to disable.
-        if (CameraUtil.SCENE_MODE_HDR.equals(mSceneMode)) {
-            mUI.enableShutter(false);
+        if (!CameraUtil.SCENE_MODE_HDR.equals(mSceneMode)) {
+            mHandler.sendEmptyMessageDelayed(UNLOCK_CAM_SHUTTER, 120);
         }
 
         if (!isShutterSoundOn()) {
-- 
2.17.1

