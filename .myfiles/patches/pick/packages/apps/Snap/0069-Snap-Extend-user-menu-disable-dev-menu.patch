From ef1d7d89e943398cf6d8e124f9828349de0b6457 Mon Sep 17 00:00:00 2001
From: codeworkx <codeworkx@cyanogenmod.org>
Date: Sun, 1 May 2016 12:19:41 +0200
Subject: [PATCH 069/172] Snap: Extend user menu, disable dev menu

Change-Id: Iaa64372e5d196fd0117a32a386686bdb1fd51e45
---
 src/com/android/camera/CameraActivity.java |  4 +++
 src/com/android/camera/PhotoMenu.java      | 42 ++++++++++++++--------
 2 files changed, 31 insertions(+), 15 deletions(-)

diff --git a/src/com/android/camera/CameraActivity.java b/src/com/android/camera/CameraActivity.java
index 0e00e4278..d4db9177f 100755
--- a/src/com/android/camera/CameraActivity.java
+++ b/src/com/android/camera/CameraActivity.java
@@ -396,6 +396,10 @@ public class CameraActivity extends Activity
         mDeveloperMenuEnabled = true;
     }
 
+    public void disableDeveloperMenu() {
+        mDeveloperMenuEnabled = false;
+    }
+
     private String fileNameFromDataID(int dataID) {
         final LocalData localData = mDataAdapter.getLocalData(dataID);
 
diff --git a/src/com/android/camera/PhotoMenu.java b/src/com/android/camera/PhotoMenu.java
index 716a8a6d7..9c408d741 100644
--- a/src/com/android/camera/PhotoMenu.java
+++ b/src/com/android/camera/PhotoMenu.java
@@ -200,7 +200,13 @@ public class PhotoMenu extends MenuController
                 CameraSettings.KEY_SELFIE_MIRROR,
                 CameraSettings.KEY_SHUTTER_SOUND,
                 CameraSettings.KEY_POWER_SHUTTER,
-                CameraSettings.KEY_MAX_BRIGHTNESS
+                CameraSettings.KEY_MAX_BRIGHTNESS,
+                CameraSettings.KEY_SATURATION,
+                CameraSettings.KEY_CONTRAST,
+                CameraSettings.KEY_SHARPNESS,
+                CameraSettings.KEY_AUTOEXPOSURE,
+                CameraSettings.KEY_ANTIBANDING,
+                CameraSettings.KEY_DENOISE
         };
 
         mOtherKeys2 = new String[] {
@@ -223,6 +229,12 @@ public class PhotoMenu extends MenuController
                 CameraSettings.KEY_REDEYE_REDUCTION,
                 CameraSettings.KEY_POWER_SHUTTER,
                 CameraSettings.KEY_MAX_BRIGHTNESS,
+                CameraSettings.KEY_SATURATION,
+                CameraSettings.KEY_CONTRAST,
+                CameraSettings.KEY_SHARPNESS,
+                CameraSettings.KEY_AUTOEXPOSURE,
+                CameraSettings.KEY_ANTIBANDING,
+                CameraSettings.KEY_DENOISE,
                 CameraSettings.KEY_AUTO_HDR,
                 CameraSettings.KEY_HDR_MODE,
                 CameraSettings.KEY_HDR_NEED_1X,
@@ -234,12 +246,6 @@ public class PhotoMenu extends MenuController
                 CameraSettings.KEY_FACE_RECOGNITION,
                 CameraSettings.KEY_SELECTABLE_ZONE_AF,
                 CameraSettings.KEY_PICTURE_FORMAT,
-                CameraSettings.KEY_SATURATION,
-                CameraSettings.KEY_CONTRAST,
-                CameraSettings.KEY_SHARPNESS,
-                CameraSettings.KEY_AUTOEXPOSURE,
-                CameraSettings.KEY_ANTIBANDING,
-                CameraSettings.KEY_DENOISE,
                 CameraSettings.KEY_ADVANCED_FEATURES,
                 CameraSettings.KEY_AE_BRACKET_HDR,
                 CameraSettings.KEY_INSTANT_CAPTURE,
@@ -1297,20 +1303,26 @@ public class PhotoMenu extends MenuController
     }
 
     public void onPreferenceClicked(ListPreference pref, int y) {
-        if (!mActivity.isDeveloperMenuEnabled()) {
-            if (pref.getKey().equals(CameraSettings.KEY_REDEYE_REDUCTION)) {
-                privateCounter++;
-                if (privateCounter >= DEVELOPER_MENU_TOUCH_COUNT) {
+        // Developer menu
+        if (pref.getKey().equals(CameraSettings.KEY_REDEYE_REDUCTION)) {
+            privateCounter++;
+            if (privateCounter >= DEVELOPER_MENU_TOUCH_COUNT) {
+                SharedPreferences prefs = PreferenceManager
+                        .getDefaultSharedPreferences(mActivity);
+                if (!mActivity.isDeveloperMenuEnabled()) {
                     mActivity.enableDeveloperMenu();
-                    SharedPreferences prefs = PreferenceManager
-                            .getDefaultSharedPreferences(mActivity);
                     prefs.edit().putBoolean(CameraSettings.KEY_DEVELOPER_MENU, true).apply();
                     RotateTextToast.makeText(mActivity,
                             "Camera developer option is enabled now", Toast.LENGTH_SHORT).show();
+                } else {
+                    mActivity.disableDeveloperMenu();
+                    prefs.edit().putBoolean(CameraSettings.KEY_DEVELOPER_MENU, false).apply();
+                    RotateTextToast.makeText(mActivity,
+                            "Camera developer option is disabled now", Toast.LENGTH_SHORT).show();
                 }
-            } else {
-                privateCounter = 0;
             }
+        } else {
+            privateCounter = 0;
         }
         LayoutInflater inflater = (LayoutInflater) mActivity.getSystemService(
                 Context.LAYOUT_INFLATER_SERVICE);
-- 
2.17.1

