From d01f57fd583ae16d97f222dae539fd5d03c52406 Mon Sep 17 00:00:00 2001
From: codeworkx <daniel.hillenbrand@codeworkx.de>
Date: Sun, 13 Aug 2017 12:22:05 +0200
Subject: [PATCH 173/194] Snap: Add missing null check on isCamera2Supported

Change-Id: I61c04c7cb8d344573ab7fb11f7114f09aaf24fb7
---
 src/com/android/camera/util/CameraUtil.java | 30 ++++++++++++---------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/src/com/android/camera/util/CameraUtil.java b/src/com/android/camera/util/CameraUtil.java
index 17b513b73..cfdeaff22 100755
--- a/src/com/android/camera/util/CameraUtil.java
+++ b/src/com/android/camera/util/CameraUtil.java
@@ -413,18 +413,24 @@ public class CameraUtil {
         android.hardware.camera2.CameraManager manager = (android.hardware.camera2.CameraManager)context.getSystemService(Context.CAMERA_SERVICE);
 
         try {
-            CameraCharacteristics characteristics = manager.getCameraCharacteristics(manager.getCameraIdList()[0]);
-            int deviceLevel = characteristics.get(CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL);
-
-            switch (deviceLevel) {
-                case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED:
-                    return true;
-                case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_FULL:
-                    return true;
-                case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_3:
-                    return true;
-                default:
-                    return false;
+            String[] cameraIds = manager.getCameraIdList();
+
+            if (cameraIds != null && cameraIds.length > 0) {
+                CameraCharacteristics characteristics =
+                        manager.getCameraCharacteristics(cameraIds[0]);
+                int deviceLevel =
+                        characteristics.get(CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL);
+
+                switch (deviceLevel) {
+                    case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED:
+                        return true;
+                    case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_FULL:
+                        return true;
+                    case CameraCharacteristics.INFO_SUPPORTED_HARDWARE_LEVEL_3:
+                        return true;
+                    default:
+                        return false;
+                }
             }
         } catch(CameraAccessException | NumberFormatException e) {
             Log.e(TAG, "exception trying to get camera characteristics");
-- 
2.17.1

