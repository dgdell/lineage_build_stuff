From 520f3731cf0ea4a98aff4098b097c21ba8e38c69 Mon Sep 17 00:00:00 2001
From: LuK1337 <priv.luk@gmail.com>
Date: Fri, 26 Feb 2016 14:12:55 +0100
Subject: [PATCH 086/206] Snap: Do not crash when cur-focus-scale is null

* Some cameras simply don't set this parameter.
* Also set cur-focus-diopter to 0 if it's null.

Change-Id: Ib1049012de9a58279560c14ed77f83f52c07fe30
---
 src/com/android/camera/PhotoModule.java | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/src/com/android/camera/PhotoModule.java b/src/com/android/camera/PhotoModule.java
index f4463fbf3..17fdb2ec1 100644
--- a/src/com/android/camera/PhotoModule.java
+++ b/src/com/android/camera/PhotoModule.java
@@ -4508,7 +4508,14 @@ public class PhotoModule
             final int maxFocusPos = mParameters.getInt(CameraSettings.KEY_MAX_FOCUS_SCALE);
             //update mparameters to fetch latest focus position
             mParameters = mCameraDevice.getParameters();
-            final int CurFocusPos = mParameters.getInt(CameraSettings.KEY_MANUAL_FOCUS_SCALE);
+            int CurFocusPos = minFocusPos;
+
+            try {
+                 CurFocusPos = mParameters.getInt(CameraSettings.KEY_MANUAL_FOCUS_SCALE);
+            } catch (NumberFormatException e) {
+                 // Do nothing
+            }
+
             focusbar.setProgress(CurFocusPos);
             focusPositionText.setText("Current focus position is " + CurFocusPos);
 
@@ -4560,7 +4567,8 @@ public class PhotoModule
             //update mparameters to fetch latest focus position
             mParameters = mCameraDevice.getParameters();
             final String CurFocusPos = mParameters.get(CameraSettings.KEY_MANUAL_FOCUS_DIOPTER);
-            focusPositionText.setText("Current focus position is " + CurFocusPos);
+            focusPositionText.setText("Current focus position is " +
+                    (CurFocusPos != null ? CurFocusPos : minFocusStr));
             linear.addView(input);
             linear.addView(focusPositionText);
             alert.setView(linear);
-- 
2.17.1

