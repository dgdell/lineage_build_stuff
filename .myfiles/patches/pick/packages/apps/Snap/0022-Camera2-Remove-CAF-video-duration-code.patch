From 740ef2453e53252f4ab9797cc22b7ceba8f386c8 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mikeioannina@gmail.com>
Date: Fri, 24 Oct 2014 11:26:25 +0300
Subject: [PATCH 022/173] Camera2: Remove CAF video duration code

Change-Id: I583e212f3c43a5ddf80fdb16557b3ddd9e3161c2
---
 res/values/camera2arrays.xml               | 15 ---------------
 res/values/qcomarrays.xml                  | 16 ----------------
 res/values/qcomstrings.xml                 | 11 -----------
 res/xml/capture_preferences.xml            |  8 --------
 res/xml/setting_menu_preferences.xml       | 10 ----------
 res/xml/video_preferences.xml              |  7 -------
 src/com/android/camera/CameraSettings.java | 20 --------------------
 src/com/android/camera/CaptureModule.java  |  4 ++++
 src/com/android/camera/VideoMenu.java      |  2 --
 src/com/android/camera/VideoModule.java    | 18 ------------------
 10 files changed, 4 insertions(+), 107 deletions(-)

diff --git a/res/values/camera2arrays.xml b/res/values/camera2arrays.xml
index e05303325..9889d2fa0 100755
--- a/res/values/camera2arrays.xml
+++ b/res/values/camera2arrays.xml
@@ -730,21 +730,6 @@
         <item>320x240</item>
     </string-array>
 
-    <string-array name="pref_camera2_video_duration_entries" translatable="false">
-        <item>@string/pref_camera_video_duration_entry_mms</item>
-        <item>@string/pref_camera_video_duration_entry_10</item>
-        <item>@string/pref_camera_video_duration_entry_30</item>
-        <item>@string/pref_camera_video_duration_entry_nolimit</item>
-    </string-array>
-
-    <!-- The numbers are in minutes, except -1 means the duration suitable for mms. -->
-    <string-array name="pref_camera2_video_duration_entryvalues" translatable="false">
-        <item>-1</item>
-        <item>10</item>
-        <item>30</item>
-        <item>0</item>
-    </string-array>
-
     <string-array name="pref_camera2_videoencoder_entries" translatable="false">
         <item>@string/pref_camera_videoencoder_entry_0</item>
         <item>@string/pref_camera_videoencoder_entry_1</item>
diff --git a/res/values/qcomarrays.xml b/res/values/qcomarrays.xml
index 954ac363f..0a2c33b7c 100755
--- a/res/values/qcomarrays.xml
+++ b/res/values/qcomarrays.xml
@@ -574,22 +574,6 @@
         <item>aac</item>
     </string-array>
 
-    <!-- Camera Preferences Video Duration dialog box entries -->
-    <string-array name="pref_camera_video_duration_entries" translatable="false">
-    <item>@string/pref_camera_video_duration_entry_mms</item>
-    <item>@string/pref_camera_video_duration_entry_10</item>
-    <item>@string/pref_camera_video_duration_entry_30</item>
-    <item>@string/pref_camera_video_duration_entry_nolimit</item>
-    </string-array>
-
-    <!-- The numbers are in minutes, except -1 means the duration suitable for mms. -->
-    <string-array name="pref_camera_video_duration_entryvalues" translatable="false">
-    <item>-1</item>
-    <item>10</item>
-    <item>30</item>
-    <item>0</item>
-    </string-array>
-
     <!-- Camera Preferences Skin Tone Enhancement dialog box entries -->
      <string-array name="pref_camera_skinToneEnhancement_entries">
           <item>@string/pref_camera_skinToneEnhancement_entry_enable</item>
diff --git a/res/values/qcomstrings.xml b/res/values/qcomstrings.xml
index e1aaff79d..1d3237b9d 100755
--- a/res/values/qcomstrings.xml
+++ b/res/values/qcomstrings.xml
@@ -81,17 +81,6 @@
     <!-- Settings screen, Audio encoder dialog radio button choices -->
     <string name="pref_camera_audioencoder_entry_0">AMRNB</string>
     <string name="pref_camera_audioencoder_entry_1">AAC</string>
-    <!-- Default video duration setting. A numerical value.-->
-    <string name="pref_camera_video_duration_default" translatable="false">10</string>
-
-    <!-- Settings screen, Video duration title -->
-    <string name="pref_camera_video_duration_title">Video duration</string>
-
-    <!-- Settings screen, Video duration dialog radio button choices -->
-    <string name="pref_camera_video_duration_entry_mms">30 seconds(MMS)</string>
-    <string name="pref_camera_video_duration_entry_10">10 minutes</string>
-    <string name="pref_camera_video_duration_entry_30">30 minutes</string>
-    <string name="pref_camera_video_duration_entry_nolimit">no limit</string>
 
     <!-- Default Skin Tone Enhancement setting. Do not translate. -->
     <string name="pref_camera_skinToneEnhancement_default">disable</string>
diff --git a/res/xml/capture_preferences.xml b/res/xml/capture_preferences.xml
index 9050f6319..6c61bee56 100755
--- a/res/xml/capture_preferences.xml
+++ b/res/xml/capture_preferences.xml
@@ -213,14 +213,6 @@
         camera:singleIcon="@drawable/ic_settings_quality"
         camera:title="@string/pref_video_quality_title"/>
 
-    <IconListPreference
-        camera:defaultValue="@string/pref_camera_video_duration_default"
-        camera:entries="@array/pref_camera2_video_duration_entries"
-        camera:entryValues="@array/pref_camera2_video_duration_entryvalues"
-        camera:key="pref_camera2_video_duration_key"
-        camera:singleIcon="@drawable/ic_settings_duration"
-        camera:title="@string/pref_camera_video_duration_title"/>
-
     <ListPreference
         camera:defaultValue="@string/pref_camera_videoencoder_default"
         camera:entries="@array/pref_camera2_videoencoder_entries"
diff --git a/res/xml/setting_menu_preferences.xml b/res/xml/setting_menu_preferences.xml
index 0036c11b2..2061b370d 100755
--- a/res/xml/setting_menu_preferences.xml
+++ b/res/xml/setting_menu_preferences.xml
@@ -179,16 +179,6 @@
             android:summary="%s"
             android:title="@string/pref_video_quality_title" />
 
-        <ListPreference
-            android:defaultValue="@string/pref_camera_video_duration_default"
-            android:entries="@array/pref_camera2_video_duration_entries"
-            android:entryValues="@array/pref_camera2_video_duration_entryvalues"
-            android:icon="@drawable/video_duration"
-            android:key="pref_camera2_video_duration_key"
-            android:layout="@layout/preference"
-            android:summary="%s"
-            android:title="@string/pref_camera_video_duration_title" />
-
         <SwitchPreference
             android:defaultValue="false"
             android:icon="@drawable/image_stabilization"
diff --git a/res/xml/video_preferences.xml b/res/xml/video_preferences.xml
index 3fafddda7..4fb74b94f 100644
--- a/res/xml/video_preferences.xml
+++ b/res/xml/video_preferences.xml
@@ -47,13 +47,6 @@
             camera:title="@string/pref_camera_video_tnr_title"
             camera:entries="@array/pref_camera_video_tnr_entries"
             camera:entryValues="@array/pref_camera_video_tnr_entryvalues" />
-    <IconListPreference
-            camera:key="pref_camera_video_duration_key"
-            camera:defaultValue="@string/pref_camera_video_duration_default"
-            camera:title="@string/pref_camera_video_duration_title"
-            camera:singleIcon="@drawable/ic_settings_duration"
-            camera:entries="@array/pref_camera_video_duration_entries"
-            camera:entryValues="@array/pref_camera_video_duration_entryvalues" />
     <IconListPreference
             camera:key="pref_video_time_lapse_frame_interval_key"
             camera:defaultValue="@string/pref_video_time_lapse_frame_interval_default"
diff --git a/src/com/android/camera/CameraSettings.java b/src/com/android/camera/CameraSettings.java
index 5364ecec6..446caa0c1 100755
--- a/src/com/android/camera/CameraSettings.java
+++ b/src/com/android/camera/CameraSettings.java
@@ -83,7 +83,6 @@ public class CameraSettings {
 
     public static final String KEY_VIDEO_ENCODER = "pref_camera_videoencoder_key";
     public static final String KEY_AUDIO_ENCODER = "pref_camera_audioencoder_key";
-    public static final String KEY_VIDEO_DURATION = "pref_camera_video_duration_key";
     public static final String KEY_POWER_MODE = "pref_camera_powermode_key";
     public static final String KEY_PICTURE_FORMAT = "pref_camera_pictureformat_key";
     public static final String KEY_ZSL = "pref_camera_zsl_key";
@@ -201,10 +200,6 @@ public class CameraSettings {
 
     private static final String KEY_QC_PICTURE_FORMAT = "picture-format-values";
     public static final String KEY_VIDEO_ROTATION = "pref_camera_video_rotation_key";
-    private static final String VIDEO_QUALITY_HIGH = "high";
-    private static final String VIDEO_QUALITY_MMS = "mms";
-    private static final String VIDEO_QUALITY_YOUTUBE = "youtube";
-
 
     //manual 3A keys and parameter strings
     public static final String KEY_MANUAL_EXPOSURE = "pref_camera_manual_exp_key";
@@ -279,11 +274,6 @@ public class CameraSettings {
     public static final int CURRENT_VERSION = 5;
     public static final int CURRENT_LOCAL_VERSION = 2;
 
-    public static final int DEFAULT_VIDEO_DURATION = 0; // no limit
-    private static final int MMS_VIDEO_DURATION = (CamcorderProfile.get(CamcorderProfile.QUALITY_LOW) != null) ?
-          CamcorderProfile.get(CamcorderProfile.QUALITY_LOW).duration :30;
-    private static final int YOUTUBE_VIDEO_DURATION = 15 * 60; // 15 mins
-
     private static final String TAG = "CameraSettings";
 
     private final Context mContext;
@@ -1303,7 +1293,6 @@ public class CameraSettings {
             // Just use video quality to replace it and
             // ignore the current settings.
             editor.remove("pref_camera_videoquality_key");
-            editor.remove("pref_camera_video_duration_key");
         }
 
         editor.putInt(KEY_VERSION, CURRENT_VERSION);
@@ -1481,7 +1470,6 @@ public class CameraSettings {
               supported.add(Integer.toString(CamcorderProfile.QUALITY_QCIF));
            }
         }
-
     }
 
     public static ArrayList<String> getSupportedVideoQualities(int cameraId,Parameters parameters) {
@@ -1497,14 +1485,6 @@ public class CameraSettings {
         }
         return supported;
     }
-    public static int getVideoDurationInMillis(String quality) {
-        if (VIDEO_QUALITY_MMS.equals(quality)) {
-            return MMS_VIDEO_DURATION * 1000;
-        } else if (VIDEO_QUALITY_YOUTUBE.equals(quality)) {
-            return YOUTUBE_VIDEO_DURATION * 1000;
-        }
-        return DEFAULT_VIDEO_DURATION * 1000;
-    }
 
     public static boolean isInternalPreviewSupported(Parameters params) {
         boolean ret = false;
diff --git a/src/com/android/camera/CaptureModule.java b/src/com/android/camera/CaptureModule.java
index ca5050eab..cbd545562 100755
--- a/src/com/android/camera/CaptureModule.java
+++ b/src/com/android/camera/CaptureModule.java
@@ -3869,6 +3869,10 @@ public class CaptureModule implements CameraModule, PhotoController,
 
     private void updateMaxVideoDuration() {
         String minutesStr = mSettingsManager.getValue(SettingsManager.KEY_VIDEO_DURATION);
+        if (minutesStr == null) {
+            mMaxVideoDurationInMs = 0;
+            return;
+        }
         int minutes = Integer.parseInt(minutesStr);
         if (minutes == -1) {
             // User wants lowest, set 30s */
diff --git a/src/com/android/camera/VideoMenu.java b/src/com/android/camera/VideoMenu.java
index ca6aa0687..971372bf8 100644
--- a/src/com/android/camera/VideoMenu.java
+++ b/src/com/android/camera/VideoMenu.java
@@ -112,7 +112,6 @@ public class VideoMenu extends MenuController
         mOtherKeys1 = new String[] {
                 CameraSettings.KEY_VIDEOCAMERA_FLASH_MODE,
                 CameraSettings.KEY_VIDEO_QUALITY,
-                CameraSettings.KEY_VIDEO_DURATION,
                 CameraSettings.KEY_RECORD_LOCATION,
                 CameraSettings.KEY_CAMERA_SAVEPATH,
                 CameraSettings.KEY_WHITE_BALANCE,
@@ -122,7 +121,6 @@ public class VideoMenu extends MenuController
         mOtherKeys2 = new String[] {
                 CameraSettings.KEY_VIDEOCAMERA_FLASH_MODE,
                 CameraSettings.KEY_VIDEO_QUALITY,
-                CameraSettings.KEY_VIDEO_DURATION,
                 CameraSettings.KEY_RECORD_LOCATION,
                 CameraSettings.KEY_CAMERA_SAVEPATH,
                 CameraSettings.KEY_WHITE_BALANCE,
diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index 6ffb37b77..15540ddc2 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -840,24 +840,6 @@ public class VideoModule implements CameraModule,
 
         Log.v(TAG, "Audio Encoder selected = " +mAudioEncoder);
 
-        String minutesStr = mPreferences.getString(
-              CameraSettings.KEY_VIDEO_DURATION,
-              mActivity.getString(R.string.pref_camera_video_duration_default));
-        int minutes = -1;
-        try {
-            minutes = Integer.parseInt(minutesStr);
-        } catch(NumberFormatException npe) {
-            // use default value continue
-            minutes = Integer.parseInt(mActivity.getString(
-                         R.string.pref_camera_video_duration_default));
-        }
-        if (minutes == -1) {
-            // User wants lowest, set 30s */
-            mMaxVideoDurationInMs = 30000;
-        } else {
-            // 1 minute = 60000ms
-            mMaxVideoDurationInMs = 60000 * minutes;
-        }
         if(ParametersWrapper.isPowerModeSupported(mParameters)) {
             String powermode = mPreferences.getString(
                     CameraSettings.KEY_POWER_MODE,
-- 
2.17.1

