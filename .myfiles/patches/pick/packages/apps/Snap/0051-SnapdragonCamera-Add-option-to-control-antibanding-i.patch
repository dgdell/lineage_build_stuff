From b18fbd1d46bb2472caa0717000568da48aa67f2f Mon Sep 17 00:00:00 2001
From: Sultanxda <sultanxda@gmail.com>
Date: Mon, 26 Oct 2015 18:39:05 -0700
Subject: [PATCH 051/171] SnapdragonCamera: Add option to control antibanding
 in camcorder

The antibanding setting in camcorder is linked to the setting in camera
mode for better UX (if you change one, the other will change accordingly).

Change-Id: I98c1bc65472cf8eec530f5a7572f46458b0ab3fa
---
 res/values/qcomstrings.xml              |  4 ++--
 res/xml/video_preferences.xml           |  6 ++++++
 src/com/android/camera/VideoMenu.java   |  1 +
 src/com/android/camera/VideoModule.java | 23 +++++++----------------
 4 files changed, 16 insertions(+), 18 deletions(-)

diff --git a/res/values/qcomstrings.xml b/res/values/qcomstrings.xml
index 550b59439..e2505bce3 100755
--- a/res/values/qcomstrings.xml
+++ b/res/values/qcomstrings.xml
@@ -529,8 +529,8 @@
 
      <!-- Settings screen, Anti Banding entries -->
      <string name="pref_camera_antibanding_entry_0">Off</string>
-     <string name="pref_camera_antibanding_entry_1">50 Hz</string>
-     <string name="pref_camera_antibanding_entry_2">60 Hz</string>
+     <string name="pref_camera_antibanding_entry_1">50 Hz (Europe)</string>
+     <string name="pref_camera_antibanding_entry_2">60 Hz (USA)</string>
      <string name="pref_camera_antibanding_entry_3">Auto</string>
 
         <!-- Default color effect setting. -->
diff --git a/res/xml/video_preferences.xml b/res/xml/video_preferences.xml
index bcf52e2fb..3bc72acf9 100644
--- a/res/xml/video_preferences.xml
+++ b/res/xml/video_preferences.xml
@@ -184,6 +184,12 @@
             camera:title="@string/pref_camera_video_rotation_title"
             camera:entries="@array/pref_camera_video_rotation_entries"
             camera:entryValues="@array/pref_camera_video_rotation_entryvalues" />
+    <ListPreference
+            camera:key="pref_camera_antibanding_key"
+            camera:defaultValue="@string/pref_camera_antibanding_default"
+            camera:title="@string/pref_camera_antibanding_title"
+            camera:entries="@array/pref_camera_antibanding_entries"
+            camera:entryValues="@array/pref_camera_antibanding_entryvalues" />
     <ListPreference
             camera:key="pref_camera_zoom_key"
             camera:defaultValue="@string/pref_camera_zoom_default"
diff --git a/src/com/android/camera/VideoMenu.java b/src/com/android/camera/VideoMenu.java
index ce8f3feae..4465292b8 100644
--- a/src/com/android/camera/VideoMenu.java
+++ b/src/com/android/camera/VideoMenu.java
@@ -141,6 +141,7 @@ public class VideoMenu extends MenuController
                 CameraSettings.KEY_VIDEO_ENCODER,
                 CameraSettings.KEY_AUDIO_ENCODER,
                 CameraSettings.KEY_VIDEO_HDR,
+                CameraSettings.KEY_ANTIBANDING,
                 CameraSettings.KEY_POWER_MODE,
                 CameraSettings.KEY_VIDEO_ROTATION,
                 CameraSettings.KEY_VIDEO_CDS_MODE,
diff --git a/src/com/android/camera/VideoModule.java b/src/com/android/camera/VideoModule.java
index 4c615bdb6..b87b3e432 100644
--- a/src/com/android/camera/VideoModule.java
+++ b/src/com/android/camera/VideoModule.java
@@ -362,7 +362,6 @@ public class VideoModule implements CameraModule,
     private boolean mUnsupportedHFRVideoSize = false;
     private boolean mUnsupportedHSRVideoSize = false;
     private boolean mUnsupportedHFRVideoCodec = false;
-    private String mDefaultAntibanding = null;
     boolean mUnsupportedProfile = false;
 
     // This Handler is used to post message back onto the main thread of the
@@ -2417,23 +2416,15 @@ public class VideoModule implements CameraModule,
             }
         }
 
-        if (mDefaultAntibanding == null) {
-            mDefaultAntibanding = mParameters.getAntibanding();
-            Log.d(TAG, "default antibanding value = " + mDefaultAntibanding);
+        // Set anti banding parameter.
+        String antiBanding = mPreferences.getString(
+                 CameraSettings.KEY_ANTIBANDING,
+                 mActivity.getString(R.string.pref_camera_antibanding_default));
+        Log.v(TAG, "antiBanding value =" + antiBanding);
+        if (CameraUtil.isSupported(antiBanding, mParameters.getSupportedAntibanding())) {
+            mParameters.setAntibanding(antiBanding);
         }
 
-        if (disMode.equals("enable")) {
-            Log.d(TAG, "dis is enabled, set antibanding to auto.");
-            if (isSupported(Parameters.ANTIBANDING_AUTO, mParameters.getSupportedAntibanding())) {
-                mParameters.setAntibanding(Parameters.ANTIBANDING_AUTO);
-            }
-        } else {
-            if (isSupported(mDefaultAntibanding, mParameters.getSupportedAntibanding())) {
-                mParameters.setAntibanding(mDefaultAntibanding);
-            }
-        }
-        Log.d(TAG, "antiBanding value = " + mParameters.getAntibanding());
-
         mUnsupportedHFRVideoSize = false;
         mUnsupportedHFRVideoCodec = false;
         mUnsupportedHSRVideoSize = false;
-- 
2.17.1

