From 9b994b1c7680ec6a6501c941663035d99e85d811 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Tue, 8 Aug 2017 21:18:48 +0300
Subject: [PATCH 01/12] Use set_prop() macro for property sets

Change-Id: Id67a05f8ed718cad5856613c2700f4ce1e404cf0
---
 private/mirrorlink.te               |  4 ++--
 private/wfdservice.te               |  3 ---
 vendor/apq8098_latv/init_shell.te   |  2 +-
 vendor/common/fidodaemon.te         |  3 ---
 vendor/common/hal_display_color.te  |  2 +-
 vendor/common/hal_sensors.te        |  2 +-
 vendor/common/hal_telephony.te      |  2 +-
 vendor/common/init_shell.te         |  2 +-
 vendor/common/location.te           |  4 ++--
 vendor/common/mirrorlink.te         |  2 +-
 vendor/common/nqnfcinfo.te          |  2 +-
 vendor/common/peripheral_manager.te |  2 +-
 vendor/common/poweroffalarm_app.te  |  2 +-
 vendor/common/qcomsysd.te           |  2 +-
 vendor/common/qdma_app.te           |  2 +-
 vendor/common/qdmastatsd.te         |  2 +-
 vendor/common/qseecomd.te           |  2 --
 vendor/common/qseeproxy.te          |  3 ---
 vendor/common/qti_logkit_app.te     |  2 +-
 vendor/common/recovery.te           |  2 +-
 vendor/common/system_app.te         | 15 ++++++---------
 vendor/common/system_server.te      | 17 +++++++----------
 vendor/common/wcnss_filter.te       |  2 +-
 vendor/common/wcnss_service.te      |  4 ++--
 vendor/common/wifi_ftmd.te          |  4 ++--
 vendor/common/wigighalsvc.te        |  2 +-
 vendor/common/zygote.te             |  3 ++-
 vendor/msm8937/init_shell.te        |  7 +++----
 vendor/msm8953/init_shell.te        |  5 ++---
 vendor/msm8996/init_shell.te        |  2 +-
 vendor/msm8998/init_shell.te        |  2 +-
 vendor/msmsteppe/init_shell.te      |  6 ++----
 vendor/sdm660/init_shell.te         |  6 +++---
 vendor/sdm710/init_shell.te         |  4 +---
 vendor/test/fidotest.te             |  3 ---
 vendor/test/qseeproxysample.te      |  3 ---
 36 files changed, 52 insertions(+), 80 deletions(-)

diff --git a/private/mirrorlink.te b/private/mirrorlink.te
index b9684286..8a21fe52 100644
--- a/private/mirrorlink.te
+++ b/private/mirrorlink.te
@@ -82,8 +82,8 @@ hal_client_domain(mirrorlink, hal_graphics_composer);
 hal_client_domain(mirrorlink, hal_graphics_allocator);
 
 # Allow RW access to USB properties.
-set_prop(mirrorlink, exported_system_radio_prop);
-get_prop(mirrorlink, system_prop);
+set_prop(mirrorlink, exported_system_radio_prop)
+get_prop(mirrorlink, system_prop)
 
 # Allow access to usb ncm state from net
 allow mirrorlink sysfs_net:dir r_dir_perms;
diff --git a/private/wfdservice.te b/private/wfdservice.te
index c9d48257..6eb09435 100644
--- a/private/wfdservice.te
+++ b/private/wfdservice.te
@@ -68,9 +68,6 @@ allow wfdservice graphics_device:chr_file rw_file_perms;
 #Allow access to encoder for YUV statistics
 allow wfdservice gpu_device:chr_file rw_file_perms;
 
-#Allow communication with init over property server
-unix_socket_connect(wfdservice, property, init);
-
 #Allow access to /dev/video/* devices for encoding/decoding
 allow wfdservice video_device:chr_file rw_file_perms;
 allow wfdservice video_device:dir r_dir_perms;
diff --git a/vendor/apq8098_latv/init_shell.te b/vendor/apq8098_latv/init_shell.te
index 32fe1779..77a8fbb8 100644
--- a/vendor/apq8098_latv/init_shell.te
+++ b/vendor/apq8098_latv/init_shell.te
@@ -30,7 +30,7 @@ allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
 
 # For VR
-allow qti_init_shell ctl_qvrd_prop:property_service set;
+set_prop(qti_init_shell, ctl_qvrd_prop)
 allow qti_init_shell sysfs_cpu_boost:dir r_dir_perms;
 allow qti_init_shell sysfs_cpu_boost:file rw_file_perms;
 allow qti_init_shell sysfs_devfreq:lnk_file r_file_perms;
diff --git a/vendor/common/fidodaemon.te b/vendor/common/fidodaemon.te
index 79fb1515..a8f754d8 100644
--- a/vendor/common/fidodaemon.te
+++ b/vendor/common/fidodaemon.te
@@ -17,9 +17,6 @@ binder_call(fidodaemon, system_app)
 #Allow fidodaemon to be registered with service manager
 allow fidodaemon fidodaemon_service:service_manager add;
 
-#Allow communication with init over property server
-unix_socket_connect(fidodaemon, property, init);
-
 #Allow access to tee device
 allow fidodaemon tee_device:chr_file rw_file_perms;
 
diff --git a/vendor/common/hal_display_color.te b/vendor/common/hal_display_color.te
index 8efc8561..51a2ab31 100644
--- a/vendor/common/hal_display_color.te
+++ b/vendor/common/hal_display_color.te
@@ -52,4 +52,4 @@ add_hwservice(hal_display_color_server, hal_display_postproc_hwservice)
 allow hal_display_postproc_client hal_display_postproc_hwservice:hwservice_manager find;
 
 # Set vendor_qdcmss property
-set_prop(hal_display_color, vendor_qdcmss_prop);
+set_prop(hal_display_color, vendor_qdcmss_prop)
diff --git a/vendor/common/hal_sensors.te b/vendor/common/hal_sensors.te
index e0ef6648..597d65b6 100644
--- a/vendor/common/hal_sensors.te
+++ b/vendor/common/hal_sensors.te
@@ -30,7 +30,7 @@ userdebug_or_eng(`
     diag_use(hal_sensors)
     allow hal_sensors debugfs_tracing:file { open write };
 ')
-set_prop(hal_sensors, slpi_prop);
+set_prop(hal_sensors, slpi_prop)
 allow hal_sensors self:{ socket qipcrtr_socket } create_socket_perms;
 allowxperm hal_sensors self:{ socket qipcrtr_socket } ioctl msm_sock_ipc_ioctls;
 allow hal_sensors sysfs_socinfo:file r_file_perms;
diff --git a/vendor/common/hal_telephony.te b/vendor/common/hal_telephony.te
index b134fad5..194ceba8 100644
--- a/vendor/common/hal_telephony.te
+++ b/vendor/common/hal_telephony.te
@@ -25,4 +25,4 @@
 #OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 #IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-set_prop(hal_telephony_server, vendor_radio_prop);
+set_prop(hal_telephony_server, vendor_radio_prop)
diff --git a/vendor/common/init_shell.te b/vendor/common/init_shell.te
index 5f26b4bd..d67db345 100644
--- a/vendor/common/init_shell.te
+++ b/vendor/common/init_shell.te
@@ -196,7 +196,7 @@ allow qti_init_shell sysfs_cpu_boost:file w_file_perms;
 allow qti_init_shell vendor_mbn_data_file:dir create_dir_perms;
 allow qti_init_shell vendor_mbn_data_file:file create_file_perms;
 
-set_prop(qti_init_shell, vendor_rild_libpath_prop);
+set_prop(qti_init_shell, vendor_rild_libpath_prop)
 set_prop(qti_init_shell, ctl_vendor_hbtp_prop)
 set_prop(qti_init_shell, vendor_radio_prop)
 
diff --git a/vendor/common/location.te b/vendor/common/location.te
index a9ae58b7..5b4dca70 100644
--- a/vendor/common/location.te
+++ b/vendor/common/location.te
@@ -64,7 +64,7 @@ allow location hal_gnss_qti:unix_dgram_socket sendto;
 netmgr_socket(location);
 
 #Allow access to properties
-set_prop(location, location_prop);
+set_prop(location, location_prop)
 
 #diag
 userdebug_or_eng(`
@@ -102,4 +102,4 @@ get_prop(location, vendor_wifi_prop)
 allow location self:capability2 wake_alarm;
 
 #allow qdma prop
-get_prop(location, vendor_qdma_prop);
+get_prop(location, vendor_qdma_prop)
diff --git a/vendor/common/mirrorlink.te b/vendor/common/mirrorlink.te
index 85c13ac2..d65f31be 100644
--- a/vendor/common/mirrorlink.te
+++ b/vendor/common/mirrorlink.te
@@ -26,7 +26,7 @@
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 # Allow read access to mirrorlink specific property type.
-get_prop(mirrorlink, vendor_mirrorlink_prop);
+get_prop(mirrorlink, vendor_mirrorlink_prop)
 
 # Allow read access to udc connection state
 allow mirrorlink sysfs_usb_controller:dir r_dir_perms;
diff --git a/vendor/common/nqnfcinfo.te b/vendor/common/nqnfcinfo.te
index 814b2f51..fb5a6079 100644
--- a/vendor/common/nqnfcinfo.te
+++ b/vendor/common/nqnfcinfo.te
@@ -33,7 +33,7 @@ init_daemon_domain(nqnfcinfo)
 
 r_dir_file(nqnfcinfo, sysfs_socinfo);
 
-set_prop(nqnfcinfo, nfc_nq_prop);
+set_prop(nqnfcinfo, nfc_nq_prop)
 
 # Access device nodes inside /dev/nq-nci
 allow nqnfcinfo nfc_device:chr_file rw_file_perms;
diff --git a/vendor/common/peripheral_manager.te b/vendor/common/peripheral_manager.te
index c47af7c1..68a964e9 100644
--- a/vendor/common/peripheral_manager.te
+++ b/vendor/common/peripheral_manager.te
@@ -28,4 +28,4 @@ r_dir_file(vendor_per_mgr, sysfs)
 allow vendor_per_mgr sysfs_data:file r_file_perms;
 
 # Set the peripheral state property
-set_prop(vendor_per_mgr, vendor_per_mgr_state_prop);
+set_prop(vendor_per_mgr, vendor_per_mgr_state_prop)
diff --git a/vendor/common/poweroffalarm_app.te b/vendor/common/poweroffalarm_app.te
index 2401d98d..a8b9ca15 100644
--- a/vendor/common/poweroffalarm_app.te
+++ b/vendor/common/poweroffalarm_app.te
@@ -45,6 +45,6 @@ allow poweroffalarm_app surfaceflinger_service:service_manager find;
 allow poweroffalarm_app audioserver_service:service_manager find;
 allow poweroffalarm_app mediaserver_service:service_manager find;
 
-get_prop(poweroffalarm_app, vendor_alarm_boot_prop);
+get_prop(poweroffalarm_app, vendor_alarm_boot_prop)
 
 get_prop(poweroffalarm_app, vendor_iop_prop)
diff --git a/vendor/common/qcomsysd.te b/vendor/common/qcomsysd.te
index 9d71cb9f..4cd44232 100755
--- a/vendor/common/qcomsysd.te
+++ b/vendor/common/qcomsysd.te
@@ -22,7 +22,7 @@ allow vendor_qcomsysd self:capability { sys_boot };
 allow vendor_qcomsysd self:qipcrtr_socket create_socket_perms_no_ioctl;
 use_vendor_per_mgr(vendor_qcomsysd);
 #allow qcomsysd access boot mode switch
-set_prop(vendor_qcomsysd, vendor_boot_mode_prop);
+set_prop(vendor_qcomsysd, vendor_boot_mode_prop)
 
 #diag
 userdebug_or_eng(`
diff --git a/vendor/common/qdma_app.te b/vendor/common/qdma_app.te
index ce7aaddf..bcea2bdf 100644
--- a/vendor/common/qdma_app.te
+++ b/vendor/common/qdma_app.te
@@ -70,4 +70,4 @@ allow qdma_app system_app_data_file:dir create_dir_perms;
 allow qdma_app system_app_data_file:file create_file_perms;
 
 # allow qdma_prop
-set_prop(qdma_app, vendor_qdma_prop);
+set_prop(qdma_app, vendor_qdma_prop)
diff --git a/vendor/common/qdmastatsd.te b/vendor/common/qdmastatsd.te
index 239b90c6..d2e8507d 100644
--- a/vendor/common/qdmastatsd.te
+++ b/vendor/common/qdmastatsd.te
@@ -105,4 +105,4 @@ userdebug_or_eng(`
 #read_logd(qdmastatsd);
 
 # allow qdma_prop
-set_prop(qdmastatsd, vendor_qdma_prop);
+set_prop(qdmastatsd, vendor_qdma_prop)
diff --git a/vendor/common/qseecomd.te b/vendor/common/qseecomd.te
index fbad4609..7bb9d604 100644
--- a/vendor/common/qseecomd.te
+++ b/vendor/common/qseecomd.te
@@ -55,8 +55,6 @@ allow tee sysfs_securetouch:file rw_file_perms;
 binder_call(tee, surfaceflinger)
 #binder_use(tee)
 
-#allow tee system_app:unix_dgram_socket sendto;
-unix_socket_connect(tee, property, init)
 
 userdebug_or_eng(`
   allow tee su:unix_dgram_socket sendto;
diff --git a/vendor/common/qseeproxy.te b/vendor/common/qseeproxy.te
index 12517fb3..7008ba40 100644
--- a/vendor/common/qseeproxy.te
+++ b/vendor/common/qseeproxy.te
@@ -43,9 +43,6 @@ allow qseeproxy qseeproxy_service:service_manager add;
 #Allow qseeproxy to use system_server via binder to check caller identity
 binder_call(qseeproxy, system_server)
 
-#Allow communication with init over property server
-unix_socket_connect(qseeproxy, property, init);
-
 #Allow access to tee device
 allow qseeproxy tee_device:chr_file rw_file_perms;
 
diff --git a/vendor/common/qti_logkit_app.te b/vendor/common/qti_logkit_app.te
index f94c280c..52640a1f 100644
--- a/vendor/common/qti_logkit_app.te
+++ b/vendor/common/qti_logkit_app.te
@@ -71,7 +71,7 @@ allow qti_logkit_app qti_logkit_pub_data_file:file create_file_perms;
 allow qti_logkit_app wcnss_service_exec:file rx_file_perms;
 
 # bugreport
-allow qti_logkit_app ctl_dumpstate_prop:property_service set;
+set_prop(qti_logkit_app, ctl_dumpstate_prop)
 unix_socket_connect(qti_logkit_app, dumpstate, dumpstate)
 
 # ANR
diff --git a/vendor/common/recovery.te b/vendor/common/recovery.te
index 7c86b272..2d23f9fd 100755
--- a/vendor/common/recovery.te
+++ b/vendor/common/recovery.te
@@ -22,6 +22,6 @@ recovery_only(`
     # Enable adb on configfs devices
     allow recovery configfs:file rw_file_perms;
     allow recovery configfs:dir rw_dir_perms;
-    set_prop(recovery, ffs_prop);
+    set_prop(recovery, ffs_prop)
     get_prop(recovery, vendor_boot_mode_prop)
 ')
diff --git a/vendor/common/system_app.te b/vendor/common/system_app.te
index 05d10ada..78229acb 100644
--- a/vendor/common/system_app.te
+++ b/vendor/common/system_app.te
@@ -28,10 +28,8 @@ allow system_app fm_radio_device:chr_file r_file_perms;
 r_dir_file(system_app, bluetooth_data_file);
 r_dir_file(system_app, bt_firmware_file);
 
-allow system_app {
-    fm_prop
-    usf_prop
-}:property_service set;
+set_prop(system_app, fm_prop)
+set_prop(system_app, usf_prop)
 
 allow system_app {
     atfwd_service
@@ -65,7 +63,7 @@ allow system_app bluetooth:unix_stream_socket ioctl;
 hal_client_domain(system_app, hal_hbtp)
 
 #access to wifi_ftmd
-allow system_app vendor_wifi_ftmd_prop:property_service set;
+set_prop(system_app, vendor_wifi_ftmd_prop)
 #unix_socket_send(system_app, wififtmd, wifi_ftmd)
 
 # allow system_app to interact with dtseagleservice
@@ -123,7 +121,7 @@ allow system_app qti_logkit_priv_socket:dir r_dir_perms;
 #allow system_app qti_logkit_priv_socket:sock_file r_file_perms;
 
 # bugreport
-allow system_app ctl_dumpstate_prop:property_service set;
+set_prop(system_app, ctl_dumpstate_prop)
 unix_socket_connect(system_app, dumpstate, dumpstate)
 
 # allow gba auth service to add itself as system service
@@ -183,19 +181,18 @@ hal_client_domain(system_app, hal_perf)
 
 #allow system app to interact with the esepowermanager
 hal_client_domain(system_app, hal_esepowermanager)
-allow system_app fm_prop:file r_file_perms;
 
 #allow system_app access factory
 hal_client_domain(system_app, vendor_hal_factory_qti);
 
 #Wi-Fi Display
-set_prop(system_app, wfd_service_prop);
+set_prop(system_app, wfd_service_prop)
 userdebug_or_eng(`
 allow system_app wfd_debug_prop:file r_file_perms;
 ')
 
 # allow system app to set mirrorlink prop
-set_prop(system_app, vendor_mirrorlink_prop);
+set_prop(system_app, vendor_mirrorlink_prop)
 
 #secureUI
 hal_client_domain(system_app, hal_qdutils_disp);
diff --git a/vendor/common/system_server.te b/vendor/common/system_server.te
index 909308ee..447cfdc7 100644
--- a/vendor/common/system_server.te
+++ b/vendor/common/system_server.te
@@ -30,10 +30,8 @@ allow system_server {
 allow system_server qtitetherservice_service:service_manager find;
 
 #For ANT tty communication and to set wc_transport prop
-allow system_server {
-    vendor_bluetooth_prop
-    usf_prop
-}:property_service set;
+set_prop(system_server, vendor_bluetooth_prop)
+set_prop(system_server, usf_prop)
 
 # required for ANT App to connectto wcnss_filter sockets
 allow system_server bluetooth:unix_stream_socket connectto;
@@ -57,7 +55,7 @@ type_transition system_server location_data_file:sock_file location_socket "alar
 #For wifistatemachine
 allow system_server kernel:key search;
 allow system_server wlan_device:chr_file rw_file_perms;
-allow system_server vendor_softap_prop:property_service set;
+set_prop(system_server, vendor_softap_prop)
 allow system_server vendor_softap_prop:file r_file_perms;
 
 #For ssr
@@ -110,7 +108,7 @@ allow system_server qti_logkit:fd use;
 allow system_server qti_logkit:fifo_file write;
 
 #Rules for system server to talk to peripheral manager
-get_prop(system_server, vendor_per_mgr_state_prop);
+get_prop(system_server, vendor_per_mgr_state_prop)
 
 # Allow system server access to qfp daemon
 binder_call(system_server, qfp-daemon);
@@ -118,15 +116,14 @@ binder_call(system_server, fps_hal)
 allow system_server iqfp_service:service_manager find;
 
 # For shutdown animation
-allow system_server ctl_bootanim_prop:property_service set;
+set_prop(system_server, ctl_bootanim_prop)
 
 # allow tethering to access dhcp leases
 r_dir_file(system_server, dhcp_data_file)
 
 # Allow system server to access fst,wigig system properties
-allow system_server fst_prop:property_service set;
-get_prop(system_server, fst_prop);
-set_prop(system_server, wigig_prop);
+set_prop(system_server, fst_prop)
+set_prop(system_server, wigig_prop)
 
 #allow access to fingerprintd data file
 allow system_server fingerprintd_data_file:file { r_file_perms unlink };
diff --git a/vendor/common/wcnss_filter.te b/vendor/common/wcnss_filter.te
index fae70de3..67c4f1f8 100644
--- a/vendor/common/wcnss_filter.te
+++ b/vendor/common/wcnss_filter.te
@@ -41,7 +41,7 @@ allow wcnss_filter {
 
 #wakelock policy
 wakelock_use(wcnss_filter);
-set_prop(wcnss_filter, vendor_bluetooth_prop);
+set_prop(wcnss_filter, vendor_bluetooth_prop)
 
 #For bluetooth firmware
 r_dir_file(wcnss_filter, bt_firmware_file)
diff --git a/vendor/common/wcnss_service.te b/vendor/common/wcnss_service.te
index fce80cb0..bade29f4 100644
--- a/vendor/common/wcnss_service.te
+++ b/vendor/common/wcnss_service.te
@@ -66,10 +66,10 @@ get_prop(wcnss_service, hwservicemanager_prop)
 hal_client_domain(wcnss_service, hal_perf)
 
 # read persist.vendor.wigig.npt.enable
-get_prop(wcnss_service, wigig_prop);
+get_prop(wcnss_service, wigig_prop)
 
 # allow to read /sys/class/net file
 r_dir_file(wcnss_service, sysfs_net);
 
 # set property to vendor.wlan is enable
-set_prop(wcnss_service, vendor_wifi_prop);
+set_prop(wcnss_service, vendor_wifi_prop)
diff --git a/vendor/common/wifi_ftmd.te b/vendor/common/wifi_ftmd.te
index 2f61c08d..a8a47460 100644
--- a/vendor/common/wifi_ftmd.te
+++ b/vendor/common/wifi_ftmd.te
@@ -31,6 +31,6 @@ init_daemon_domain(wifi_ftmd)
 
 net_domain(wifi_ftmd)
 
-set_prop(wifi_ftmd,vendor_wifi_ftmd_prop);
+set_prop(wifi_ftmd,vendor_wifi_ftmd_prop)
 allow wifi_ftmd self:capability net_admin;
-allow wifi_ftmd vendor_wifi_ftmd_prop:property_service set;
+set_prop(wifi_ftmd, vendor_wifi_ftmd_prop)
diff --git a/vendor/common/wigighalsvc.te b/vendor/common/wigighalsvc.te
index b978fbf0..1424706d 100644
--- a/vendor/common/wigighalsvc.te
+++ b/vendor/common/wigighalsvc.te
@@ -46,7 +46,7 @@ set_prop(hal_wigig, ctl_vendor_wigigsvc_prop)
 
 # access wigig properties
 # need to write vendor.wigig.driver.status
-set_prop(hal_wigig, wigig_prop);
+set_prop(hal_wigig, wigig_prop)
 
 # access wifi vendor data files
 r_dir_file(hal_wigig, wifi_vendor_data_file)
diff --git a/vendor/common/zygote.te b/vendor/common/zygote.te
index 5cc8dd65..607bec8d 100644
--- a/vendor/common/zygote.te
+++ b/vendor/common/zygote.te
@@ -27,5 +27,6 @@
 
 typeattribute zygote system_writes_vendor_properties_violators;
 # persist.service.bdroid.bdaddr hw.cabl.level
-allow zygote { vendor_bluetooth_prop system_prop } :property_service set;
+set_prop(zygote, vendor_bluetooth_prop)
+set_prop(zygote, system_prop)
 get_prop(zygote, vendor_mpctl_prop)
diff --git a/vendor/msm8937/init_shell.te b/vendor/msm8937/init_shell.te
index 1eb0a315..976c915a 100644
--- a/vendor/msm8937/init_shell.te
+++ b/vendor/msm8937/init_shell.te
@@ -25,10 +25,9 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
+# media_msm8937_version_prop - to choose target version specific media_codecs.xml
+set_prop(qti_init_shell, vendor_media_msm8937_version_prop)
+
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
-
-allow qti_init_shell {
-    vendor_media_msm8937_version_prop
-}:property_service set;
diff --git a/vendor/msm8953/init_shell.te b/vendor/msm8953/init_shell.te
index 47784574..143a5ee6 100644
--- a/vendor/msm8953/init_shell.te
+++ b/vendor/msm8953/init_shell.te
@@ -25,9 +25,8 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-allow qti_init_shell {
-    vendor_media_msm8953_version_prop
-}:property_service set;
+# media_msm8953_version_prop - to choose target version specific media_codecs.xml
+set_prop(qti_init_shell, vendor_media_msm8953_version_prop)
 
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
diff --git a/vendor/msm8996/init_shell.te b/vendor/msm8996/init_shell.te
index 5546fa1a..e2995e5c 100644
--- a/vendor/msm8996/init_shell.te
+++ b/vendor/msm8996/init_shell.te
@@ -25,4 +25,4 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
-allow qti_init_shell ctl_qvrd_prop:property_service set;
+set_prop(qti_init_shell, ctl_qvrd_prop)
diff --git a/vendor/msm8998/init_shell.te b/vendor/msm8998/init_shell.te
index c0e5dd44..0b267e8f 100644
--- a/vendor/msm8998/init_shell.te
+++ b/vendor/msm8998/init_shell.te
@@ -30,7 +30,7 @@ allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
 
 # For VR
-allow qti_init_shell ctl_qvrd_prop:property_service set;
+set_prop(qti_init_shell, ctl_qvrd_prop)
 
 # For LPMs
 allow qti_init_shell sysfs_msm_power:file rw_file_perms;
diff --git a/vendor/msmsteppe/init_shell.te b/vendor/msmsteppe/init_shell.te
index fa5ccef9..1e138e59 100644
--- a/vendor/msmsteppe/init_shell.te
+++ b/vendor/msmsteppe/init_shell.te
@@ -27,7 +27,5 @@
 
 # media_sm6150_version_prop - to choose target version specific media_codecs.xml
 # media_sm7150_version_prop - to choose target version specific media_codecs.xml
-allow qti_init_shell {
-    vendor_media_sm6150_version_prop
-    vendor_media_sm7150_version_prop
-}:property_service set;
+set_prop(qti_init_shell, vendor_media_sm6150_version_prop)
+set_prop(qti_init_shell, vendor_media_sm7150_version_prop)
diff --git a/vendor/sdm660/init_shell.te b/vendor/sdm660/init_shell.te
index 3c09f7a5..e2610d38 100644
--- a/vendor/sdm660/init_shell.te
+++ b/vendor/sdm660/init_shell.te
@@ -25,12 +25,12 @@
 # OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
+# media_sdm660_version_prop - to choose target version specific media_codecs.xml
+set_prop(qti_init_shell, vendor_media_sdm660_version_prop)
+
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
 allow qti_init_shell regionalization_file:file create_file_perms;
 
 #Needed for starting cdsprpcd service post-boot
 set_prop(qti_init_shell, vendor_cdsprpcd_prop)
-allow qti_init_shell {
-    vendor_media_sdm660_version_prop
-}:property_service set;
diff --git a/vendor/sdm710/init_shell.te b/vendor/sdm710/init_shell.te
index 413d6a1f..98b61ee2 100644
--- a/vendor/sdm710/init_shell.te
+++ b/vendor/sdm710/init_shell.te
@@ -26,9 +26,7 @@
 # IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 
 # media_sdm710_version_prop - to choose target version specific media_codecs.xml
-allow qti_init_shell {
-    vendor_media_sdm710_version_prop
-}:property_service set;
+set_prop(qti_init_shell, vendor_media_sdm710_version_prop)
 
 # For regionalization
 allow qti_init_shell regionalization_file:dir r_dir_perms;
diff --git a/vendor/test/fidotest.te b/vendor/test/fidotest.te
index a331dca9..d0adb00d 100644
--- a/vendor/test/fidotest.te
+++ b/vendor/test/fidotest.te
@@ -17,9 +17,6 @@ userdebug_or_eng(`
   #Allow fido test daemons to be registered with service manager
   allow fidotest fidotest_service:service_manager add;
 
-  # Allow communication with init over property server
-  unix_socket_connect(fidotest, property, init);
-
   # Allow access to tee device
   allow fidotest tee_device:chr_file rw_file_perms;
 
diff --git a/vendor/test/qseeproxysample.te b/vendor/test/qseeproxysample.te
index 1e71b7f7..381400ff 100644
--- a/vendor/test/qseeproxysample.te
+++ b/vendor/test/qseeproxysample.te
@@ -45,9 +45,6 @@ userdebug_or_eng(`
   #Allow test daemon to use system_server via binder to check caller identity
   binder_call(qseeproxysample, system_server)
 
-  # Allow communication with init over property server
-  unix_socket_connect(qseeproxysample, property, init);
-
   # Allow access to tee device
   allow qseeproxysample tee_device:chr_file rw_file_perms;
 
-- 
2.17.1

