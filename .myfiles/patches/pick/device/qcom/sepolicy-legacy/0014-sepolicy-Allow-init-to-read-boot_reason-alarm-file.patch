From b046c04be43db84f3d8de8967038d0526f96b8e2 Mon Sep 17 00:00:00 2001
From: "Kevin F. Haggerty" <haggertk@lineageos.org>
Date: Sun, 25 Nov 2018 13:08:53 -0700
Subject: [PATCH 14/14] sepolicy: Allow init to read boot_reason alarm file

Change-Id: Ifb0e93a7b79e9a5354847fa9b63b65b810938d3c
---
 common/file.te        | 3 +++
 common/genfs_contexts | 1 +
 common/init.te        | 3 +++
 3 files changed, 7 insertions(+)

diff --git a/common/file.te b/common/file.te
index ef8ed1a..9e32dbe 100644
--- a/common/file.te
+++ b/common/file.te
@@ -344,3 +344,6 @@ type kgsl_debugfs, debugfs_type, fs_type;
 
 #sysfs emmc dload type
 type sysfs_emmc_dload, sysfs_type, fs_type;
+
+# /proc/sys/kernel/boot_reason, or similar, used by many init extensions
+type proc_boot_reason, fs_type, proc_type;
diff --git a/common/genfs_contexts b/common/genfs_contexts
index f96b3b4..b9e4e88 100644
--- a/common/genfs_contexts
+++ b/common/genfs_contexts
@@ -1,4 +1,5 @@
 genfscon proc /asound/card0/state u:object_r:proc_audiod:s0
+genfscon proc /sys/kernel/boot_reason u:object_r:proc_boot_reason:s0
 genfscon proc /sys/vm/dirty_ratio  u:object_r:proc_dirty_ratio:s0
 genfscon sysfs /module/msm_performance/workload_modes u:object_r:sysfs_msm_perf:s0
 genfscon sysfs /devices/platform/soc/soc:qcom,l3-cdsp/devfreq/soc:qcom,l3-cdsp/userspace u:object_r:sysfs_devfreq_l3cdsp:s0
diff --git a/common/init.te b/common/init.te
index ab6511a..9bd2d4c 100644
--- a/common/init.te
+++ b/common/init.te
@@ -58,3 +58,6 @@ allow init rawdump_block_device:blk_file setattr;
 
 #cpu.rt_period_us and _runtime_us need this
 allow init cgroup:file create;
+
+# allow init extensions to read the boot_reason alarm file
+allow init proc_boot_reason:file r_file_perms;
-- 
2.17.1

