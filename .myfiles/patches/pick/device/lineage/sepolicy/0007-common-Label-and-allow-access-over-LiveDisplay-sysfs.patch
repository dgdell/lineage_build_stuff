From edeadb70aa5de55d9b406f6814fa498d6457839b Mon Sep 17 00:00:00 2001
From: Bruno Martins <bgcngm@gmail.com>
Date: Sat, 24 Nov 2018 22:27:33 +0000
Subject: [PATCH 7/9] common: Label and allow access over LiveDisplay sysfs
 nodes

Change-Id: I57bddaa04ed071b8ab9dcde3d8cdc206c81e3662
---
 common/private/file.te          | 1 +
 common/private/genfs_contexts   | 8 ++++++++
 common/private/init.te          | 5 ++++-
 common/private/system_server.te | 3 +++
 4 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/common/private/file.te b/common/private/file.te
index c039f4a..7a47d08 100644
--- a/common/private/file.te
+++ b/common/private/file.te
@@ -1 +1,2 @@
 type sysfs_io_sched_tuneable, fs_type, sysfs_type;
+type sysfs_livedisplay_tuneable, fs_type, sysfs_type;
diff --git a/common/private/genfs_contexts b/common/private/genfs_contexts
index 97887b9..eed7a2d 100644
--- a/common/private/genfs_contexts
+++ b/common/private/genfs_contexts
@@ -1,4 +1,12 @@
 genfscon fuseblk / u:object_r:vfat:s0
 genfscon sdfat / u:object_r:exfat:s0
 
+genfscon sysfs /devices/virtual/graphics/fb0/aco u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/cabc u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/color_enhance u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/hbm u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/rgb u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/sre u:object_r:sysfs_livedisplay_tuneable:s0
+genfscon sysfs /devices/virtual/graphics/fb0/reading_mode u:object_r:sysfs_livedisplay_tuneable:s0
+
 genfscon sysfs /devices/virtual/timed_output/vibrator u:object_r:sysfs_vibrator:s0
diff --git a/common/private/init.te b/common/private/init.te
index 8ee04d6..cd72a21 100644
--- a/common/private/init.te
+++ b/common/private/init.te
@@ -1 +1,4 @@
-allow init sysfs_io_sched_tuneable:file { setattr w_file_perms };
+allow init {
+    sysfs_io_sched_tuneable
+    sysfs_livedisplay_tuneable
+}:file { setattr w_file_perms };
diff --git a/common/private/system_server.te b/common/private/system_server.te
index 0a3f565..82e25fb 100644
--- a/common/private/system_server.te
+++ b/common/private/system_server.te
@@ -1 +1,4 @@
 allow system_server storage_stub_file:dir getattr;
+
+# Allow LineageHW (running as system server) to access LiveDisplay tuneables
+allow system_server sysfs_livedisplay_tuneable:file rw_file_perms;
-- 
2.17.1

