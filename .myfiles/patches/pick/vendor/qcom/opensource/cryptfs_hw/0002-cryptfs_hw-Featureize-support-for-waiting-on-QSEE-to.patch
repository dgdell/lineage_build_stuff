From 6a9d5b1ff9e69372f1aafc46a5eed5d486f90224 Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Wed, 20 Dec 2017 22:07:16 +0200
Subject: [PATCH 2/4] cryptfs_hw: Featureize support for waiting on QSEE to
 start

* Match keymaster change to support older blobs

Change-Id: I2d45fe60e0f4bf076d064d6c432740af0b3c840c
---
 Android.bp   | 3 +++
 cryptfs_hw.c | 7 +++++++
 2 files changed, 10 insertions(+)

diff --git a/Android.bp b/Android.bp
index 15e9187..0e7f2ee 100644
--- a/Android.bp
+++ b/Android.bp
@@ -21,6 +21,9 @@ cc_library_shared {
             device_legacy_hwfde: {
                 cflags: ["-DLEGACY_HW_DISK_ENCRYPTION"],
             },
+            device_skip_waiting_for_qsee: {
+                cflags: ["-DSKIP_WAITING_FOR_QSEE"],
+            },
         },
     },
 
diff --git a/cryptfs_hw.c b/cryptfs_hw.c
index e231759..b2bd599 100644
--- a/cryptfs_hw.c
+++ b/cryptfs_hw.c
@@ -373,6 +373,12 @@ static unsigned char* get_tmp_passwd(const char* passwd)
     return tmp_passwd;
 }
 
+#ifdef SKIP_WAITING_FOR_QSEE
+int is_qseecom_up()
+{
+    return 1;
+}
+#else
 int is_qseecom_up()
 {
     int i = 0;
@@ -390,6 +396,7 @@ int is_qseecom_up()
     }
     return 0;
 }
+#endif
 
 /*
  * For NON-ICE targets, it would return 0 on success. On ICE based targets,
-- 
2.17.1

