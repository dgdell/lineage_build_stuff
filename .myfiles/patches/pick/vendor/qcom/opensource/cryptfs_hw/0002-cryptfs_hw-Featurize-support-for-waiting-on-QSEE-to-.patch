From 32e36cd23be5c04d978e7d15085a1efaa6f44f5a Mon Sep 17 00:00:00 2001
From: Michael Bestas <mkbestas@lineageos.org>
Date: Wed, 20 Dec 2017 22:07:16 +0200
Subject: [PATCH 2/2] cryptfs_hw: Featurize support for waiting on QSEE to
 start

* Match keymaster change to support older blobs

Change-Id: I2d45fe60e0f4bf076d064d6c432740af0b3c840c
---
 Android.bp   | 3 +++
 cryptfs_hw.c | 7 +++++++
 2 files changed, 10 insertions(+)

diff --git a/Android.bp b/Android.bp
index 12e2aa6..ea6cbb0 100644
--- a/Android.bp
+++ b/Android.bp
@@ -18,6 +18,9 @@ cc_library_shared {
 
     product_variables: {
         lineage: {
+            should_skip_waiting_for_qsee: {
+                cflags: ["-DSKIP_WAITING_FOR_QSEE"],
+            },
             supports_legacy_hw_fde: {
                 cflags: ["-DLEGACY_HW_DISK_ENCRYPTION"],
             },
diff --git a/cryptfs_hw.c b/cryptfs_hw.c
index 4aede03..9c354b9 100644
--- a/cryptfs_hw.c
+++ b/cryptfs_hw.c
@@ -375,6 +375,12 @@ static unsigned char* get_tmp_passwd(const char* passwd)
     return tmp_passwd;
 }
 
+#ifdef SKIP_WAITING_FOR_QSEE
+int is_qseecom_up()
+{
+    return 1;
+}
+#else
 int is_qseecom_up()
 {
     int i = 0;
@@ -392,6 +398,7 @@ int is_qseecom_up()
     }
     return 0;
 }
+#endif
 
 /*
  * For NON-ICE targets, it would return 0 on success. On ICE based targets,
-- 
2.17.1

