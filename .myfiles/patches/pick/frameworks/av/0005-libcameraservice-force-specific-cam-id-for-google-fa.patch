From d2ba437d594c6ecc53fa433256578b6929d0f602 Mon Sep 17 00:00:00 2001
From: TheScarastic <warabhishek@gmail.com>
Date: Tue, 27 Nov 2018 02:53:21 -0500
Subject: [PATCH 5/5] libcameraservice: force specific cam id for google face
 unlock

Change-Id: I07d5ee39eff3ede13811b3f9c6e617f7a3bac21e

# Conflicts:
#	services/camera/libcameraservice/Android.mk
---
 services/camera/libcameraservice/Android.mk        | 4 ++++
 services/camera/libcameraservice/CameraService.cpp | 8 ++++++++
 2 files changed, 12 insertions(+)

diff --git a/services/camera/libcameraservice/Android.mk b/services/camera/libcameraservice/Android.mk
index b54e28e84..3936721ce 100644
--- a/services/camera/libcameraservice/Android.mk
+++ b/services/camera/libcameraservice/Android.mk
@@ -112,6 +112,10 @@ ifneq ($(TARGET_CAMERA_NEEDS_ADD_STATES_IN_ENUMERATE),)
     LOCAL_CFLAGS += -DCAMERA_NEEDS_ADD_STATES_IN_ENUMERATE
 endif
 
+ifneq ($(TARGET_FACE_UNLOCK_CAMERA_ID),)
+    LOCAL_CFLAGS += -DFACE_UNLOCK_CAMERA_ID=$(TARGET_FACE_UNLOCK_CAMERA_ID)
+endif
+
 LOCAL_MODULE:= libcameraservice
 
 include $(BUILD_SHARED_LIBRARY)
diff --git a/services/camera/libcameraservice/CameraService.cpp b/services/camera/libcameraservice/CameraService.cpp
index 0716af4d8..4dc536c51 100644
--- a/services/camera/libcameraservice/CameraService.cpp
+++ b/services/camera/libcameraservice/CameraService.cpp
@@ -1231,6 +1231,14 @@ Status CameraService::connect(
     Status ret = Status::ok();
 
     String8 id = cameraIdIntToStr(api1CameraId);
+
+#ifdef FACE_UNLOCK_CAMERA_ID
+    if (strcmp16(clientPackageName, String16("com.android.facelock")) == 0 &&
+           api1CameraId == 1) {
+        id = cameraIdIntToStr(FACE_UNLOCK_CAMERA_ID);
+    }
+#endif
+
     sp<Client> client = nullptr;
     ret = connectHelper<ICameraClient,Client>(cameraClient, id, api1CameraId,
             CAMERA_HAL_API_VERSION_UNSPECIFIED, clientPackageName, clientUid, clientPid, API_1,
-- 
2.17.1

