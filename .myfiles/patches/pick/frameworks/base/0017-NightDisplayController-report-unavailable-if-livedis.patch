From 99db61f5297a47e2c3f4306f7cb5b18e96d429ff Mon Sep 17 00:00:00 2001
From: Dan Pasanen <dan.pasanen@gmail.com>
Date: Tue, 20 Feb 2018 07:51:43 -0600
Subject: [PATCH 17/57] NightDisplayController: report unavailable if
 livedisplay feature is present

Change-Id: Id677e76d452ced2e62373337d63593c7b85f2fba
---
 .../com/android/internal/app/ColorDisplayController.java    | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/core/java/com/android/internal/app/ColorDisplayController.java b/core/java/com/android/internal/app/ColorDisplayController.java
index ba6cf269b73..a85457e630e 100644
--- a/core/java/com/android/internal/app/ColorDisplayController.java
+++ b/core/java/com/android/internal/app/ColorDisplayController.java
@@ -558,10 +558,12 @@ public final class ColorDisplayController {
     }
 
     /**
-     * Returns {@code true} if Night display is supported by the device.
+     * Returns {@code true} if Night display is supported by the device,
+     * unless LiveDisplay feature is available.
      */
     public static boolean isAvailable(Context context) {
-        return context.getResources().getBoolean(R.bool.config_nightDisplayAvailable);
+        return context.getResources().getBoolean(R.bool.config_nightDisplayAvailable) &&
+                !context.getPackageManager().hasSystemFeature("org.lineageos.livedisplay");
     }
 
     /**
-- 
2.17.1

