From 4ff6c2b8ff0ca353bb96bf87fffcdbc3ae50a26b Mon Sep 17 00:00:00 2001
From: nx111 <NX111.AimH@gmail.com>
Date: Mon, 12 Nov 2018 13:08:03 +0800
Subject: [PATCH 14/14] Revert "Don't turn off signal strength update in power
 save mode."

This reverts commit 622798d4e39ee7e8b0b946e0068dcfdf1ee73f05.

Change-Id: I45f63721ed29579b0f1047446f2bb3a8d9b7c629
---
 .../internal/telephony/DeviceStateMonitor.java  | 17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/src/java/com/android/internal/telephony/DeviceStateMonitor.java b/src/java/com/android/internal/telephony/DeviceStateMonitor.java
index 92a78f77f..2eb0a9bed 100644
--- a/src/java/com/android/internal/telephony/DeviceStateMonitor.java
+++ b/src/java/com/android/internal/telephony/DeviceStateMonitor.java
@@ -208,13 +208,18 @@ public class DeviceStateMonitor extends Handler {
      * @return True if low data is expected
      */
     private boolean isLowDataExpected() {
-        return !mIsCharging && !mIsTetheringOn && !mIsScreenOn;
+        return mIsPowerSaveOn || (!mIsCharging && !mIsTetheringOn && !mIsScreenOn);
     }
 
     /**
      * @return True if signal strength update should be turned off.
      */
     private boolean shouldTurnOffSignalStrength() {
+        // We don't want to get signal strength update when the device is in power save mode.
+        if (mIsPowerSaveOn) {
+            return true;
+        }
+
         // We should not turn off signal strength update if one of the following condition is true.
         // 1. The device is charging.
         // 2. When the screen is on.
@@ -236,6 +241,11 @@ public class DeviceStateMonitor extends Handler {
      * trigger the network update unsolicited response.
      */
     private boolean shouldTurnOffFullNetworkUpdate() {
+        // We don't want to get full network update when the device is in power save mode.
+        if (mIsPowerSaveOn) {
+            return true;
+        }
+
         // We should not turn off full network update if one of the following condition is true.
         // 1. The device is charging.
         // 2. When the screen is on.
@@ -255,6 +265,11 @@ public class DeviceStateMonitor extends Handler {
      * @return True if data dormancy status update should be turned off.
      */
     private boolean shouldTurnOffDormancyUpdate() {
+        // We don't want to get dormancy status update when the device is in power save mode.
+        if (mIsPowerSaveOn) {
+            return true;
+        }
+
         // We should not turn off data dormancy update if one of the following condition is true.
         // 1. The device is charging.
         // 2. When the screen is on.
-- 
2.17.1

