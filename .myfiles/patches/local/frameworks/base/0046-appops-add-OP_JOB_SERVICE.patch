From d0b4338e207382082d120665a0feab1dc8e9c6f3 Mon Sep 17 00:00:00 2001
From: nx111 <NX111.AimH@gmail.com>
Date: Sun, 4 Nov 2018 16:20:58 +0800
Subject: [PATCH 46/47] appops: add OP_JOB_SERVICE

Change-Id: Ia89855498308dcf7e9eeb88d8225a46bd02fdee3
---
 core/java/android/app/AppOpsManager.java | 20 ++++++++++++++++++--
 1 file changed, 18 insertions(+), 2 deletions(-)

diff --git a/core/java/android/app/AppOpsManager.java b/core/java/android/app/AppOpsManager.java
index 208e7e5745d..d42362e5a68 100644
--- a/core/java/android/app/AppOpsManager.java
+++ b/core/java/android/app/AppOpsManager.java
@@ -374,8 +374,10 @@ public class AppOpsManager {
     public static final int OP_DATA_CONNECT_CHANGE = 81;
     /** @hide SU access */
     public static final int OP_SU = 82;
+    /** @hide bind JOB Service */
+    public static final int OP_JOB_SERVICE = 83;
     /** @hide */
-    public static final int _NUM_OP = 83;
+    public static final int _NUM_OP = 84;
 
     /** Access to coarse location information. */
     public static final String OPSTR_COARSE_LOCATION = "android:coarse_location";
@@ -631,6 +633,9 @@ public class AppOpsManager {
     /** @hide */
     public static final String OPSTR_SU = "android:su";
 
+    /** @hide */
+    public static final String OPSTR_JOB_SERVICE = "android:job_service";
+
     // Warning: If an permission is added here it also has to be added to
     // com.android.packageinstaller.permission.utils.EventLogger
     private static final int[] RUNTIME_AND_APPOP_PERMISSIONS_OPS = {
@@ -679,7 +684,8 @@ public class AppOpsManager {
             OP_WRITE_SETTINGS,
             OP_REQUEST_INSTALL_PACKAGES,
             OP_START_FOREGROUND,
-            OP_SU
+            OP_SU,
+            OP_JOB_SERVICE
     };
 
     /**
@@ -774,6 +780,7 @@ public class AppOpsManager {
             OP_NFC_CHANGE,                      // NFC_CHANGE
             OP_DATA_CONNECT_CHANGE,             // DATA_CONNECT_CHANGE
             OP_SU,                              // SU
+            OP_JOB_SERVICE,                     // JOB_SERVICE
     };
 
     /**
@@ -863,6 +870,7 @@ public class AppOpsManager {
             OPSTR_NFC_CHANGE,
             OPSTR_DATA_CONNECT_CHANGE,
             OPSTR_SU,
+            OPSTR_JOB_SERVICE
     };
 
     /**
@@ -953,6 +961,7 @@ public class AppOpsManager {
             "NFC_CHANGE",
             "DATA_CONNECT_CHANGE",
             "SU",
+            "JOB_SERVICE"
     };
 
     /**
@@ -1043,6 +1052,7 @@ public class AppOpsManager {
             Manifest.permission.NFC,
             null,
             null, // no permission for OP_SU
+            Manifest.permission.BIND_JOB_SERVICE
     };
 
     /**
@@ -1134,6 +1144,7 @@ public class AppOpsManager {
             null, // NFC_CHANGE
             null, // DATA_CONNECT_CHANGE
             UserManager.DISALLOW_SU, // SU TODO: this should really be investigated.
+            null, // JOB_SERVICE
     };
 
     /**
@@ -1224,6 +1235,7 @@ public class AppOpsManager {
             true, // NFC_CHANGE
             true, // DATA_CONNECT_CHANGE
             false, // SU
+            false, // JOB_SERVICE
     };
 
     /**
@@ -1313,6 +1325,7 @@ public class AppOpsManager {
             AppOpsManager.MODE_ALLOWED,  // OP_NFC_CHANGE
             AppOpsManager.MODE_ALLOWED,  // OP_DATA_CONNECT_CHANGE
             AppOpsManager.MODE_ASK,      // OP_SU
+            AppOpsManager.MODE_ALLOWED,  // OP_JOB_SERVICE
     };
 
     /**
@@ -1403,6 +1416,7 @@ public class AppOpsManager {
             AppOpsManager.MODE_ASK,     // OP_NFC_CHANGE
             AppOpsManager.MODE_ASK,     // OP_DATA_CONNECT_CHANGE
             AppOpsManager.MODE_ASK,     // OP_SU
+            AppOpsManager.MODE_ALLOWED, // OP_JOB_SERVICE
     };
 
     /**
@@ -1492,6 +1506,7 @@ public class AppOpsManager {
             true,  // NFC_CHANGE
             true,  // DATA_CONNECT_CHANGE
             true,  // SU
+            false, // JOB_SERVICE
     };
 
     /**
@@ -1585,6 +1600,7 @@ public class AppOpsManager {
             false, // OP_NFC_CHANGE
             false, // OP_DATA_CONNECT_CHANGE
             false, // OP_SU
+            false, // OP_JOB_SERVICE
     };
 
     /**
-- 
2.17.1

